window.FH_VERSION='0.9.0.1';;(function(){'use strict';window.configure=function(application){var configuration=window.slipstream?window.slipstream.configuration:"unknown";application.factory('$exceptionHandler',[function(){return function(exception,cause){var stackTrace=_.isArray(exception.stack)?exception.stack.join('\n'):exception.stack;var message='$exceptionHandler: uncaught exception '+exception.message;if(cause){message+=' (caused by "'+cause+'")';exception.message+=' (caused by "'+cause+'")';}
console.error(message,stackTrace||'(no stack trace)');};}]);application.config(['$animateProvider','$compileProvider','$injector','$interpolateProvider','$httpProvider','$locationProvider','$sceProvider','$qProvider','convertProvider',function($animateProvider,$compileProvider,$injector,$interpolateProvider,$httpProvider,$locationProvider,$sceProvider,$qProvider,convert){$compileProvider.debugInfoEnabled(configuration!=='production');$locationProvider.html5Mode(true);$locationProvider.hashPrefix('!');$interpolateProvider.startSymbol('[[');$interpolateProvider.endSymbol(']]');$interpolateProvider.staticStartSymbol('[!');$interpolateProvider.staticEndSymbol('!]');$httpProvider.defaults.transformResponse.push(function(data){return convert.serverResponse(data);});$httpProvider.defaults.transformRequest.unshift(function(data){return convert.clientRequest(data);});$httpProvider.defaults.xsrfCookieName='csrftoken';$httpProvider.defaults.xsrfHeaderName='X-CSRFToken';$httpProvider.defaults.headers.common['X-Requested-With']='XMLHttpRequest';$httpProvider.defaults.headers.common['X-CSRFToken']=window.slipstream.csrfToken||'';$animateProvider.classNameFilter(/\banimatable\b/);$qProvider.errorOnUnhandledRejections(false);}]);application.run(['$filter','$browser','$injector','$interpolate','$rootScope',function($filter,$browser,$injector,$interpolate,$rootScope){window.$$injector=$injector;$rootScope.isReadonlyEnabled=window.slipstream.isReadonlyEnabled;$rootScope.max=Math.max;$rootScope.addClassIf=$filter('addClassIf');$rootScope.isUndefined=$filter('isUndefined');$rootScope.DESKTOP_MIN_WIDTH=680;$rootScope.T=window.T;$rootScope.cT=window.cT;$rootScope.nT=window.nT;$rootScope.ncT=window.ncT;$rootScope.interpolate=interpolate;$rootScope.msie=document.documentMode;$rootScope.$bind=function(dst,src){var scope=this;var bind=function(){var value=_.get(scope,src);_.set(scope,dst,value);};bind();scope.$watch(bind);};$rootScope.$model=function(model){var fn=_.bind(model,model,this);fn.assign=_.bind(model.assign,model,this);return fn;};$rootScope.$once=function(event,fn){var unregister=this.$on(event,function(){unregister();return fn.apply(this,arguments);});return unregister;};$rootScope.isSet=function(expr){if(_.isUndefined(expr)){return false;}
if(expr===''){return true;}
return this.$eval(expr);};var _$new=$rootScope.$new;$rootScope.$new=function(isolate,parent){if(isolate){return _$new.call(this,false,this.$root);}
else{return _$new.call(this,isolate,parent);}};$rootScope.$safeApply=function(fn){if(!this.$root){return;}
var phase=this.$root.$$phase;if(phase=='$apply'||phase=='$digest'){return fn&&fn();}else{return this.$apply(fn);}};$rootScope.$safeDigest=function(){if(!this.$root){return;}
var phase=this.$root.$$phase;if(phase=='$apply'||phase=='$digest'){return;}
this.$digest();};var FOREVER=365*24*60*60*1000;$rootScope.$asyncApply=function(fn){var p=$browser.defer(_.ignore,FOREVER);var done=function(){$browser.defer.cancel(p);};fn(done);return done;};$rootScope.$interpolate=function(text,extra){var scope=this;var destroy=false;if(extra){scope=scope.$new();_.extend(scope,extra);destroy=true;}
if(_.isUndefined(text)){return'';}
var fn=$interpolate(text);if(!fn){return'';}
var result=fn(scope);if(destroy){scope.$destroy();}
return result;};window.$$digest=function(count,scope){var element=angular.element(document.querySelector('[ng-app]'));scope=scope||element.injector().get('$rootScope');count=count||100;console.info('digest: running '+count+'...');var time=performance.now();for(var i=0;i<count;i++){scope.$digest();}
var finalTime=performance.now();console.info('digest: average time '+((finalTime-time)/count)+'ms');var watcherCount=0;var currentScope=scope;var nextScope;do{watcherCount+=currentScope.$$watchers?currentScope.$$watchers.length:0;if(!(nextScope=(currentScope.$$childHead||(currentScope!==scope&&currentScope.$$nextSibling)))){while(currentScope!==scope&&!(nextScope=currentScope.$$nextSibling)){currentScope=currentScope.$parent;}}}while((currentScope=nextScope));console.info('digest: watcher count',watcherCount);};window.$$scope=function(element){return angular.element(element).scope();};}]);};})();;/*! For license information please see cart-embed-bundle.js.LICENSE.txt */!function(){var e={305:function(){!function(){"use strict";var e=angular.module("auth.controllers",["lib","navigation"]);e.controller("auth.LoginProviderErrorCtrl",["$scope","navigation",function(e,t){var n=t.get("status")||"",r=t.get("message")||T("Unable to log in via single sign-on.");t.clear("status",!0),t.clear("message",!0),e.errorMessage="","error"===n&&(e.errorMessage=r)}]),e.controller("auth.LoginCtrl",["$scope","navigation","urls",function(e,t,n){var r=function(e){return e.replace(/\s+/g,"").toLowerCase()},i=t.get("shortname")||"";e.credentials={shortname:i},e.isSessionExpired=t.get("isSessionExpired")||!1,t.clear("isSessionExpired",!0);var a=t.get("next");e.submit=function(i){if(e.credentials.shortname){var o=n.populate(n.company.login,{shortname:r(e.credentials.shortname)});a&&(o=t.compose(o,{next:a})),t.navigate(o)}}}]),e.controller("auth.CompanyLoginCtrl",["$scope","auth","db","navigation","urls",function(e,t,n,r,i){var a=r.currentCompany?r.currentCompany.shortname:"",o=r.get("username")||"";r.clear("username",!0),e.isSessionExpired=r.get("isSessionExpired")||!1,r.clear("isSessionExpired",!0),e.credentials={shortname:a,username:o,password:""},e.isForceReloadingAfterSuccess=!1;var s=r.get("next"),c="yes"===r.get("require");if(!c&&t.currentUser.isAuthenticated&&a===t.currentUser.company.shortname)return r.redirect(s||t.currentUser.company.$url(i.dashboard.index),"replace"),void(e.isForceReloadingAfterSuccess=!0);if(e.differentCompanyLoginUrl=i.root.login,s){var l={next:s};c&&(l.require="yes"),e.differentCompanyLoginUrl=r.compose(e.differentCompanyLoginUrl,l)}e.submit=function(a){t.login(e.credentials,a).then((function(){var a=s||t.currentUser.company.$url(i.dashboard.index);e.isForceReloadingAfterSuccess=(n.slipstream("targetLanguage")||"")!==e.company.language,r.navigate(a,null,e.isForceReloadingAfterSuccess)}),(function(t){if(t.data.passwordChangeToken){var n={token:t.data.passwordChangeToken,shortname:e.credentials.shortname,username:e.credentials.username,isPasswordChangeRequired:!0},a=r.compose(i.root.forgot.resetPassword,n);r.navigate(a)}else e.credentials.password=""}))},e.providerLogin=function(){e.isForceReloadingAfterSuccess=!0;var t=r.currentCompany.$url(i.api.providerLogin);s&&(t=r.compose(t,{next:s})),r.navigate(t,"extend",!0)},e.LOGIN_PROVIDER_OPTION="login-provider",e.FAREHARBOR_OPTION="fareharbor",e.isShowingLoginOptions=r.currentCompany.features.isLoginProviderEnabled&&!r.currentCompany.features.isLoginProviderRequired,e.currentLoginOption=e.isShowingLoginOptions?"":r.currentCompany.features.isLoginProviderEnabled?e.LOGIN_PROVIDER_OPTION:e.FAREHARBOR_OPTION,e.selectLoginOption=function(t){e.currentLoginOption=t||""}}]),e.controller("auth.ForgotPasswordCtrl",["$scope","db","flash","navigation","urls",function(e,t,n,r,i){var a=r.get("shortname")||"";r.clear("shortname",!0);var o=r.get("username")||"";r.clear("username",!0),e.alreadyHasCompany=!!a,e.credentials={shortname:a,username:o},e.submit=function(a){t.forgot.password({},e.credentials,a).$promise.then((function(){n.success(T("An email has been sent to the address associated with this account.")),r.navigate(i.root.login)}))}}]),e.controller("auth.ResetPasswordCtrl",["$scope","auth","clientOptions","db","flash","navigation","urls",function(e,t,n,r,i,a,o){var s=a.get("shortname")||"";a.clear("shortname",!0);var c=a.get("username")||"";a.clear("username",!0);var l,u=a.get("token")||"";if(a.clear("token",!0),n.preview&&((l={}).preview=n.preview),e.isPasswordChangeRequired=!!a.get("isPasswordChangeRequired"),a.clear("isPasswordChangeRequired",!0),e.company=r.company({shortname:s},null,null,l),!s||!c||!u)return i.error(T("Bad password reset link")),void a.navigate(o.root.login);e.credentials={token:u,username:c,shortname:s,password:""},e.submit=function(n){r.forgot.password.reset({shortname:s},e.credentials,n).$promise.then((function(){i.success(T("Your password has been changed.")),t.login(e.credentials,n).then((function(){var n=a.get("next")||t.currentUser.company.$url(o.dashboard.index),i=(r.slipstream("targetLanguage")||"")!==e.company.language;a.navigate(n,null,i)}),(function(){e.credentials.password=""}))}))}}]),e.controller("auth.ForgotCredentialsCtrl",["$scope","db","flash","navigation","urls",function(e,t,n,r,i){e.credentials={email:""},e.submit=function(a){var o=e.credentials.email;t.forgot.credentials({},e.credentials,a).$promise.then((function(){n.success(T("We emailed you at")+" <b>"+o+"</b>."),r.navigate(i.root.login)}))}}])}()},8784:function(){!function(){"use strict";angular.module("auth.directives",[]).config(["$compileProvider","d",function(e,t){var n=function(n,r){if(!r.parse||!r.permission)throw new Error("auth: "+n+": invalid directive definition");var i=function(e,t){return!t.ngCanOnce||e.$eval(t.ngCanOnce)};return e.directive(n,t.conditionalDirective({name:n,watch:["$injector","$parse","auth",function(e,a,o){var s=t.safeInvoke(e,r.permission),c=t.safeInvoke(e,r.parse);return function(e,t,r){var o,l=c(r),u=r.ngCanOnlyWhen?a(r.ngCanOnlyWhen):_.always,d=r.ngCanAlsoWhen?a(r.ngCanAlsoWhen):_.never,m=i(e,r),p=!0;return function(){try{return!!d(e)||!!u(e)&&(m&&!p?t=o:(t=o=s(l(e)),p=!1),t);var t}catch(e){throw console.error("auth: "+n+": error checking permission for arguments: "+r[n]),e}}}}],once:function(e,t,n){return!n.ngCanOnlyWhen&&!n.ngCanAlsoWhen&&i(e,n)},operator:function(e,t,n){return function(t){return n.ngThen&&(e[n.ngThen]=t),t}}}))},r=function(e,t){return n(e,{parse:["$parse",function(t){return function(n){return t(n[e])}}],permission:["auth",function(e){return function(n){return e.permissions.can(t.permission,n)}}]})};r("ngCanView",{permission:"view"}),r("ngCanUpdate",{permission:"update"}),r("ngCanRemove",{permission:"remove"}),r("ngCanAdminView",{permission:"adminView"}),r("ngCanAdminUpdate",{permission:"adminUpdate"}),r("ngCanViewAmounts",{permission:"viewAmounts"}),r("ngCanViewDashboardSection",{permission:"viewDashboardSection"}),r("ngCanViewAdminSection",{permission:"viewAdminSection"}),r("ngCanViewManifestSection",{permission:"viewManifestSection"}),r("ngCanViewInvoiceAmounts",{permission:"viewInvoiceAmounts"});var i=function(e,t){return n(e,{parse:["$parse",function(t){return function(n){var r=n[e].match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s*$/);if(!r)throw new Error("auth: "+e+": expected expression of the form '_type_ on _object_'");var i=r[1],a=t(r[2]);return function(e){return{cls:i,owner:a(e)}}}}],permission:["auth",function(e){return function(n){return e.permissions.can(t.permission,n.cls,n.owner)}}]})};i("ngCanCreate",{permission:"create"}),i("ngCanList",{permission:"list"}),i("ngCanClear",{permission:"update"}),i("ngCanAdminCreate",{permission:"adminCreate"}),i("ngCanAdminList",{permission:"adminList"}),n("ngCan",{parse:["$parse",function(e){return function(t){var n=t.ngCan.match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s*$/),r=t.ngCan.match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s+with\s+([\s\S]+)\s*$/);if(!n&&!r)throw new Error("auth: ng-can: expected expression of the form '_type_ on _object_' or '_type_ on _model_ with _object_'");var i=n[1],a=_.never,o=_.never;return r?(a=e(r[2]),o=e(r[3])):o=e(n[2]),function(e){return{permission:i,object:o(e),cls:a(e)}}}}],permission:["auth",function(e){return function(t){return t.cls?e.permissions.can(t.permission,t.cls,t.object):e.permissions.can(t.permission,t.object)}}]}),n("ngCanAny",{parse:["$parse",function(e){return function(t){var n,r,i=e(t.ngCanAny);return t.ngCanAnyWith?(n=e(t.ngCanAnyOn),r=e(t.ngCanAnyWith)):(n=_.never,r=e(t.ngCanAnyOn)),function(e){return{permissions:i(e),object:r(e),cls:n(e)}}}}],permission:["auth",function(e){return function(t){return t.cls?_.any(t.permissions,(function(n){return e.permissions.can(n,t.cls,t.object)})):_.any(t.permissions,(function(n){return e.permissions.can(n,t.object)}))}}]})}])}()},6270:function(){!function(){"use strict";var e=angular.module("auth.services",["db.services","lib.services","urls.services"]);e.factory("auth",["$browser","$http","$injector","$q","$rootScope","$timeout","convert","db","events","models","sessionStorage","storage","urls",function(e,t,n,r,i,a,o,s,c,l,u,d,m){var p=["canUpdateOnlyFutureBookings","canViewOnlyCrewedAvailabilities"],f=["canView","canList"],h=s.slipstream("isReadonlyEnabled"),g={isAuthenticated:!1},y={},v=function(e){var t=H.currentUser;return(e=e||t.company)&&t.isAuthenticated&&t.company&&t.company===e},T=function(){var e=H.currentUser;return e.isAuthenticated&&e.company&&e.company.isAdmin},E=function(e){return e.affiliation&&e.affiliation.affiliateCompany===H.currentUser.company},b={},C={},k=function(e,t){if(H.currentUser.isAuthenticated){var n=t.uri,r=C[n];return _.isUndefined(r)?(r=P(e,t),C[n]=r,r):r}},A=function(){C={}};c.on(i,"auth.login",A),c.on(i,"auth.logout",A),c.on(i,"auth.clearEffectiveGroupCache",A);var P=function(e,t){var n,r;if(H.currentUser.company===t)n=H.currentUser.group;else if(H.currentUser.company.isAdmin)(n=H.currentUser.adminGroup)&&!function(e,t){var n=e.conditions.maxCompanyTier;if(_.isNumber(n)){var r=t.features?t.features.tier:null;if(_.isNumber(r)&&r>n)return!1}return!0}(n,t)&&(n=null);else if(H.currentUser.company.isAffiliate){var i=_.findWhere(H.currentUser.company.partners,{company:t});H.currentUser.partnerGroup&&i&&i.affiliateGroup&&(r={groupPermissions:_.omit(i.affiliateGroup.groupPermissions,(function(e,t){return!(e&&_.get(H.currentUser.partnerGroup.groupPermissions,t,!1))}))},_.forEach(p,(function(e){(i.affiliateGroup.groupPermissions[e]||H.currentUser.partnerGroup.groupPermissions[e])&&(r.groupPermissions[e]=!0)})))}if(!n){var a=_.findWhere(H.currentUser.relatedGroupOverrides,{company:t});a||(a=_.findWhere(H.currentUser.company.relatedGroupOverrides,{company:t,relatedUser:null})),a&&(n=a.group||H.currentUser.group)}if(n=n||r)return n;console.warn("auth: user with no effective group",H.currentUser,e,t)},S=function(e){if(!e)throw console.error("auth: invalid permission",this,e,this.cls),new Error("auth: invalid permission");if(e="can"+_.capitalize(e),F.call(this,e)){var t=b[this.cls][e];return t?U.call(this,t):(console.error("auth: invalid permission configuration",this,e,b,t),!1)}return!1},O=function(e){var t,n,r;if(2===arguments.length?(n=(t=arguments[1])?t.cls:"",r=l.Company.forObject(t)):3===arguments.length?(t=null,(n=arguments[1])&&!_.isString(n)&&(n=n.cls),r=arguments[2]):console.error("auth: invalid arguments when checking permission",arguments),_.isUndefined(t))throw console.error("auth: invalid object when checking permission",e,t),new Error("auth: invalid object when checking permission "+e);if(!n)throw console.error("auth: invalid class when checking permission",e,n,r),new Error("auth: invalid class when checking permission "+e);if(!r)throw console.error("auth: invalid owner when checking permission",e,n,r),new Error("auth: invalid owner when checking permission "+e);var i=l.Company.forObject(r);if(!i)throw console.error("auth: invalid company when checking permission",e,n,r,t),new Error("auth: invalid company when checking permission "+e);var a=k(t,i),o=a?a.groupPermissions:{},s={company:i,instance:t,owner:r,cls:n,group:a,permissions:o,can:S};i!==r&&(s[_.uncapitalize(r.cls)]=r);var c=b[n].init;return c&&c.call(s),S.call(s,e)},I=function(e){return function(){var t=_.toArray(arguments);return t.unshift(e),O.apply(this,t)}};y.canView=I("view"),y.canUpdate=I("update"),y.canRemove=I("remove"),y.canAdminView=I("adminView"),y.canAdminUpdate=I("adminUpdate"),y.canCreate=I("create"),y.canList=I("list"),y.canAdminCreate=I("adminCreate"),y.canAdminList=I("adminList"),y.can=O;var R=function(e,t,n){t=t||!1,n=_.isUndefined(n)?t:n;var r="canView"+(e=_.capitalize(e)),i="canEdit"+e,a="canEditPrivateProperties"+e,o="canViewPrivateProperties"+e;return{canView:function(){return!!t||this.permissions[r]},canList:function(){return!!n||this.permissions[r]},canCreate:i,canUpdate:i,canRemove:i,canClear:i,canAdminUpdate:a,canAdminCreate:a,canAdminView:o,canAdminList:o}},N=function(e,t){if(!this||!this.permissions)throw console.error("auth: this context needed to check canUpdatePastBooking",this),new Error("auth: this context needed");if(!(e=e||this.booking))throw console.error("auth: booking reference needed to check canUpdatePastBooking",this),new Error("auth: booking reference needed");return t&&e.availability.company.features.isLimitedPastBookingUpdatesEnabled||!this.permissions.canUpdateOnlyFutureBookings||!l.Availability.isInPast(e.availability)},w=function(e,t){var n=(t=t||{}).field||"booking";e=_.capitalize(e);var r=t.permissionOverrides||{},i=!!_.isUndefined(t.checkPastBooking)||t.checkPastBooking,a=t.isLimitedPastBookingUpdate||!1,o=r.canView||"canView"+e,s=r.canList||"canView"+e,c=r.canCreate||"canEdit"+e,l=r.canUpdate||"canEdit"+e,u=r.canRemove||"canEdit"+e;return _.extend(R(e,t.canAlwaysView,t.canAlwaysList),{init:function(){this.instance&&(this.booking=_.getDotted(this.instance,n))},canView:function(){return!this.group||!!O("view",this.booking)&&this.permissions[o]},canList:function(){return!this.group||!!O("view",this.booking)&&this.permissions[s]},canCreate:function(){return!!O("update",this.booking)&&!(this.booking&&i&&!N.call(this,this.booking,a))&&this.permissions[c]},canUpdate:function(){return!!O("update",this.booking)&&!(i&&!N.call(this,this.booking,a))&&this.permissions[l]},canRemove:function(){return!!O("update",this.booking)&&!(i&&!N.call(this,this.booking,a))&&this.permissions[u]}})},U=function(e){return _.isFunction(e)?e.apply(this):_.isString(e)?this.permissions[e]||!1:void 0},F=function(e){return!(h&&!_.find(f,(function(t){return 0===e.indexOf(t)})))},D=function(e,t){return function(){e=_.isArray(e)?e:[e];var n=!0,r=_.clone(this);return r.cls=r.company.cls,!!F.call(this,t)&&(_.forEach(e,(function(e){if(!r.can(e)||!F.call(this,e))return n=!1,!1})),n&&U.call(this,t))}};b[l.Company.cls]=R("company",!0),b[l.Company.cls].canCreate=function(){return!!T()&&this.permissions.canEditCompanies},b[l.Company.cls].canRemove=function(){return this.instance!==H.currentUser.company&&this.can("create")},b[l.Company.cls].canUpdateCompanyWebsite="canEditCompany",b[l.Company.cls].canUpdateCompanyPayments=D("viewAmounts","canEditAccounting"),b[l.Company.cls].canEditAccounting=D("viewAmounts","canEditAccounting"),b[l.Company.cls].canEditTransportation="canEditTransportation",b[l.Company.cls].canDuplicateAcrossCompanies=function(){return H.currentUser.company.isAdmin&&this.permissions.canEditTransportation},b[l.Company.cls].canViewAmounts=function(){return!this.group&&!H.currentUser.isAuthenticated||this.permissions.canViewAmounts},b[l.Company.cls].canViewInvoiceAmounts="canViewInvoiceAmounts",b[l.Company.cls].canViewPricing=D("viewAmounts","canViewSheets"),b[l.Company.cls].canUpdatePricing=D("viewAmounts","canEditPricing"),b[l.Company.cls].canViewAdminSection=function(){return!!H.currentUser.isAuthenticated&&H.currentUser.company.isAdmin&&this.permissions.canViewAdminSection},b[l.Company.cls].canViewDashboardSection="canViewDashboardSection",b[l.Company.cls].canViewItemsSection="canViewItemsSection",b[l.Company.cls].canViewSettingsSection="canViewSettingsSection",b[l.Company.cls].canViewBookingsSection="canViewBookingsSection",b[l.Company.cls].canViewManifestSection="canViewManifestSection",b[l.Company.cls].canSkipContactName=function(){return T()||this.permissions.canSkipContactName},b[l.Company.cls].canViewReports="canViewReports",b[l.Company.cls].canViewNetworkSettings="canViewNetworkSettings",b[l.Company.cls].canCancel=function(){return this.permissions.canCancelBookings},b[l.Company.cls].canCancelEligible=function(){return this.permissions.canCancelEligibleBookings},b[l.Company.cls].canAdminUpdatePaymentSettings=function(){return T()&&this.can("update")&&this.permissions.canEditPrivatePropertiesCompanyPayments},b[l.Company.cls].canEditSheets="canEditSheets",b[l.TagGroup.cls]=R("tags",!0);var L=function(){return!!T()&&!!this.company.isAdmin&&this.permissions.canEditTags};b[l.TagGroup.cls].canCreate=L,b[l.TagGroup.cls].canUpdate=L,b[l.TagGroup.cls].canRemove=L,b[l.Tag.cls]=b[l.TagGroup.cls],b[l.TagInstance.cls]=R("tagInstances",!0);var M=function(){return!!T()&&!!O("update",this.owner)&&this.permissions.canEditTagInstances};b[l.TagInstance.cls].canCreate=M,b[l.TagInstance.cls].canUpdate=M,b[l.TagInstance.cls].canRemove=M,b[l.CustomManifest.cls]=R("customManifests"),b[l.CustomCalendar.cls]=R("customCalendars"),b[l.CustomReport.cls]=R("customReports"),b[l.Role.cls]=R("roles"),b[l.CrewMember.cls]=R("crewMembers"),b[l.CrewMember.cls].canCreateSelfAssignable="canEditCrewMembersSelfAssignable";var x,B=function(){return this.instance.user===H.currentUser&&this.permissions.canEditCrewMembersSelfAssignable};b[l.CrewMember.cls].canUpdate=function(){return!!this.permissions.canEditCrewMembers||B.call(this)},b[l.CrewMember.cls].canRemove=function(){return!!this.permissions.canEditCrewMembers||B.call(this)},b[l.CrewMember.cls].canCreate=function(){return this.permissions.canEditCrewMembers},b[l.Group.cls]=R("groups"),b[l.GroupOverride.cls]=R("groups"),b[l.User.cls]=R("users",!0),b[l.User.cls].canUpdate=function(){return this.instance===H.currentUser||this.permissions.canEditUsers},b[l.User.cls].canRemove=function(){return this.instance!==H.currentUser&&this.permissions.canEditUsers},b[l.Agent.cls]=R("agents",!0),b[l.Agent.cls].canCreate=function(){return!!this.permissions.canEditAgents||!!this.affiliation&&!!v(this.affiliation.affiliateCompany)&&O("create",l.Agent,this.affiliation.affiliateCompany)},b[l.Desk.cls]=R("desks",!0),b[l.Desk.cls].canCreate=function(){return!!this.permissions.canEditDesks||!!this.affiliation&&(v(this.affiliation.affiliateCompany)?O("create",l.Desk,this.affiliation.affiliateCompany):void 0)},b[l.Affiliation.cls]=R("network"),b[l.Affiliation.cls].canView=function(){return!!this.permissions.canViewNetwork||!!this.instance&&O("view",l.Affiliation,this.instance.affiliateCompany)},b[l.Affiliation.cls].canRemove=function(){return!!this.permissions.canEditNetwork||!!this.instance&&O("remove",l.Affiliation,this.instance.affiliateCompany)},b[l.AvailabilityHeadline.cls]=R("items",!0),b[l.AvailabilityHeadline.cls].canListAssociatedItems="canListAssociatedItems",b[l.CannedMessage.cls]=R("cannedMessages"),b[l.CannedMessage.cls].canListAssociatedItems="canListAssociatedItems",b[l.Item.cls]=R("items",!0),b[l.Item.cls].canView=function(){return!this.instance.isPrivate||this.permissions.canViewItems},b[l.Item.cls].canViewPrivate="canViewPrivateItems",b[l.Item.cls].canUpdateLedger=function(){return this.can("update")&&this.permissions.canViewAccounting&&this.permissions.canEditAccounting},b[l.Item.cls].canUpdateCheckinStatuses=function(){return this.permissions.canEditCheckinStatuses},b[l.FlowNode.cls]=R("flowNodes",!0),b[l.Image.cls]=R("images",!0),b[l.CustomField.cls]=R("customFields",!0),b[l.CustomField.cls].canListAssociatedItems="canListAssociatedItems",b[l.CustomField.cls].canViewPrivate="canViewPrivateCustomFields",b[l.ExtendedOption.cls]=R("customFields",!0),b[l.TransportationOption.cls]=R("customFields",!0),b[l.ConnectedCampaign.cls]=R("customFields",!0,!1),b[l.ConnectedWaiver.cls]=R("customFields",!0,!1),b[l.GeneratingCampaign.cls]=R("customFields",!0),b[l.CustomFieldInstance.cls]=R("customFields",!0),b[l.CustomFieldInstanceCondition.cls]=R("customFields",!0),b[l.CustomFieldInstanceGroup.cls]=R("customFields",!0),b[l.CustomFieldInstanceGroup.cls].canListAssociatedItems="canListAssociatedItems",b[l.Availability.cls]=R("availabilities",!0),b[l.Availability.cls].canCreate=function(){return!this.permissions.canViewOnlyCrewedAvailabilities&&this.permissions.canCreateAvailabilities},b[l.Availability.cls].canBookClosed="canBookClosedAvailabilities",b[l.Availability.cls].canOverbook="canOverbookAvailabilities",b[l.Availability.cls].canBookCancelled="canBookCancelledAvailabilities",b[l.Availability.cls].canBookUnbookable=function(){return v(this.company)||this.permissions.canBookClosedAvailabilities||this.permissions.canOverbookAvailabilities},b[l.Availability.cls].canSelectExclusiveSeatGroup=function(){return v(this.company)||T()},b[l.Availability.cls].canUpdateMultiple=function(){return!this.permissions.canViewOnlyCrewedAvailabilities&&this.permissions.canEditMultipleAvailabilities},b[l.Availability.cls].canViewCapacities="canViewAvailabilityCapacities",b[l.Availability.cls].canReportOn="canViewAvailabilities",b[l.Availability.cls].canViewOnlyCrewed="canViewOnlyCrewedAvailabilities",b[l.Availability.cls].canUpdateLedger=function(){return this.can("update")&&this.permissions.canViewAccounting&&this.permissions.canEditAccounting},b[l.CustomerType.cls]=R("customerTypes",!0),b[l.CustomerType.cls].canListAssociatedItems="canListAssociatedItems",b[l.CheckinStatus.cls]=R("checkinStatuses"),b[l.Campaign.cls]=R("campaigns",!0),b[l.Code.cls]=R("codes"),b[l.CampaignValidityRule.cls]=R("campaigns",!0),b[l.StoredValueType.cls]=R("storedValueCards"),b[l.StoredValueCard.cls]=R("storedValueCards",!0,!1),b[l.StoredValueCard.cls].canReportOn=function(){return this.permissions.canViewStoredValueCards},b[l.StoredValueCard.cls].canIssue=function(){return this.permissions.canIssueStoredValueCards},b[l.StoredValueAdjustment.cls]=R("storedValueCards",!0),b[l.PaymentProcessingDocument.cls]=R("paymentProcessingDocuments"),b[l.PaymentProcessingDocument.cls].canReportOn=function(){return this.permissions.canViewAdvancedReport},b[l.Fund.cls]={canView:x="canView"+_.capitalize("accounting"),canList:x,canCreate:_.never,canUpdate:_.never,canRemove:_.never},b[l.Fund.cls].canView=b[l.Fund.cls].canList=function(){return!!T()&&this.permissions.canViewAccounting},b[l.Transaction.cls]=b[l.Fund.cls],b[l.Contact.cls]=R("contacts",!0),b[l.InStorePaymentType.cls]=R("inStorePaymentTypes"),b[l.EmvDevice.cls]=R("emvDevices"),b[l.EmvDevice.cls].canView=b[l.EmvDevice.cls].canList=function(){return this.permissions.canCreateCreditCardPayments},b[l.EmvDevice.cls].canCreate=b[l.EmvDevice.cls].canRemove=b[l.EmvDevice.cls].canUpdate=function(){return this.permissions.canEditAccounting},b[l.Ledger.cls]=R("accounting"),b[l.Ledger.cls].canCreate=function(){return this.permissions.canViewAccounting&&this.permissions.canEditAccounting},b[l.Ledger.cls].canRemove=function(){return this.permissions.canViewAccounting&&this.permissions.canEditAccounting},b[l.Ledger.cls].canUpdate=function(){return this.permissions.canViewAccounting&&this.permissions.canEditAccounting},b[l.BankAccount.cls]=R("bankAccounts"),b[l.BankAccount.cls].canCreate=function(){return this.permissions.canEditAccounting},b[l.BankAccount.cls].canRemove=function(){return this.permissions.canEditAccounting},b[l.BankAccount.cls].canUpdate=function(){return this.permissions.canEditAccounting},b[l.Card.cls]=R("cards",!0),b[l.Card.cls].canCreate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting},b[l.Card.cls].canRemove=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting},b[l.Card.cls].canUpdate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting},b[l.CardAffiliation.cls]=R("cards",!0),b[l.CardAffiliation.cls].canCreate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting},b[l.CardAffiliation.cls].canRemove=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting},b[l.CardAffiliation.cls].canUpdate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting},b[l.Account.cls]=R("accounting"),b[l.Payout.cls]=R("accounting"),b[l.Payout.cls].canRetry=function(){return T()&&this.can("adminUpdate")},b[l.Transfer.cls]=R("accounting"),b[l.Adjustment.cls]=R("accounting"),b[l.Adjustment.cls].canCreate=function(){return!!T()&&this.permissions.canEditAccounting},b[l.Adjustment.cls].canUpdate=_.never,b[l.Adjustment.cls].canRemove=_.never,b[l.Invoice.cls]=R("invoices"),b[l.InvoiceEntry.cls]=R("invoices"),b[l.Upload.cls]=R("accounting"),b[l.Upload.cls].canCreateDirectType=function(){return!!this.permissions.canEditAccounting&&this.permissions.canCreateDirectUploads},b[l.Hotel.cls]=R("hotels",!0),b[l.Hotel.cls].canCreate=function(){return!!T()&&this.permissions.canEditHotels},b[l.Hotel.cls].canUpdate=b[l.Hotel.cls].canCreate,b[l.Hotel.cls].canRemove=b[l.Hotel.cls].canCreate,b[l.Lodging.cls]=R("transportation",!0),b[l.Pickup.cls]=R("transportation",!0),b[l.PreferredPickup.cls]=R("transportation",!0),b[l.Route.cls]=R("transportation",!0),b[l.Route.cls].canListAssociatedItems="canListAssociatedItems",b[l.Run.cls]=R("transportation",!0),b[l.Stop.cls]=R("transportation",!0),b[l.Activity.cls]=R("activities"),b[l.Activity.cls].canCreate="canEditActivities",b[l.Activity.cls].canView=function(){return!l.Activity.isAdminOnly(this.instance)||T()},b[l.Activity.cls].canToggleAdminOnlyStatus=function(){return!!T()&&(!this.instance.object||this.instance.object.cls!==l.Activity.cls)&&!(l.Activity.isAdminOnly(this.instance)&&!this.instance.context.adminOnlyOriginalType)&&this.can("update")},b[l.Activity.cls].canCreateNoteOnActivity=function(){return!!T()&&(!this.instance.object||this.instance.object.cls!==l.Activity.cls)&&this.can("create")},b[l.Activity.cls].canList=function(){return this.permissions.canViewActivities||this.permissions.canViewActivitiesSelf},b[l.Activity.cls].canListFeed=function(){return this.permissions.canViewActivitiesFeed},b[l.Waiver.cls]=R("waivers",!0),b[l.WaiverInstance.cls]=w("waiverInstances"),b[l.CustomerPrototype.cls]=R("customFields",!0),b[l.CustomerPrototype.cls].canCreate=function(){return!!O("updatePricing",this.company)&&this.permissions.canEditCustomFields},b[l.CustomerTypeRate.cls]=R("availabilities",!0),b[l.Block.cls]=R("blocks"),b[l.TotalSchedule.cls]=R("sheets"),b[l.InvoiceSchedule.cls]=R("sheets"),b[l.TotalScheduleEntry.cls]=R("sheets"),b[l.InvoiceScheduleEntry.cls]=R("sheets"),b[l.TotalScheduleEntryRule.cls]=R("sheets"),b[l.InvoiceScheduleEntryRule.cls]=R("sheets"),b[l.TotalSheet.cls]=R("sheets"),b[l.TotalSheet.cls].canView=_.always,b[l.TotalSheet.cls].canReportOn=function(){return this.can("list")},b[l.InvoiceSheet.cls]=R("sheets"),b[l.InvoiceSheet.cls].canView=_.always,b[l.InvoiceSheet.cls].canReportOn=function(){return this.can("list")},b[l.TotalLine.cls]=R("sheets"),b[l.TotalLine.cls].canView=_.always,b[l.TotalLine.cls].canCreate="canEditPricing",b[l.TotalLine.cls].canUpdate="canEditPricing",b[l.TotalLine.cls].canRemove="canEditPricing",b[l.InvoiceLine.cls]=R("sheets"),b[l.InvoiceLine.cls].canView=_.always,b[l.InvoiceLine.cls].canCreate="canEditPricing",b[l.InvoiceLine.cls].canUpdate="canEditPricing",b[l.InvoiceLine.cls].canRemove="canEditPricing",b[l.TaxType.cls]=R("accounting"),b[l.Subscription.cls]=R("users"),b[l.Notification.cls]=w("notifications",{checkPastBooking:!1}),b[l.Notification.cls].canCreate=_.super(b[l.Notification.cls].canCreate,(function(){return this.booking?this.super():this.permissions.canEditNotifications})),b[l.Notification.cls].canCreateDisputeType=function(){return!!T()&&this.can("create",this.booking)},b[l.SmsNotification.cls]=w("smsNotifications",{checkPastBooking:!1}),b[l.SmsNotification.cls].canCreate=function(){return this.company.isSmsEnabled&&this.permissions.canEditSmsNotifications&&(!this.booking||O("update",this.booking))},b[l.ReviewExpressNotification.cls]=w("reviewExpress",{checkPastBooking:!1}),b[l.Order.cls]=R("orders"),b[l.Booking.cls]=R("bookings"),b[l.Booking.cls].canSkipPayment="canSkipPayment",b[l.Booking.cls].canBookHiddenFields="canBookHiddenFields",b[l.Booking.cls].canViewAffiliateBookings="canViewAffiliateBookings",b[l.Booking.cls].canOverrideTransportation="canOverrideTransportation",b[l.Booking.cls].canUpdateOnlyFutureBookings="canUpdateOnlyFutureBookings",b[l.Booking.cls].canCreate=function(){return!this.group&&!H.currentUser.isAuthenticated||this.permissions.canCreateBookings},b[l.Booking.cls].canUpdate=function(){return!!this.permissions.canEditBookings||E(this.instance)},b[l.Booking.cls].canUpdateExplicitTotal=function(){return!!this.permissions.canViewAmounts&&!(this.instance&&!this.can("update"))&&!(this.instance&&!N.call(this,this.instance))&&this.permissions.canEditBookingExplicitTotals},b[l.Booking.cls].canUpdateExplicitInvoicePrice=function(){return!!this.permissions.canViewInvoiceAmounts&&!(this.instance&&!this.can("update"))&&!(this.instance&&!N.call(this,this.instance))&&this.permissions.canEditBookingExplicitInvoicePrices},b[l.Booking.cls].canViewBookingNote="canViewBookingNotes",b[l.Booking.cls].canUpdateBookingNote=function(){return!!this.can("viewBookingNote")&&!(this.instance&&!N.call(this,this.instance))&&this.permissions.canEditBookingNotes},b[l.Booking.cls].canUpdateBookingAffiliations=function(){return!!this.can("update")&&!!N.call(this,this.instance)&&this.permissions.canEditBookingAffiliations},b[l.Booking.cls].canUpdateBookingAffiliationInfo=function(){return!!this.can("update")&&!!N.call(this,this.instance)&&this.permissions.canEditBookingAffiliationInfo},b[l.Booking.cls].canView=function(){return!this.group||!!this.permissions.canViewBookings||E(this.instance)},b[l.Booking.cls].canCancel=function(){return this.can("update")&&this.permissions.canCancelBookings&&N.call(this,this.instance)},b[l.Booking.cls].canCancelEligible=function(){return!!this.can("update")&&!!l.Booking.isEligibleForCancellation(this.instance,H.currentUser)&&!!N.call(this,this.instance)&&this.permissions.canCancelEligibleBookings},b[l.Booking.cls].canRebook=function(){return!!this.can("cancel")&&this.can("create")},b[l.Booking.cls].canRebookEligible=function(){return!!this.can("cancelEligible")&&!!l.Booking.isEligibleForRebook(this.instance,H.currentUser)&&this.can("create")},b[l.Booking.cls].canEditCustomFieldValues=function(){return this.can("update")&&this.permissions.canEditCustomFieldValues&&N.call(this,this.instance,!0)},b[l.Booking.cls].canPushCustomFieldValues=function(){return this.permissions.canPushCustomFieldValues&&(!this.instance||N.call(this,this.instance,!0))},b[l.Booking.cls].canChangePriceSheets=function(){return!!this.permissions.canViewAmounts&&!(this.instance&&!N.call(this,this.instance))&&this.permissions.canChangePriceSheets},b[l.Booking.cls].canReapplyResourceUses=function(){return!(this.instance&&!N.call(this,this.instance))&&this.permissions.canEditResourceUses},b[l.Booking.cls].canSelectResourceRequirements=function(){return this.permissions.canEditResourceUses||v(this.company)||T()},b[l.Booking.cls].canCreateCustomRefunds=function(){return!!this.permissions.canViewAmounts&&!!N.call(this,this.instance,!0)&&this.permissions.canCreateCustomRefunds},b[l.Booking.cls].canCreateDeposits=function(){return!(H.currentUser.isAuthenticated&&!v(this.company)&&!T()&&(!this.group||!this.group.pk)&&!this.permissions.canCreateDeposits)},b[l.Booking.cls].canAdjustCustomFieldValuePrice=function(){return!(this.instance&&!N.call(this,this.instance)||!this.permissions.canAdjustCustomFieldValuePrice)},b[l.Customer.cls]=w("customers"),b[l.Customer.cls].canViewCheckinStatus=function(){return this.booking?this.can("view")&&this.permissions.canViewCustomerCheckinStatus:this.permissions.canViewCustomerCheckinStatus},b[l.Customer.cls].canUpdateCheckinStatus=function(){return O("update",this.booking)&&this.permissions.canEditCustomerCheckinStatus&&N.call(this)},b[l.BookingCustomFieldValue.cls]=w("customFieldValues",{isLimitedPastBookingUpdate:!0}),b[l.CustomerCustomFieldValue.cls]=w("customFieldValues",{isLimitedPastBookingUpdate:!0}),b[l.BookingCustomFieldValue.cls].canUpdate=function(){return this.permissions.canEditCustomFieldValues&&N.call(this,this.booking,!0)},b[l.CustomerCustomFieldValue.cls].canUpdate=function(){return this.permissions.canEditCustomFieldValues&&N.call(this,this.booking,!0)},b[l.Refund.cls]=w("refunds",{isLimitedPastBookingUpdate:!0}),b[l.Refund.cls]=w("refunds",{isLimitedPastBookingUpdate:!0}),b[l.Refund.cls].canUpdate=D("viewAmounts",b[l.Refund.cls].canUpdate),b[l.Refund.cls].canCreate=D("viewAmounts",b[l.Refund.cls].canCreate);var $=function(){return T()&&this.permissions.canViewAdminSection};b[l.Refund.cls].canViewBookingFee=function(){return $.call(this)},b[l.LineItem.cls]=w("lineItems",{isLimitedPastBookingUpdate:!0}),b[l.LineItem.cls].canUpdate=D("viewAmounts",b[l.LineItem.cls].canUpdate),b[l.LineItem.cls].canCreate=D("viewAmounts",b[l.LineItem.cls].canCreate),b[l.LineItem.cls].canRemove=D("viewAmounts",b[l.LineItem.cls].canRemove),b[l.LineItem.cls].canReportOn=function(){return this.permissions.canViewLineItems},b[l.Payment.cls]=w("payments",{isLimitedPastBookingUpdate:!0}),b[l.Payment.cls].canCreatePartial=D("viewAmounts","canSkipPayment"),b[l.Payment.cls].canCreateWithoutCVC=function(){return T()||this.permissions.canCreateCreditCardPaymentsWithoutCvv},b[l.Payment.cls].canCreateWithoutCardholdersName="canSkipCardholderInfo",b[l.Payment.cls].canCreateWithoutPostalCode="canSkipPostalCode",b[l.Payment.cls].canCreateWithoutCountryCode="canSkipPostalCode",b[l.Payment.cls].canCreateCreditCard=D("viewAmounts","canCreateCreditCardPayments"),b[l.Payment.cls].canCreateInStore=D("viewAmounts","canCreateInStorePayments"),b[l.Payment.cls].canCreateStoredValueCard=D("viewAmounts","canCreateStoredValueCardPayments"),b[l.Payment.cls].canCreateDeferred="canCreateDeferredPayments",b[l.Payment.cls].canCreateAffiliate=function(){return!!this.permissions.canCreateAffiliatePayments||!!this.booking&&E(this.booking)},b[l.Payment.cls].canViewBookingFee=function(){return $.call(this)},b[l.TicketLayout.cls]=R("ticketLayouts",!0),b[l.SupportedLanguage.cls]=R("supportedLanguages"),b[l.Translation.cls]=R("translations"),b[l.Location.cls]=R("locations"),b[l.Location.cls].canView="canEditLocations",b[l.Location.cls].canViewSensitive="canEditLocations",b[l.Location.cls].canList="canEditLocations",b[l.Report.cls]=R("reports"),b[l.Report.cls].canViewAccountsType="canViewAccounting",b[l.Report.cls].canViewEscrowType="canViewAccounting",b[l.Report.cls].canViewFundsType="canViewAccounting",b[l.Report.cls].canViewPayoutsType="canViewAccounting",b[l.Report.cls].canViewTransfersType="canViewAccounting",b[l.Report.cls].canViewInvoicesType="canViewInvoices",b[l.Report.cls].canViewInvoiceableBookingsType="canEditInvoices",b[l.Report.cls].canViewAdvancedType="canViewAdvancedReport",b[l.Report.cls].canViewAgentsSummaryType="canViewAgentsSummaryReport",b[l.Report.cls].canViewBookingTypesSummaryType="canViewBookingTypesSummaryReport",b[l.Report.cls].canViewBookingsType="canViewBookingsReport",b[l.Report.cls].canViewCampaignsSummaryType="canViewCampaignsSummaryReport",b[l.Report.cls].canViewContactsType="canViewContactsReport",b[l.Report.cls].canViewCrewSummaryType="canViewCrewSummaryReport",b[l.Report.cls].canViewCustomFieldSummaryType="canViewCustomFieldSummaryReport",b[l.Report.cls].canViewCustomerTypesSummaryType="canViewCustomerTypesSummaryReport",b[l.Report.cls].canViewDesksSummaryType="canViewDesksSummaryReport",b[l.Report.cls].canViewItemsSummaryType="canViewItemsSummaryReport",b[l.Report.cls].canViewLineItemsSummaryType="canViewLineItemsSummaryReport",b[l.Report.cls].canViewLodgingsSummaryType="canViewLodgingsSummaryReport",b[l.Report.cls].canViewPaymentsType="canViewPaymentsReport",b[l.Report.cls].canViewDisputesType="canViewDisputesReport",b[l.Report.cls].canViewPickupLocationsSummaryType="canViewPickupLocationsSummaryReport",b[l.Report.cls].canViewRevenueSummaryType="canViewRevenueSummaryReport",b[l.Report.cls].canViewUsersSummaryType="canViewUsersSummaryReport",b[l.Report.cls].canViewCompaniesType="canViewCompaniesReport",b[l.Report.cls].canViewInProgressReportsType="canViewInProgressReportsReport",b[l.Report.cls].canViewTransactionsType="canViewTransactionsReport",b[l.Report.cls].canViewVolumeType="canViewVolumeReport",b[l.Report.cls].canReport=function(){return!!this.group},s.slipstream("isReadonlyEnabled")&&(b[l.Report.cls].canView=_.never,b[l.Report.cls].canList=_.never,b[l.Report.cls].canCreate=_.never,b[l.Report.cls].canUpdate=_.never,b[l.Report.cls].canRemove=_.never,b[l.Report.cls].canViewBookingTypesSummaryType=_.never,b[l.Report.cls].canViewAdvancedType=_.never,b[l.Report.cls].canViewPayoutsType=_.never,b[l.Report.cls].canViewItemsSummaryType=_.never,b[l.Report.cls].canViewRevenueSummaryType=_.never,b[l.Report.cls].canReport=_.never),b[l.Resource.cls]=R("resources"),b[l.Resource.cls].canListAssociatedItems="canListAssociatedItems",b[l.Requirement.cls]=R("resources"),b[l.RequirementGroup.cls]=R("resources"),b[l.RequirementGroup.cls].canListAssociatedItems="canListAssociatedItems",b[l.CustomerPrototypeRequirement.cls]=R("resources"),b[l.CustomerTypeRequirement.cls]=R("resources"),b[l.ResourceRequirement.cls]=R("resources"),b[l.ResourceOverride.cls]=R("resourceUses",!0),b[l.SeatMap.cls]=R("seatMaps",!0),b[l.SeatGroup.cls]=R("seatMaps",!0),b[l.SeatZone.cls]=R("seatMaps",!0),b[l.ResourceUse.cls]=w("resources",{permissionOverrides:{canCreate:"canEditResourceUses",canUpdate:"canEditResourceUses",canRemove:"canEditResourceUses"}}),b[l.ResourceUse.cls].canReapplyAcrossBookings=function(){return this.permissions.canEditResourceUses},b[l.ResourceUse.cls].canList=_.super(b[l.ResourceUse.cls].canList,(function(){return this.booking?this.super():this.permissions.canViewResources})),b[l.AnalyticsService.cls]=R("analyticsServices",!0),b[l.CancellationPolicy.cls]=R("cancellationPolicies",!0),b[l.CancellationPolicy.cls].canListAssociatedItems="canListAssociatedItems",b[l.CancellationRule.cls]=R("cancellationPolicies",!0),b[l.BookingRestriction.cls]=R("bookingRestrictions",!0),b[l.BookingRestriction.cls].canListAssociatedItems="canListAssociatedItems",y.canBookWithNoFee=function(e,t){return H.currentUser.isAuthenticated};var G,Y=function(){return!!T()&&this.permissions.canEditReseller};b[l.ResellerApp.cls]=R("reseller"),b[l.ResellerApp.cls].canList=Y,b[l.ResellerAppCompany.cls]=R("reseller"),b[l.ResellerCompany.cls]=R("reseller"),b[l.ResellerCompany.cls].canList=Y,b[l.ResellerAppRequest.cls]=R("accounting"),b[l.ResellerAppRequest.cls].canUpdate=Y,b[l.ResellerAppRequest.cls].canRemove=Y,b[l.ResellerCompanyMapping.cls]=R("reseller"),b[l.ResellerCompanyMapping.cls].canCreate=Y,b[l.ResellerCompanyMapping.cls].canList=Y,b[l.ResellerCompanyMapping.cls].canRemove=Y,b[l.ResellerItem.cls]=R("reseller"),b[l.ResellerItemMapping.cls]=R("reseller"),b[l.ResellerCustomerType.cls]=R("reseller"),b[l.ResellerCustomerTypeMapping.cls]=R("reseller"),b[l.ResellerOption.cls]=R("reseller"),b[l.ResellerOptionMapping.cls]=R("reseller"),b[l.ResellerKey.cls]=R("resellerKeys"),b[l.ResellerKey.cls].canCreate=function(){return!!this.permissions.canEditResellerKeys||v()},b[l.ResellerKey.cls].canCreateForAnyUser=function(){return this.permissions.canEditResellerKeys},b[l.Order.cls].canCancelEligible=function(){return this.permissions.canCancelEligibleBookings&&!this.can("cancel")};var V=s.slipstream("currentUser");V?(G=V).isAuthenticated=!0:G=g;var K=function(e){var t=function(){return H.currentUser.isAuthenticated?H.currentUser.username+"@"+H.currentUser.company.shortname:"anonymous"},n=function(e){return t()+":"+e};return{get:function(t){return e.get(n(t))},set:function(t,r){return e.set(n(t),r)},del:function(t){return e.del(n(t))},clear:function(){if(e.key&&e.length)for(var n,r=t(),i=0;i<e.length;i++)(n=e.key(i)).split(":",1)[0]===r&&e.del(n);else e.clear()}}},H={CACHED_ENDPOINTS:["/api/v1/version/"],ALLOWED_STATUSES:[400,403],permissions:y,storage:K(d),sessionStorage:K(u),currentUser:G,isSessionExpirationInProgress:!1,isLogoutInProgress:!1,isCompanyUser:function(e,t){return t=t||H.currentUser,!(!e||!t)&&t.company===e},isAuthenticatedForAdminCompany:T,relatedCompanies:function(){return H.currentUser.isAuthenticated?_.sortBy(_.unique(_.append(_.pluck(l.GroupOverride.companyLevelOverrides(H.currentUser.company.relatedGroupOverrides),"company"),_.pluck(H.currentUser.relatedGroupOverrides,"company"))),"name"):[]},login:function(e,t){var n=s.login({},e,t);return n.$promise.then((function(){H.currentUser=n,H.currentUser.isAuthenticated=!0,c.broadcast("auth.login")}))},logout:function(e){var n;return H.storage.clear(),H.sessionStorage.clear(),H.currentUser=g,n=e?r.defer().promise:t.post(m.api.logout),c.broadcast("auth.logout"),n},expireSession:function(e){var t,r=n.get("navigation"),i=H.currentUser.company;t=i?i.$url(m.company.login):m.index;var o=r.compose(t,{isSessionExpired:!0});r.navigate(o),H.isSessionExpirationInProgress=!0,a((function(){H.logout(e),H.isSessionExpirationInProgress=!1}))},checkSession:function(e,t,n,r){if((r<200||r>=300)&&!_.contains(H.ALLOWED_STATUSES,r))return e;if(_.contains(H.CACHED_ENDPOINTS,n))return e;var i=t("X-fh-active"),a=!1;return H.currentUser.isAuthenticated&&i&&(a=parseInt(i,10)!==H.currentUser.pk),(H.currentUser.isAuthenticated&&!i||a)&&H.expireSession(a),e},effectiveGroup:k};return window.$$auth=H,H}]),e.run(["$rootScope","$window","auth",function(e,t,n){e.auth=n,t.$$auth=n}])}()},9407:function(){!function(){"use strict";var e=angular.module("cache.services",["lib.services","urls.services"]);e.factory("cache",["moment","urls",function(e,t){var n=function(e,t){for(var n in t=t||{},e)e.hasOwnProperty(n)&&(t[n]=r(e[n]));return t},r=function e(t){if(_.isArray(t)){for(var r=[],a=0,o=t.length;a<o;a++)r.push(e(t[a]));return r}return _.isModelObject(t)?i(t):_.isObject(t)?n(t):t},i=function(e,r){if(_.isUndefined(e)||null===e)return r&&delete a.cache[r],e;if(!_.isObject(e))return e;var i=e.uri;r=r||i;var o,s=a.cache[r];i&&r&&r!==i&&!_.isUndefined(s)&&(console.log("cache: overlapping uris",i,r),delete a.cache[r]),o=_.isUndefined(s)?{}:s,i&&(a.cache[i]=o,o.$url||(o.$url=t.populateForObject));var c=n(e,o);return c.$fresh=!1,c},a={cache:{},read:function(e,t){if(_.isUndefined(e))throw new Error("cache.read: invalid key");t&&(e="["+e+"]");var n=a.cache[e];return _.isUndefined(n)&&((n=t?[]:{}).uri=e,n.$fresh=!0,a.cache[e]=n),n},update:i,clear:function(){a.cache={}},fresh:function(e){return!!e.$fresh},populate:r,reference:function(e){if(e.cls&&e.uri)return{cls:e.cls,pk:e.pk,uri:e.uri}}};return window.$$cache=a,a}]),e.run(["$rootScope","cache","events",function(e,t,n){n.on(e,"auth.logout",(function(){t.clear()}))}])}()},7405:function(){!function(){"use strict";var e=angular.module("cart",["cache","db","navigation"]);e.factory("cart",["$q","$rootScope","$timeout","cache","clientOptions","db","events","flows","models","navigation","require","persistentStorage","urls","xmessage",function(e,t,n,r,i,a,o,s,c,l,u,d,m,p){var f=function(e){return{company:e,entries:[],isNoTax:!1,isCardRequired:!0,totals:{price:0,tax:0,taxByType:{},total:0}}},h=function(){C.status="success",o.broadcast("cart.loaded")},g=function(e){e.totals.price=_.sum(e.entries,"totals.price"),e.totals.tax=_.sum(e.entries,"totals.tax"),e.totals.bookingFee=_.sum(e.entries,"totals.bookingFee");var t=_.pluck(e.entries,"totals.taxByType");_.all(t)?e.totals.taxByType=_.reduce(t,_.sumObjectValues)||{}:e.totals.taxByType=void 0,e.isNoTax=_.all(e.entries,"availability.item.isNoTax"),e.totals.isAnyBookingFeeOnly=_.any(e.entries,"availability.item.settings.isBookingFeeOnly"),e.isCardRequired=_.any(e.entries,"isCardRequired")},y={},v=function(e,t,n,r,i,a){u.assert(!!t,"cart: expected availability"),u.assert(!!n,"cart: expected breakdown"),u.defined(r,"price","cart: expected total price"),u.defined(r,"tax","cart: expected total tax"),u.defined(r,"bookingFee","cart: expected total total"),u.defined(r,"deposit","cart: expected total deposit"),u.assert(!!i,"cart: expected model");var o=e.company.shortname;y[o]=y[o]||{};var s=y[o][t.uri];s||(s={availability:t},y[o][t.uri]=s,e.entries.push(s)),s.customerBreakdown=n,s.totals=r,s.isCardRequired=t.item.isCardRequired,s.model=i,s.newResourceUses=a,g(e)},T=function(e){_.clear(e.entries),y[e.company.shortname]={},g(e)},E=function(t,n){try{var i=_.map(n.entries,(function(e){var t=a.availability(e.availability,null,null,null,{tagAlong:!0});return t.$promise.then((function(){return{availability:t,storedEntry:e}}),(function(){return null}))}));return e.all(i).then((function(e){T(t),_.forEach(e,(function(e){if(e){var n=e.availability,i=e.storedEntry,a=_.choose(i.customerBreakdown,(function(e){var t=r.read(e.customerTypeRate.uri);if(t)return{count:e.count,customerTypeRate:t}}));v(t,n,a,i.totals,i.model,i.newResourceUses)}})),console.info("cart: finished hydrating")}))}catch(t){return console.warn("cart: unable to load cart",n,t),e.when(null)}},b=function(e){if(C.company){var t,n=function(e){var t={};return t.entries=_.map(e,(function(e){var t=_.map(e.customerBreakdown,(function(e){return{count:e.count,customerTypeRate:r.reference(e.customerTypeRate)}})),n=_.map(e.newResourceUses,(function(e){return _.extend({},e,{seat:e.seat?r.reference(e.seat):null,startAt:e.startAt.format("YYYY-MM-DDTHH:mm:ss"),endAt:e.endAt.format("YYYY-MM-DDTHH:mm:ss")})}));return{availability:m.extract(e.availability),customerBreakdown:t,totals:e.totals,model:e.model,newResourceUses:n}})),t}(C.entries);return n?(console.info("cart: storing",n),t=d.set("cart",n)):t=d.del("cart"),e&&(t=t.then((function(){p.broadcast("fareharbor.cart.changed")}))),t}},C={status:"success",add:function(e,t,n,r,i){return v(C,e,t,n,r,i),b(!0)},remove:function(e){!function(e,t){_.overwriteWithout(e.entries,(function(e){return e.availability===t.availability})),y[e.company.shortname]&&delete y[e.company.shortname][t.availability.uri],g(e)}(C,e),b(!0)},clear:function(){T(C),b(!0)},updateBookingFees:function(e){!function(e,t){_.forEach(e.entries,(function(e){_.isUndefined(e.totals.feeable)||(e.totals.bookingFee=c.Company.bookingFee(e.availability.company,e.totals.feeable,e.availability.item.isFreeAllowed,e.totals.price,t))})),g(e)}(C,e)},search:function(e){return(y[C.company.shortname]||{})[e.uri]||null},keepShoppingUrl:function(e){return s.initialFlowNode?s.initialUrl():e.$url(m.company.index)},permalinkUrl:function(e){var t=m.populate(m.company.cart.permalink,{shortname:e.shortname,cartUuid:i.userIdentifier});return s.extendWithFlow(t)},load:function(){if(C.company&&"loading"!==C.status)return C.status="loading",C.$promise=d.get("cart").then((function(e){if(e)return console.info("cart: hydrating...",e),E(C,e)})).then(h,h),C.$promise},allCompanies:{status:"success",carts:{},load:function(){return C.allCompanies.status="loading",C.allCompanies.$promise=d.getForAllCompanies("cart").then((function(t){delete C.allCompanies.$promise,_.clear(C.allCompanies.carts),y={};var n=[];return _.forEach(t,(function(e){if(e.cart){var t=e.company.shortname;C.allCompanies.carts[t]=f(e.company),console.info("cart: loading all...",e),n.push(E(C.allCompanies.carts[t],e.cart))}})),e.all(n).then((function(){C.company&&C.allCompanies.carts[C.company.shortname]?_.extend(C,C.allCompanies.carts[C.company.shortname]):_.extend(C,f()),C.allCompanies.status="success"}),(function(){C.allCompanies.status="success"}))})),C.allCompanies.$promise}}};_.extend(C,f(null));var k=function(e){e&&C.company!==e&&(console.info("cart: loading for new company",e),b(),C.company=e,C.load())};return k(l.currentCompany),o.on(t,"navigation.company.updated",(function(e,t){k(t.company)})),o.on(t,"persistentStorage.reIdentifiedUser",(function(){l.currentCompany&&(C.company=l.currentCompany,C.load(),console.info("cart: loading for new user"))})),C}]),e.controller("cart.CartCtrl",["$scope","clientOptions","controllers","db","navigation","require",function(e,t,n,r,i,a){t.reflect("userIdentifier")}]),e.controller("cart.ViewCartCtrl",["$scope","cart",function(e,t){t.load()}]),e.directive("ngCart",["analytics","cart","clientOptions","db","events","flows","lightframe","models","navigation","paymentController","queueToken","tracking","tracking.geo","urls",function(e,t,n,r,i,a,o,s,c,l,u,d,m,p){return{templateUrl:"cart.cart",controller:["$scope","$attrs",function(f,h){r.slipstream("isDebug")&&(window.$$pop=function(e,t){f.$safeApply((function(){var n=e?e.replace(" ","-"):"z",r=_.capitalize(e||"zach");g.newOrder["contact-name"]=r,g.newOrder["contact-phone"]="4158881212",g.newOrder["contact-email"]=n+"@fareharbor.com",g.newOrder["payments-payment-cardNumber"]="4242424242424242",g.newOrder["payments-payment-cardholdersName"]=r,g.newOrder["payments-payment-cardExpiryMonth"]="12",g.newOrder["payments-payment-cardExpiryYear"]="2023",g.newOrder["payments-payment-cardCvc"]="123",g.newOrder["payments-payment-postalCode"]="12345",g.newOrder["payments-payment-countryCode"]="US",_.extend(g.newOrder,t)}))});var g=this,y={};g.setEntryValidity=function(e,t){var n=e.availability.uri;_.isUndefined(t)?delete y[n]:y[n]=!!t},g.addEntryController=function(e){_.contains(g.entryCtrls,e)||g.entryCtrls.push(e)},g.removeEntryController=function(e){_.contains(g.entryCtrls,e)&&_.ref.remove(g.entryCtrls,e)},g.newOrder=f.newOrder={clientUuid:_.uuid()},g.company=f.$eval(h.ngCart),g.attachControl=function(e,t){g[e]=t,t.cartCtrl=g},g.showCompleteButton=function(e){return!e.$invalid&&!e.$submitting&&t.entries.length>0&&_.all(y)&&g.paymentCtrl&&g.paymentCtrl.isCurrentOptionValid()&&g.paymentCtrl.isCurrentKindValid()&&!g.paymentCtrl.isAmountTooLow()},g.isEligibleForGiftCardRedemption=function(){return!!g.company.features.isOnlineStoredValueCardRedemptionEnabled&&g.cartTotalsCtrl.totals.price+g.cartTotalsCtrl.totals.tax>0&&!_.any(t.entries,(function(e){return s.Item.isDepositRequired(e.availability.item)}))};var v=!1;g.isNavigateAwayAllowed=function(e){return!!v||!!e.$pristine},g.getEntryDepositStatus=function(e,t){return e.model.isDeposit&&s.Booking.isEligibleForDeposit(e.availability.item,e.totals.deposit,t)};var T=function s(l,h){h=h||_.ignore;var y=_.extend({},g.newOrder);y.bookingCount=t.entries.length,_.forEach(t.entries,(function(e,t){var n="booking"+t.toString()+"-";_.extendWithPrefix(n,y,e.model),y[n+"availability"]=e.availability.pk})),console.info("cart: creating order",y);var T={"X-FH-User-Identifier":n.userIdentifier};_.forEach(u.tokens,(function(e,t){T["X-QUEUING-TOKEN-"+t]=e.uuid}));var E=r.orders.create({shortname:g.company.shortname},T,y,l);E.$promise.then((function(){if(E.clientAction)g.paymentCtrl.completeClientAction(l,E).then((function(){s(l,h)}),(function(){d.track(f,"failed-order",{company:g.company.shortname,"company-id":g.company.pk,isLightframe:o.isLightframe(),clientAction:!0}),g.paymentCtrl.restoreCard(),l.$submitting=!1,h()}));else{v=!0;var n=E.$url(p.company.order.index);if(1===E.contributingBookings.length){var r=E.contributingBookings[0];E.isPending?(n=r.$url(p.embeds.book.wait.booking),n=c.extendQuery(n,{status:"initial"})):n=r.$url(p.company.item.booking)}else E.isPending&&(n=E.$url(p.embeds.book.wait.order),n=c.extendQuery(n,{status:"initial"}));n=a.extendWithFlow(n),E.isPending&&o.isLightframe()?e.storeContext().then((function(){console.log("cart: analytics context sucessfully stored")}),(function(){console.error("cart: failed to store analytics context")})).finally((function(){n=c.absoluteUrl(n),c.redirect(n)})):c.navigate(n),t.clear(),l.$submitting=!0;var i={company:g.company.shortname,"company-id":g.company.pk,total:E.contributingBookingCosts.totalCost.total,bookingCount:E.bookingCount,isLightframe:o.isLightframe()},u=_.map(E.contributingBookings,"item");_.isArray(u)&&u.length>0&&(i.items=_.unique(_.map(u,"name")),i["item-ids"]=_.unique(_.map(u,"pk"))),!1===m.isEU&&(i.order=E.uuid),d.track(f,"completed-order",i),E.isPending?e.trackOrder(E,{trackGAOnly:!0}):e.trackOrder(E),h()}}),(function(e){d.track(f,"failed-order",{company:g.company.shortname,"company-id":g.company.pk,isLightframe:o.isLightframe()}),g.paymentCtrl.restoreCard(),l.$submitting=!1,_.isUndefined(e.data.tokens)||_.forEach(e.data.tokens,(function(e){var n=_.find(t.entries,(function(t){if(t.availability.item.pk===e.itemPk)return t}));n&&(u.replace(n.availability.item,e),i.broadcast("queuing.tokenIssued",e,parseInt(e.itemPk)))})),h()}))};g.submit=function(e){if(t.entries.length)if(e.$valid){e.$submitting=!0,g.paymentCtrl.saveCard();var n=g.paymentCtrl.isRedirectBasedPaymentOption();g.newOrder.type=n?s.Order.PENDING_TYPE:s.Order.COMPLETED_TYPE,_.forEach(t.entries,(function(e){e.model.type=n?s.Booking.PENDING_TYPE:s.Booking.COMPLETED_TYPE;var t=g.redeemStoredValueCardsCtrl.storedValueCardsAppliedByEntry[e.availability.uri]||0,r=_.sum([e.totals.price,e.totals.tax]);e.model.isDeposit=g.getEntryDepositStatus(e,r-t)}));var r=g.paymentCtrl.option();r!==g.paymentCtrl.CHARGE_OPTION&&r!==g.paymentCtrl.DEFER_OPTION||(g.tokenizingCard=!0),f.$asyncApply((function(t){g.paymentCtrl.createToken(e,(function(){g.tokenizingCard=!1,T(e,t)}),(function(){g.tokenizingCard=!1,e.$submitting=!1,t()}))}))}else console.error("cart: attempting to submit invalid order form");else console.error("cart: attempting to submit empty order form")},l(f,{modelKey:"newOrder",fieldPrefix:"payments-payment",company:g.company,gross:function(){return g.cartTotalsCtrl?g.cartTotalsCtrl.totals.isAnyBookingFeeOnly?g.cartTotalsCtrl.totals.bookingFeeOnlyGross:g.cartTotalsCtrl.totals.preBookingFeeTotal:0},deposit:function(){return g.cartTotalsCtrl?g.cartTotalsCtrl.totals.totalDeposits:0},isDepositEligible:function(){return g.cartTotalsCtrl?_.any(t.entries,"model.isDeposit")&&g.cartTotalsCtrl.totals.totalDeposits>0:0},bookingFee:function(){return g.cartTotalsCtrl?g.cartTotalsCtrl.totals.bookingFee:0},invoicePrice:0,isAnonymous:!0,isAffiliate:!1,isCompany:!1,isCardRequired:!!t.isCardRequired}),g.attachControl("paymentCtrl",f.paymentCtrl)}],controllerAs:"cartCtrl"}}]),e.directive("ngCartEntry",["cart","db","navigation","urls",function(e,t,n,r){return{restrict:"A",require:"^ngCart",templateUrl:"cart.entry",controller:["$scope","$attrs",function(i,a){var o=this;o.status="loading",o.cartCtrl=i.cartCtrl,o.entry=i.$eval(a.ngCartEntry),o.total=_.sum([o.entry.totals.price,o.entry.totals.tax]),o.isDeposit=function(){var e=o.entry.availability.uri,t=i.cartCtrl.redeemStoredValueCardsCtrl.storedValueCardsAppliedByEntry[e]||0;return o.cartCtrl.getEntryDepositStatus(o.entry,o.total-t)},o.change=function(){var e=o.entry.availability.$url(r.company.item.book);n.navigate(e)},o.remove=function(t,n){delete t["booking"+n+"-all"],e.remove(o.entry)};var s={};_.forEach(o.entry.customerBreakdown,(function(e){s[e.customerTypeRate.pk]=e.count}));var c=t.availability.liveCapacity({shortname:o.entry.availability.item.company.shortname,itemPk:o.entry.availability.item.pk,availabilityPk:o.entry.availability.pk},null,null,{customerTypeRateCounts:_.stringifyJSON(s),totalSheet:o.entry.model.totalSheet});c.$promise.then((function(){o.cartCtrl.setEntryValidity(o.entry,c.isBookable),o.status=o.entry.availability.isBookable&&c.isBookable?"success":"error",o.isPossiblyBookable=o.entry.availability.isBookable}),(function(){o.cartCtrl.setEntryValidity(o.entry,!0),o.status="success"})),i.$on("$destroy",(function(){o.cartCtrl.setEntryValidity(o.entry)}))}],controllerAs:"cartEntryCtrl"}}]),e.directive("ngCartTotals",["cart","models","redeemStoredValueCardsController",function(e,t,n){return{restrict:"A",require:"^ngCart",templateUrl:"cart.totals",controller:["$scope",function(r){var i=this;r.cartCtrl.attachControl("cartTotalsCtrl",i),i.cartCtrl=r.cartCtrl,i.totals=_.extend({},e.totals);var a={};i.currentPrice=function(){return i.totals.price},i.currentTax=function(){return i.totals.tax};var o=function(e){return e.availability.uri},s=function(e){return e.totals.price+e.totals.tax},c=function(e){var t=o(e);return a[t]||0},l=function(){_.extend(i.totals,e.totals),i.totals.bookingFee=function(n){_.clear(a);var i=r.redeemStoredValueCardsCtrl.storedValueCards;if(!i.length)return n;_.forEach(i,(function(t){var n=r.redeemStoredValueCardsCtrl.applied(t),i=_.prorate(n,e.entries,s,o);_.merge(a,i,_.add)}));var l=0;return _.forEach(e.entries,(function(e){l+=t.Booking.adjustBookingFee(e.totals.bookingFee,e.totals.price,e.totals.tax,c(e))})),l}(i.totals.bookingFee),i.totals.preBookingFeeTotal=i.totals.price+i.totals.tax-r.redeemStoredValueCardsCtrl.totalApplied(),i.totals.total=i.totals.preBookingFeeTotal+i.totals.bookingFee,i.totals.totalDeposits=_.sum(e.entries,(function(e){var n=s(e)-c(e);return e.totals.deposit=t.Booking.effectiveDeposit(e.availability.item,n),i.cartCtrl.getEntryDepositStatus(e,n)?e.totals.deposit:0})),i.totals.amountDue=_.sum(e.entries,(function(e){return i.cartCtrl.getEntryDepositStatus(e,s(e)-c(e))?e.totals.deposit:e.availability.item.settings.isBookingFeeOnly?0:e.totals.price+e.totals.tax-c(e)}))+i.totals.bookingFee,i.totals.bookingFeeOnlyGross=_.sum(e.entries,(function(e){return e.availability.item.settings.isBookingFeeOnly?0:e.totals.price+e.totals.tax}))};r.$watchCollection("cart.entries",(function(){l()})),n(r,{company:i.cartCtrl.company,modelKey:"newOrder",price:i.currentPrice,tax:i.currentTax,toggleName:"applyStoredValueCard",storedValueCardsAppliedByEntry:a}),r.cartCtrl.attachControl("redeemStoredValueCardsCtrl",r.redeemStoredValueCardsCtrl),r.$watch("redeemStoredValueCardsCtrl.storedValueCards.length",(function(e){l()})),r.$watch((function(){var e=r.cartCtrl.paymentCtrl?r.cartCtrl.paymentCtrl.processor():null;return null===e?null:e.PROCESSOR_TYPE}),(function(t){e.updateBookingFees(t),l()}))}],controllerAs:"cartTotalsCtrl"}}]),e.directive("ngCartComplete",["cart",function(e){return{restrict:"A",require:"^ngCart",templateUrl:"cart.complete",controller:["$scope",function(e){}],controllerAs:"cartCompleteCtrl"}}]),e.directive("ngCartAdd",["cart","navigation","urls",function(e,t,n){return{restrict:"A",require:"^ngBook",templateUrl:"cart.add",controller:["$scope",function(n){var r=this;r.isAdding=!1,r.isAvailabilityInCart=!!e.search(n.bookCtrl.availability),r.add=function(){r.isAdding=!0;var i={feeable:n.bookCtrl.bookTotalsCtrl.totals.feeable,price:n.bookCtrl.bookTotalsCtrl.totals.price,tax:n.bookCtrl.bookTotalsCtrl.totals.tax,taxByType:n.bookCtrl.bookTotalsCtrl.totals.taxByType,bookingFee:n.bookCtrl.bookTotalsCtrl.totals.bookingFee,deposit:n.bookCtrl.bookTotalsCtrl.totals.deposit};n.bookCtrl.reflectASN(),n.bookCtrl.isAlreadyBooked=!0,e.add(n.bookCtrl.availability,n.bookCtrl.bookCountsCtrl.customerBreakdown(),i,n.bookCtrl.newBooking,_.get(n.bookCtrl,"bookCountsCtrl.liveCapacity.resourceUses")).then((function(){t.navigate(e.permalinkUrl(n.bookCtrl.item.company))}),(function(){n.bookCtrl.restoreASN(),r.isAdding=!1}))}}],controllerAs:"cartAddCtrl"}}]),e.directive("ngCartSubmit",[function(){return{restrict:"A",require:"^ngCart",templateUrl:"cart.submit"}}]),e.run(["$rootScope","cart",function(e,t){e.cart=t,window.$$cart=t}])}()},7253:function(){!function(){"use strict";var e=angular.module("clientOptions.services",["db","lib","navigation"]);e.factory("clientOptions",["$rootScope","$sniffer","auth","db","events","models","navigation","storage","urls",function(e,t,n,r,i,a,o,s,c){var l="int",u="yes-no",d=/^(?:https?:\/\/)?(?:[a-z0-9\-_]+\.[a-z0-9\-_]+)+.*/i,m=[{query:"u",key:"userIdentifier",reflect:!s.isPersistent(),reflectExternal:function(){return!n.currentUser.isAuthenticated}},{query:"asn",key:"asnAffiliateCompany",reflect:!0},{query:"asn-ref",key:"asnVoucherNumber",reflect:!0},{query:"sheet",key:"defaultTotalSheetPk",reflect:!0,type:l},{query:"sheet-uuid",key:"defaultTotalSheetUuid",reflect:!0},{query:"schedule",key:"defaultTotalSchedulePk",reflect:!0,type:l},{query:"schedule-uuid",key:"defaultTotalScheduleUuid",reflect:!0},{query:"full-items",key:"isFullItemsEnabled",reflect:!0,type:u,isAuthenticatedAllowed:!0},{query:"kiosk",key:"isKioskModeEnabled",isSlipstream:!0,type:u},{query:"ref",key:"onlineBookingReference",reflect:!0,isAuthenticatedAllowed:!0},{query:"referrer",key:"referrerUrl",pattern:d},{query:"back",key:"backUrl",pattern:d,reflect:!0,decode:!0},{query:"is-back-company-url",key:"isBackCompanyUrl",type:u},{query:"preview",key:"preview"},{query:"site-tags",key:"trackingSiteTags",onlyIfDefined:!0,decode:!0},{query:"page-tags",key:"trackingPageTags",onlyIfDefined:!0,decode:!0},{query:"button-tags",key:"trackingButtonTags",onlyIfDefined:!0,decode:!0},{query:"from-ssl",key:"trackingIsFromSsl",type:u,onlyIfDefined:!0},{query:"from-embed",key:"trackingFromEmbed",onlyIfDefined:!0},{query:a.FlowNode.FLOW_QUERY,key:"flowNode",reflect:!0,isUpdatedOnLocationChange:!0,isAuthenticatedAllowed:!0},{query:a.FlowNode.IS_FROM_CART_QUERY,key:"isFromCart",reflect:!0,type:u,isUpdatedOnLocationChange:!0},{query:"bookable-only",key:"isBookableOnly",type:u},{query:"branding",key:"isCompanyBrandingEnabled",reflect:!0,type:u},{query:"rebookingUuid",key:"rebookingUuid",reflect:!0,onlyIfDefined:!0},{query:"gclid",key:"gclid"}],p=_.filter(m,"isUpdatedOnLocationChange"),f=function(e){e=e||_.always;var t={};return _.forEach(m,(function(n){if(e(n)&&n.key){var r=v[n.key];_.isUndefined(r)||(n.type===u?r&&(t[n.query]="yes"):n.type===l?_.isFinite(r)&&(t[n.query]=r):r&&(t[n.query]=r))}})),t},h=function(){return f((function(e){return!!e.reflect}))};e.$on("$locationChangeSuccess",(function(){_.forEach(p,T);var e=h();_.forEach(e,(function(e,t){o.set(t,e,!0)}))})),i.on(e,"navigation.company.updated",(function(){o.currentCompany&&(v.asnCharterCompany?v.asnCharterCompany!==o.currentCompany.shortname&&(v.asnCharterCompany="",v.asnAffiliateCompany="",v.asnVoucherNumber=""):v.asnCharterCompany=o.currentCompany.shortname)}));var g=r.slipstream("domain"),y=r.slipstream("protocol")+"://"+g,v={reflect:function(e){var t=_.find(m,"key",e).query;o.set(t,v[e],!0)},extendUrl:function(e){return o.compose(e,f(),!0)},reflectUrl:function(e){var t,n;if("/"===e.charAt(0)||0===e.indexOf(y))t=h();else{if(0!==e.indexOf("http"))return e;n=f((function(e){return _.isFunction(e.reflectExternal)?e.reflectExternal():!!e.reflectExternal})),t=_.mapKeys(n,(function(e,t){return"fh-"+t}))}return o.compose(e,t,!0)},reflectUrlsInHrefs:function(e){e.on("mousedown","a",(function(){var e=$(this);e.attr("href",v.reflectUrl(e.attr("href")))}))}},T=function(e){var i=o.get(e.query)||"";!i&&e.isSlipstream&&(i=r.slipstream(e.query)||""),n.currentUser.isAuthenticated&&!e.isAuthenticatedAllowed&&(i=""),e.pattern&&!e.pattern.test(i)&&(i=""),e.onlyIfDefined&&!i||(e.type===l?(i=parseInt(i,10),i=isNaN(i)?null:i):e.type===u&&(i="yes"===i),t.history&&!e.isUpdatedOnLocationChange&&o.clear(e.query,!0),e.decode&&(i=decodeURIComponent(i)),e.key&&(v[e.key]=i))};return _.forEach(m,T),n.currentUser.isAuthenticated||(v.asnAffiliateCompany=v.asnAffiliateCompany||r.slipstream("asnAffiliateCompany")||""),v.asnAffiliateCompany||(v.asnAffiliateCompany="",v.asnVoucherNumber=""),v}]),e.run(["$rootScope","clientOptions",function(e,t){e.clientOptions=t}])}()},8145:function(){!function(){"use strict";var e=angular.module("db.services",["cache.services","lib.services"]),t=0;e.factory("db",["$http","$injector","$rootScope","$q","$window","cache","convert","flash","ratelimit","require","urls",function(e,n,r,i,a,o,s,c,l,u,d){var m=!1;angular.element(a).on("beforeunload",(function(){m=!0}));var p={},f=_.debounce((function(){m||c.warn("<b>"+T("Could not reach FareHarbor.")+"</b> "+T("Please check your internet connection."))}),2e3,!0),h=function(e){_.isUndefined(e)&&(e="<b>"+T("That didn't work.")+"</b> "+T("Please try again.")),e&&c.error(e)},g=_.debounce((function(e){c.error("<b>"+interpolate(T("Too many %(errorType)s."),{errorType:e})+"</b> "+T("Please wait a few minutes and try again. If you continue to receive this message please contact")+' <a href="mailto:support@fareharbor.com" target="_blank">support@fareharbor.com</a>.')}),2e3,!0),y=_.debounce((function(){c.error("<b>"+T("FareHarbor will be right back.")+"</b> "+T("Please wait a few minutes and try again."))}),2e3,!0),v=function(e,t,n){return n?_.map(e,(function(e){return o.update(e)})):o.update(e,t)},E=function(r){var a={},m={isDelete404Success:!0},E=r.formName||r.key+"Form";return function(k,A,P,S,O,I){var R,N,w,U=_.extend({},m,r,O),F=!1!==U.flashError,D=!1!==U.flash500Error;if(_.isString(k))R=k;else{var L={};_.extend(L,U.defaultParams||{},k),R=d.populate(U.url,L)}if(N=R,_.isUndefined(R)){console.warn("db: invalid endpoint",U.url,L);var M=U.isArray?[]:{};return M.$promise=i.reject(null),M.$promise.cancel=_.ignore,M}S&&(R+="?"+Ai(s.clientRequest(S)),S=null),U.ignoreQueryParamsInCacheUri||(N=R);var x,B=t+=1;if(console.log("db: endpoint",R,B),(w=a[R])&&!U.ignoreInFlight){if(U.tagAlong)return console.log("db: tagging along",R,B),w.value;"GET"===U.method&&"GET"===w.method&&(console.log("db: already in flight, cancelling",R,B),w.timeout.promise.cancelled=!0,w.timeout.resolve())}if(x=U.ignoreCache?U.isArray?[]:{}:o.read(N,U.isArray),U.eagerCache&&!x.$fresh)return x;var $,G=function(e){return _.isFunction(U.key)?U.key(e):U.key},Y=function(e){e.data&&U.sideKeys&&_.forEach(U.sideKeys,(function(t){var n=e.data[t];n&&(e[t]=v(n,null,_.isArray(n)))}))},V=_.identity;U.key&&(V=U.isArray?function(e){if(console.log("db: success",R,B),x.$requestId!==B)return console.log("db: out of order",R,x.$requestId,B),e;var t=G(e);return _.overwrite(x,v(e.data[t],null,!0)),x.$fresh=!1,e.data?(e.primaryData=e.data[t]=x,Y(e)):e.primaryData=null,P&&C(P,E)(e,x),e}:function(e){if(console.log("db: success",R,B),x.$requestId!==B)return console.warn("db: out of order",R,x.$requestId,B),e;var t=G(e),n=e.data[t];return n=U.ignoreCache?v(n):v(n,N),e.data?(e.primaryData=e.data[t]=n,Y(e)):e.primaryData=null,P&&C(P,E)(e,n),e}),P&&($=b(P,E));var K=function(e){console.log("db: error",R,B,e);var t,r=e.status;return 500===r?(D&&c.error("<b>"+T("Whoops, an internal error has occurred.")+"</b> "+T("FareHarbor has been notified. Please wait a few minutes and try again.")),i.reject(e)):503===r?(y(),i.reject(e)):403===r?(F&&(t='href="'+n.get("navigation").loginRedirectUrl(!0)+'"',c.error("<b>"+T("Not allowed.")+"</b> "+interpolate(T("Please <a %(href)s>log in</a> as a different user or request permission from your administrator."),{href:t}))),i.reject(e)):420===r?(g("connections"),i.reject(e)):429===r?(g("requests"),i.reject(e)):324===r?(f(),i.reject(e)):0===r||-1===r?e.config.timeout&&e.config.timeout.cancelled?p:(f(),i.reject(e)):400===r?($?$(e,r):F&&h(e.data.errorMessage||U.errorMessage),i.reject(e)):404!==r?(h(e.data.errorMessage||U.errorMessage),console.error("db: unknown error",e,r),i.reject(e)):U.isDelete404Success&&"DELETE"===U.method?(console.log("db: treating 404 as success",R,B),V(e)):i.reject(e)},H=function(e){return function(t){var n=e(t);return console.log("db: complete",R,B),U.ignoreInFlight||(a[R]=null),P&&(P.$submitting=!1),x.$requestId===B&&(delete x.$requestId,delete x.$promise),n}};P&&(P.$submitting=!0);var q,W,j=i.defer(),z={method:U.method,url:R,data:A||{},timeout:j.promise,headers:I,transformResponse:(q=e.defaults.transformResponse,W=function(e,t,r){return n.get("auth").checkSession(e,t,R,r)},(q=_.isArray(q)?q:[q]).concat(W))},X=function(){return e(z).then(H(V),H(K))};U.isRatelimited&&(X=l(X));var Q=X();return u.assert(!Q.success&&!Q.error,"db: disallow $http promise interface"),U.ignoreInFlight||(a[R]={timeout:j,value:x,requestId:B,method:U.method,uri:R}),x.$requestId=B,x.$promise=Q,x.$promise.timeout=j,x.$promise.cancel=function(){if(Q.timeout){if(U.tagAlong)return void console.warn("db: attempting to cancel a tag-along to request",R,B);Q.timeout.promise.cancelled=!0,Q.timeout.resolve(),U.ignoreInFlight||(a[R]=null),console.log("db: cancelled",R,B)}else console.warn("db: cancellation failed",R,B)},x}},b=function(e,t){return function(n){var r=n.data[t];_.forEach(r,(function(t,n){e[n]||(e[n]={$error:{}});var r=e[n];t&&t.length?r.$error.$server=t:r.$error={}})),e.$errorCallbacks&&_.forEach(e.$errorCallbacks,(function(e){e(r)}))}},C=function(e,t){return function(t,n){_.forEach(e,(function(e,t){e&&e.$error&&delete e.$error.$server})),e.$successCallbacks&&_.forEach(e.$successCallbacks,(function(e){e(n)}))}},k=function(e,t){t||(t=e+"s");var n=E({method:"GET",url:d.api[t],isArray:!0,key:t});return n.create=E({method:"POST",url:d.api[t],key:e}),n},A=function(e){var t=E({method:"GET",url:d.api[e],key:e});return t.update=E({method:"PUT",url:d.api[e],key:e}),t.remove=E({method:"DELETE",url:d.api[e],formName:"disableForm"}),t},P=function(e){return function(t,n,r,i,a,o){return E({method:e.method||null,url:e.url||null,key:e.key||null,formName:e.formName||null,flash500Error:e.flash500Error})(t,r,i,a,o,n)}},S=function(e,t,n){var r={};return r[t]=_.isUndefined(n)?"yes":n,function(t,n,i,a,o){return a=_.extend({},r,a),e(t,n,i,a,o)}},O=function(e){return S(e,"pickable")},I=function(e){return S(e,"all")},R=E({method:"POST",url:d.api.login,key:"user",formName:"loginForm"}),N={};N.password=E({method:"POST",url:d.api.forgotPassword,formName:"forgotPasswordForm"}),N.password.reset=E({method:"POST",url:d.api.resetPassword,formName:"resetPasswordForm"}),N.credentials=E({method:"POST",url:d.api.forgotCredentials,formName:"forgotCredentialsForm"});var w=E({method:"GET",url:d.api.reportTest,key:"report"}),U=E({method:"GET",url:d.api.companies,isArray:!0,key:"companies"});U.pickable=O(U),U.jump=S(U,"jump"),U.full=S(U,"full"),U.create=E({method:"POST",url:d.api.companies,key:"company"}),U.admin=E({method:"GET",url:d.api.company,key:"company",defaultParams:{shortname:"admin"}}),U.report=E({method:"GET",url:d.api.reportCompanies,key:"report"});var F=E({method:"GET",url:d.api.company,key:"company"});F.update=E({method:"PUT",url:d.api.company,key:"company"}),F.remove=E({method:"DELETE",url:d.api.company,formName:"disableForm"}),F.styles={},F.styles.update=E({method:"PUT",url:d.api.companyStyles,key:"styles",formName:"companyStylesForm"}),F.adminNotes={},F.adminNotes.update=E({method:"PUT",url:d.api.companyAdminNotes,key:"adminNotes",formName:"companyAdminNotesForm"}),F.accounts=E({method:"GET",url:d.api.companyAccounts,isArray:!0,key:"accounts"}),F.accounts.report=E({method:"GET",url:d.api.reportAccounts,key:"report"}),F.nags={},F.nags.update=E({method:"PUT",url:d.api.companyNags,key:"companyNags",formName:"companyNagsForm"}),F.companyFeatures={},F.companyFeatures.update=E({method:"PUT",url:d.api.companyFeatures,key:"companyFeatures",formName:"companyFeaturesForm"}),F.refundReserve={},F.refundReserve.update=E({method:"PUT",url:d.api.refundReserve,key:"companyFeatures",formName:"refundReserveForm"}),F.itemColorsFeature={},F.itemColorsFeature.update=E({method:"PUT",url:d.api.companyItemColorsFeature,key:"companyItemColorsFeature",formName:"companyItemColorsFeatureForm"}),F.contactInformation={},F.contactInformation.update=E({method:"PUT",url:d.api.companyContactInformation,key:"contactInformation",formName:"companyContactInformationForm"}),F.processorAccount={},F.processorAccount.create=E({method:"POST",url:d.api.processorAccount,key:"processorAccount"}),F.tosAcceptance={},F.tosAcceptance.update=E({method:"PUT",url:d.api.companyTosAcceptance,key:"tosAcceptance",formName:"companyTosAcceptanceForm"}),F.processorOnboard={},F.processorOnboard.update=E({method:"PUT",url:d.api.processorOnboard,key:"processorOnboard",formName:"processorOnboardForm"}),F.processorCompleteAccountSetup={},F.processorCompleteAccountSetup.update=E({method:"PUT",url:d.api.processorCompleteAccountSetup,key:"processorCompleteAccountSetup",formName:"processorCompleteAccountSetupForm"}),F.escrowReport=E({method:"GET",url:d.api.reportEscrow,key:"report"}),F.profile={},F.profile.update=E({method:"PUT",url:d.api.companyProfile,key:"profile",formName:"companyProfileForm"}),F.payments={},F.payments.update=E({method:"PUT",url:d.api.companyPayments,key:"payments",formName:"companyPaymentsForm"}),F.manifestSettings={},F.manifestSettings.update=E({method:"PUT",url:d.api.companyManifestSettings,key:"manifestSettings",formName:"manifestSettingsForm"}),F.images=E({method:"GET",url:d.api.companyImages,key:"images",isArray:!0}),F.images.create=E({method:"POST",url:d.api.companyImages,key:"image"}),F.image={},F.image.update=E({method:"PUT",url:d.api.companyImage,key:"image"}),F.image.remove=E({method:"DELETE",url:d.api.companyImage}),F.activities={},F.activities.all=E({method:"GET",url:d.api.allActivities,isArray:!0,key:"activities"}),F.activities.system=E({method:"GET",url:d.api.systemActivities,isArray:!0,key:"activities"}),F.activities.admin=S(F.activities.system,"admin"),F.calendar=E({method:"GET",url:d.api.companyCalendar,key:"calendar"}),F.summaryReport={},F.summaryReport.items=E({method:"GET",url:d.api.reportItemsSummary,key:"report"}),F.summaryReport.users=E({method:"GET",url:d.api.reportUsersSummary,key:"report"}),F.summaryReport.bookingTypes=E({method:"GET",url:d.api.reportBookingTypesSummary,key:"report"}),F.summaryReport.customerTypes=E({method:"GET",url:d.api.reportCustomerTypesSummary,key:"report"}),F.summaryReport.customField=E({method:"GET",url:d.api.reportCustomFieldSummary,key:"report"}),F.summaryReport.lodgings=E({method:"GET",url:d.api.reportLodgingsSummary,key:"report"}),F.summaryReport.pickups=E({method:"GET",url:d.api.reportPickupsSummary,key:"report"}),F.summaryReport.crew=E({method:"GET",url:d.api.reportCrewSummary,key:"report"}),F.summaryReport.agents=E({method:"GET",url:d.api.reportAgentsSummary,key:"report"}),F.summaryReport.desks=E({method:"GET",url:d.api.reportDesksSummary,key:"report"}),F.summaryReport.campaigns=E({method:"GET",url:d.api.reportCampaignsSummary,key:"report"}),F.summaryReport.revenue=E({method:"GET",url:d.api.reportRevenueSummary,key:"report"}),F.advancedReport=E({method:"POST",url:d.api.reportAdvanced,key:"report"}),F.seatZones=E({method:"GET",isArray:!0,url:d.api.companySeatZones,key:"seatZones"});var D=k("group"),L=A("group");L.duplicate=E({method:"POST",url:d.api.duplicateGroup,key:"group",formName:"duplicateGroupForm"}),L.remove=E({method:"DELETE",url:d.api.group,formName:"disableForm"});var M=k("groupOverride");M.related=E({method:"GET",url:d.api.relatedGroupOverrides,isArray:!0,key:"groupOverrides"});var x=A("groupOverride");x.activities=E({method:"GET",url:d.api.groupOverrideActivities,isArray:!0,key:"activities"});var B=k("bankAccount"),$=A("bankAccount");$.remove=E({method:"DELETE",url:d.api.bankAccount,key:"bankAccount",formName:"disableForm"}),$.verify=E({method:"PUT",url:d.api.verifyBankAccount,key:"verifiedBankAccount",formName:"verifyBankAccountForm"});var G=k("card"),Y=A("card");Y.remove=E({method:"DELETE",url:d.api.card,key:"disableForm"});var V=E({method:"GET",url:d.api.cardAffiliations,isArray:!0,key:"cardAffiliations"});V.create=E({method:"POST",url:d.api.cardAffiliations,isArray:!0,key:"cardAffiliations",form:"cardAffiliationsForm"});var K=k("customManifest"),H=A("customManifest"),q=k("customCalendar"),W=A("customCalendar"),j=k("customReport"),z=A("customReport"),X=E({method:"GET",url:d.api.users,isArray:!0,key:"users"});X.pickable=O(X),X.all=E({method:"GET",url:d.api.allUsers,isArray:!0,key:"users"}),X.related=E({method:"GET",url:d.api.relatedUsers,isArray:!0,key:"users"}),X.create=E({method:"POST",url:d.api.users,key:"user",formName:"createUserForm"});var Q=E({method:"GET",url:d.api.user,key:"user"});Q.update=E({method:"PUT",url:d.api.user,key:"user",formName:"updateUserForm"}),Q.remove=E({method:"DELETE",url:d.api.user}),Q.activities=E({method:"GET",url:d.api.userActivities,isArray:!0,key:"activities"}),Q.subscriptions=E({method:"GET",url:d.api.userSubscriptions,isArray:!0,key:"subscriptions"}),Q.itemSubscriptions=E({method:"GET",url:d.api.userItemSubscriptions,isArray:!0,key:"subscriptions"}),Q.itemSubscriptions.update=E({method:"POST",url:d.api.userItemSubscriptions,isArray:!0,key:"subscriptions"}),Q.overview=E({method:"GET",url:d.api.userOverview,key:"overview"}),Q.nags={},Q.nags.update=E({method:"PUT",url:d.api.userNags,key:"userNags",formName:"userNagsForm"});var Z=k("item");Z.pickable=O(Z),Z.public=S(Z,"public"),Z.all=E({method:"GET",url:d.api.allItems,isArray:!0,key:"items"}),Z.calendar=E({method:"GET",url:d.api.itemsCalendar,key:"calendar"});var J=A("item");J.pricingOverview=E({method:"GET",url:d.api.itemPricingOverview,key:"pricingOverview"}),J.color=E({method:"PUT",url:d.api.itemColor,key:"color",formName:"updateItemColorForm"}),J.calendar=E({method:"GET",url:d.api.itemCalendar,key:"calendar"}),J.duplicate=E({method:"POST",url:d.api.duplicateItem,key:"item"}),J.subscriptions=E({method:"GET",url:d.api.itemSubscriptions,isArray:!0,key:"subscriptions"}),J.images=E({method:"GET",url:d.api.itemImages,key:"images",isArray:!0}),J.images.create=E({method:"POST",url:d.api.itemImages,key:"image"}),J.image={},J.image.update=E({method:"PUT",url:d.api.itemImage,key:"image"}),J.image.remove=E({method:"DELETE",url:d.api.itemImage}),J.reviewExpressSettings={},J.reviewExpressSettings.update=E({method:"PUT",url:d.api.reviewExpressSettings,key:"reviewExpressSettings",form:"reviewExpressSettingsForm"}),J.picthriveSettings={},J.picthriveSettings.update=E({method:"PUT",url:d.api.picthriveSettings,key:"picthriveSettings",formName:"picthriveSettingsForm"}),J.ratings=E({method:"GET",url:d.api.itemRatings,key:"ratings"}),J.flowPages=E({method:"GET",isArray:!0,url:d.api.itemFlowPages,key:"flowNodes"}),J.flowPages.full=S(J.flowPages,"full"),J.futureAvailabilityCount=E({method:"GET",url:d.api.futureAvailabilityCount,key:"futureAvailabilityCount"}),J.isQueued=E({method:"GET",url:d.api.isItemQueued,key:"queuedStatus"}),J.hasFutureAvailsUsingCompanyLevelCfig=E({method:"GET",url:d.api.itemHasFutureAvailsUsingCompanyLevelCfig,key:"hasFutureAvails"});var ee=A("flowNode"),te=function(){var e=n.get("flows");return e.wrapEndpoint(ee).apply(null,arguments)};te.update=ee.update,te.remove=ee.remove;var ne=E({method:"GET",url:d.api.defaultFlowPage,key:"defaultFlowPage"});te.withDescendants=S(E({method:"GET",url:d.api.flowNode,key:"flowNode",ignoreQueryParamsInCacheUri:!0}),"descendants"),te.duplicate=E({method:"POST",url:d.api.duplicateFlowNode,key:"flowNode"});var re=k("flowNode");re.multi=E({method:"POST",url:d.api.flowNodes,isArray:!0,key:"flowNodes",formName:"flowNodeForm"}),re.root=S(re,"root"),re.root.create=S(re.create,"root"),re.pages=S(re,"pages");var ie=E({method:"GET",url:d.api.affiliates,isArray:!0,key:"affiliations"});ie.all=E({method:"GET",url:d.api.allAffiliates,isArray:!0,key:"affiliations"}),ie.pickable=O(ie),ie.create=E({method:"POST",url:d.api.affiliates,key:"affiliation",formName:"createAffiliationForm"});var ae=E({method:"GET",url:d.api.affiliate,key:"affiliation"});ae.update=E({method:"PUT",url:d.api.affiliate,key:"affiliation",formName:"updateAffiliationForm"}),ae.remove=E({method:"DELETE",url:d.api.affiliate,formName:"disableForm"});var oe=E({method:"GET",url:d.api.affiliateCards,key:"cards",isArray:!0,flashError:!1}),se=E({method:"GET",url:d.api.affiliateCardAffiliations,key:"cardAffiliations",isArray:!0,flashError:!1}),ce=E({method:"GET",url:d.api.partners,isArray:!0,key:"affiliations"});ce.all=I(ce),ce.pickable=O(ce),ce.minimal=function(e){return S(e,"minimal")}(ce);var le=E({method:"GET",url:d.api.partner,key:"partner"});le.remove=E({method:"DELETE",url:d.api.partner,formName:"disableForm"});var ue=E({method:"GET",url:d.api.partnerCards,key:"cards",isArray:!0,flashError:!1}),de=E({method:"GET",url:d.api.partnerCardAffiliations,key:"cardAffiliations",isArray:!0,flashError:!1}),me=k("agent");me.all=E({method:"GET",url:d.api.allAgents,isArray:!0,key:"agents"});var pe=A("agent"),fe=k("desk");fe.all=E({method:"GET",url:d.api.allDesks,isArray:!0,key:"desks"});var he=A("desk"),ge=k("hotel"),ye=A("hotel"),ve=k("lodging");ve.duplicate=E({method:"POST",url:d.api.duplicateLodgingsAcrossCompanies,formName:"duplicateLodgingsAcrossCompaniesForm",key:"lodgings",isArray:!0});var Te=A("lodging"),Ee=k("preferredPickup"),_e=A("preferredPickup"),be=k("pickup");be.duplicate=E({method:"POST",url:d.api.duplicatePickupsAcrossCompanies,formName:"duplicatePickupsAcrossCompaniesForm",key:"pickups",isArray:!0});var Ce=A("pickup"),ke=k("route");ke.pickable=O(ke),ke.duplicate=E({method:"POST",url:d.api.duplicateRoutesAcrossCompanies,formName:"duplicateRoutesAcrossCompaniesForm",key:"routes",isArray:!0});var Ae=E({method:"GET",url:d.api.route,key:"route",ignoreQueryParamsInCacheUri:!0});Ae.update=E({method:"PUT",url:d.api.route,key:"route"}),Ae.remove=E({method:"DELETE",url:d.api.route,formName:"disableForm"}),Ae.items=E({method:"GET",url:d.api.routeItems,isArray:!0,key:"items"}),Ae.duplicate=E({method:"POST",url:d.api.duplicateRoute,key:"route",formName:"duplicateRouteForm"});var Pe=k("stop"),Se=A("stop"),Oe={};Oe.searchByDate=E({method:"GET",url:d.api.searchRunsByDate,isArray:!0,key:"runs"}),Oe.manifest=E({method:"GET",url:d.api.runsManifest,isArray:!0,key:"runs"});var Ie=E({method:"GET",url:d.api.campaigns,isArray:!0,key:"campaigns"});Ie.create=E({method:"POST",url:d.api.campaigns,key:"campaign"});var Re=E({method:"GET",url:d.api.campaign,key:"campaign"});Re.update=E({method:"PUT",url:d.api.campaign,key:"campaign"}),Re.remove=E({method:"DELETE",url:d.api.campaign,formName:"disableForm"}),Re.customFields=E({method:"GET",url:d.api.campaignCustomFields,isArray:!0,key:"customFields"});var Ne=E({method:"GET",url:d.api.campaignValidityRules,isArray:!0,key:"campaignValidityRules"});Ne.create=E({method:"POST",url:d.api.campaignValidityRules,key:"campaignValidityRule",formName:"createCampaignValidityRuleForm"});var we=E({method:"GET",url:d.api.campaignValidityRule,key:"campaignValidityRule"});we.remove=E({method:"DELETE",url:d.api.campaignValidityRule,formName:"disableForm"});var Ue=E({method:"GET",url:d.api.codes,isArray:!0,key:"codes"});Ue.create=E({method:"POST",url:d.api.codes,key:"codes",isArray:!0,formName:"createCodesForm"}),Ue.byTag={},Ue.byTag.clear=E({method:"DELETE",url:d.api.codesByTag});var Fe=E({method:"GET",url:d.api.code,key:"code"});Fe.update=E({method:"PUT",url:d.api.code,key:"code",formName:"updateCodeForm"}),Fe.remove=E({method:"DELETE",url:d.api.code});var De=k("storedValueType"),Le=A("storedValueType"),Me=E({method:"GET",url:d.api.storedValueCards,isArray:!0,key:"storedValueCards"});Me.create=E({method:"POST",url:d.api.storedValueCards,key:"storedValueCards",isArray:!0,formName:"createStoredValueCardsForm"}),Me.issue=E({method:"POST",url:d.api.issueStoredValueCard,key:"storedValueCard",formName:"issueStoredValueCardForm"}),Me.search=E({method:"GET",url:d.api.searchStoredValueCardsByNumber,key:"searchResult"});var xe=A("storedValueCard");xe.payments=E({method:"GET",url:d.api.storedValueCardPayments,isArray:!0,key:"payments"}),xe.notifications={},xe.notifications.create=E({method:"POST",url:d.api.storedValueCardNotifications,isArray:!0,key:"notifications",formName:"storedValueCardNotificationForm"});var Be=k("storedValueAdjustment"),$e=A("storedValueAdjustment");delete $e.update,delete $e.remove;var Ge=k("document"),Ye=E({method:"GET",url:d.api.paymentProcessingDocument,isArray:!0,key:"pk"}),Ve=k("resellerCompany","resellerCompanies"),Ke=A("resellerCompany"),He=k("resellerCompanyMapping"),qe=A("resellerCompanyMapping"),We=k("resellerItem"),je=A("resellerItem"),ze=k("resellerItemMapping"),Xe=A("resellerItemMapping"),Qe=k("resellerCustomerType"),Ze=A("resellerCustomerType"),Je=k("resellerCustomerTypeMapping"),et=A("resellerCustomerTypeMapping"),tt=k("resellerOption"),nt=A("resellerOption"),rt=k("resellerOptionMapping"),it=A("resellerOptionMapping"),at=E({method:"GET",url:d.api.resellerUnmappedItems,isArray:!0,key:"items"}),ot=E({method:"GET",url:d.api.resellerUnmappedCustomerPrototypes,isArray:!0,key:"customerPrototypes"}),st=k("resellerKey"),ct=A("resellerKey"),lt=k("resellerApp"),ut=A("resellerApp"),dt=k("resellerAppRequest"),mt=A("resellerAppRequest");dt.refresh=S(dt,"refresh");var pt=k("resellerAppCompany","resellerAppCompanies"),ft=A("resellerAppCompany"),ht=E({method:"GET",url:d.api.customFields,isArray:!0,key:"customFields"});ht.includeArchived=S(ht,"include-archived"),ht.all=E({method:"GET",url:d.api.allCustomFields,isArray:!0,key:"customFields"}),ht.create=E({method:"POST",url:d.api.customFields,key:"customField",formName:"createCustomFieldForm"});var gt=E({method:"GET",url:d.api.customField,key:"customField"});gt.items=E({method:"GET",url:d.api.customFieldItems,key:"items",isArray:!0}),gt.companyCustomFieldInstanceGroups=E({method:"GET",url:d.api.customFieldCompanyCustomFieldGroups,key:"customFieldInstanceGroups",isArray:!0}),gt.duplicate=E({method:"POST",url:d.api.duplicateCustomField,key:"customField",formName:"duplicateCustomFieldForm"}),gt.prevalidate=E({method:"POST",url:d.api.prevalidateCustomField,key:"prevalidity",formName:"prevalidateCustomFieldForm",flashError:!1}),gt.update=E({method:"PUT",url:d.api.customField,key:"customField",formName:"updateCustomFieldForm"}),gt.remove=E({method:"DELETE",url:d.api.customField,formName:"disableForm"});var yt={};yt.create=E({method:"POST",url:d.api.transportationOptions,key:"transportationOption"});var vt={};vt.update=E({method:"PUT",url:d.api.transportationOption,key:"transportationOption"}),vt.remove=E({method:"DELETE",url:d.api.transportationOption});var Tt={};Tt.create=E({method:"POST",url:d.api.extendedOptions,key:"extendedOption",formName:"createExtendedOptionForm"});var Et={};Et.update=E({method:"PUT",url:d.api.extendedOption,key:"extendedOption",formName:"updateExtendedOptionForm"}),Et.remove=E({method:"DELETE",url:d.api.extendedOption,key:"extendedOption",formName:"disableForm"});var _t={};_t.create=E({method:"POST",url:d.api.connectedCampaigns,key:"connectedCampaign",formName:"createConnectedCampaignForm"});var bt={};bt.remove=E({method:"DELETE",url:d.api.connectedCampaign});var Ct={};Ct.create=E({method:"POST",url:d.api.generatingCampaigns,key:"generatingCampaign",formName:"generatingCampaignForm"});var kt={};kt.update=E({method:"PUT",url:d.api.generatingCampaign,key:"generatingCampaign",formName:"generatingCampaignForm"}),kt.remove=E({method:"DELETE",url:d.api.generatingCampaign});var At=E({method:"GET",url:d.api.itemCustomFieldInstanceGroups,isArray:!0,key:"customFieldInstanceGroups"});At.includeArchived=S(At,"include-archived"),At.create=E({method:"POST",url:d.api.itemCustomFieldInstanceGroups,key:"customFieldInstanceGroup"});var Pt=E({method:"GET",url:d.api.companyCustomFieldInstanceGroups,isArray:!0,key:"customFieldInstanceGroups"});Pt.includeArchived=S(Pt,"include-archived"),Pt.create=E({method:"POST",url:d.api.companyCustomFieldInstanceGroups,key:"customFieldInstanceGroup"});var St=A("customFieldInstanceGroup");St.multi=E({method:"POST",url:d.api.customFieldInstanceGroupsMulti,isArray:!0,key:"customFieldInstanceGroups",formName:"customFieldInstanceGroupsForm"}),St.remove=E({method:"DELETE",url:d.api.customFieldInstanceGroup,key:"customFieldInstanceGroup",formName:"disableForm"}),St.duplicate=E({method:"POST",url:d.api.duplicateCustomFieldInstanceGroup,key:"customFieldInstanceGroup",formName:"duplicateForm"}),St.items=E({method:"GET",url:d.api.customFieldInstanceGroupItems,isArray:!0,key:"items"});var Ot=A("customFieldInstance"),It=k("customFieldInstance");It.multi=E({method:"POST",url:d.api.customFieldInstancesMulti,isArray:!0,key:"customFieldInstances",formName:"customFieldInstancesForm"}),It.forPushedCustomFieldValues=E({method:"GET",url:d.api.customFieldInstancesForPushedCustomFieldValues,key:"customFieldInstances",isArray:!0});var Rt=A("customFieldInstanceCondition"),Nt=k("customFieldInstanceCondition"),wt=A("supportedLanguage"),Ut=k("supportedLanguage"),Ft=E({method:"GET",url:d.api.translations,key:"translations"}),Dt=E({method:"GET",url:d.api.translationsForModel,key:"translationsForModel",isArray:!0});Dt.includeArchived=S(Dt,"include-archived");var Lt=E({method:"GET",url:d.api.translationsForField,key:"translationsAndSourceField"});Lt.update=E({method:"POST",url:d.api.translationsForField,key:"updatedTranslations",formName:"translationsForFieldForm",isArray:!0});var Mt=E({method:"GET",url:d.api.understoodLanguages,key:"understoodLanguages"}),xt=E({method:"GET",url:d.api.translationsForSubfield,key:"translationsAndSourceField"});xt.update=E({method:"POST",url:d.api.translationsForSubfield,key:"updatedTranslations",formName:"translationsForFieldForm",isArray:!0});var Bt=E({method:"GET",url:d.api.roles,isArray:!0,key:"roles"});Bt.create=E({method:"POST",url:d.api.roles,key:"role"});var $t=E({method:"GET",url:d.api.role,key:"role"});$t.update=E({method:"PUT",url:d.api.role,key:"role"}),$t.remove=E({method:"DELETE",url:d.api.role});var Gt=E({method:"GET",url:d.api.crewMembers,isArray:!0,key:"crewMembers"});Gt.create=E({method:"POST",url:d.api.crewMembers,key:"crewMember"});var Yt=E({method:"GET",url:d.api.crewMember,key:"crewMember"});Yt.update=E({method:"PUT",url:d.api.crewMember,key:"crewMember"}),Yt.remove=E({method:"DELETE",url:d.api.crewMember,key:"crewMember"});var Vt=A("customerType");Vt.items=E({method:"GET",url:d.api.customerTypeItems,key:"items",isArray:!0});var Kt=k("customerType");Kt.includeArchived=S(Kt,"include-archived"),Kt.all=E({method:"GET",url:d.api.allCustomerTypes,isArray:!0,key:"customerTypes"});var Ht=A("customerPrototype");Ht.duplicate=E({method:"POST",url:d.api.duplicateCustomerPrototype,key:"customerPrototype",formName:"duplicateForm"});var qt=k("customerPrototype");qt.all=E({method:"GET",url:d.api.allCustomerPrototypes,isArray:!0,key:"customerPrototypes"}),qt.multi=E({method:"POST",url:d.api.customerPrototypesMulti,isArray:!0,key:"customerPrototypes",formName:"customerPrototypesForm"});var Wt=A("checkinStatus"),jt=k("checkinStatus","checkinStatuses");Wt.updateBookings=E({method:"PUT",url:d.api.checkinStatusForBookings,key:"bookings",isArray:!0,formName:"updateCheckinStatusForBookingsForm"});var zt=k("cannedMessage"),Xt=A("cannedMessage");Xt.items=E({method:"GET",url:d.api.cannedMessageItems,key:"items",isArray:!0}),Xt.availabilityHeadlines=E({method:"GET",url:d.api.cannedMessageAvailabilityHeadlines,key:"availabilityHeadlines",isArray:!0});var Qt=k("availabilityHeadline"),Zt=A("availabilityHeadline");Zt.items=E({method:"GET",url:d.api.availabilityHeadlineItems,key:"items",isArray:!0});var Jt={};Jt.next=E({method:"GET",url:d.api.nextAvailability,key:"availability"}),Jt.update=E({method:"POST",url:d.api.updateAvailabilities,formName:"updateAvailabilitiesForm",key:"updateAvailabilities"}),Jt.updateByItem=E({method:"POST",url:d.api.updateItemAvailabilities,formName:"updateAvailabilitiesForm",key:"updateAvailabilities"}),Jt.byDate=E({method:"GET",url:d.api.availabilitiesByDate,isArray:!0,key:"availabilities"}),Jt.byTag={},Jt.byTag.clear=E({method:"DELETE",url:d.api.availabilitiesByTag,formName:"disableForm"}),Jt.futureCount=E({method:"GET",url:d.api.futureAvailabilityCount,key:"futureAvailabilityCount"}),Jt.searchByDate=E({method:"GET",url:d.api.searchAvailabilitiesByDate,isArray:!0,key:"availabilities",sideKeys:["nextBookableStartAt"]}),Jt.searchAllByDate=E({method:"GET",url:d.api.searchAllAvailabilitiesByDate,isArray:!0,key:"availabilities",sideKeys:["nextBookableStartAt"]}),Jt.searchByPk=E({method:"GET",url:d.api.searchAvailabilitiesByPk,isArray:!0,key:"availabilities"}),Jt.manifest=E({method:"GET",url:d.api.availabilitiesManifest,isArray:!0,key:"availabilities",sideKeys:["bookings","bookingCounts","crewMembers","sonarAvailabilities"]}),Jt.manifestSelectable=E({method:"GET",url:d.api.manifestSelectableAvailabilities,isArray:!0,key:"availabilities"}),Jt.searchByUpcoming=E({method:"GET",url:d.api.searchAvailabilitiesByUpcoming,isArray:!0,key:"availabilities"}),Jt.rule=E({method:"POST",url:d.api.rule,key:"createdAvailabilities",formName:"ruleForm"}),Jt.withResourceRequirements=E({method:"GET",url:d.api.availabilitiesWithResourceRequirements,key:"availabilities",isArray:!0});var en=E({method:"GET",url:d.api.availability,key:"availability"});en.update=E({method:"PUT",url:d.api.availability,key:"availability",formName:"updateAvailabilityForm"}),en.status={},en.status.update=E({method:"PUT",url:d.api.availabilityStatus,key:"availabilityStatus",formName:"updateAvailabilityStatusForm"}),en.book=P({method:"POST",url:d.api.book,key:"booking",formName:"bookForm"}),en.liveCapacity=E({method:"GET",url:d.api.availabilityLiveCapacity,key:"liveCapacity",formName:"liveCapacityForm"}),en.resourceUses=E({method:"GET",url:d.api.availabilityResourceUses,key:"resourceUses",isArray:!0}),en.remove=E({method:"DELETE",url:d.api.availability,formName:"disableForm"}),en.notifications=E({method:"POST",url:d.api.notifications,formName:"notificationsForm"}),en.notificationOptions={},en.notificationOptions.update=E({method:"PUT",url:d.api.availabilityNotificationOptions,key:"notificationOptions",formName:"updateAvailabilityNotificationOptionsForm"}),en.note={},en.note=E({method:"PUT",url:d.api.availabilityNote,key:"note",formName:"updateAvailabilityNoteForm"}),en.smsNotifications={},en.smsNotifications.create=E({method:"POST",url:d.api.smsNotifications,formName:"smsNotificationsForm"}),en.checkinStatuses=E({method:"GET",url:d.api.availabilityCheckinStatuses,isArray:!0,key:"bookings"}),en.seatRequirements=E({method:"GET",url:d.api.seatRequirements,isArray:!0,key:"requirements"});var tn={};tn.create=E({method:"POST",url:d.api.customerTypeRates,key:"customerTypeRate"});var nn={};nn.remove=E({method:"DELETE",url:d.api.customerTypeRate,formName:"disableForm"}),nn.update=E({method:"PUT",url:d.api.customerTypeRate,key:"customerTypeRate"});var rn=k("block"),an=A("block"),on={};on.availability=E({method:"GET",url:d.api.subjectsAvailability,key:"subjects"}),on.booking=E({method:"GET",url:d.api.subjectsBooking,key:"subjects"}),on.order=E({method:"GET",url:d.api.subjectsOrder,key:"subjects"});var sn=A("contact");sn.bookings={},sn.bookings.update=E({method:"PUT",url:d.api.contactBookings,key:"modified"});var cn={};cn.report=E({method:"GET",url:d.api.reportContacts,key:"report"});var ln=E({method:"GET",url:d.api.contactPayments,isArray:!0,key:"payments"}),un=E({method:"GET",url:d.api.order,key:"order",sideKeys:["customersWithSeatAssignments"]}),dn=E({method:"GET",url:d.api.order,key:"order",ignoreQueryParamsInCacheUri:!0});un.wait=S(dn,"wait"),un.notification=E({method:"POST",url:d.api.orderNotification,formName:"orderNotificationForm"}),un.cancel=E({method:"POST",url:d.api.orderCancellation,key:"order",formName:"cancelOrderBookingsForm"}),un.customersWithSeatAssignments=E({method:"GET",url:d.api.orderCustomersWithSeatAssignments,key:"customersWithSeatAssignments"});var mn={};mn.create=P({method:"POST",url:d.api.orders,key:"order",formName:"orderForm"});var pn=E({method:"GET",url:d.api.orderPayments,isArray:!0,key:"payments"});pn.create=E({method:"POST",url:d.api.orderPayments,key:"payments"}),pn.refund=E({method:"POST",url:d.api.orderRefunds,isArray:!0,key:"payments"});var fn=E({method:"GET",url:d.api.bookings,isArray:!0,key:"bookings"});fn.byContact=E({method:"GET",url:d.api.bookingsByContact,isArray:!0,key:"bookings"}),fn.searchByQuery=E({method:"GET",url:d.api.searchBookingsByQuery,isArray:!0,key:"bookings"}),fn.searchByNew=E({method:"GET",url:d.api.searchBookingsByNew,isArray:!0,key:"bookings"}),fn.report=E({method:"GET",url:d.api.reportBookings,key:"report"}),fn.invoiceableReport=E({method:"GET",url:d.api.reportInvoiceableBookings,key:"report"}),fn.manifest=E({method:"GET",url:d.api.bookingsManifest,isArray:!0,key:"bookings"}),fn.searchByUuid=E({method:"GET",url:d.api.searchBookingsByUuid,isArray:!0,key:"bookings"});var hn=E({method:"GET",url:d.api.booking,key:"booking",sideKeys:["customersWithSeatAssignments"]});hn.customersWithSeatAssignments=E({method:"GET",url:d.api.bookingCustomersWithSeatAssignments,key:"customersWithSeatAssignments"}),hn.withScheduleEntryRules=S(E({method:"GET",url:d.api.booking,key:"booking",ignoreQueryParamsInCacheUri:!0}),"withScheduleEntryRules");var gn=E({method:"GET",url:d.api.booking,key:"booking",ignoreQueryParamsInCacheUri:!0});hn.wait=S(gn,"wait"),hn.byPk=E({method:"GET",url:d.api.bookingByPk,key:"booking",ignoreCache:!0}),hn.reprice=E({method:"PUT",url:d.api.repriceBooking,key:"repricing",formName:"repriceBookingForm"}),hn.notification=E({method:"POST",url:d.api.notification,formName:"notificationForm"}),hn.smsNotification=E({method:"POST",url:d.api.smsNotification,formName:"smsNotificationForm"}),hn.cancel=E({method:"DELETE",url:d.api.booking,key:"booking",formName:"cancelBookingForm"}),hn.note={},hn.note.update=E({method:"PUT",url:d.api.bookingNote,key:"note",formName:"updateBookingNoteForm"}),hn.explicitGross={},hn.explicitGross.update=E({method:"PUT",url:d.api.bookingExplicitGross,key:"explicitGross",formName:"updateBookingExplicitGrossForm"}),hn.explicitInvoicePrice={},hn.explicitInvoicePrice.update=E({method:"PUT",url:d.api.bookingExplicitInvoicePrice,key:"explicitInvoicePrice",formName:"updateBookingExplicitInvoicePriceForm"}),hn.notificationOptions={},hn.notificationOptions.update=E({method:"PUT",url:d.api.bookingNotificationOptions,key:"notificationOptions",formName:"updateBookingNotificationOptionsForm"}),hn.affiliation={},hn.affiliation.update=E({method:"PUT",url:d.api.affiliation,key:"affiliation"}),hn.checkinStatus={},hn.checkinStatus.update=E({method:"PUT",url:d.api.bookingCheckinStatus,key:"bookingCheckinStatus",formName:"updateBookingCheckinStatusForm"}),hn.effectiveCancellationRule=E({method:"GET",url:d.api.bookingEffectiveCancellationRule,key:"cancellationRule"});var yn={checkinStatus:{}};yn.checkinStatus.update=E({method:"PUT",url:d.api.customerCheckinStatus,key:"customerCheckinStatus",formName:"updateCustomerCheckinStatusForm"});var vn={};vn.find=E({method:"GET",url:d.api.searchCustomersByEncodedPk,key:"booking"}),vn.withSeats=E({method:"GET",url:d.api.customersWithSeats,isArray:!0,key:"customers"});var Tn={};Tn.update=E({method:"PUT",url:d.api.bookingCustomFieldValue,key:"customFieldValue"}),Tn.remove=E({method:"DELETE",url:d.api.bookingCustomFieldValue});var En={};En.update=E({method:"PUT",url:d.api.customerCustomFieldValue,key:"customFieldValue"}),En.remove=E({method:"DELETE",url:d.api.customerCustomFieldValue});var _n=E({method:"POST",url:d.api.pushCustomFieldValues,key:"customFieldValues",isArray:!0,sideKeys:["booking"],formName:"pushCustomFieldValuesForm"}),bn=k("report");bn.recent=E({method:"GET",url:d.api.recentReports,key:"reports",isArray:!0}),bn.inProgress=E({method:"GET",url:d.api.inProgressReports,key:"reports",isArray:!0}),bn.volumeOverview=E({method:"GET",url:d.api.volumeOverviewReport,key:"volume"}),bn.dailyVolumeOverview=E({method:"GET",url:d.api.dailyVolumeOverviewReport,key:"dailyVolume"}),bn.paymentOverview=E({method:"GET",url:d.api.paymentOverviewReport,key:"paymentOverview"}),bn.itemsSummaryOverview=E({method:"GET",url:d.api.itemsSummaryOverviewReport,key:"itemsSummary"}),bn.nextPayoutOverview=E({method:"GET",url:d.api.nextPayoutOverviewReport,key:"nextPayouts",isArray:!0}),bn.report=E({method:"GET",url:d.api.reportReports,key:"report"});var Cn=A("report");Cn.rerun=Cn.update,delete Cn.update,Cn.cancel=E({method:"DELETE",url:d.api.report,formName:"disableForm",key:"report"}),delete Cn.remove,Cn.objects=E({method:"POST",url:d.api.reportObjects,key:"objects",isArray:!1});var kn=k("invoice");kn.report=E({method:"GET",url:d.api.reportInvoices,key:"report"}),kn.partnerInvoice=E({method:"GET",url:d.api.partnerInvoice,key:"invoice"});var An=A("invoice");An.uploads=E({method:"GET",url:d.api.invoiceUploads,isArray:!0,key:"uploads"}),An.uploads.create=E({method:"POST",url:d.api.invoiceUploads,key:"upload"}),An.notifications={},An.notifications.create=E({method:"POST",url:d.api.invoiceNotifications,isArray:!0,key:"notifications",formName:"invoiceNotificationForm"}),An.uuid=E({method:"GET",url:d.api.uuidInvoice,key:"invoice"});var Pn={};Pn.create=E({method:"POST",url:d.api.lineItems,key:"lineItem"}),Pn.report=E({method:"GET",url:d.api.reportLineItems,key:"report"});var Sn=E({method:"GET",url:d.api.lineItem,key:"lineItem"});Sn.remove=E({method:"DELETE",url:d.api.lineItem}),Sn.update=E({method:"PUT",url:d.api.lineItem,key:"lineItem"});var On=k("tagGroup"),In=A("tagGroup"),Rn={};Rn.create=E({method:"POST",url:d.api.tags,key:"tag"});var Nn={};Nn.update=E({method:"PUT",url:d.api.tag,key:"tag"}),Nn.remove=E({method:"DELETE",url:d.api.tag,formName:"disableForm"});var wn=E({method:"GET",url:d.api.objectTags,key:"objectTags",isArray:!0});wn.update=E({method:"PUT",url:d.api.objectTags,key:"objectTags",isArray:!0});var Un=E({method:"GET",url:d.api.payments,isArray:!0,key:"payments"});Un.related=E({method:"GET",url:d.api.relatedPayments,isArray:!0,key:"payments"}),Un.create=E({method:"POST",url:d.api.payments,key:"payment"}),Un.refund=E({method:"POST",url:d.api.refunds,isArray:!0,key:"payments"}),Un.report=E({method:"GET",url:d.api.reportPayments,key:"report"}),Un.volumeReport=E({method:"GET",url:d.api.reportVolume,key:"report"});var Fn={};Fn.create=E({method:"POST",url:d.api.installmentPayment,key:"installmentPayment"});var Dn={};Dn.create=E({method:"POST",url:d.api.orderInstallmentPayment,key:"orderInstallmentPayment"});var Ln=E({method:"GET",url:d.api.authorizationHolds,isArray:!0,key:"authorizationHolds"});Ln.update=E({method:"PUT",url:d.api.authorizationHolds,isArray:!0,key:"authorizationHolds"});var Mn=E({method:"GET",url:d.api.paymentFees,isArray:!0,key:"payments"});Mn.update=E({method:"POST",url:d.api.paymentFees,key:"payments"});var xn=k("inStorePaymentType"),Bn=E({method:"POST",url:d.api.emvLocation,key:"emvLocation",formName:"emv_location_form"});xn.all=E({method:"GET",url:d.api.allInStorePaymentTypes,isArray:!0,key:"inStorePaymentTypes"});var $n=k("ledger");$n.all=E({method:"GET",url:d.api.allLedgers,isArray:!0,key:"ledgers"});var Gn=A("ledger"),Yn=A("inStorePaymentType"),Vn=k("emvDevice"),Kn=A("emvDevice");Kn.authenticate=E({method:"POST",url:d.api.retrieveConnectionToken,key:"activation",formName:"retrieve_connection_token_form",flashError:!1,ignoreCache:!0,ignoreInFlight:!0}),Kn.createInteractionToken=E({method:"POST",url:d.api.createInteractionToken,key:"tokenId",formName:"emv_device_create_payment_intent_form",flashError:!1}),Kn.checkConnections=E({method:"GET",url:d.api.checkEmvDeviceConnections,key:"connectedDevices",flashError:!1}),Kn.checkConnection=E({method:"GET",url:d.api.checkEmvDeviceConnection,key:"connectedDevices"}),Kn.checkPaymentStatus=E({method:"POST",url:d.api.checkEmvPaymentStatus,key:"result",flashError:!1,flash500Error:!1}),Kn.cancelCharge=E({method:"POST",url:d.api.cancelEmvCharge});var Hn={custom:{}};Hn.custom.create=E({method:"POST",url:d.api.customRefunds,key:"refund",formName:"customRefundForm"});var qn={};qn.report=E({method:"GET",url:d.api.reportDisputes,key:"report"});var Wn=E({method:"GET",url:d.api.payouts,isArray:!0,key:"payouts"});Wn.report=E({method:"GET",url:d.api.reportPayouts,key:"report"});var jn=E({method:"GET",url:d.api.payout,key:"payout"});jn.retry=E({method:"PUT",url:d.api.payoutRetry,key:"payoutRetry"});var zn=E({method:"GET",url:d.api.transfers,isArray:!0,key:"transfers"});zn.create=E({method:"POST",url:d.api.transfers,key:"transfer"});var Xn=E({method:"GET",url:d.api.transfer,key:"transfer"}),Qn={};Qn.create=E({method:"POST",url:d.api.oneTimeTransfer,formName:"transferAndUploadDelegateForm",key:"oneTimeTransfer"});var Zn=E({method:"GET",url:d.api.upcomingRefundReserveAmounts,key:"upcomingRefundReserveAmounts"}),Jn=E({method:"GET",url:d.api.uploads,isArray:!0,key:"uploads"});Jn.create=E({method:"POST",url:d.api.uploads,key:"upload"});var er=E({method:"GET",url:d.api.upload,key:"upload"}),tr=E({method:"GET",url:d.api.funds,isArray:!0,key:"funds"});tr.report=E({method:"GET",url:d.api.reportFunds,key:"report"});var nr=E({method:"GET",url:d.api.fund,key:"fund"}),rr=E({method:"GET",url:d.api.adjustments,isArray:!0,key:"adjustments"});rr.create=E({method:"POST",url:d.api.adjustments,key:"adjustment"});var ir=E({method:"GET",url:d.api.adjustment,key:"adjustment"}),ar={};ar.report=E({method:"GET",url:d.api.reportTransactions,key:"report"});var or=E({method:"GET",url:d.api.activities,isArray:!0,key:"activities"});or.notes={},or.notes.create=E({method:"POST",url:d.api.notes,key:"activity",formName:"noteForm"});var sr=E({method:"GET",url:d.api.activity,key:"activity"});sr.update=E({method:"PUT",url:d.api.activity,key:"activity"});var cr=E({method:"PUT",url:d.api.reorder,key:"reorder"}),lr=E({method:"GET",url:d.api.waivers,isArray:!0,key:"waivers"});lr.create=E({method:"POST",url:d.api.waivers,key:"waiver"});var ur=E({method:"GET",url:d.api.waiver,key:"waiver"});ur.update=E({method:"PUT",url:d.api.waiver,key:"waiver"}),ur.remove=E({method:"DELETE",url:d.api.waiver,formName:"disableForm"});var dr={};dr.create=E({method:"POST",url:d.api.connectedWaivers,key:"connectedWaiver",formName:"createConnectedWaiverForm"});var mr={};mr.remove=E({method:"DELETE",url:d.api.connectedWaiver});var pr={};pr.remove=E({method:"DELETE",url:d.api.waiverInstance,key:"waiverInstance"});var fr=k("totalSchedule");fr.online=S(fr,"online"),fr.includeArchived=S(fr,"include-archived");var hr=A("totalSchedule"),gr=k("totalScheduleEntry","totalScheduleEntries"),yr=A("totalScheduleEntry"),vr=k("totalScheduleEntryRule"),Tr=A("totalScheduleEntryRule"),Er=k("invoiceSchedule");Er.includeArchived=S(Er,"include-archived");var _r=A("invoiceSchedule"),br=k("invoiceScheduleEntry","invoiceScheduleEntries"),Cr=A("invoiceScheduleEntry"),kr=k("invoiceScheduleEntryRule"),Ar=A("invoiceScheduleEntryRule");hr.duplicate=E({method:"POST",url:d.api.duplicateTotalSchedule,key:"totalSchedule",formName:"duplicateTotalScheduleForm"}),hr.affiliations=E({method:"GET",isArray:!0,url:d.api.totalScheduleAffiliations,key:"affiliations"}),_r.duplicate=E({method:"POST",url:d.api.duplicateInvoiceSchedule,key:"invoiceSchedule",formName:"duplicateInvoiceScheduleForm"}),_r.affiliations=E({method:"GET",isArray:!0,url:d.api.invoiceScheduleAffiliations,key:"affiliations"});var Pr=E({method:"GET",url:d.api.effectiveSheets,key:"effectiveSheets"}),Sr=E({method:"GET",url:d.api.affiliationEffectiveSheets,key:"effectiveSheets"}),Or=E({method:"GET",url:d.api.rebookingEffectiveSheets,key:"effectiveSheets"}),Ir=E({method:"GET",url:d.api.totalScheduleEffectiveSheet,key:"effectiveSheets"}),Rr=E({method:"GET",url:d.api.invoiceScheduleEffectiveSheet,key:"effectiveSheets"}),Nr=k("totalSheet");Nr.all=I(Nr),Nr.includeArchived=S(Nr,"include-archived"),Nr.nonBase=S(Nr,"nonBase"),Nr.online=S(Nr,"online"),Nr.bases=S(Nr,"bases");var wr=A("totalSheet");wr.duplicate=E({method:"POST",url:d.api.duplicateTotalSheet,key:"totalSheet",formName:"duplicateSheetForm"}),wr.pricing=E({method:"GET",url:d.api.totalPricing,key:"effectivePricings",isArray:!0}),wr.pricing.update=E({method:"PUT",url:d.api.totalPricing,key:"effectivePricings",isArray:!0,formName:"priceLineForm"}),wr.pricing.stack=E({method:"GET",url:d.api.totalStack,key:"lines",isArray:!0}),wr.schedules=E({method:"GET",isArray:!0,url:d.api.totalSheetSchedules,key:"totalSchedules"}),wr.affiliations=E({method:"GET",isArray:!0,url:d.api.totalSheetAffiliations,key:"affiliations"});var Ur=k("invoiceSheet");Ur.all=I(Ur),Ur.includeArchived=S(Ur,"include-archived"),Ur.nonBase=S(Ur,"nonBase");var Fr=A("invoiceSheet");Fr.duplicate=E({method:"POST",url:d.api.duplicateInvoiceSheet,key:"invoiceSheet",formName:"duplicateSheetForm"}),Fr.pricing=E({method:"GET",url:d.api.invoicePricing,key:"effectivePricings",isArray:!0}),Fr.pricing.update=E({method:"PUT",url:d.api.invoicePricing,key:"effectivePricings",isArray:!0,formName:"priceLineForm"}),Fr.pricing.stack=E({method:"GET",url:d.api.invoiceStack,key:"lines",isArray:!0}),Fr.schedules=E({method:"GET",isArray:!0,url:d.api.invoiceSheetSchedules,key:"invoiceSchedules"}),Fr.affiliations=E({method:"GET",isArray:!0,url:d.api.invoiceSheetAffiliations,key:"affiliations"});var Dr={};Dr.channels=E({method:"GET",url:d.pusher.channels,key:"channels",isArray:!0}),Dr.members=E({method:"POST",url:d.pusher.members,key:"channels",isArray:!0});var Lr=k("taxType");Lr.all=I(Lr);var Mr=A("taxType"),xr=A("location");xr.items=E({method:"GET",url:d.api.locationItems,key:"items",isArray:!0});var Br=k("location");Br.createPrimary=E({method:"POST",url:d.api.primaryLocation,key:"location"});var $r=k("resource");$r.includeArchived=S($r,"include-archived"),$r.manifest=E({method:"GET",url:d.api.resourcesManifest,key:"resources",isArray:!0});var Gr=A("resource");Gr.items=E({method:"GET",url:d.api.resourceItems,key:"items",isArray:!0}),Gr.requirementGroups=E({method:"GET",url:d.api.resourceRequirementGroups,key:"requirementGroups",isArray:!0}),Gr.availabilities=E({method:"GET",url:d.api.resourceAvailabilities,key:"availabilities",isArray:!0});var Yr={};Yr.byDate=E({method:"GET",url:d.api.resourceUsesByDate,key:"resourceUses",isArray:!0}),Yr.calendar=E({method:"GET",url:d.api.resourceUsesCalendar,key:"calendar"}),Yr.unassignSeats=E({method:"PUT",url:d.api.resourceUsesUnassignSeats,isArray:!0,key:"resourceUses",formName:"unassignSeatsForm"}),Yr.reapplyResourceUses=E({method:"POST",url:d.api.reapplyResourceUses,isArray:!0,key:"resourceUses",sideKeys:["unsatisfiableResources","bookings"],formName:"reapplyResourceUsesForm"}),Yr.reapplyResourceUsesPoll=E({method:"GET",url:d.api.reapplyResourceUses,key:"taskState",sideKeys:["bookings","resourceUses","unsatisfiableResources"]});var Vr=E({method:"GET",url:d.api.itemRequirementGroups,isArray:!0,key:"requirementGroups"});Vr.create=E({method:"POST",url:d.api.itemRequirementGroups,key:"requirementGroup"});var Kr=k("requirementGroup"),Hr=A("requirementGroup");Hr.duplicate=E({method:"POST",url:d.api.duplicateRequirementGroup,key:"requirementGroup",formName:"duplicateRequirementGroupForm"}),Hr.items=E({method:"GET",url:d.api.requirementGroupItems,isArray:!0,key:"items"});var qr=k("requirement"),Wr=A("requirement"),jr=k("resourceRequirement"),zr=A("resourceRequirement");zr.update=E({method:"PUT",url:d.api.resourceRequirement,key:"resourceRequirement",sideKeys:["newResourceRequirement"]});var Xr=A("resourceUse");Xr.update=E({method:"PUT",url:d.api.resourceUse,key:"resourceUse",sideKeys:["customer"],formName:"resourceUseForm",flashError:!1});var Qr=E({method:"GET",url:d.api.resourceOverride,key:"resourceOverride"});Qr.update=E({method:"PUT",url:d.api.resourceOverride,key:"resourceOverride",formName:"resourceOverrideForm"}),Qr.remove=E({method:"DELETE",url:d.api.resourceOverride,formName:"disableForm"}),Qr.rule=E({method:"POST",url:d.api.resourceOverrideRule,isArray:!0,key:"resourceOverrides",formName:"resourceOverrideRuleForm"});var Zr={byTag:{}};Zr.byTag.clear=E({method:"DELETE",url:d.api.resourceOverridesByTag,formName:"disableForm"}),Zr.byDate=E({method:"GET",url:d.api.resourceOverridesByDate,key:"resourceOverrides",isArray:!0}),Zr.forSeat=E({method:"POST",url:d.api.seatResourceOverrides,key:"resourceOverrides",isArray:!0,formName:"seatResourceOverridesForm"});var Jr=k("seatMap"),ei=A("seatMap");ei.duplicate=E({method:"POST",url:d.api.duplicateSeatMap,key:"seatMap",formName:"duplicateSeatMapForm"}),ei.update=E({method:"PUT",url:d.api.seatMap,key:"seatMap"}),ei.full=S(E({method:"GET",url:d.api.seatMap,key:"seatMap",sideKeys:["seatZones","seatGroups"],ignoreQueryParamsInCacheUri:!0}),"full"),ei.resourceUsesBySeat=E({method:"GET",url:d.api.seatMapResourceUsesBySeat,key:"resourceUsesBySeat",ignoreCache:!0}),ei.resourceOverridesBySeat=E({method:"GET",url:d.api.seatMapResourceOverridesBySeat,key:"resourceOverridesBySeat",sideKeys:["resourceOverrides"],ignoreCache:!0}),ei.resources=E({method:"GET",url:d.api.seatMapResources,key:"resources",isArray:!0});var ti=k("seatGroup"),ni=A("seatGroup"),ri=k("seatZone"),ii=A("seatZone"),ai=k("ticketLayout"),oi=A("ticketLayout"),si=k("analyticsService"),ci=A("analyticsService"),li=k("cancellationPolicy","cancellationPolicies"),ui=A("cancellationPolicy"),di=k("cancellationRule"),mi=A("cancellationRule");ui.affiliations=E({method:"GET",isArray:!0,url:d.api.cancellationPolicyAffiliations,key:"affiliations"}),ui.items=E({method:"GET",isArray:!0,url:d.api.cancellationPolicyItems,key:"items"});var pi=k("bookingRestriction"),fi=A("bookingRestriction");fi.items=E({method:"GET",isArray:!0,url:d.api.bookingRestrictionItems,key:"items"});var hi=E({method:"GET",isArray:!0,url:d.api.persistentStore,key:"persistentStores"});hi.remove=E({method:"DELETE",url:d.api.persistentStore});var gi=E({method:"GET",url:d.api.persistentStoreForCompany,key:"persistentStore"});gi.remove=E({method:"DELETE",url:d.api.persistentStoreForCompany});var yi=E({method:"GET",url:d.api.persistentStoreItem,key:"value"});yi.update=E({method:"PUT",url:d.api.persistentStoreItem,key:"value",formName:"persistentStoreForm"}),yi.remove=E({method:"DELETE",url:d.api.persistentStoreItem});var vi=E({method:"GET",url:d.api.taskResult,key:"taskResult"}),Ti=P({method:"POST",url:d.api.token,key:"tokens",flash500Error:!1}),Ei=E({method:"GET",formName:"noForm",key:function(e){return _.keys(e.data)[0]}}),_i=E({method:"GET",url:d.api.view,key:"view"}),bi=E({method:"GET",url:d.api.version,key:"version"}),Ci=function(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%2F/gi,"/").replace(/%3B/gi,";").replace(/%20/g,t?"%20":"+")},ki=function(e,t){return t=_.isBoolean(t)?function(e){return e?"yes":"no"}(t):t,Ci(e,!0)+"="+Ci(t,!0)},Ai=function(e){var t=[];return _.forEach(e,(function(e,n){_.isArray(e)?_.forEach(e,(function(e){t.push(ki(n,e))})):t.push(ki(n,e))})),t.join("&")};return{CANCELLED:p,toKeyValue:Ai,login:R,forgot:N,companies:U,company:F,users:X,user:Q,groups:D,group:L,groupOverrides:M,groupOverride:x,contacts:cn,contact:sn,contactPayments:ln,customManifests:K,customManifest:H,customCalendars:q,customCalendar:W,customReports:j,customReport:z,items:Z,item:J,flowNodes:re,flowNode:te,defaultFlowPage:function(){var e=n.get("flows");return e.wrapEndpoint(ne,!0).apply(null,arguments)},activities:or,activity:sr,affiliates:ie,affiliate:ae,affiliateCards:oe,affiliateCardAffiliations:se,partners:ce,partner:le,partnerCards:ue,partnerCardAffiliations:de,agents:me,agent:pe,desks:fe,desk:he,cannedMessages:zt,cannedMessage:Xt,availabilityHeadlines:Qt,availabilityHeadline:Zt,customerPrototypes:qt,customerPrototype:Ht,customerTypes:Kt,customerType:Vt,checkinStatuses:jt,checkinStatus:Wt,customFields:ht,customField:gt,transportationOptions:yt,transportationOption:vt,extendedOptions:Tt,extendedOption:Et,connectedCampaigns:_t,connectedCampaign:bt,generatingCampaigns:Ct,generatingCampaign:kt,customFieldInstances:It,customFieldInstance:Ot,customFieldInstanceConditions:Nt,customFieldInstanceCondition:Rt,customFieldInstanceGroup:St,companyCustomFieldInstanceGroups:Pt,combinedCustomFieldInstanceGroups:function(e,t){var n={shortname:e.company.shortname,itemPk:e.pk},r={shortname:e.company.shortname},a=t?At.includeArchived(n):At(n),o=e.company.features.isCompanyLevelCustomFieldInstanceGroupsEnabled?t?Pt.includeArchived(r):Pt(r):[],s=[];return s.$promise=i.all([a.$promise,o.$promise]).then((function(){_.ref.append(s,a,o)})),s},itemCustomFieldInstanceGroups:At,pushCustomFieldValues:_n,customerCustomFieldValue:En,bookingCustomFieldValue:Tn,availabilities:Jt,availability:en,customerTypeRates:tn,customerTypeRate:nn,subjects:on,blocks:rn,block:an,orders:mn,order:un,orderPayments:pn,bookings:fn,booking:hn,customer:yn,customers:vn,lineItems:Pn,lineItem:Sn,payments:Un,installmentPayment:Fn,orderInstallmentPayment:Dn,disputes:qn,refunds:Hn,authorizationHolds:Ln,paymentFees:Mn,inStorePaymentTypes:xn,inStorePaymentType:Yn,emvLocation:Bn,emvDevices:Vn,emvDevice:Kn,bankAccounts:B,bankAccount:$,cards:G,card:Y,cardAffiliations:V,supportedLanguages:Ut,supportedLanguage:wt,translations:Ft,translationsForModel:Dt,translationsForField:Lt,understoodLanguages:Mt,translationsForSubfield:xt,reports:bn,report:Cn,campaigns:Ie,campaign:Re,campaignValidityRules:Ne,campaignValidityRule:we,codes:Ue,code:Fe,storedValueTypes:De,storedValueType:Le,storedValueCards:Me,storedValueCard:xe,storedValueAdjustments:Be,storedValueAdjustment:$e,resellerCompanies:Ve,resellerCompany:Ke,resellerCompanyMappings:He,resellerCompanyMapping:qe,resellerItems:We,resellerItem:je,resellerItemMappings:ze,resellerItemMapping:Xe,resellerCustomerTypes:Qe,resellerCustomerType:Ze,resellerCustomerTypeMappings:Je,resellerCustomerTypeMapping:et,resellerOptions:tt,resellerOption:nt,resellerOptionMappings:rt,resellerOptionMapping:it,resellerUnmappedItems:at,resellerUnmappedCustomerPrototypes:ot,resellerKeys:st,resellerKey:ct,resellerApps:lt,resellerApp:ut,resellerAppRequest:mt,resellerAppRequests:dt,resellerAppCompany:ft,resellerAppCompanies:pt,reorder:cr,refresh:function(e,t){return u.assert(e,"db.refresh: expected uri"),Ei(e,null,null,null,t)},slipstream:function(e,t){if(t=t||{},window.slipstream&&window.slipstream[e]){var n=window.slipstream[e],r=t.doNotConvert||!1;return _.isObject(n)?(n=r?n:s.serverResponse(n),v(n,null,_.isArray(n))):n}},ledgers:$n,ledger:Gn,payouts:Wn,payout:jn,transfers:zn,transfer:Xn,uploads:Jn,upload:er,oneTimeTransfer:Qn,upcomingRefundReserveAmounts:Zn,adjustments:rr,adjustment:ir,transactions:ar,funds:tr,fund:nr,roles:Bt,role:$t,crewMembers:Gt,crewMember:Yt,hotels:ge,hotel:ye,lodgings:ve,lodging:Te,pickups:be,pickup:Ce,routes:ke,route:Ae,stops:Pe,stop:Se,runs:Oe,preferredPickups:Ee,preferredPickup:_e,testReport:w,invoices:kn,invoice:An,totalSchedules:fr,totalSchedule:hr,totalScheduleEntries:gr,totalScheduleEntry:yr,totalScheduleEntryRules:vr,totalScheduleEntryRule:Tr,invoiceScheduleEntryRules:kr,invoiceScheduleEntryRule:Ar,invoiceSchedules:Er,invoiceSchedule:_r,invoiceScheduleEntries:br,invoiceScheduleEntry:Cr,effectiveSheets:Pr,affiliationEffectiveSheets:Sr,rebookingEffectiveSheets:Or,totalScheduleEffectiveSheet:Ir,invoiceScheduleEffectiveSheet:Rr,totalSheets:Nr,totalSheet:wr,invoiceSheets:Ur,invoiceSheet:Fr,taxTypes:Lr,taxType:Mr,paymentProcessingDocuments:Ge,paymentProcessingDocument:Ye,locations:Br,location:xr,waivers:lr,waiver:ur,connectedWaivers:dr,connectedWaiver:mr,waiverInstance:pr,resources:$r,resource:Gr,resourceUses:Yr,requirementGroups:function(e){var t=Vr(e),n=Kr(e);return i.all([t.$promise,n.$promise]).then((function(){return t.concat(n)}))},requirementGroup:Hr,companyRequirementGroups:Kr,itemRequirementGroups:Vr,requirements:qr,requirement:Wr,resourceRequirements:jr,resourceRequirement:zr,resourceUse:Xr,resourceOverride:Qr,resourceOverrides:Zr,seatMaps:Jr,seatMap:ei,seatGroups:ti,seatGroup:ni,seatZones:ri,seatZone:ii,ticketLayouts:ai,ticketLayout:oi,analyticsServices:si,analyticsService:ci,cancellationPolicies:li,cancellationPolicy:ui,cancellationRules:di,cancellationRule:mi,bookingRestrictions:pi,bookingRestriction:fi,persistentStore:hi,persistentStoreForCompany:gi,persistentStoreItem:yi,tagGroups:On,tagGroup:In,tags:Rn,tag:Nn,objectTags:wn,taskResult:vi,tokens:Ti,version:bi,serverResponse:v,formErrorHandler:b,errorStatus:function(e){return 0!==e||m?404===e?"not-found":403===e?"forbidden":"error":"disconnect"},pusher:Dr,searchEndpoint:function(e,t,n){return n=n||{},function(r){return e(t,null,null,_.defaults({q:r},n))}},view:_i}}])}()},1073:function(){!function(){"use strict";angular.module("flash",["flash.services"]),angular.module("flash.services",[]).factory("flash",[function(){return{debug:_.ignore,info:_.ignore,warn:_.ignore,error:_.ignore,success:_.ignore}}])}()},1916:function(){!function(){"use strict";var e=angular.module("lib.factories",[]);e.factory("dataController",["$q","cache","db",function(e,t,n){var r={};return function(i,a){var o=(a=a||{}).successCallback||_.ignore,s=a.errorCallback||_.ignore;i.dataCtrl={STALE:r,status:a.isManual?"manual":"loading",isStale:!1};var c=!1;i.$on("$destroy",(function(){_.forEach(a.promises,(function(e){e&&e.cancel&&e.cancel()})),c=!0}));var l=function(e){i.dataCtrl.status=e,i.dataCtrl.isStale=!1},u=function(e){if(e){var t=n.errorStatus(e.status);t&&(s(e),l(t))}},d=function(e){if(!c){var t=o(e);return t&&_.isFunction(t.then)?t.then((function(){l("success")}),u):l("success"),e}},m=function(){if(_.isFunction(a.loadCallback)){var n=a.loadCallback();_.isObject(n)&&(_.extend(a,n),o=a.successCallback||_.ignore,s=a.errorCallback||_.ignore)}i.dataCtrl.status="loading";var r=_.choose(a.promises||[]);return r.length?(a.stale&&_.every(a.stale,(function(e){return!_.isUndefined(e)&&!t.fresh(e)}))&&(o(i.dataCtrl.STALE),i.dataCtrl.isStale=!0,i.dataCtrl.status="success"),e.all(r).then(d,u)):d()};return i.dataCtrl.showLoading=function(){i.dataCtrl.status="loading"},i.dataCtrl.showComplete=function(){i.dataCtrl.status="success"},a.retry&&(i.dataCtrl.retry=function(){m()}),a.isManual?i.dataCtrl.load=function(){return m()}:m(),i}}]),e.factory("navigationController",["navigation",function(e){return function(t,n){return t.navigationCtrl={entries:n.entries||[]},_.forEach(t.navigationCtrl.entries,(function(t){_.isUndefined(t.isCurrent)&&(t.isCurrent=function(){var n=t.navigationUrl||t.url;return!!n&&(t.equals?e.pathEquals:e.pathStartsWith)(n)})})),t.navigationCtrl.isVisible=function(e){return!!_.isUndefined(e.isVisible)||(_.isFunction(e.isVisible)?e.isVisible():e.isVisible)},t}}]),e.factory("nagsController",["auth","db","models",function(e,t,n){return function(r,i){return r.nagsCtrl={company:i.company},r.nagsCtrl.isNagSaving=!1,r.nagsCtrl.dismissCompanyNag=function(e){if(!r.nagsCtrl.isNagSaving){r.nagsCtrl.isNagSaving=!0;var n={};n[e]=!0,t.company.nags.update({shortname:r.nagsCtrl.company.shortname},n).$promise.then((function(){r.nagsCtrl.isNagSaving=!1}),(function(){r.nagsCtrl.isNagSaving=!1}))}},r.nagsCtrl.dismissUserNag=function(n){if(e.currentUser.nags[n]){r.nagsCtrl.isNagSaving=!0;var i={};i[n]=!0,t.user.nags.update({shortname:e.currentUser.company.shortname,username:e.currentUser.username},i).$promise.then((function(){r.nagsCtrl.isNagSaving=!1}),(function(){r.nagsCtrl.isNagSaving=!1}))}else console.error("Invalid dismissal for user nag: ",n)},r.nagsCtrl.dismissUserNags=function(){n.User.hasAnyNags(e.currentUser)&&t.user.nags.update({shortname:e.currentUser.company.shortname,username:e.currentUser.username})},r.nagsCtrl.undismissCompanyNags=function(){r.nagsCtrl.isNagSaving=!0,t.company.nags.update({shortname:r.nagsCtrl.company.shortname},{undismiss:!0}).$promise.then((function(){r.nagsCtrl.isNagSaving=!1}),(function(){r.nagsCtrl.isNagSaving=!1}))},r.nagsCtrl.undismissUserNags=function(){r.nagsCtrl.isNagSaving=!0,t.user.nags.update({shortname:e.currentUser.company.shortname,username:e.currentUser.username},{undismiss:!0}).$promise.then((function(){r.nagsCtrl.isNagSaving=!1}),(function(){r.nagsCtrl.isNagSaving=!1}))},r}}]),e.factory("headerController",["$timeout","auth","db","models","nagsController","navigation","navigationController","urls",function(e,t,n,r,i,a,o,s){return function(n,c){return n.headerCtrl={},n.headerCtrl.logout=function(){t.isLogoutInProgress=!0;var n=t.currentUser.company;n?a.navigate(n.$url(s.company.login)):a.navigate(s.index),e((function(){t.isLogoutInProgress&&t.logout(),t.isLogoutInProgress=!1}))},t.currentUser.isAuthenticated&&(n.headerCtrl.relatedCompanies=t.relatedCompanies()),n.$watch(c.companyFn,(function(e){n.headerCtrl.company=e,i(n,{company:n.headerCtrl.company}),o(n,{entries:[{text:"Admin",url:e.$url(s.dashboard.admin.index),isVisible:function(){return e.isAdmin&&t.permissions.can("viewAdminSection",e)},shortcut:"shift+a",shortcutDescription:"Show Admin."},{text:"Bookings",url:e.$url(s.dashboard.bookings.index),isVisible:function(){return(e.isCharter||e.isAffiliate)&&t.permissions.can("viewBookingsSection",e)},shortcut:"shift+b",shortcutDescription:"Show Bookings calendar."},{text:"Manifest",url:e.$url(s.dashboard.manifest.index),isVisible:function(){return e.isCharter&&t.permissions.can("viewManifestSection",e)},shortcut:"shift+m",shortcutDescription:"Show Manifest."},{text:"Reports",url:e.$url(s.dashboard.reports.index),isVisible:function(){return t.permissions.canList(r.Report,e)},shortcut:"shift+r",shortcutDescription:"Show Reports."},{text:"Items",url:e.$url(s.dashboard.items.index),isVisible:function(){return e.isCharter&&t.permissions.can("viewItemsSection",e)},shortcut:"shift+i",shortcutDescription:"Show Items.",isCurrent:function(){return a.pathStartsWith(s.dashboard.items.index)||a.pathStartsWith(s.dashboard.resources.index)}},{text:"Settings",url:e.$url(s.dashboard.settings.index),shortcut:"shift+s|shift+e",shortcutDescription:"Show Settings."},{text:"Website Admin",url:"https://content.fareharbor.me/wp-admin/",isVisible:_.getter(e,"isAdmin"),isOutbound:!0},{text:"Help",url:"https://fareharbor.com/help/",isOutbound:!0}]})})),n.headerCtrl.turnOffSnowstorm=t.storage.get("turnOffSnowstorm"),n.$watch("headerCtrl.turnOffSnowstorm",(function(e){e?t.storage.set("turnOffSnowstorm",!0):t.storage.del("turnOffSnowstorm")})),n}}]),e.factory("emailSubjectsController",["$q","db","models","require",function(e,t,n,r){var i=[n.Booking.cls,n.Order.cls,n.Availability.cls];return function(a,o){r.defined(o,"modelKey"),r.defined(o,"target","emailSubjectsCtrl: target must be provided"),r.assert(_.contains(i,o.target.cls),"emailSubjectsCtrl: target must be an availability, booking, or an order");var s={};a[o.controllerAs||"emailSubjectsCtrl"]=s;var c=o.target.company,l=o.prefix||"",u=l+"type",d=l+"subject",m=l+"language",p=function(e,t){return t||(t=_.getDotted(a,o.modelKey)),_.isObject(t)?_.getDotted(t,e):void 0},f=function(e,t){_.getDotted(a,o.modelKey)[e]=t};s.resetToDefault=function(){var e=p(u),t="";if(a.isSubjectEditable=n.Notification.isSubjectEditable(e),e===n.Notification.DISPUTE_TYPE&&(t=n.Notification.subjectForDisputeType(o.target)),o.subjectKeys)_.forEach(o.subjectKeys,(function(e,n){f(n,t||a.subjects[e]||a.subjects[c.language])}));else{var r=p(m);f(d,t||a.subjects[r])}};var h=!1,g=e.defer();return s.promises=[g.promise],a.$watchCollection((function(){return _.getDotted(a,o.modelKey)}),(function(e,r){var i=p(u,e),l=p(u,r),d=p(m,e),f=p(m,r);if(!h&&i)if(i!==n.Notification.DISPUTE_TYPE){if(o.target.cls===n.Availability.cls){if(a.subjects&&i===l)return;var y=_.values(o.subjectKeys).join(",");a.subjects=t.subjects.availability({shortname:c.shortname,type:i,availabilityPk:o.target.pk,languages:y})}else{if(!d)return;if(a.subjects&&i===l&&d===f)return;o.target.cls===n.Order.cls?a.subjects=t.subjects.order({shortname:c.shortname,type:i,orderUuid:o.target.uuid,language:d}):a.subjects=t.subjects.booking({shortname:c.shortname,type:i,bookingUuid:o.target.uuid,language:d})}h=!0,a.subjects.$promise.then((function(){s.resetToDefault(),h=!1,g.resolve()})).catch((function(){g.reject()}))}else s.resetToDefault()})),s}}]),e.factory("cannedMessagesController",["$q","auth","db","flash","models","navigation","require","toggles",function(e,t,n,r,i,a,o,s){return function(c,l){o.defined(l,"modelKey"),o.defined(l,"noteField"),l.cannedField=l.cannedField||"message";var u={};c.cannedMessagesCtrl=u;var d=function(){return l.languageOverride||c[l.modelKey][l.languageKey]};u.toggleKey="canned-message-"+c.$id,u.useDefaultMessage=!l.languageKey&&!l.onTranslationsLoad&&!l.languageOverride;var m=function(e,t){var n=i.SupportedLanguage.rootLanguage(t),r=_.find(e,{language:t});return(r=(r=r||_.find(e,{language:n}))||_.find(e,(function(e){return i.SupportedLanguage.shareRootLanguage(e.language,t)})))?r.fieldValue:null};if(u.onTranslationsLoad=l.onTranslationsLoad||function(e,t){var n=t[l.cannedField],a=d(),o=e(a);o?n=o:i.SupportedLanguage.shareRootLanguage(t.company.language,a)||r.warn(interpolate(T("Selected canned message is missing translation for %(language)s, using original message instead."),{language:i.SupportedLanguage.display(a)})),u.addMessageToNote(n)},u.select=function(e){var a=t.permissions.canView(i.SupportedLanguage,e.company),o=e.company.companyFeatures.isContentTranslationEnabled;if(u.useDefaultMessage||!o||!a){u.addMessageToNote(e[l.cannedField]);var c=i.SupportedLanguage.shareRootLanguage(d(),e.company.language);return!o||a||c||r.warn(interpolate(T("You do not have permission to view translated content for %(companyName)s. Please contact your administrator."),{companyName:e.company.name})),void s.toggle(u.toggleKey,!1)}u.loadingCannedMessagePk=e.pk;var p=n.translationsForField({shortname:e.company.shortname,objectType:e.cls,objectId:e.pk,objectField:l.cannedField});return p.$promise.then((function(){var t=_.filter(p.translationsForField,(function(e){return e.supportedLanguage.isLive})),n=_.bind(m,null,t);u.onTranslationsLoad(n,e)})).finally((function(){u.loadingCannedMessagePk=!1,s.toggle(u.toggleKey,!1)}))},u.addMessageToNote=l.addMessageToNote||function(e){var t=c[l.modelKey][l.noteField]||"";""!==(t=t.replace(/\s+$/g,""))&&(t=t.concat("\n\n"));var n=t.concat(e);c[l.modelKey][l.noteField]=l.formattingFn?l.formattingFn(n):n},u.TYPES=l.types||i.CannedMessage.TYPES,u.displayType=i.CannedMessage.displayType,u.promises=[],!l.cannedMessagesByType){l.cannedMessagesByType={},_.forEach(u.TYPES,(function(e){l.cannedMessagesByType[e]=[]}));var p=[a.currentCompany,t.currentUser.company,l.company];_.forEach(_.unique(p),(function(e){if(e&&t.permissions.canList(i.CannedMessage,e)){var r=n.cannedMessages({shortname:e.shortname});u.promises.push(r.$promise.catch(_.ignore))}})),e.all(u.promises).then((function(e){var t=_.flatten(_.pluck(e,"primaryData"));_.forEach(t,(function(e){_.contains(u.TYPES,e.type)&&l.cannedMessagesByType[e.type].push(e)}))}))}return u.cannedMessagesByType=l.cannedMessagesByType,u.isEmptyMessage=function(e){var t=e[l.cannedField];return _.isString(t)?_.isEmpty(t):_.isNull(t)},u.hasEmptyMessages=function(e){return _.all(u.cannedMessagesByType[e],u.isEmptyMessage)},c}}]),e.factory("imageUploadController",["$q","filepicker","require",function(e,t,n){return function(r,i){n.defined(i,"modelKey");var a=i.id||"image",o=i.field||"imageUrl",s=i.width||2560,c=i.height||2560,l=!!_.isUndefined(i.resetAfterSubmit)||i.resetAfterSubmit,u=function(){_.extend(r.imageUploadCtrl[a],{url:"",urls:{},initialUrls:{},isSelected:!1,isPristine:!0,isUploading:!1,isCropping:!1,isSavingCrop:!1,crop:{},unCroppedUrl:null})},d=u;return r.imageUploadCtrl&&r.imageUploadCtrl.scope===r||(r.imageUploadCtrl={scope:r,ids:[]},r.imageUploadCtrl.isPristine=function(){return _.every(r.imageUploadCtrl.ids,(function(e){return r.imageUploadCtrl[e].isPristine}))},r.imageUploadCtrl.isUploading=function(){return _.some(r.imageUploadCtrl.ids,(function(e){return r.imageUploadCtrl[e].isUploading}))}),r.imageUploadCtrl.ids.push(a),r.imageUploadCtrl[a]={},r.imageUploadCtrl[a].clear=function(){r.imageUploadCtrl[a].urls[o]="",r[i.modelKey][o]="",_.extend(r.imageUploadCtrl[a],{url:"",isSelected:!1,isPristine:!1,crop:{},unCroppedUrl:null})},r.imageUploadCtrl[a].select=function(){r.imageUploadCtrl[a].isUploading=!0,t.pick({mimetypes:["image/*"],services:["COMPUTER","WEBCAM","FACEBOOK","INSTAGRAM","URL"]},(function(n){r.$apply((function(){(function(n){var i=e.defer(),a={height:c,width:s,fit:"max"};return t.convert(n,a,(function(e){r.$safeApply((function(){console.log("imageUploadCtrl: converted image",e.url,a),i.resolve(e)}))}),(function(e){r.$safeApply((function(){console.error("imageUploadCtrl: unable to convert image",e),i.reject(e)}))})),i.promise})(n).then((function(e){r.imageUploadCtrl[a].urls[o]=e.url,r[i.modelKey][o]=e.url,_.extend(r.imageUploadCtrl[a],{url:e.url,isSelected:!0,isPristine:!1,isUploading:!1,crop:{},unCroppedUrl:null})}),(function(e){console.error("imageUploadCtrl.select: unable to convert image",e),r.imageUploadCtrl[a].isUploading=!1}))}))}),(function(e){r.$apply((function(){101!==e.code&&console.error("imageUploadCtrl.select: unable to pick image",e),r.imageUploadCtrl[a].isUploading=!1}))}))},r.imageUploadCtrl[a].edit=function(){n.defined(i,"elementKey");var e=r[i.elementKey][o];r.imageUploadCtrl[a].urls[o]=e,r.imageUploadCtrl[a].initialUrls[o]=e,r[i.modelKey][o]=e,_.extend(r.imageUploadCtrl[a],{url:e,isSelected:!!e,crop:{},unCroppedUrl:null})},r.imageUploadCtrl[a].submit=function(){var n,i,s,c=r.imageUploadCtrl[a].urls[o];return r.imageUploadCtrl[a].initialUrls[o]!==c&&c?(i=c,s=e.defer(),t.store({url:i},{location:"S3"},(function(e){console.log("imageUploadCtrl: stored image ",e.url),s.resolve(e)}),(function(e){console.error("imageUploadCtrl: unable to store image",e),s.reject(e)})),n=s.promise):n=e.resolve(),r.imageUploadCtrl[a].isPristine=!0,l&&d(),n},r.imageUploadCtrl[a].cancel=function(){d()},r.imageUploadCtrl[a].saveCrop=function(){r.imageUploadCtrl[a].isSavingCrop=!0;var e={fit:"crop",crop:[r.imageUploadCtrl[a].crop.x,r.imageUploadCtrl[a].crop.y,r.imageUploadCtrl[a].crop.width,r.imageUploadCtrl[a].crop.height],format:"jpg",quality:90},n=r.imageUploadCtrl[a].url;t.stat({url:n},(function(s){s.url=n,t.convert(s,e,(function(e){r.$safeApply((function(){r[i.modelKey][o]=e.url,r.imageUploadCtrl[a].urls[o]=e.url,_.extend(r.imageUploadCtrl[a],{url:e.url,isPristine:!1,isCropping:!1,isSavingCrop:!1,unCroppedUrl:n})}))}),(function(e){console.error("imageUploadCtrl.saveCrop: unable to crop image",e)}))}))},r.imageUploadCtrl[a].startCropping=function(){r.imageUploadCtrl[a].unCroppedUrl&&(r.imageUploadCtrl[a].url=r.imageUploadCtrl[a].unCroppedUrl),r.imageUploadCtrl[a].isCropping=!0},r.imageUploadCtrl[a].cancelCrop=function(){r.imageUploadCtrl[a].isCropping=!1,r.imageUploadCtrl[a].url=r[i.modelKey][o]},u(),r}}]),e.factory("splitPaymentController",["require","toggles",function(e,t){return function(e,n){e.splitPaymentCtrl={customerCount:n.customerCount(),amount:n.amount(),divideByPeople:1,payForPeople:1,splitAmount:0},e.$watch((function(){return n.amount()}),(function(t){e.splitPaymentCtrl.amount=t})),e.$watch(n.customerCount,(function(t){t=Math.max(1,t),e.splitPaymentCtrl.customerCount=t,e.splitPaymentCtrl.divideByPeople=t,e.splitPaymentCtrl.payForPeople=Math.min(e.splitPaymentCtrl.divideByPeople,e.splitPaymentCtrl.payForPeople)})),e.$watch((function(){var t=_.roundHalfToEven(e.splitPaymentCtrl.amount*e.splitPaymentCtrl.payForPeople/e.splitPaymentCtrl.divideByPeople);return isFinite(t)||(t=0),t}),(function(t){e.splitPaymentCtrl.splitAmount=t})),e.splitPaymentCtrl.useSplitAmount=function(){var r=Math.min(e.splitPaymentCtrl.splitAmount,n.max());r<=0||(n.amount(r),t.toggle("splitPaymentCalc",!1))}}}]),e.factory("reorderController",["$window","db","events","flash",function(e,t,n,r){return function(i,a){var o=a.reorderCallback||_.ignore,s=a.reorderConfirm,c=a.reorderConfirmWhen||(s?_.always:_.never);return(i=i||{}).reorderCtrl={},i.reorderCtrl.reorder=function(l,u,d){var m,p={},f=0;if(u&&(p.previousPk=u.pk,f=(u.sortableIndex||0)+.1),!d&&a.alwaysLast&&(d=a.alwaysLast),d&&(p.nextPk=d.pk,f=(d.sortableIndex||0)-.1),a.collectionKey?m=_.get(i,a.collectionKey):a.collectionFn&&(m=a.collectionFn(l)),m){if(c(l,u,d)&&!e.confirm(s||T("Are you sure you want to reorder this list?")))return!1;l.sortableIndex=f,_.ref.reorder(m,l,u,d);var h=l.company?l.company:a.company,g=l.cls?l.cls:a.cls,y=t.reorder({shortname:h.shortname,objectCls:g,objectPk:l.pk},{},null,p);o(y),y.$promise.then((function(){r.success(T("Saved sort order")),a.refreshActivities&&n.broadcast("dashboard.shared.ActivitiesCtrl.refresh")}),(function(){r.error(T("Sort order not saved, please try again."))}))}},i}}]),e.factory("listController",["reorderController","imageUploadController","urls","events",function(e,t,n,r){return function(i,a){var o=a.get,s=a.create||o&&o.create,c=a.remove,l=a.successCallback||_.ignore,u=a.errorCallback||_.ignore,d=a.submitCallback||_.ignore,m=a.removeCallback||_.ignore,p=_.isFunction(a.params)?a.params:_.constant(a.params||{}),f=n.extract,h=!!_.isUndefined(a.reset)||a.reset,g=!!_.isUndefined(a.closeAfterSubmit)||a.closeAfterSubmit,y=!!a.imageUpload,v=a.defaultModel||{};return _.isFunction(v)||(v=_.constant(v)),i[a.modelKey]=_.extend({},v()),y&&t(i,{modelKey:a.modelKey}),o&&a.collectionKey&&!_.isArray(_.get(i,a.collectionKey))&&_.set(i,a.collectionKey,o(p())),i.listCtrl={},i.listCtrl.submit=function(e){var t=i[a.modelKey],n=d(e);n&&(t=_.extend({},t,n));var o=(a.createFn?a.createFn():s)(p(),t,e);o.$promise.then((function(t){if(a.collectionKey){var n=_.get(i,a.collectionKey);n&&(_.isArray(o)?a.overwrite?_.overwrite(n,o):_.ref.append(n,o):n.push(o))}i.listCtrl.cancel(e),a.refreshActivities&&r.broadcast("dashboard.shared.ActivitiesCtrl.refresh"),y&&i.imageUploadCtrl.image.submit(),l(o,e,t)}),(function(t){u(t,e)}))},i.listCtrl.adding=a.adding||!1,i.listCtrl.cancel=function(e){g&&(i.listCtrl.adding=!1),h&&(i[a.modelKey]=_.extend({},v())),e.$setPristine()},i.listCtrl.add=function(){i.listCtrl.adding=!0},i.listCtrl.toggle=function(){i.listCtrl.adding=!i.listCtrl.adding},i.listCtrl.close=function(e){i.listCtrl.adding=!1,e&&h&&(i[a.modelKey]=_.extend({},v()),e.$setPristine())},a.sortable&&a.collectionKey&&(i.listCtrl.reorder=e(i,{collectionKey:a.collectionKey,reorderCallback:a.reorderCallback,reorderConfirm:a.reorderConfirm,reorderConfirmWhen:a.reorderConfirmWhen,alwaysLast:a.alwaysLast,company:a.company,refreshActivities:a.refreshActivities}).reorderCtrl.reorder),a.remove&&(i.listCtrl.remove=function(e,t){i.listCtrl.status="removing",c(f(e),{},t).$promise.then((function(){i.listCtrl.status="success",t&&_.overwrite(t,{}),a.collectionKey&&_.overwriteWithout(_.get(i,a.collectionKey),_.isReferenceEqualTo(e)),a.refreshActivities&&r.broadcast("dashboard.shared.ActivitiesCtrl.refresh"),m(e)}))}),i}}]),e.factory("createController",["events",function(e){return function(t,n){var r=n.get||{},i=n.create||r.create,a=n.successCallback||_.ignore,o=n.errorCallback||_.ignore,s=n.submitCallback||_.ignore,c=_.isFunction(n.params)?n.params:_.constant(n.params||{}),l=!!_.isUndefined(n.reset)||n.reset,u=n.defaultModel||{},d=function(e){return _.set(t,n.modelKey,e)};return d(_.extend({},u)),t.createCtrl={},t.createCtrl.creating=!1,t.createCtrl.submit=function(r){s(r);var l=i(c(),_.get(t,n.modelKey),r);l.$promise.then((function(){t.createCtrl.cancel(r),n.refreshActivities&&e.broadcast("dashboard.shared.ActivitiesCtrl.refresh"),a(l,r)}),(function(e){o(e,r)}))},t.createCtrl.cancel=function(e){l&&d(_.extend({},u)),e.$setPristine(),t.createCtrl.creating=!1},t}}]),e.factory("removeController",[function(){return function(e,t){var n=t.remove||t.get.remove,r=t.removeCallback||_.ignore,i=_.isFunction(t.params)?t.params:_.constant(t.params||{});return e.removeCtrl={status:"success"},e.removeCtrl.remove=function(a){e.removeCtrl.status="removing",n(i(),{},a).$promise.then((function(){e.removeCtrl.status="success",a&&_.overwrite(a,{}),t.collectionKey&&_.overwriteWithout(e[t.collectionKey],_.isReferenceEqualTo(e[t.elementKey])),r(e[t.elementKey],a)}),(function(){e.removeCtrl.status="error"}))},e}}]),e.factory("editController",["$injector","events","flash","imageUploadController","navigation",function(e,t,n,r,i){return function(e,a){var o=a.get||_.ignore,s=a.update||o.update,c=a.remove||o.remove,l=a.successCallback||_.ignore,u=a.errorCallback||_.ignore,d=a.editCallback||_.ignore,m=a.removeCallback||_.ignore,p=a.cancelCallback||_.ignore,f=a.submitCallback||_.ignore,h=_.isFunction(a.params)?a.params:_.constant(a.params||{}),g=a.jsonFieldKeys||[],y=!!a.imageUpload;e.editCtrl={},e.editCtrl.editing=!1,e.editCtrl.status="success",y&&r(e,{modelKey:a.modelKey,elementKey:a.elementKey}),_.isUndefined(_.get(e,a.collectionKey))&&!a.remove||(e.editCtrl.remove=function(r){e.editCtrl.status="removing",c(h(),{},r).$promise.then((function(){e.editCtrl.status="success",r&&_.overwrite(r,{});var o=_.get(e,a.collectionKey);if(o&&_.overwriteWithout(o,_.isReferenceEqualTo(e[a.elementKey])),a.refreshActivities&&t.broadcast("dashboard.shared.ActivitiesCtrl.refresh"),a.flashAfterRemove){var s=_.isString(a.flashAfterRemove)?a.flashAfterRemove:interpolate(T("Removed %(name)s"),{name:e[a.elementKey].unicode});n.success(s)}a.navigateAfterRemove&&i.navigate(a.navigateAfterRemove),m(e[a.elementKey],r)}),(function(){e.editCtrl.status="error"}))});var v=function(){var t={};_.forEach(e[a.elementKey],(function(e,n){_.isObject(e)&&!_.includes(g,n)||(t[n]=e)})),a.modelFields&&(t=_.pick(t,a.modelFields)),e[a.modelKey]=t};return e.editCtrl.edit=function(t,n){n||v(),e.editCtrl.editing=!0,y&&e.imageUploadCtrl.image.edit(),d(t,n)},e.editCtrl.cancel=function(t){e.editCtrl.editing=!1,v(),p(t),t&&t.$setPristine(),a.editing&&e.editCtrl.edit(t)},e.editCtrl.submit=function(n){var r=e[a.modelKey],i=f(n);i&&(r=_.extend({},r,i)),e.editCtrl.status="submitting";var o=s(h(),r,n);o.$promise.then((function(r){e.editCtrl.status="success",n.$setPristine(),e.editCtrl.editing=!1,a.refreshActivities&&t.broadcast("dashboard.shared.ActivitiesCtrl.refresh"),y&&e.imageUploadCtrl.image.submit(),l(o,n,r),a.editing&&e.editCtrl.edit(n)}),(function(t){e.editCtrl.status="error",u(t,n),a.editing&&e.editCtrl.edit(n,a.skipResetAfterError)}))},a.editing&&e.editCtrl.edit(),e}}]),e.factory("calendarController",["$filter","$injector","auth","cache","db","events","localization","navigation","require","urls",function(e,t,n,r,i,a,o,s,c,l){return function(e,c){var u=t.get("flows"),d=l.calendarUrls(c.url),m=_.isFunction(c.params)?c.params:_.constant(c.params||{}),p=_.isFunction(c.queryParams)?c.queryParams:_.constant(c.queryParams||{}),f=c.endpoint,h=c.beforeRequest||_.ignore,g=c.onSuccess||_.ignore,y=c.largeDaySelected||_.ignore,v=c.smallDaySelected||_.ignore,E=c.urlParams||_.ignore,b=c.preselectDate||null,C=_.isFunction(c.isSundayBased)?c.isSundayBased:_.isBoolean(c.isSundayBased)?_.constant(c.isSundayBased):_.constant(!c.company||c.company.features.isSundayBased);e.calendarCtrl={status:"uninitialized",company:c.company||null,isSundayBased:C,calendar:{},isRetrieving:!1,isEmptyAllowed:c.isEmptyAllowed||!1,date:moment().startOf("day"),isCalendarEmpty:c.isCalendarEmpty||_.ignore,isWeekEmpty:c.isWeekEmpty||_.ignore,isDayEmpty:c.isDayEmpty||_.ignore,isDayUsed:c.isDayUsed||_.ignore,isEditable:c.isEditable||!1,editDay:c.editDay||_.ignore,showSelectedDay:!!_.isUndefined(c.showSelectedDay)||c.showSelectedDay};var k=moment().startOf("day");e.calendarCtrl.dropdownMonths=_.map([T("January"),T("February"),cT("the month of March","March"),T("April"),cT("the month of May","May"),T("June"),T("July"),T("August"),T("September"),T("October"),T("November"),T("December")],(function(e,t){return{value:t,text:e}})),e.calendarCtrl.dropdownYears=_.map(_.range(k.year()-2,k.year()+5),(function(e){return{value:e,text:e}}));var A,P,S=!1,O=e.calendarCtrl.refresh=function(t){if(S=!1,!1!==h()){var n=_.extend({year:e.calendarCtrl.date.format("YYYY"),month:e.calendarCtrl.date.format("MM")},m()),a=p();!t&&angular.equals([n,a],[A,P])||(A=n,P=a,e.calendarCtrl.status="loading",R={},e.calendarCtrl.calendar.$promise&&e.calendarCtrl.calendar.$promise.cancel(),e.calendarCtrl.calendar=f(_.extend({},n),{},null,a),r.fresh(e.calendarCtrl.calendar)?e.calendarCtrl.isRetrieving=!0:D(),e.calendarCtrl.calendar.$promise.then((function(t){t!==i.CANCELLED&&(D(),e.calendarCtrl.status="success",e.calendarCtrl.isRetrieving=!1,g(t))}),(function(){e.calendarCtrl.status="error",e.calendarCtrl.isRetrieving=!1})))}},I=function(e,t){var n=k-e.at;return 0===n?t.current||"":n>0?t.past||"":t.future||""};e.calendarCtrl.dayPastPresentFutureClass=function(e){return I(e,{past:"past-day",current:"current-day"})},e.calendarCtrl.anonymousDayClass=function(e){return 0===e.count?"empty":e.isBookable?"":"no-bookable"},e.calendarCtrl.isPastWeek=function(e){return I(_.last(e.days),{past:!0})};var R={},N=k.clone().startOf("month");e.calendarCtrl.showingPastWeek=function(t){return 0!==e.calendarCtrl.date.clone().startOf("month").diff(N)||R[t.number]},e.calendarCtrl.showPastWeek=function(e){R[e.number]=!0},s.watch(e,(function(t){if(s.pathEquals(d.index))s.redirect(l.populate(d.month,_.extend({year:e.calendarCtrl.date.format("YYYY"),month:e.calendarCtrl.date.format("MM")},E())));else{var n,r,i,o=s.pathEquals(d.month);o?(n=o.year,r=o.month-1,i=moment({year:n,month:r,day:1}),e.calendarCtrl.style="month",e.calendarCtrl.date=i,e.calendarCtrl.monthDropdown=i.month(),e.calendarCtrl.yearDropdown=i.year(),a.broadcast("lib.shared.CalendarCtrl.month",{date:e.calendarCtrl.date}),O()):console.warn("calendarController: invalid calendar url",t)}}));var w=e.calendarCtrl.monthUrl=function(e,t){return l.populate(d.month,_.extend({year:e.format("YYYY"),month:e.format("MM")},E(),t))};e.calendarCtrl.nextMonthUrl=function(){var t=e.calendarCtrl.date.clone();return t.add(1,"months"),w(t)},e.calendarCtrl.currentMonthUrl=function(){return w(k)},e.calendarCtrl.previousMonthUrl=function(){var t=e.calendarCtrl.date.clone();return t.add(-1,"months"),w(t)},e.$watch("calendarCtrl.yearDropdown",(function(t,n){if(!_.isUndefined(n)&&t!==n){var r=e.calendarCtrl.date.clone();r.year(t);var i=w(r);s.pathEquals(i)||s.navigate(u.extendWithFlow(i))}})),e.$watch("calendarCtrl.monthDropdown",(function(t,n){if(!_.isUndefined(n)&&t!==n){var r=e.calendarCtrl.date.clone();r.month(t);var i=w(r);s.pathEquals(i)||s.navigate(u.extendWithFlow(i))}}));var U=function(e,t){return e.year()===t.year()&&e.month()===t.month()};e.calendarCtrl.isCurrentMonth=function(){return U(e.calendarCtrl.date,k)},a.on(e,"lib.shared.CalendarCtrl.refresh",(function(){O(!0)}));var F=e.calendarCtrl.dayForDate=function(t){if(t){var n=e.calendarCtrl.calendar.weeks;if(!n)return null;var r=null;return _.some(n,(function(e){return _.some(e.days,(function(e){return!!e.at.isSame(t,"day")&&(r=e,!0)}))})),r}};e.calendarCtrl.goToToday=function(){s.navigate(e.calendarCtrl.currentMonthUrl()),e.calendarCtrl.selectedDay=F(moment()),R={}},e.calendarCtrl.selectLargeDay=function(t){e.calendarCtrl.selectedDay=t,y(t)};e.calendarCtrl.dayLabel=function(t,n){return n===e.calendarCtrl.calendar.weeks[0]&&t===n.days[0]||1===t.number?t.at.format(o.current().DATE_FORMATS.dayWithMonthAbbr):t.number},e.calendarCtrl.selectSmallDay=function(t){t&&(e.calendarCtrl.selectedDay=t,v(t),S=!0)};var D=function(){if(b){var t=F(b())||F(e.calendarCtrl.date);return e.calendarCtrl.selectedDay=t,void v(t)}var r;r=S?e.calendarCtrl.selectedDay.at:n.currentUser.isAuthenticated?U(e.calendarCtrl.date,k)?k:e.calendarCtrl.date.clone().startOf("month"):null,e.calendarCtrl.selectedDay=F(r)};return e.calendarCtrl.debouncedRefresh=_.debounce((function(t){e.$safeApply((function(){e.calendarCtrl.refresh(t)}))}),1e3,{leading:!0}),e.calendarCtrl.effectiveRange=function(e,t){var n=e.startAt,r=e.endAt;return n<t.at&&(n=t.at),r>t.at+864e5&&(r=t.at.clone().add(1,"day").startOf("day")),{startAt:n,endAt:r}},e}}]),e.factory("availabilityCalendarController",["$filter","calendarController","events","navigation",function(e,t,n,r){return function(i,a){var o=_.isFunction(a.params)?a.params:_.constant(a.params||{}),s=a.beforeRequest||_.ignore,c=!!_.isUndefined(a.autoOpenItemGroups)||a.autoOpenItemGroups,l=a.openLightframe?a.openLightframe:r.navigate,u=a.items||null;return n.on(i,"dashboard.bookings.NavigationCtrl.calendarFilter.items",(function(e,t){var n=t.items||[],r=_.difference(n,i.calendarCtrl.items).length;i.calendarCtrl.items=n,r&&i.calendarCtrl.debouncedRefresh(!0)})),n.on(i,"dashboard.bookings.NavigationCtrl.filterChoicesUpdated",(function(e,t){t&&(i.calendarCtrl.items=t.filteredItems||[]),i.calendarCtrl.refresh()})),_.extend(a,{isCalendarEmpty:function(){return!i.calendarCtrl.calendar.availabilityCount},isWeekEmpty:function(e){return!e.availabilityCount},isDayEmpty:function(e){var t=e.availabilities,n=e.itemGroups||[];return!t.length&&!n.length||!!i.isCalendarFiltered&&_.all(t,i.isCalendarFiltered)&&_.all(n,i.isCalendarFiltered)},isDayUsed:function(e){return function(e){var t=e.availabilities,n=e.itemGroups||[];return i.isCalendarFiltered&&(t=_.reject(t,i.isCalendarFiltered),n=_.reject(n,i.isCalendarFiltered)),_.sum(_.pluck(t,"customerCount"))+_.sum(_.pluck(n,"customerCount"))}(e)>0},smallDaySelected:a.smallDaySelected||function(t){var n=t.availabilities,r=t.itemGroups||[];if(c&&!n.length&&1===r.length){var i=e("itemGroupUrl")(r[0],t.at);l(i)}},beforeRequest:function(){return!(i.calendarCtrl.items&&!i.calendarCtrl.items.length)&&s()},params:function(){var e=_.extend({},o());if(i.calendarCtrl.items){var t=_.pluck(i.calendarCtrl.items,"pk").join(",");e.itemPks=t}return e}}),t(i,a),_.extend(i.calendarCtrl,{items:u,nextBookableMonthUrl:function(){var e=i.calendarCtrl.calendar.nextBookableStartAt;if(e)return i.calendarCtrl.monthUrl(e)},alreadyRedirectedToNextBookableMonth:!1,redirectToNextBookableMonth:function(){i.calendarCtrl.alreadyRedirectedToNextBookableMonth||(i.calendarCtrl.alreadyRedirectedToNextBookableMonth=!0,r.redirect(i.calendarCtrl.nextBookableMonthUrl()))}}),i}}]),e.factory("emailPreviewController",["convert","models","navigation","urls",function(e,t,n,r){var i={type:"type",emails:"emails",subject:"subject",note:"note",language:"language"};return function(a,o){var s,c=_.extend({},i,o.fields),l=_.isFunction(o.params)?o.params:_.constant(o.params||{});o.data&&(s=_.isFunction(o.data)?o.data:function(){return o.data}),a.emailPreviewCtrl={},a.emailPreviewCtrl.previewUrl=function(){var t={};_.forEach(c,(function(e,n){e&&(t[n]=a[o.modelKey][e]||"")})),o.languageOverride&&(t.language=o.languageOverride),s&&_.extend(t,e.clientRequest(s()));var i=r.populate(o.url,l(t.type));return n.compose(i,t)};var u=_.isFunction(o.isPreviewable)?o.isPreviewable:_.constant(o.isPreviewable);return a.emailPreviewCtrl.isPreviewable=function(){var e=a[o.modelKey][c.type],n=a[o.modelKey][c.emails],r=a[o.modelKey][c.subject];if(!e||!n||!r)return!1;var i=u(e);return _.isUndefined(i)?t.Notification.isPreviewable(e):i},a}}]),e.factory("affiliationController",["$q","auth","cache","db","editController","events","models",function(e,t,n,r,i,a,o){return function(s,c){var l=function(e){return(c.prefix?c.prefix+"-":"")+"voucher-"+e};s.affiliationCtrl={status:"success",substatus:"success",showDesks:!1},s.affiliationCtrl.agentName=function(e){return e===o.Agent.OTHER_AGENT?e.name:e.name+" (#"+e.pk+")"},s[c.modelKey][l("agent")]=null,s[c.modelKey][l("agentName")]="",s[c.modelKey][l("desk")]=null,s[c.modelKey][l("deskName")]="";var u=function(i){if(s.affiliationCtrl.agents=[],s.affiliationCtrl.desks=[],s.affiliationCtrl.showDesks=!1,i){var a={agents:t.permissions.canCreate(o.Agent,i),desks:t.permissions.canCreate(o.Desk,i)},c={agents:o.Agent.OTHER_AGENT,desks:o.Desk.OTHER_DESK},l=function(e,t){_.overwrite(s.affiliationCtrl[e],t),a[e]&&s.affiliationCtrl[e].push(c[e])},u=[];if(t.permissions.canList(o.Agent,i.affiliateCompany)){var d=r.agents({shortname:i.affiliateCompany.shortname}),m=d.$promise.then((function(){l("agents",d)}));n.fresh(d)?u.push(m):l("agents",d)}if(t.permissions.canList(o.Desk,i.affiliateCompany)){var p=r.desks({shortname:i.affiliateCompany.shortname}),f=p.$promise.then((function(){s.affiliationCtrl.showDesks=p.length>0,l("desks",p)}));n.fresh(p)?u.push(f):(s.affiliationCtrl.showDesks=p.length>0,l("desks",p))}u.length&&(s.affiliationCtrl.substatus="loading",e.all(u).then((function(){s.affiliationCtrl.substatus="success"})))}};s.$watch(c.affiliateModelKey+".currentAffiliation",(function(e,t){u(e),(e&&t&&e!==t||!e)&&(s[c.modelKey][l("agent")]=null,s[c.modelKey][l("agentName")]="",s[c.modelKey][l("desk")]=null,s[c.modelKey][l("deskName")]="")}));var d=function(e){var i=c.booking?c.booking.company:c.company;t.permissions.canList(o.Affiliation,i)?i.affiliatesCount>o.Affiliation.MAX_SELECTABLE_AFFILIATES?(s.affiliationCtrl.affiliatesNgDropdownEndpoint=r.searchEndpoint(r.affiliates.pickable,{shortname:i.shortname}),s.affiliationCtrl.status="success"):(s.affiliationCtrl.affiliations=r.affiliates.pickable({shortname:i.shortname},null,null,null,{flashError:!!c.isEditingAffiliationOnBooking}),s.affiliationCtrl.status=n.fresh(s.affiliationCtrl.affiliations)?"loading":"stale",s.affiliationCtrl.affiliations.$promise.then((function(){s.affiliationCtrl.status="success",c.booking&&c.booking.affiliation&&!_.contains(s.affiliationCtrl.affiliations,c.booking.affiliation)&&s.affiliationCtrl.affiliations.unshift(c.booking.affiliation)}),(function(){c.isEditingAffiliationOnBooking&&s.editCtrl.cancel(e)}))):s.affiliationCtrl.status="success"};c.isEditingAffiliationOnBooking?i(s,{elementKey:"affiliation",modelKey:c.modelKey,update:r.booking.affiliation.update,editCallback:function(e){d(e),s[c.modelKey].isBlockable=c.booking.isBlockable,s[c.modelKey].affiliation=c.booking.affiliation?c.booking.affiliation.pk:null,s[c.modelKey][l("agent")]=c.booking.agent?c.booking.agent.pk:null,s[c.modelKey][l("desk")]=c.booking.desk?c.booking.desk.pk:null,s[c.modelKey][l("voucherNumber")]=c.booking.voucherNumber,s[c.affiliateModelKey].currentAffiliation=c.booking.affiliation||null},successCallback:function(e){var t=-1==s[c.modelKey][l("agent")],n=-1==s[c.modelKey][l("desk")];(t||n)&&u(e.booking.affiliation),a.broadcast("dashboard.shared.ActivitiesCtrl.refresh")},params:function(){return{shortname:c.booking.company.shortname,bookingUuid:c.booking.uuid}}}):d()}}]),e.factory("controllers",["affiliationController","calendarController","cannedMessagesController","createController","dataController","editController","emailPreviewController","emailSubjectsController","headerController","imageUploadController","listController","nagsController","navigationController","removeController","reorderController","splitPaymentController",function(e,t,n,r,i,a,o,s,c,l,u,d,m,p,f,h){return{affiliationController:e,calendarController:t,cannedMessagesController:n,createController:r,dataController:i,editController:a,emailPreviewController:o,emailSubjectsController:s,headerController:c,imageUploadController:l,listController:u,nagsController:d,navigationController:m,removeController:p,reorderController:f,splitPaymentController:h}}])}()},4477:function(){!function(){"use strict";var e=angular.module("lib.controllers",["auth.services","db.services","lib.services"]);e.controller("lib.shared.CompanyAdminNotesEditableCtrl",["$scope","controllers","db","require","shortcutsOverlay",function(e,t,n,r,i){r.inScope(e,"company","lib.shared.CompanyAdminNotesEditableCtrl"),t.editController(e,{collectionKey:"companies",elementKey:"company",modelKey:"editableCompany",update:n.company.adminNotes.update,editCallback:function(){e.editableCompany.adminNotes||(e.editableCompany.adminNotes="# Dashboard Flag Explanation\n\nIf there is anything critical FH Admins should know before working with this Dashboard or this client please:\n\n1. Add all critical information here, be as specific as possible\n2. Check the **Flag this company** box below\n\nOR - Erase this section if it is not applicable to this Dashboard or client\n\n-----\n# Dashboard Notes\n\nBasic overview of company, what they do/sell\n\n-----\n# Additional Feature Notes\n\nIf anything enabled in **Advanced settings** needs further explanation please include that information here, be as specific as possible.\n\nIf usage is straightforward please do not retype enabled features here.\n\n-----\n# Items\n\n• Settings that must be active on all new items\n• Information and item numbers for any items that vary in setup from the majority of the Dashboard\n\n-----\n# Resources\n\nBasic overview of company resource layout, other useful information.\n\n-----\n# Affiliates\n\nIf OTAs such as Viator, Expedia, GYG, or Google are in use please explain usage.\n\n-----\n# Related Dashboards\n\nInclude links\n\n-----\n# Major Dashboard Updates Log\n\nYour name:\nWhat you updated:\nWhen you updated it:"),i.confirmClose(!0)},cancelCallback:_.partial(i.confirmClose,!1),successCallback:function(){e.editCtrl.editing=!1,i.confirmClose(!1)},params:function(){return{shortname:e.company.shortname}}})}]),e.controller("lib.shared.NewTransportationCtrl",["$scope","$attrs","$injector","$interpolate","$parse","auth","controllers","convert","db","require","models",function(e,t,n,r,i,a,o,s,c,l,u){l.inScope(e,"customField","lib.shared.NewTransportationCtrl");var d=n.get("plusbook"),m=n.get("rebook"),p=i(t.ngNewTransportation),f=p(e);f&&_.isString(f)&&(f=s.serverResponse(_.parseJSON(f)));e.availability||(e.availability={company:e.company,startAt:moment()}),e.newTransportationCtrl={canOverrideTransportation:a.permissions.can("overrideTransportation",u.Booking,e.availability.company),needsTransportation:void 0,rebookingTransportation:!1,rebookingTransportationOptions:[],rebookingTransportationOption:null,data:{lodging:null,lodgingRoomNumber:"",selfLodgingAddress:"",route:null,stop:null},status:"loading"},e.customFieldPricing.visibility.isRequired?e.newTransportationCtrl.needsTransportation=!0:e.newTransportationCtrl.canOverrideTransportation?e.newTransportationCtrl.needsTransportation=!1:e.newTransportationCtrl.needsTransportation=void 0;var h=function(){return e.newTransportationCtrl.canOverrideTransportation&&!e.booking&&!e.availability.defaultRoute};e.newTransportationCtrl.showSelfTransportation=function(){return!(h()||!e.newTransportationCtrl.currentLodging||e.newTransportationCtrl.isTransportationAvailable()&&!1!==e.newTransportationCtrl.needsTransportation)},e.newTransportationCtrl.isTransportationAvailable=function(){return!(h()||!e.newTransportationCtrl.routes.length||!e.newTransportationCtrl.currentLodging||!(e.newTransportationCtrl.canOverrideTransportation||e.customFieldPricing.visibility.isRequired||b(y())))},e.newTransportationCtrl.showRoutes=function(){return!(e.newTransportationCtrl.routes.length<=1)&&e.newTransportationCtrl.canOverrideTransportation},e.newTransportationCtrl.showStops=function(){return!(e.newTransportationCtrl.stops.length<=0||!e.newTransportationCtrl.canOverrideTransportation&&b(e.newTransportationCtrl.currentRoute))},e.newTransportationCtrl.showNeedsTransportation=function(){return!e.customFieldPricing.visibility.isRequired&&e.newTransportationCtrl.isTransportationAvailable()},e.newTransportationCtrl.showTransportationPrice=function(){return!e.customField.isPricingHidden&&(u.PriceLine.showOffset(e.customFieldPricing)||u.PriceLine.showRate(e.customFieldPricing))};var g=function(){e.newTransportationCtrl.stops=e.newTransportationCtrl.currentRoute?e.newTransportationCtrl.currentRoute.stops:[]},y=function(){return 1===e.newTransportationCtrl.routes.length?e.newTransportationCtrl.routes[0]:e.availability.defaultRoute?e.availability.defaultRoute:null},v=function(){var t=y();t?(e.newTransportationCtrl.data.route=t.pk,e.newTransportationCtrl.currentRoute=t):(e.newTransportationCtrl.data.route=null,e.newTransportationCtrl.currentRoute=null)},E=function(t){if(e.newTransportationCtrl.currentLodging&&t)return 1===e.newTransportationCtrl.stops.length&&(e.newTransportationCtrl.canOverrideTransportation||e.customFieldPricing.visibility.isRequired)?e.newTransportationCtrl.stops[0]:_.chooseFirst(e.newTransportationCtrl.currentLodging.preferredPickups,(function(e){return _.chooseFirst(t.stops,(function(t){if(t.pickup===e.pickup)return t}))}))},b=function(e){return!!E(e)},C=function(){var t=E(e.newTransportationCtrl.currentRoute);return t?(e.newTransportationCtrl.data.stop=t.pk,e.newTransportationCtrl.currentStop=t,!0):(e.newTransportationCtrl.data.stop=null,e.newTransportationCtrl.currentStop=null,e.newTransportationCtrl.canOverrideTransportation||e.customFieldPricing.visibility.isRequired||(e.newTransportationCtrl.data.route=null,e.newTransportationCtrl.currentRoute=null),!1)},k=function(e){return{route:e,run:{capacity:e.capacity,customerCount:0,bookingCount:0},pk:e.pk}};e.newTransportationCtrl.routeSelectionText=function(t){var n=t.route,r=t.run;if(!e.newTransportationCtrl.canOverrideTransportation)return n.name;if(!r.customerCount)return n.name;var i=r.customerCount.toString();return null!==r.capacity&&(i+=" "+T("of")+" "+r.capacity.toString()),i=interpolate(nT("(%(count)s person booked so far)","(%(count)s people booked so far)",i),{count:i}),n.name+" "+i};var A,P,S,O=function(){A=c.lodgings({shortname:e.availability.company.shortname},null,null,null,{tagAlong:!0}),P=e.newTransportationCtrl.canOverrideTransportation?c.routes({shortname:e.availability.company.shortname},null,null,null,{tagAlong:!0}):e.availability.defaultRoute?c.route({shortname:e.availability.company.shortname,routePk:e.availability.defaultRoute.pk},null,null,null,{tagAlong:!0}):[],S=e.newTransportationCtrl.canOverrideTransportation?c.runs.searchByDate({shortname:e.availability.company.shortname,date:e.availability.startAt.format("YYYY-MM-DD")},null,null,null,{tagAlong:!0}):[],o.dataController(e,{promises:[A.$promise,P.$promise,S.$promises],successCallback:I,errorCallback:function(){e.newTransportationCtrl.status="error"}})},I=function(){var t;e.newTransportationCtrl.status="success",e.newTransportationCtrl.lodgings=A,e.newTransportationCtrl.routes=_.isArray(P)?P:[P],e.newTransportationCtrl.routeSelections=_.map(e.newTransportationCtrl.routes,k),_.forEach(S,(function(t){var n=_.find(e.newTransportationCtrl.routeSelections,(function(e){return e.route===t.route}));n&&(n.run=t)})),f&&(t=f,e.newTransportationCtrl.data=t,t.lodging?(e.newTransportationCtrl.currentLodging=_.find(e.newTransportationCtrl.lodgings,(function(e){return e.pk===t.lodging})),e.newTransportationCtrl.currentLodging||(t.lodging=null)):e.newTransportationCtrl.currentLodging=null,!t.route||d.currentSourceBooking||h()?e.newTransportationCtrl.currentRoute=null:(e.newTransportationCtrl.currentRoute=_.find(e.newTransportationCtrl.routes,(function(e){return e.pk===t.route})),e.newTransportationCtrl.currentRoute||(t.route=null)),t.stop&&e.newTransportationCtrl.currentRoute?(e.newTransportationCtrl.currentStop=_.find(e.newTransportationCtrl.currentRoute.stops,(function(e){return e.pk===t.stop})),e.newTransportationCtrl.currentStop||(t.stop=null)):(t.route=null,e.newTransportationCtrl.currentRoute=null,t.stop=null,e.newTransportationCtrl.currentStop=null),e.newTransportationCtrl.needsTransportation=!!e.newTransportationCtrl.currentStop||e.customFieldPricing.visibility.isRequired,e.newTransportationCtrl.needsTransportation&&m.currentBooking&&function(){e.newTransportationCtrl.rebookingTransportation=!0,e.newTransportationCtrl.rebookTransportationOptions=[],e.newTransportationCtrl.rebookTransportationOption=null;var t=function(t){_.find(e.newTransportationCtrl.rebookTransportationOptions,(function(e){return e.route===t.route&&e.stop===t.stop}))||(e.newTransportationCtrl.rebookTransportationOptions.push(t),e.newTransportationCtrl.rebookTransportationOption||(e.newTransportationCtrl.rebookTransportationOption=t))};if(e.availability.defaultRoute){if(m.currentBooking.stop){var n=_.find(e.availability.defaultRoute.stops,(function(e){return e.pickup===m.currentBooking.stop.pickup}));n&&t({text:T("Match pickup location"),tip:T("Move to route of new availability but keep same pickup location"),route:e.availability.defaultRoute,stop:n})}var r=_.chooseFirst(e.newTransportationCtrl.currentLodging.preferredPickups,(function(t){return _.find(e.availability.defaultRoute.stops,(function(e){if(e.pickup===t.pickup)return e}))}));r&&t({text:T("Use new availability's default"),tip:T("Use the lodging's preferred stop on the default route"),route:e.availability.defaultRoute,stop:r})}if(e.newTransportationCtrl.currentRoute&&e.newTransportationCtrl.currentStop&&t({text:T("Keep old booking's options"),route:e.newTransportationCtrl.currentRoute,stop:e.newTransportationCtrl.currentStop}),e.newTransportationCtrl.canOverrideTransportation){var i={text:T("Pick new options"),route:e.availability.defaultRoute||"",stop:""};t(i)}e.newTransportationCtrl.rebookTransportationOption&&(e.newTransportationCtrl.data.route=e.newTransportationCtrl.rebookTransportationOption.route.pk,e.newTransportationCtrl.currentRoute=e.newTransportationCtrl.rebookTransportationOption.route,e.newTransportationCtrl.data.stop=e.newTransportationCtrl.rebookTransportationOption.stop.pk,e.newTransportationCtrl.currentStop=e.newTransportationCtrl.rebookTransportationOption.stop);var a=!1;e.$watch("newTransportationCtrl.data",(function(t,n){var r=_.find(e.newTransportationCtrl.rebookTransportationOptions,(function(e,n){return e.route.pk===t.route&&e.stop.pk===t.stop}));(r=r||i)!==e.newTransportationCtrl.rebookTransportationOption&&(e.newTransportationCtrl.rebookTransportationOption=r,a=!0,e.$evalAsync((function(){a=!1})))}),!0),e.$watch("newTransportationCtrl.rebookTransportationOption",(function(t,n){t&&t!==n&&(a||(t.route&&(e.newTransportationCtrl.data.route=t.route.pk,e.newTransportationCtrl.currentRoute=t.route),e.$evalAsync((function(){e.newTransportationCtrl.data.stop=t.stop?t.stop.pk:null,e.newTransportationCtrl.currentStop=t.stop||null}))))}))}()),e.$watch("customFieldPricing.visibility.isRequired",(function(t){t&&(e.newTransportationCtrl.needsTransportation=!0)})),e.$watch("newTransportationCtrl.currentLodging",(function(t,n){t&&e.newTransportationCtrl.needsTransportation&&(e.newTransportationCtrl.currentRoute||v(),t!==n&&C(),t!==n||e.newTransportationCtrl.canOverrideTransportation||e.newTransportationCtrl.currentStop||(g(),C()))})),e.$watch("newTransportationCtrl.currentRoute",(function(e,t){g(),e!==t&&e&&C()})),e.$watch("newTransportationCtrl.needsTransportation",(function(t,n){t!==n&&(t?(e.newTransportationCtrl.currentRoute||v(),C()):(e.newTransportationCtrl.data.route=null,e.newTransportationCtrl.currentRoute=null,e.newTransportationCtrl.data.stop=null,e.newTransportationCtrl.currentStop=null))})),e.$watch("newTransportationCtrl.data",(function(){e.newTransportationCtrl.data.lodging?p.assign(e,_.stringifyJSON(s.clientRequest(e.newTransportationCtrl.data))):p.assign(e,null)}),!0)};e.availability.pk&&_.isUndefined(e.availability.defaultRoute)?c.availability({shortname:e.availability.company.shortname,itemPk:e.availability.item.pk,availabilityPk:e.availability.pk}).$promise.then((function(){O()})):O()}])}()},5038:function(){!function(){"use strict";var e=angular.module("lib.directives",[]),t={isTouchEnabled:"ontouchstart"in window||navigator.msMaxTouchPoints,isTextInput:function(e){return e.is("input")&&_.isUndefined(e.attr("type"))||e.is('input[type="text"], input[type="password"], input[type="email"], input[type="tel"], input[type="number"], input[type="url"], input[type="search"], textarea')},bind:function(e,t,n){e.$watch(n,(function(n){e[t]=n}))},watcher:function(e,t,n,r,i){var a=e.$eval(t);return e.$watch(t,(function(e){a=e,r&&r(a)}),i),function(){return _.isUndefined(a)?n:a}},observer:function(e,t,n,r){var i;return i=e[t],e.$observe(t,(function(e){i=e,r&&r(i)})),function(){if(!_.isUndefined(i))return i;if(!_.isUndefined(n))return n;throw new Error("d: undefined attribute "+t+" for observer")}},restrictKeypresses:function(e,t){e.on("keypress",(function(e){if(e.which&&!e.metaKey&&!e.controlKey&&!e.altKey&&8!==e.which&&9!==e.which&&13!==e.which){var n=String.fromCharCode(e.which);t.test(n)||e.preventDefault()}}))},safeInvoke:function(e,t){return _.isArray(t)?e.invoke(t):t},conditionalDirective:function(e){return e=_.extend({operator:_.constant(_.identity),link:_.constant(_.ignore),transclude:_.constant(_.ignore),once:_.never},e),["$animate","$injector",function(n,r){return _.extend({transclude:"element",priority:800,terminal:!0,restrict:"A",compile:function(i,a,o){var s=t.safeInvoke(r,e.watch),c=t.safeInvoke(r,e.operator),l=t.safeInvoke(r,e.transclude),u=t.safeInvoke(r,_.isBoolean(e.once)?_.constant(e.once):e.once);return function(t,r,i,a){var d,m;e.link(t,r,i,a);var p=s(t,r,i,a),f=l(t,r,i,a),h=c(t,r,i,a),g=t.$watch(p,(function(e){d&&(n.leave(d),d=void 0),m&&(m.$destroy(),m=void 0),h(e)&&(m=t.$new(),o(m,(function(e){d=e,f(m,e),n.enter(e,r.parent(),r)}))),u(t,r,i)&&g()}))}}},e.directiveDescription)}]},isDropdownSupported:!(/iP(od|hone|ad)/i.test(window.navigator.userAgent)||/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)||/BlackBerry|Windows Phone|webOS/i.test(window.navigator.userAgent)),chromeVersion:function(){var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return e?_.int(e[2]):null}};e.constant("d",t),e.config(["$provide",function(e){e.decorator("ngIfDirective",["$delegate",function(e){return e.shift(),e}])}]);var n=function(e){var t=e.$modelValue;_.forEach(e.$formatters,(function(e){t=e(t)})),e.$viewValue=t,e.$render()},r=function(t,n){e.directive(t,[function(){return{restrict:n,priority:500,require:"form",link:function(e,t,n,r){r.$errorCallbacks=[],r.$successCallbacks=[],t.attr("novalidate","novalidate")}}}])};r("form","E"),r("ngForm","A");var i=function(e,t){var n="20"+e,r=parseInt(t,10).toFixed();if(!isNaN(r))return{month:r,year:n}},a=[{device:"MSR100U",trackSeparator:"^",fullName:function(e){var t=e.split("/"),n=(t[1]||"").trim(),r=(t[0]||"").trim();return n?n+" "+r:r},details:function(e){var t=/;(\d+)=(\d\d)(\d\d)/.exec(e);if(t||(t=/%B(\d+)=(\d\d)(\d\d)/.exec(e)),t){var n=t[1],r=i(t[2],t[3]);if(r)return{number:n,expiryMonth:r.month,expiryYear:r.year}}}},{device:"denzer-has-a-weird-one",trackSeparator:"^",fullName:_.identity,details:function(e){var t=/;(\d+)=(\d\d)(\d\d)/.exec(e);if(t){var n=t[1],r=i(t[2],t[3]);if(r)return{number:n,expiryMonth:r.month,expiryYear:r.year}}}},{device:"knock-off-MSR100U",trackSeparator:"",details:function(e){var t=/^(\d+)=(\d\d)(\d\d)/.exec(e);if(t){var n=t[1],r=i(t[2],t[3]);if(r)return{number:n,expiryMonth:r.month,expiryYear:r.year}}}}];e.directive("ngOverthrow",[function(){return{restrict:"A",link:function(e,t,n){t.addClass("overthrow")}}}]),e.directive("ngSticky",["$parse","$window","auth","d",function(e,t,n,r){return{restrict:"A",link:function(e,i,a){if(e.isSet(a.ngStickyAllowTouch)||!r.isTouchEnabled){var o=e.isSet(a.ngStickyDisableMsie),s=document.documentMode;if(!(o&&s&&s<=11)){var c,l=e.$eval(a.ngStickyEdgeTopMargin)||0,u=(e.$eval(a.ngStickyEdgeBottomMargin),e.$eval(a.ngStickyTopMargin)||0),d=e.$eval(a.ngStickyBottomMargin)||0,m=$(t),p=function(){var t=function(){var e=$(a.ngStickyContent);if(e.length){var t=n.currentUser.isAuthenticated?93:0,r=m.height()-t,o=m.scrollTop(),s=e.offset().top,c=e.outerHeight(),p=i.outerHeight();if(p>c||p>r)return i.removeClass("sticky sticky-pinned sticky-floating").css({top:"",bottom:""}),"no-sticky";var f,h,g=o+(l+t),y=s+u,v=g+p>s+c-d,T=g>y&&!v;return g<=y?(f=u,i.removeClass("sticky-floating"),i.addClass("sticky sticky-pinned").css({top:f,bottom:""}),["sticky-pinned","top",f]):T?(f=t+l,i.removeClass("sticky-pinned"),i.addClass("sticky sticky-floating").css({top:t+l,bottom:""}),["sticky-floating","top",f]):v?(h=d,i.removeClass("sticky-floating"),i.addClass("sticky sticky-pinned").css({top:"",bottom:h}),["sticky-pinned","bottom",h]):void console.warn("ng-sticky: nothing makes sense")}}();angular.equals(c,t)||(c=t,e.$apply())};m.on("scroll",p),m.on("resize",p),e.$watch((function(){setTimeout(p)}))}}else console.info("ng-sticky: touch is enabled")}}}]),e.directive("ngSwipe",[function(){return{restrict:"A",link:function(e,t,n){var r=e.$eval(n.ngSwipe);t.on("keypress",(function(n){13===n.which&&e.$apply((function(){var e;r((e=t.val(),_.chooseFirst(a,(function(t){var n="";if(t.trackSeparator){var r=e.split(t.trackSeparator);if(3!==r.length)return;if(n=t.fullName(r[1]),_.isUndefined(n))return}else r=["","",e];var i=t.details(r[2]);if(!_.isUndefined(i))return _.extend(i,{fullName:n})}))))}))})),t.on("blur",(function(){e.$apply((function(){r()}))})),t.val(""),t.focus()}}}]),e.directive("ngApp",[function(){return{restrict:"A",link:function(e,t,n){$("html").removeClass("html-loading")}}}]),e.directive("ngAutoselect",["d",function(e){return{restrict:"A",link:function(t,n,r){if(n.attr("readonly","readonly"),!e.isTouchEnabled){var i=!1;n.on("click",(function(){n.focus(),i||(n.select(),i=!0)})),n.on("blur",(function(){i=!1}))}}}}]),e.directive("ngAutofocus",["$parse","$timeout","d",function(e,t,n){var r="input, textarea, select",i=function(e){if(e.is(r))return e;var t=e.find(r).first();return t.length?t:void 0};return{restrict:"A",link:function(a,o,s){var c=a.isSet(s.ngAutofocus),l=a.isSet(s.ngAutofocusSelect),u=a.isSet(s.ngAutofocusOpen),d=s.ngAutofocusWhen?e(s.ngAutofocusWhen):_.always;if(r+=s.ngAutofocusElement?", "+s.ngAutofocusElement:"",c)if(n.isTouchEnabled){if(!l)return;t((function(){var e=i(o);e&&!e.is("select")&&e.on("focus",(function(){t((function(){e[0].setSelectionRange(0,1e3)}))}))}))}else t((function(){if(d(a)){var e=i(o);e&&(e.hasClass("ng-dropdown")?(e.trigger("dropdown:focus"),u&&e.trigger("dropdown:open")):(e.focus(),l&&!e.is("select")&&e.select()))}}))}}}]),e.directive("ngAutoNavigate",["$location","$timeout","$window","navigation",function(e,t,n,r){return{restrict:"A",link:function(i,a,o){(!o.ngAutoNavigate||i.$eval(o.ngAutoNavigate))&&t((function(){var t=a.prop("href");e.$$rewrite(t)?r.navigate(t):(n.parent||window).location.href=t}))}}}]),e.directive("ngCurrentOption",["$parse",function(e){return{restrict:"A",scope:!0,controller:["$scope","$attrs",function(t,n){var r=this,i=e(n.ngCurrentOption),a=e(n.ngCurrentOptionTarget||"currentOption"),o=e(n.ngCurrentOptionCollection),s=e(n.ngCurrentOptionOnUpdate),c=t.$eval(n.ngCurrentOptionKey)||"pk",l=function(e,n){var i=_.find(n,(function(t){return t[c]===e}));i||(i=null),a.assign(t.$parent,i);var o=r.currentOption;r.currentOption=i,s&&o!==r.currentOption&&s(t)};t.$parent.$watch(i,(function(e){var n=o(t);l(e,n)})),t.$parent.$watch((function(){return _.pluck(o(t),"uri")}),(function(){var e=o(t),n=i(t);l(n,e)}),!0)}],controllerAs:"currentOptionCtrl"}}]),e.directive("ngWatchHeight",["$document","$window","db","lightframe",function(e,t,n,r){return{restrict:"A",link:function(t,n,i){var a=function(){if(e[0].body)return e[0].body.offsetHeight},o=function(e){r.updateHeight(e)};t.$watch(a,o),setInterval((function(){o(a())}),2500)}}}]),e.directive("ngDimensions",["$document","$parse","$window","$rootScope","scrollbar",function(e,t,n,r,i){var a=function(){return{width:Math.max(e[0].documentElement.clientWidth,n.innerWidth||0),height:Math.max(e[0].documentElement.clientHeight,n.innerHeight||0)}},o=function(e){return{width:e.width(),height:e.height(),outerWidth:e.outerWidth(),outerHeight:e.outerHeight()}};return{restrict:"A",link:function(e,r,s){if(!s.ngDimensionsWhen||e.$eval(s.ngDimensionsWhen)){var c=e.isSet(s.ngDimensionsViewport)?a:_.bind(o,null,r),l=t(s.ngDimensions||"dimensions"),u=c();l.assign(e,u);var d=Math.max(i.getWidth(),15),m=function(){var t=c();t.width===u.width&&t.height===u.height||function(e){var t=u.width-e.width;return t>0&&t<=d}(t)||(_.extend(u,t),e.$digest())},p=_.debounce(m,0),f=_.debounce(m,250);e.$watch(p),$(n).on("resize",f),e.$on("$destroy",(function(){$(n).off("resize",f),p.cancel(),f.cancel()}))}}}}]),e.directive("ngStyleOnce",[function(){return{restrict:"A",link:function(e,t,n){t.css(e.$eval(n.ngStyleOnce))}}}]);var o=function(t){e.directive(t.name,[function(){return{restrict:"A",link:function(e,n,r){var i=t.transform||_.identity,a=t.isNumeric&&!_.isUndefined(r[t.name+"AddToInitial"]),o=function(){var i=e.$eval(r[t.name+"Selector"]);return i?$(i):n},s=r[t.name+"ForceInitialValue"]?e.$eval(r[t.name+"ForceInitialValue"]):o().css(t.property);t.isNumeric&&(s=parseInt(s,10)),(_.isUndefined(s)||_.contains(t.emptyValues,s))&&(s="");var c=function(e){e?(a&&s&&(e+=s),o().css(t.property,i(e))):o().css(t.property,s)};t.interpolate?r.$observe(t.name,c):e.$watch(r[t.name],c),e.$on("$destroy",(function(){c()}))}}}])};o({name:"ngBackgroundImage",property:"background-image",transform:function(e){return"url("+c(e)+")"},emptyValues:["none"]}),o({name:"ngBackgroundColor",property:"background-color",emptyValues:["rgba(0, 0, 0, 0)","transparent"]}),o({name:"ngTop",property:"top",isNumeric:!0}),e.directive("ngLocation",[function(){return{restrict:"A",link:function(e,t,n){e[n.ngLocation]=function e(){var n,r={width:t[0].offsetWidth,height:t[0].offsetHeight};try{n=t.position()}catch(e){n={top:0,left:0}}var i={position:n,size:r};return e.position=i.position,e.size=i.size,i}}}}]),e.directive("ngScrollStatic",["$window",function(e){return{restrict:"A",link:function(t,n,r){var i=r.ngScrollStaticContainer||"html,body",a=!r.ngScrollStaticContainer,o=t.$eval(r.ngScrollStaticPadding)||0;!function(){var t=r.ngScrollStatic,n=$(i),s=n.find(t);if(s.length&&n.length){var c=_.min(_.map(s,(function(e){return $(e).position().top||0}))),l=_.chooseFirst(n,(function(e){if(e.scrollHeight)return e.scrollHeight}))||0,u=_.min(_.choose(n,(function(e){var t=$(e).height();if(t)return t})));a&&(u=Math.min(u,e.innerHeight));var d=Math.max(0,l-u);(c-=o)<0?c=0:c>d&&(c=d),n.scrollTop(c)}}()}}}]),e.directive("ngScrollTo",["scroll",function(e){return{restrict:"A",link:function(t,n,r){var i=t.isSet(r.ngScrollOnClick),a=t.isSet(r.ngScrollSmooth),o=t.isSet(r.ngScrollForce);i?n.on("click",(function(n){r.ngScrollPreAction&&t.$safeApply((function(){t.$eval(r.ngScrollPreAction)})),e.scrollTo(r.ngScrollTo,r.ngScrollContainer,a,o)})):e.scrollTo(r.ngScrollTo,r.ngScrollContainer,a,o)}}}]),e.directive("ngTopScrolled",["$document",function(e){return{restrict:"A",link:function(t,n,r){var i=t.$eval(r.ngTopScrolled)||0,a=e.scrollTop()+i;n.css({top:a})}}}]),e.directive("ngWithLocation",[function(){return{restrict:"A",link:function(e,t,n){e.$watch(n.ngWithLocation,(function(r){if(t.toggleClass("with-location",!!r),r){var i={x:0,y:0};if(n.ngWithLocationOffset){var a=e.$eval(n.ngWithLocationOffset)||{};i.x=a.x||i.x,i.y=a.y||i.y}var o=e.$eval(n.ngWithLocationRight)||!1,s={top:r.position.top+i.y};s.left=o?r.position.left+-t[0].offsetWidth+i.x:r.position.left+r.size.width+i.x,t.toggleClass("left",!o),t.toggleClass("right",o),t.css(s)}}))}}}]),e.directive("ngTranslate",["$window","translate",function(e,t){return{restrict:"A",link:function(e,n){t.initialize(n)}}}]);var s=function(e){return e&&!_.isUndefined(e.x)&&!_.isUndefined(e.y)&&e.width&&e.height},c=function(e){return-1===e.indexOf("Cdn")?e.replace("Url","CdnUrl"):e};e.directive("ngImage",["$parse",function(e){return{restrict:"A",compile:function(t,n){var r=e(n.ngImage),i=_.isUndefined(n.ngImageOnce)||""===n.ngImageOnce?_.always:e(n.ngImageOnce);return function(e,t,n){var a=function(r){if(r){var i,a=e.$eval(n.ngImageCrop),o=e.$eval(n.ngImageSquare),c=e.$eval(n.ngImageMaxWidth),l=e.$eval(n.ngImageMaxHeight),u=e.$eval(n.ngImageMaxSize),d=e.$eval(n.ngImageWidth),m=e.$eval(n.ngImageHeight),p=e.$eval(n.ngImageFilter),f=e.$eval(n.ngImageFilterAmount),h={cache:!0,compress:!0,quality:90};return s(a)&&_.extend(h,{crop:a.x.toFixed(0)+","+a.y.toFixed(0)+","+a.width.toFixed(0)+","+a.height.toFixed(0)}),o&&_.extend(h,{w:o,h:o,fit:"crop"}),c&&_.extend(h,{w:c,fit:"max"}),l&&_.extend(h,{h:l,fit:"max"}),u&&_.extend(h,{w:u,h:u,fit:"max"}),d&&_.extend(h,{w:d}),m&&_.extend(h,{h:m}),p&&-1!==_.indexOf(["blur","sharpen"],p)&&f&&(h.filter=p,h[p+"Amount"]=f),_.startsWith(r,"https://fh-sites.imgix.net")||(r+="/convert?",r+=(i=h,_.map(i,(function(e,t){return t+"="+e.toString()})).join("&"))),t.is("img")?t.attr("src",r):t.css("background-image","url("+r+")"),r}console.info("ng-image: no url supplied")};if(i()){var o=a(r(e));console.info("ng-image: once",o)}else e.$watch(r,(function(e){e=a(e),console.info("ng-image: watch",e)}))}}}}]),e.directive("ngCrop",["$parse","$timeout",function(e,t){return{restrict:"A",require:"^form",link:function(n,r,i,a){r.attr("src",n.$eval(i.ngCrop));var o=n.$eval(i.ngCropAspectRatio);o=!1===o?0:o||1.9;var c,l=e(i.ngCropModel),u=function(){return r[0].naturalWidth/r.width()},d=function(e){n.$safeApply((function(){var t=l(n),r=u();t.x=Math.floor(e.x*r),t.y=Math.floor(e.y*r),t.width=Math.floor(e.w*r),t.height=Math.floor(e.h*r),a.$setDirty()}))};t((function(){r.Jcrop({onSelect:d,keySupport:!1,aspectRatio:o},(function(){c=this;var e=l(n),t=u();if(s(e)){var r=Math.floor(e.x/t),i=Math.floor(e.y/t),a=r+Math.floor(e.width/t),d=i+Math.floor(e.height/t);c.setSelect([r,i,a,d])}else{var m,p,f=c.getWidgetSize(),h=f[0],g=f[1];if(!o)return void c.setSelect([0,0,h,g]);h/o<g?(m=h,r=0,i=(g-(p=h/o))/2):(p=g,r=(h-(m=g*o))/2,i=0),r=Math.floor(r),i=Math.floor(i),a=r+Math.floor(m),d=i+Math.floor(p),c.setSelect([r,i,a,d])}})),n.$on("$destroy",(function(){c&&c.destroy()}))}))}}}]),e.directive("ngAudio",[function(){return{restrict:"A",link:function(e,t,n){var r,i=n.ngAudioSrc;e[n.ngAudio]=function(){r||(r=$('<audio><source src="'+i+'"></audio>'),t.append(r)),r[0].load(),r[0].play()},e.$on("$destroy",(function(){r&&r.remove()}))}}}]),e.directive("ngTip",["$compile","$parse","$sanitize","$templateCache","d",function(e,t,n,r,i){var a;return{restrict:"A",link:function(o,s,c){var l=c.ngTipLocation,u=c.ngTipWhen?t(c.ngTipWhen):_.always,d=$("body"),m=c.ngTipPosition;if(!i.isTouchEnabled||o.$eval(c.ngTipTouch)){a||(a=$('<span class="tip" aria-live="polite"></span>'),d.append(a));var p,f,h,g=!1,y=function(t){var i,y=s;if((!l||(y=s.find(l)).length)&&u(o)){var v,C=m?"tip-"+m:"";if(a.attr("class","tip").addClass(b()+" "+(i=(s.attr("class")||"").split(" "),(i=_.choose(i,(function(e){if(e=e.trim())return"tip-ele--"+e}))).join(" ")+" ")+C),c.ngTipTemplate){var k=c.ngTipTemplate,A=r.get(k);if(!A)return void console.warn("ng-tip: invalid template",k);var P=e(A);o.$safeApply((function(){v=P(o)}))}else v=n(E());a.html(v),a.css({width:"auto"});var S=y.offset(),O=y.outerWidth();0===O&&y[0]instanceof SVGElement&&(O=y[0].getBoundingClientRect().width),h=a.outerWidth(),f=a.outerHeight();var I=parseInt(d.css("top"),10)||0;p={};var R=y.outerHeight();"right"!==m&&"left"!==m||(p.top=Math.floor(S.top+R/2-f/2)-I),"right"===m?p.left=S.left+O+8:"left"===m?p.left=S.left-h-8:"cursor"===m&&(O>=50||R>=50)?(g=!0,T(t)):(p.top=Math.floor(S.top-f-8-I),p.left=Math.floor(Math.max(S.left+(O-h)/2,0))),a.css(p),a.addClass("showing")}},v=function(){a.attr("class","tip"),a.css({top:-100,left:-100})},T=function(e){p.top=Math.max(e.pageY-f-8,0),p.left=Math.max(e.pageX-Math.floor(h/2),0)},E=i.observer(c,"ngTip",""),b=i.observer(c,"ngTipClasses","");s.on("mouseenter",y),s.on("mouseleave",v),"cursor"===m&&s.on("mousemove",(function(e){g&&(T(e),a.css(p))})),s.on("retip",(function(e){window.setTimeout((function(){if(o.$root){var t=a.hasClass("showing");v(),t&&y(e)}}))})),c.ngDisabled&&s.is("button, input, select, textarea")&&c.$observe("disabled",(function(e){e&&a.hasClass("showing")&&v()})),o.$on("$destroy",v)}}}}]),e.directive("ngRadioFlyer",[function(){return{link:function(e,t,n){var r=function(e){t.find('input[type="radio"]').each((function(){var t=$(this),n=_.isUndefined(e)?t.is(":checked"):t.val()===e;t.closest("label").toggleClass("radio-selected",n)}))};n.ngRadioFlyer?e.$watch(n.ngRadioFlyer,(function(e){r(e)})):e.$watch((function(){r()})),e.$evalAsync((function(){r()}))}}}]),e.directive("ngCheckboxMadness",[function(){return{require:"ngModel",link:function(e,t,n){e.$watch(n.ngModel,(function(e){t.closest(".field").toggleClass("checkbox-selected",!!e)}))}}}]),e.directive("ngSupportHacks",_.optional(["d","events","?native",function(e,t,n){return{restrict:"A",link:function(r){var i=$("html");i.addClass(e.isTouchEnabled?"touch":"not-touch"),i.addClass(n&&n.isNative?"native":"not-native"),t.on(r,"fareharbor.native.inApp",(function(e,t){i.addClass("native").removeClass("not-native")}))}}}])),e.directive("ngBlurEscape",["$document","d",function(e,t){return{restrict:"A",link:function(n,r,i){e.on("keydown",(function(e){if(27===e.which){var n=$(e.target);t.isTextInput(n)&&(e.preventDefault(),e.stopPropagation(),n.trigger("blur"))}}))}}}]),e.directive("ngShortcut",["$parse","navigation","shortcuts",function(e,t,n){return{restrict:"A",compile:function(t,r){var i=e(r.ngShortcut),a=r.ngShortcutAction?e(r.ngShortcutAction):_.ignore;return function(e,t,r){var o=i(e);if(!_.isUndefined(o)){o=o.split("|");var s=_.ignore;e.isSet(r.ngShortcutClick)&&(s=_.then(s,(function(){r.disabled||t.trigger("click")}))),e.isSet(r.ngShortcutFocus)&&(s=_.then(s,(function(){t.is("input, textarea, select")?setTimeout((function(){t.trigger("focus")})):t.find("input, textarea").first().trigger("focus")}))),r.ngShortcutAction&&(s=_.then(s,(function(){e.$apply((function(){r.disabled||a(e)}))}))),e.isSet(r.ngShortcutOnly)&&t.addClass("ng-hide"),_.forEach(o,(function(t){var i=n.register({keySet:t,action:s,description:r.ngShortcutDescription||""});e.$on("$destroy",(function(){n.unregister(i)}))}))}}}}}]),e.directive("ngGenericForm",[function(){return{link:function(e,t,n){e[n.ngGenericForm]={}}}}]),e.directive("ngSortable",[function(){return{restrict:"A",require:"^?form",link:function(e,t,n,r){var i=e.$eval(n.ngSortable);if(i){var a=n.ngSortableHandle||".sortable-handle",o=n.ngSortableSelector||"li.sortable",s='<li class="sortable sortable-placeholder"></li>';e.$eval(n.ngSortableTable)&&(s='<tbody class="sortable"><tr><td style="height: 50px"></td></tr></tbody>');var c={itemSelector:o,placeHolderTemplate:s,dragEnd:function(t,n){var a=$(this),o=$(t),s=$(n),c=a.data("ng-sortable-item"),l=o.data("ng-sortable-item"),u=s.data("ng-sortable-item");return c===u&&(u=null),c===l&&(l=null),e.$apply((function(){return r&&r.$setDirty(),i(c,l,u)}))}};a&&(c.dragSelector=a,c.dragSelectorExclude="input, textarea"),t.dragsort(c),e.$on("$destroy",(function(){t.dragsort("destroy")}))}}}}]),e.directive("ngSortableItem",[function(){return{restrict:"A",link:function(e,t,n){var r=e.$eval(n.ngSortableItem);r&&(t.data("ng-sortable-item",r),t.addClass("sortable"))}}}]),e.directive("ngDropdown",["$interpolate","$parse","$sanitize","d",function(e,t,n,r){var i=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,a=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+hide\s+when\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)?$/,o="remote-options-mode",s="ng-options-mode",c=T("Choose an option"),l={errorLoading:_.constant(T("The results could not be loaded")),inputTooLong:function(e){var t=e.input.length-e.maximum;return interpolate(nT("Please delete %(count)s character","Please delete %(count)s characters",t),{count:t})},inputTooShort:function(e){var t=e.minimum-e.input.length;return interpolate(nT("Please enter %(count)s or more character","Please enter %(count)s or more characters",t),{count:t})},loadingMore:_.constant(T("Loading more results...")),maximumSelected:function(e){return interpolate(nT("You can only select %(count)s item","You can only select %(count)s items",e.maximum),{count:e.maximum})},noResults:_.constant(T("No results found")),searching:_.constant(T("Searching..."))};return{restrict:"A",require:["ngModel","select"],compile:function(u,d){var m,p,f,h,g,y,v,T,E,b,C;if(d.ngDropdownRemoteOptions){if(b=o,!(m=d.ngDropdownRemoteOptions.match(a)))return void console.error("ngDropdown: malformed ngDropdownRemoteOptions expression.");g=t(m[2]||m[1]),v=m[3]?t(m[3]):null,T=m[4]?t(m[4]):null,p=m[6],f=m[5]||m[7],h=t(m[2]?m[1]:f),y=t(m[8]),C=d.ngDropdownMinimum?t(d.ngDropdownMinimum):_.constant(2)}else{if(!d.ngOptions)return void console.error("ngDropdown: ngDropdownRemoteOptions or ngOptions required.");if(b=s,!(m=d.ngOptions.match(i)))return void console.error("ngDropdown: ng-options regex must match angular.");p=m[5],f=m[4]||m[6],E=t(m[7])}var k=b===s&&!r.isDropdownSupported,A=d.ngPlaceholder||c,P=e(A),S=d.ngPlaceholderValue?t(d.ngPlaceholderValue):_.constant(null),O=d.ngDropdownCurrentOption&&t(d.ngDropdownCurrentOption),I=d.ngDropdownAllowClear&&t(d.ngDropdownAllowClear),R=t(d.ngModel),N=$("<option class='empty-option' value='' label=''></option>");return u.prepend(N),k?u.closest(".the-field").addClass("ng-dropdown-disabled"):(u.css("width","100%"),u.addClass("ng-dropdown")),function(e,t,r,i){var a=i[0],c=i[1],u=!I||I(e);if(k&&!u)var d=e.$watch(r.ngModel,(function(e){""!==t.val()&&(t.find(".empty-option").remove(),d())}));var m=S(e);if(a.$parsers.push((function(e){return null===e?m:e})),a.$formatters.push((function(e){return e===m?null:e})),!k){var A,N={language:l,minimumResultsForSearch:8,allowClear:u,placeholder:P(e)},w={};N.templateResult=function(e){var t=$("<span>"+n(e.text)+"</span>"),r=w[e.id];return _.isObject(r)&&r.classes&&t.addClass(r.classes),t},N.templateSelection=function(e){return $("<span>"+n(e.text)+"</span>")};var U={},F=function(t,n,r){return t?(p&&(U[p]=r),U[f]=n,t(e,U)):null};if(b===o){var D=y(e),L=function(e,t){return{id:e.uri||e.pk.toString(),text:F(g,e,t),disabled:F(T,e,t),ngModelValue:F(h,e,t),originalValue:e}};N.minimumInputLength=C(e),N.ajax={delay:250,transport:function(e,t,n){var r=e.data.term,i=D(r);return i.$promise.then((function(){t(i)}),(function(){n(i)})),{abort:i.$promise.cancel}},processResults:function(e){w={};var t=[];return _.forEach(e,(function(e,n){if(!F(v,e,n)){var r=L(e,n);t.push(r),w[r.id]=r.ngModelValue}})),{results:t}}},a.$parsers.unshift((function(e){return w[e]||null})),c.readValue=function(){var e=t.val();return e in c.selectValueMap?c.selectValueMap[e]:e}}else if(b===s){var M={default:function(){var t=E(e);if(_.isArray(t)){if(!t.length)return t;if(!_.isUndefined(t[0].label))return _.pluck(t,"label");if(!_.isUndefined(t[0].uri))return _.pluck(t,"uri");if(!_.isUndefined(t[0].pk))return _.pluck(t,"pk");if(_.isString(t[0]))return t}else if(_.isObject(t))return _.keys(t)},uri:function(){var t=E(e);return _.pluck(t,"uri")},pk:function(){var t=E(e);return _.pluck(t,"pk")}}[e.$eval(r.ngDropdownWatchType)||"default"],x=function(){window.setTimeout((function(){t.trigger("change.select2")}))};e.$watch(M,(function(){w=_.indexBy(E(e),(function(e,t){return t.toString()})),A.dataAdapter.destroy(),x()}),!0),e.$watch(r.ngModel,x)}var B=t.closest(".ng-dropdown-context");B.length&&(N.dropdownParent=B),_.forEach(["open","focus"],(function(e){t.bind("dropdown:"+e,(function(){t.select2(e)}))})),e.$watch(r.ngDisabled,(function(e){t.attr("disabled",!!e)})),e.$watch((function(){return!!t.parents("fieldset[disabled]").length}),(function(e){t.attr("disabled",e)})),e.$on("$destroy",(function(){A.destroy()})),t.select2(N),A=t.data("select2"),b===o&&O&&(e.$watch(O,(function(e){if(!_.isUndefined(e)){var t=[];e&&t.push(L(e)),A.trigger("selection:update",{data:t})}})),e.$watch(R,(function(t){t||O.assign(e,null)})),A.on("select",(function(t){e.$apply((function(){O.assign(e,t.data.originalValue)}))})))}}}}}]),e.directive("ngIf",t.conditionalDirective({watch:["$parse",function(e){return function(t,n,r){var i=e(r.ngIf);return function(){return!!i(t)}}}],operator:function(e,t,n){return function(t){return n.ngThen&&(e[n.ngThen]=t),t}}})),e.directive("ngIfOnce",t.conditionalDirective({watch:["$parse",function(e){return function(t,n,r){var i=e(r.ngIfOnce);return function(){return!!i(t)}}}],operator:function(e,t,n){return function(t){return n.ngThen&&(e[n.ngThen]=t),t}},once:!0})),e.directive("ngIfInLabs",t.conditionalDirective({watch:["labs",function(e){return function(t,n,r){return function(){var n=r.ngIfInLabs.replace("!",""),i=r.ngIfInLabsVariation,a=0===r.ngIfInLabs.indexOf("!"),o=e.isInVariation(n,i);return r.ngThen&&(t[r.ngThen]=o),a?!o:o}}}]})),e.directive("ngElse",t.conditionalDirective({watch:["$parse",function(e){return function(t,n,r){var i=e(r.ngElse);return function(){return!i(t)}}}]})),e.directive("ngElseOnce",t.conditionalDirective({watch:["$parse",function(e){return function(t,n,r){var i=e(r.ngElseOnce);return function(){return!i(t)}}}],once:!0})),e.directive("ngWatch",t.conditionalDirective({watch:["$parse",function(e){return function(t,n,r){return e(r.ngWatch)}}],operator:_.constant(_.always),transclude:["$parse",function(e){return function(t,n,r){var i=e(r.ngWatchAction)||_.ignore;return function(){i(t)}}}]})),e.directive("ngInterval",[function(){return{link:function(e,t,n){var r=e.$eval(n.ngInterval)||1,i=setInterval((function(){e.$digest()}),1e3*r);e.$on("$destroy",(function(){clearInterval(i)}))}}}]),e.directive("ngData",["$q",function(e){return{scope:!0,transclude:!0,templateUrl:"ng-data",controllerAs:"dataCtrl",controller:["$scope","$attrs",function(t,n){var r=this;r.status="loading",t.isSet(n.ngDataSmall)?r.type="small":t.isSet(n.ngDataManual)?r.type="manual":r.type="large";var i=n.ngDataOnError||"";r.transcludeOnError="transclude"===i;var a=n.ngDataOnSuccess||"",o=function(){r.status="success",a&&t.$eval(a)},s=t.$eval(n.ngData);if(_.isUndefined(s))o();else{var c=_.isArray(s);if(c||_.isPromise(s)){c&&(s=e.all(s));var l=t.$eval(n.ngDataStale);_.isUndefined(l)||(l=c?l:[l],_.any(l,"$fresh"))?s.then((function(){o()}),(function(){r.status="error"})):o()}else o()}}]}}]),e.config(["$provide",function(e){e.decorator("ngShowDirective",["$delegate",function(e){return e.shift(),e}])}]),e.directive("ngShow",["$parse",function(e){return{restrict:"A",compile:function(t,n){var r=e(n.ngShow);return function(e,t,n){e.$watch(r,(function(r){t.toggleClass("ng-hide",!r),n.ngThen&&(e[n.ngThen]=r)}))}}}}]),e.directive("ngShowOnce",["$parse",function(e){return{restrict:"A",compile:function(t,n){var r=e(n.ngShowOnce);return function(e,t,n){var i=r(e);t.toggleClass("ng-hide",!i),n.ngThen&&(e[n.ngThen]=i)}}}}]),e.config(["$provide",function(e){e.decorator("ngHideDirective",["$delegate",function(e){return e.shift(),e}])}]),e.directive("ngHideOnce",["$parse",function(e){return{restrict:"A",compile:function(t,n){var r=e(n.ngHideOnce);return function(e,t,n){var i=!!r(e);t.toggleClass("ng-hide",i),n.ngThen&&(e[n.ngThen]=i)}}}}]),e.directive("ngHide",["$parse",function(e){return{restrict:"A",compile:function(t,n){var r=e(n.ngHide);return function(e,t,n){e.$watch(r,(function(r){r=!!r,t.toggleClass("ng-hide",r),n.ngThen&&(e[n.ngThen]=r)}))}}}}]),e.directive("ngAutoExporter",["$interpolate","autoExport",function(e,t){return{scope:!0,templateUrl:"auto-exporter",compile:function(n,r){var i=e(r.ngAutoExporter),a=e(r.ngAutoExporterFilename);return function(e,n,r){e.autoExport=t,e.isLeft=e.isSet(r.ngAutoExporterLeft),e.$watch(i,(function(t){e.namespace=t})),e.$watch(a,(function(t){e.filename=t}))}}}}]),e.directive("ngAutoExportValue",[function(){return{restrict:"A",compile:function(e,t){var n=t.ngAutoExportValue||"";return t.$set("ngAutoExportValue",""),function(e,t,r){t.data("ngAutoExportValue",(function(){return e.$interpolate(n)}))}}}}]),e.directive("ngAutoExportSkip",["$parse",function(e){return{restrict:"A",compile:function(t,n){var r=e(n.ngAutoExportSkip||"true");return function(e,t,n){t.data("ngAutoExportSkip",_.bind(r,null,e))}}}}]),e.directive("ngAutoExportOnly",["$parse",function(e){return{restrict:"A",compile:function(t,n){if(n.ngAutoExportOnly){var r=e(n.ngAutoExportOnly);return function(e,t,n){e.$watch(r,(function(e){t.toggleClass("ng-hide",e)}))}}t.addClass("ng-hide")}}}]),e.directive("ngAutoExport",["$interpolate","$parse","autoExport",function(e,t,n){return{restrict:"A",scope:!0,compile:function(r,i){var a=e(i.ngAutoExport),o=i.ngAutoExportProcess?t(i.ngAutoExportProcess):null;return function(e,t){var r=a(e),s={isCSS:e.isSet(i.ngAutoExportCss),tableSelector:i.ngAutoExportTable,rowSelector:i.ngAutoExportRow,cellSelector:i.ngAutoExportCell};o&&(s.process=_.bind(o,null,e));var c=n.addExport(r,t,s);e.$on("$destroy",(function(){n.removeExport(c)}))}}}}]),e.directive("ngTableFilters",["$parse","$rootScope","require",function(e,t,n){return{restrict:"A",scope:!0,controller:function(){var e=this;e.ignore=null,e.filters=[],e.addFilter=function(t){n.assert(t.type,"ng-table-filter: expected filter description to include type"),n.assert(t.filter,"ng-table-filter: expected filter description to include filter"),e.filters.push(t),c(t)},e.removeFilter=function(t){s(t),_.overwriteWithout(e.filters,t)},e.reset=function(){_.forEach(e.filters,(function(e){e.resetValue()})),e.update()},e.isFiltering=function(t){return _.any(_.map(e.filters,(function(e){return e.isFiltering()})))};var r=function(t,n){for(var r,i,a,o=[],s=e.filters.length,c=0,l=n.length;c<l;c++){if(r=!0,(i=n[c])&&i!==e.ignore)for(var u=0;u<s;u++)if((a=e.filters[u]).isFiltering()&&!a.filter(i)){r=!1;break}r&&o.push(i)}_.overwrite(t,o),t.filtered=n.length-o.length},i={},a={};e.update=function(){console.info("ng-table-filters: filtering collections"),_.forEach(i,(function(e,t){r(a[t],e)})),s()},e.debouncedUpdate=_.debounce((function(){t.$apply((function(){e.update()}))}),500),e.addCollection=function(e,t){i[e.$id]=t||[];var n=a[e.$id];return _.isUndefined(n)&&(n=a[e.$id]=[]),r(n,i[e.$id]),n},e.removeCollection=function(e){delete i[e.$id],delete a[e.$id]};var o={},s=function t(n){o&&(_.isUndefined(n)?_.forEach(e.filters,(function(e){t(e)})):_.isUndefined(n.identifier)||_.isUndefined(n.value)||(o[n.identifier]=n.value))},c=function t(n){if(o)if(_.isUndefined(n))_.forEach(e.filters,t);else if(!_.isUndefined(n.identifier)){var r=o[n.identifier];_.isUndefined(r)?n.resetValue():n.value=r}};e.updateModel=function(t){return s(),o=t||{},c(),e.update(),o},e.storeModel=function(){return s(),o}},compile:function(t,n){var r=n.ngTableFilters?e(n.ngTableFilters):null,i=n.ngTableFiltersModel?e(n.ngTableFiltersModel):null,a=n.ngTableFiltersIgnore?e(n.ngTableFiltersIgnore):null;return{pre:function(e,t,n,o){e.$tableFilters=o,i&&e.$watch(i,(function(t){i.assign(e,o.updateModel(t))})),r&&e.$watchCollection(r,(function(t){e.$collection=o.addCollection(e,t)})),a&&e.$watch(a,(function(e){o.ignore=e,o.update()}))}}}}}]),e.directive("ngTableFilter",["$compile","$parse","$templateCache",function(e,t,n){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],scope:!0,controller:function(){var e=this;e.name="",e.isFiltering=_.never,e.filter=_.always},compile:function(r,i){var a=n.get(i.ngTableFilterTemplate||"tableFilter.filter");if(a){var o=e(a),s=i.ngTableFilterIdentifier?t(i.ngTableFilterIdentifier):null;return{pre:function(e,t,n,r){var i=r[0],a=r[1];e.$tableFilter=a,a.reset=function(){a.resetValue(),i.update()},a.name=a.identifier=n.ngTableFilter,s&&(a.identifier=s(e)),n.$observe("ngTableFilter",(function(e){a.name=e})),t.addClass("ng-table-filter"),e.$watch((function(){return a.isFiltering()}),(function(e){t.toggleClass("filtering",e)})),o(e,(function(e){t.append(e)}))},post:function(e,t,n,r){var i=r[0],a=r[1];i.addFilter(a),e.$on("$destroy",(function(){i.removeFilter(a)}))}}}console.error("ng-table-filter-filter: template not found")}}}]),e.directive("ngTableFilterString",["$parse",function(e){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(t,n){var r=e(n.ngTableFilterString);return{post:function(e,t,n,i){var a=i[0],o=i[1];o.type="string",o.value="",o.resetValue=function(){o.value=""};var s="";o.isFiltering=function(){return!!(s=o.value.toLowerCase())},o.filter=function(t){return function(t){return r(e,{$row:t})||""}(t).toLowerCase().indexOf(s)>=0},e.$watch((function(){return o.value}),(function(){a.debouncedUpdate()}))}}}}}]),e.directive("ngTableFilterDate",["$parse",function(e){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(t,n){var r=e(n.ngTableFilterDate);return{pre:function(e,t,n,i){var a=i[0],o=i[1],s=function(t){return r(e,{$row:t})||0};o.operations=[{name:T("Before"),value:"before"},{name:T("On"),value:"on"},{name:T("After"),value:"after"}];var c,l={on:function(e){var t=s(e);return!!t&&0===t.diff(c,"days")},before:function(e){var t=s(e);return!!t&&t.diff(c,"days")<0},after:function(e){var t=s(e);return!!t&&t.diff(c,"days")>0}};o.type="date",o.value={operation:"on",date:""},o.resetValue=function(){o.value.date=""},o.isFiltering=function(){return!!(c=o.value.date?moment(o.value.date,"YYYY-MM-DD"):null)},o.filter=l[o.value.operation],e.$watch((function(){return o.value.operation}),(function(e){o.filter=l[e],a.debouncedUpdate()})),e.$watch((function(){return o.value.date}),(function(){a.debouncedUpdate()}))}}}}}]),e.directive("ngTableFilterAmount",["$parse",function(e){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(t,n){var r=e(n.ngTableFilterAmount);return{pre:function(e,t,n,i){var a=i[0],o=i[1],s=function(t){return r(e,{$row:t})||0},c="greater-than";o.operations=[{name:T("is"),value:"equal"},{name:T("less than"),value:"less-than"},{name:T("greater than"),value:c}];var l={equal:function(e){return s(e)===o.value.amount},"less-than":function(e){return s(e)<o.value.amount},"greater-than":function(e){return s(e)>o.value.amount}};o.type="amount",o.value={operation:c,amount:""},o.resetValue=function(){o.value.amount=""},o.isFiltering=function(){return""!==o.value.amount},o.filter=l[o.value.operation],e.$watch((function(){return o.value.operation}),(function(e){o.filter=l[e],a.debouncedUpdate()})),e.$watch((function(){return o.value.amount}),(function(){a.debouncedUpdate()}))}}}}}]),e.directive("ngTableFilterNumber",["$parse",function(e){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(t,n){var r=e(n.ngTableFilterNumber);return{pre:function(e,t,n,i){var a=i[0],o=i[1],s=function(t){return r(e,{$row:t})||0},c="greater-than";o.operations=[{name:T("is"),value:"equal"},{name:T("less than"),value:"less-than"},{name:T("greater than"),value:c}];var l={equal:function(e){return s(e)===o.value.number},"less-than":function(e){return s(e)<o.value.number},"greater-than":function(e){return s(e)>o.value.number}};o.type="number",o.value={operation:c,number:""},o.resetValue=function(){o.value.number=""},o.isFiltering=function(){return""!==o.value.number},o.filter=l[o.value.operation],e.$watch((function(){return o.value.operation}),(function(e){o.filter=l[e],a.debouncedUpdate()})),e.$watch((function(){return o.value.number}),(function(){a.debouncedUpdate()}))}}}}}]),e.directive("ngTableFilterChoice",["$parse",function(e){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(t,n){var r=e(n.ngTableFilterChoice),i=e(n.ngTableFilterChoices),a=e(n.ngTableFilterChoiceName||"$choice.name"),o=e(n.ngTableFilterChoiceValue||"$choice.pk");return{pre:function(e,t,n,s){var c=s[0],l=s[1];l.choiceValue=function(t){return o(e,{$choice:t})},l.choiceName=function(t){return a(e,{$choice:t})};var u=i(e),d=_.map(u,(function(e){return l.choiceValue(e)}));l.type="choices",l.choices=u,l.value={},l.resetValue=function(){_.forEach(d,(function(e){l.value[e]=!1}))},l.resetValue(),l.isFiltering=function(){return _.any(_.values(l.value))},l.filter=function(t){var n,i=function(t){return r(e,{$row:t})||!1}(t);if(_.isArray(i)){for(var a=0,o=i.length;a<o;a++)if(n=l.choiceValue(i[a]),d.indexOf(n)>=0&&l.value[n])return!0;return!1}return n=l.choiceValue(i),d.indexOf(n)>=0&&l.value[n]},e.$watch((function(){return l.value}),(function(){c.debouncedUpdate()}),!0)}}}}}]),e.directive("ngTableFilterYesno",["$parse",function(e){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(t,n){var r=e(n.ngTableFilterYesno);return{pre:function(e,t,n,i){var a=i[0],o=i[1],s=o.ANY="any";o.type="yesno",o.value=s,o.resetValue=function(){o.value=s},o.isFiltering=function(){return o.value!==s},o.filter=function(t){return function(t){return r(e,{$row:t})||!1}(t)===o.value},e.$watch((function(){return o.value}),(function(){a.debouncedUpdate()}))}}}}}]),e.directive("ngTableFilterView",["$compile","$templateCache",function(e,t){var n={};return{require:"^ngTableFilter",link:{pre:function(r,i,a,o){var s="tableFilter.filters."+o.type,c=n[s];if(!c){var l=t.get(s);if(!l)return console.warn("ng-table-filter-view: invalid or custom type",o.type),void i.remove();c=n[s]=e(l)}c(r,(function(e){i.append(e)}))}}}}]),e.directive("ngTables",[function(){return{restrict:"A",scope:!0,controllerAs:"tablesCtrl",controller:function(){var e=this;e.tables=[],e.predicate=null,e.addTable=function(t){_.contains(e.tables,t)||e.tables.push(t)},e.removeTable=function(t){_.overwriteWithout(e.tables,t)},e.toggle=function(t){e.predicate=t,_.forEach(e.tables,(function(e){e.toggle(t)}))}}}}]),e.directive("ngTable",["$filter",function(e){var t=e("orderBy");return{restrict:"A",scope:!0,controller:["$scope","$attrs","$parse","$element",function(e,n,r,i){var a,o=this,s=n.ngTableName||"$table",c=e.isSet(n.ngTableFiltered)?i.controller("ngTableFilters"):null;o.collection=[],o.predicate=null,o.isReversed=!1,o.isHeadersIgnored=e.isSet(n.ngTableIgnoreHeaders),o.toggle=function(e){e&&o.predicate===e?o.isReversed=!o.isReversed:(o.predicate=e,o.isReversed=!1),o.update()},o.update=function(e){_.isUndefined(e)||(a=e);var n=a;o.predicate&&(n=t(a,o.predicate,o.isReversed)),_.overwrite(o.collection,n),_.forEach(l,(function(e){e()}))};var l=[];o.watch=function(e,t){l.push(t),e.$on("$destroy",(function(){_.overwriteWithout(l,t)}))},e.tablesCtrl&&e.isSet(n.ngTableTables)&&(e.tablesCtrl.addTable(o),o.predicate=e.tablesCtrl.predicate,e.$on("$destroy",(function(){e.tablesCtrl.removeTable(o)})));var u,d=r(n.ngTable);o.update(d(e)),e.$watchCollection(d,(function(t){c?u=c.addCollection(e,t):o.update(t)})),c&&(e.$watchCollection((function(){return u}),(function(e){o.update(e),o.filtered=e.filtered})),e.$on("$destroy",(function(){c.removeCollection(e)}))),_.set(e,s,o)}]}}]),e.directive("ngTableHeader",["tableHeaders","require",function(e,t){return{restrict:"A",require:["^?ngTable","^?ngTables"],link:function(n,r,i,a){var o=a[0]||a[1];if(o&&o===a[0]&&o.isHeadersIgnored&&(o=a[1],t.assert(o,"If ngTable is only for summaries, ngTables is required for headers!")),t.assert(o,"ngTable or ngTables required"),!i.ngTableHeaderWhen||n.$eval(i.ngTableHeaderWhen)){var s=e.parsePredicate(n,i.ngTableHeader,n.isSet(i.ngTableHeaderDefault),i.ngTableHeaderKey);n.isSet(i.ngTableHeaderDisabled)||(r.on("click",(function(){n.$apply((function(){o.toggle(s)}))})),r.addClass("ng-table-header"),n.$watch((function(){return o.predicate===s}),(function(e){r.toggleClass("active",e)}))),s.isDefault&&o.toggle(s)}}}}]),e.directive("ngTableSummary",["$parse","require",function(e,t){return{scope:!0,restrict:"A",compile:function(n,r){var i=r.ngTableSummary?e(r.ngTableSummary):null,a=r.ngTableSummaryOperator?e(r.ngTableSummaryOperator):function(e,t){return(t.$acc||0)+(t.$row||0)},o=r.ngTableSummaryInitial?e(r.ngTableSummaryInitial):r.ngTableSummaryOperator?null:_.constant(0);return r.ngTableSummaries&&(i=e(r.ngTableSummaries),o=function(){return[]},a=function(e,t){return _.forEach(t.$row,(function(e,n){t.$acc[n]=(t.$acc[n]||0)+(e||0)})),t.$acc}),{pre:function(n,r,s){var c=s.ngTableSummaryTableName||"$table";t.inScope(n,c,"ngTable controller must be in scope");var l=n[c],u=s.ngTableSummaryWhen?e(s.ngTableSummaryWhen):_.always,d=function(){n.$summary=function(){if(!u(n))return"";var e=o?o(n):null;return _.reduce(l.collection,(function(e,t){return a(n,{$acc:e,$row:i?i(n,{$row:t}):t})}),e)}()};d(),n.isSet(s.ngTableSummaryOnce)||(n.isSet(s.ngTableSummaryTableOnly)?l.watch(n,d):n.$watch(d))}}}}}]),e.directive("ngGroup",[function(){return{scope:!0,restrict:"A",require:["ngGroup","^?ngGroups"],controller:function(){var e=this;e.collection=[],e.groups=[],e.byFn=e.asFn=e.name=null,e.group=function(){var t=!0,n=e.byFn;n||(n=_.constant(""),t=!1);var r=e.asFn?e.asFn:n,i={},a={};if(e.collection.length){var o={};_.forEach(e.collection,(function(t){var s={$row:t},c=n(s)||"",l=_.isArray(c)?c:[c];l.length||(l=[null]),_.forEach(l,(function(c){if(s.$by=c,c=_.isModelObject(c)?c.uri:c,_.isUndefined(i[c])){var l=r===n?c:r(s);i[c]=l||null}_.isUndefined(a[c])&&(e.sortByFn?a[c]=e.sortByFn(s):a[c]=i[c]),delete s.$by;var u=o[c]||[];u.push(t),o[c]=u}))}));var s={};_.forEach(e.groups,(function(e){s[e.by]=e}));var c=_.map(o,(function(n,r){var o=s[r]||{},c={isGrouped:t,by:r,as:i[r],name:e.name,rows:n,sortBy:a[r]};return _.extend(o,c),o}));_.overwrite(e.groups,_.sortBy(c,"sortBy"))}else{var l={isGrouped:t,name:e.name,rows:[]};_.overwrite(e.groups,[l])}},e.groupBy=function(t,n,r,i){e.byFn=t,e.asFn=n,e.sortByFn=r,e.name=i,e.group()},e.update=function(t){e.collection=t,e.group()}},link:function(e,t,n,r){var i=r[0],a=r[1];a&&(a.addNgGroupCtrl(i),e.$on("$destroy",(function(){a.removeNgGroupCtrl(i)}))),e.$groups=i.groups,e.$watchCollection(n.ngGroup,(function(e){i.update(e)}))}}}]),e.directive("ngGroupBy",["$parse","require",function(e,t){return{require:["^?ngGroup","^?ngGroups"],compile:function(n,r){var i=r.ngGroupBy?e(r.ngGroupBy):null,a=r.ngGroupAs?e(r.ngGroupAs):null,o=r.ngGroupSortBy?e(r.ngGroupSortBy):null,s=r.ngGroupByModel?e(r.ngGroupByModel):null;return function(e,n,c,l){var u,d,m,p=l[0]||l[1];t.assert(p,"Either ngGroup or ngGroups required on ancestor"),i&&(u=_.bind(i,null,e),d=_.bind(a,null,e)),o&&(m=_.bind(o,null,e));var f=function(){p.groupBy(u,d,m,c.ngGroupName)};e.isSet(c.ngGroupDefault)&&f(),n.on("click",(function(){s?s.assign(e,r.ngGroupBy):f()})),e.$watch((function(){return p.byFn===u}),(function(e){n.toggleClass("toggled",e)})),s&&e.$watch(s,(function(e,t){e===r.ngGroupBy&&f()}))}}}}]),e.directive("ngGroups",["$parse","events",function(e,t){return{scope:!0,restrict:"A",controller:["$scope","$attrs",function(e,n){var r=this;r.ngGroupCtrls=[];var i=function(e){e.groupBy(r.byFn,r.asFn,r.sortByFn,r.name)};r.groupBy=function(e,t,n,a){r.byFn=e,r.asFn=t,r.sortByFn=n,r.name=a,_.forEach(r.ngGroupCtrls,i)},r.addNgGroupCtrl=function(e){r.ngGroupCtrls.push(e),r.byFn&&i(e)},r.removeNgGroupCtrl=function(e){_.ref.remove(r.ngGroupCtrls,e)},n.ngGroupsRegroupEvent&&t.on(e,n.ngGroupsRegroupEvent,(function(){_.forEach(r.ngGroupCtrls,i)}))}]}}]),e.directive("ngToggle",["$parse","$rootScope","toggles",function(e,t,n){return{restrict:"A",compile:function(t,r){var i=e(r.ngToggleValue),a=e(r.ngToggleDefault),o=e(r.ngToggleGroupValue),s=r.ngToggleWhen?e(r.ngToggleWhen):null;return function(e,t,r){var c=i(e)||r.ngToggle,l=a(e)||!1,u=o(e)||r.ngToggleGroup,d=e.isSet(r.ngToggleAutoClose),m=e.isSet(r.ngToggleGroupCloseable),p=_.isUndefined(r.ngToggleInteractive)||e.isSet(r.ngToggleInteractive),f=_.isUndefined(r.ngToggleAriaExpanded)||e.isSet(r.ngToggleAriaExpanded),h=s?_.bind(s,null,e):null;if(n.create(c,{autoClose:d,defaultState:l,group:u,isCloseableGroup:m,when:h}),p){var g="click";e.isSet(r.ngToggleMousedown)&&(g="mousedown"),t.on(g,(function(t){e.$apply((function(){n.toggle(c)}))}))}e.$watch((function(){return n.state(c)}),(function(e){t.toggleClass("toggled",e),f&&t.attr("aria-expanded",(!!e).toString())})),e.$on("$destroy",(function(){n.destroy(c)}))}}}}]),e.directive("ngToggled",t.conditionalDirective({watch:["$parse","toggles",function(e,t){return function(n,r,i){var a=n.$eval(i.ngToggledValue)||i.ngToggled,o=i.ngToggledAlwaysWhen?e(i.ngToggledAlwaysWhen):_.never;return function(){return t.state(a)||o(n)}}}],operator:["$parse",function(e){return function(t,n,r){var i=r.ngToggledAction?e(r.ngToggledAction):_.ignore;return function(e){return i(t,{$value:e}),e}}}]})),e.directive("ngToggledShow",["$parse","toggles",function(e,t){return{link:function(n,r,i){var a=i.ngToggledAction?e(i.ngToggledAction):_.ignore,o=i.ngToggledAlwaysWhen?e(i.ngToggledAlwaysWhen):_.never,s=n.$eval(i.ngToggledShowValue)||i.ngToggledShow;n.$watch((function(){return t.state(s)||o(n)}),(function(e){a(n,{$value:e}),r.css("display",e?"":"none")}))}}}]),e.directive("ngWith",["$parse",function(e){return{restrict:"A",scope:!0,priority:900,compile:function(t,n){var r=e(n.ngWith);return{pre:function(e,t,n){r(e),e.$watch(r)}}}}}]),e.directive("ngDestroy",[function(){return function(e,t,n){e.$on("$destroy",(function(){e.$eval(n.ngDestroy)}))}}]),e.directive("ngFadeIn",[function(){return{restrict:"A",link:function(e,t,n){var r=parseInt(n.ngFadeIn);t.hide(),t.fadeIn(r)}}}]).directive("ngFadeOut",[function(){return{restrict:"A",link:function(e,t,n){var r=parseInt(n.ngFadeOut),i=n.ngFadeTarget,a=$(t),o=e;i&&(o=e.$eval(i)),o.fadeOut=function(t){a.fadeOut(r,(function(){t&&t(e)}))}}}}]),e.directive("ngNullForm",[function(){return{name:"form",controller:function(){this.$addControl=_.ignore,this.$setValidity=_.ignore,this.$removeControl=_.ignore,this.$setDirty=_.ignore,this.$setPristine=_.ignore,this.$$renameControl=function(e,t){e.$name=t}},link:{pre:function(e){e.nullForm={$dirty:!1,$pristine:!0,$valid:!0,$invalid:!1}}}}}]),e.directive("ngName",[function(){return{restrict:"A",require:["ngModel","^?form"],link:function(e,t,n,r){e.$watch(n.ngName,(function(e){t.attr("name",e);var n=r[0],i=r[1];i.$removeControl(n),n.$name=e,i.$addControl(n)}))}}}]).directive("ngPrefix",[function(){return{restrict:"A",priority:100,controller:["$scope","$element","$attrs",function(e,t,n){var r=t.attr("name");e.$watch(n.ngPrefix,(function(e){var t=r;e&&(t=e+"-"+t),n.$set("name",t)}))}]}}]),e.directive("ngOutboundLink",[function(){return{restrict:"A",priority:-1,link:function(e,t,n){var r=e.$interpolate(n.ngOutboundLink)||"_self";n.ngOutboundLinkWhen&&!e.$eval(n.ngOutboundLinkWhen)||t.attr("target",r)}}}]),e.directive("ngBackButton",["$window",function(e){return{restrict:"A",link:function(t,n,r){n.on("click",(function(t){setTimeout((function(){e.history.back()}),50)}))}}}]),e.directive("ngSearchLink",["navigation",function(e){return{restrict:"A",link:function(t,n,r){r.$observe("ngSearchLink",(function(i){var a=t.$eval(r.ngSearchLinkCompany)||e.currentCompany;if(a){var o=a.$url(urls.dashboard.bookings.index)+"?q="+i;n.attr("href",o)}}))}}}]),e.directive("ngPrint",_.optional(["$timeout","$window","?native",function(e,t,n){var r=n&&n.isNative;return{restrict:"A",link:function(i,a,o){var s=function(){var e;if(r){if(o.ngPrintNative){var a=$(i.$interpolate(o.ngPrintNative));if(!a.length)return;e=a[0]}n.print(e)}else t.print()};a.on("click",(function(e){e.preventDefault(),e.stopPropagation(),s()})),i.isSet(o.ngPrintAuto)&&e((function(){s()}),r?0:400)}}}])),e.directive("ngOpenWindow",["$window","d",function(e,t){return{restrict:"A",link:function(n,r,i){var a=t.observer(i,"ngOpenWindow"),o=t.observer(i,"ngOpenWindowArguments","toolbar=0,status=0,scrollbars=1");r.on("click",(function(t){if(a()){var r=n.$eval(i.ngOpenWindowWidth),s=n.$eval(i.ngOpenWindowHeight),c=o();r&&(c+=",width="+r,c+=",left="+Math.max(0,(e.screen.width-r)/2)),s&&(c+=",height="+s,c+=",top="+Math.max(0,(e.screen.height-s)/2)),e.open(a(),"angular-open-winow",c)}}))}}}]),e.directive("ngCloseWindow",["$window","d",function(e,t){return{restrict:"A",link:function(t,n,r){n.on("click",(function(t){e.close()}))}}}]),e.directive("ngTouch",["$parse","d",function(e,t){return{restrict:"A",compile:function(n,r){var i=e(r.ngTouch);return function(e,n){n.on(t.isTouchEnabled?"touchstart":"click",(function(){e.$apply((function(){i(e)}))}))}}}}]),e.directive("ngConfirmClick",["d","xmessage",function(e,t){return{priority:-1,restrict:"A",link:function(n,r,i){var a=n.isSet(i.ngConfirmClickStrict);r.on("click",(function(o){if(!a||this===o.target){var s=i.ngConfirmClick;s&&function(e){return!!_.isUndefined(i.ngConfirmClickWhen)||n.$eval(i.ngConfirmClickWhen,{$event:e})}(o)&&(window.top!==window.self&&92===e.chromeVersion()?function(e,i){var a=n.isConfirmedWithOuterFrame;n.isConfirmedWithOuterFrame=!1,a||(e.stopImmediatePropagation(),e.preventDefault(),t.broadcast("fareharbor.confirm",{message:i}),t.on(n,"fareharbor.confirmed",(function(){n.isConfirmedWithOuterFrame=!0,r.click()})))}(o,s):confirm(s)||(o.stopImmediatePropagation(),o.preventDefault()))}}))}}}]),e.directive("ngCancelClick",[function(){return{priority:-1,restrict:"A",link:function(e,t,n){t.on("click",(function(t){e.$eval(n.ngCancelClick)&&(t.stopImmediatePropagation(),t.preventDefault())}))}}}]);var l=function(t,n){e.directive(t,[function(){return{restrict:"A",link:function(e,r,i){var a=e.isSet(i[t+"Strict"]),o=i[t+"On"]||"";r.on("click",(function(r){a&&this!==r.target||o&&!$(r.target).is(o)||n.test(r)&&e.$apply((function(){!1===e.$eval(i[t])&&(r.stopPropagation(),r.preventDefault())}))}))}}}])};e.config(["$provide",function(e){e.decorator("ngClickDirective",["$delegate",function(e){return e.shift(),e}])}]),e.directive("ngKeyboardAccessibleClick",[function(){var e=[13,32];return{restrict:"A",link:function(t,n,r){var i=!1,a=function(e){i=e,e?(n.attr("role","button"),n.attr("tabindex","0")):(n.removeAttr("role"),n.removeAttr("tabindex"))};r.ngKeyboardAccessibleClick?t.$watch(r.ngKeyboardAccessibleClick,a):a(!0),n.on("keydown",(function(t){_.contains(e,t.keyCode)&&i&&(t.preventDefault(),t.stopPropagation(),$(t.target).click())}))}}}]),l("ngClick",{test:function(e){return!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)}}),l("ngShiftClick",{test:function(e){return e.shiftKey&&!e.ctrlKey&&!e.metaKey&&!e.altKey}}),l("ngControlClick",{test:function(e){return!e.shiftKey&&e.ctrlKey&&!e.metaKey&&!e.altKey}}),l("ngMetaClick",{test:function(e){return!e.shiftKey&&!e.ctrlKey&&e.metaKey&&!e.altKey}}),l("ngAltClick",{test:function(e){return!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&e.altKey}}),l("ngShiftOrAltClick",{test:function(e){return(e.shiftKey||e.altKey)&&!e.ctrlKey&&!e.metaKey}}),e.directive("ngPhoneNumberInput",["d",function(e){return{priority:1,restrict:"A",link:function(t,n){e.restrictKeypresses(n,/\+|\d/)}}}]),e.directive("ngAmountInput",["$parse","d",function(e,t){return{priority:1,require:"ngModel",restrict:"A",link:function(r,i,a,o){var s=e(a.ngModel),c=parseFloat(a.max)||99999999,l=parseFloat(a.min)||-99999999,u=a.ngAmountInputMax&&e(a.ngAmountInputMax),d=a.ngAmountInputMin&&e(a.ngAmountInputMin),m=a.ngAmountInputDefault&&e(a.ngAmountInputDefault),p=r.isSet(a.ngAmountInputAllowEmpty);p=!a.required||p;var f=r.isSet(a.ngAmountInputAllowZero)&&!!a.ngAmountInputAllowZero,h=function(){return m?m(r)/100:0},g=/[0-9]|\./;(!a.ngAmountInputPositive||!r.$eval(a.ngAmountInputPositive))&&(g=/[0-9]|\.|\-/),t.restrictKeypresses(i,g);var y=function(e){return _.isUndefined(e)||""===e||null===e};o.$parsers.push((function(e){if(y(e))return p?"":(o.$$lastCommittedViewValue=h().toString(),_.roundHalfToEven(100*h()));if(f&&0===e)return 0;o.$setValidity("required",!0);var t=e,n=d?Math.max(d(r)/100,l):l,i=u?Math.min(u(r)/100,c):c;return!_.isNaN(n)&&t<n&&(t=n,o.$setValidity("min_value",!0)),!_.isNaN(i)&&t>i&&(t=i,o.$setValidity("max_value",!0)),_.roundHalfToEven(100*t)})),o.$formatters.unshift((function(e){return y(e)?p?"":h():_.roundHalfToEven(e/100,2).toFixed(2)})),r.$watch(s,(function(e,t){!p&&_.isUndefined(e)&&_.isUndefined(t)&&s.assign(r,h())})),i.on("blur",(function(){n(o)}))}}}]),e.directive("ngJsonInput",["$parse",function(e){var t=/^(?!^[_\-])(?!.*[_\-]$)[a-zA-Z0-9_\-]+$/;return{require:"ngModel",restrict:"A",link:function(n,r,i,a){var o=e(i.ngModel);a.$parsers.push((function(e){if(n=e=$.trim(e),_.isUndefined(n)||""===n||null===n)return a.$setValidity("valid_json",!0),"";var n,r=e;return t.test(r)&&(r='"'+r+'"'),a.$setValidity("valid_json",function(e){try{_.parseJSON(e)}catch(e){return!1}return!0}(r)),e})),n.$watch(o,(function(e){if(e&&'"'===e.charAt(0)&&'"'===e.slice(-1)){var r=e.slice(1,e.length-1);r&&!t.test(r)||o.assign(n,r)}}))}}}]),e.directive("ngBindOnce",[function(){return{link:function(e,t,n){t.addClass("ng-binding").data("$binding",n.ngBindOnce);var r=e.$eval(n.ngBindOnce)||"";t[0].textContent=r.toString()}}}]),e.directive("ngBindHtmlOnce",["$sce","clientOptions",function(e,t){return{link:function(n,r,i){r.addClass("ng-binding").data("$binding",i.ngBindHtmlOnce),t.reflectUrlsInHrefs(r),r.html(e.getTrustedHtml(n.$eval(i.ngBindHtmlOnce))||"")}}}]);var u=function(t,n,r){e.directive(t,["$compile","$filter","$injector","auth","navigation",function(e,i,a,o,s){var c=T("You don't have permission to see this amount"),l=a.invoke(n.render),u=i("currencySymbol");return{restrict:"A",compile:function(n,i){n.addClass("notranslate amount");var a={};return a.showNullAsZero="ngAmountShowNullAsZero"in i,function(n,i,s){var d,m;a.hideDecimalWhenInteger=n.isSet(s.ngAmountHideCents);var p=function(t,p){if(t!==m||p!==d){m=t,d=p;var f=n.$eval(s.ngAmountCurrency)||n.processorCurrency||p;if(r=r||"viewAmounts",p&&!o.permissions.can(r,p)){var h=u(f,"short");e('<span ng-tip="'+c+'">'+h+"?</span>")(n,(function(e){i.empty().append(e)})),i.addClass("amount-hidden")}else{var g=l(n,s,m,p,f,a);i.text(g),i.addClass("amount-visible"),i.toggleClass("negative",m<0)}}};n.$watch(s[t],(function(e){p(e,n.$eval(s[t+"Company"])||n.company||null)})),_.isUndefined(s[t+"Company"])||n.$watch(s[t+"Company"],(function(e){p(n.$eval(s[t]),e||null)}))}}}}])},d={render:["$filter",function(e){var t=e("amount");return function(e,n,r,i,a,o){return t(r,a,o.hideDecimalWhenInteger,!0,o.showNullAsZero)}}]};u("ngAmount",d),u("ngInvoiceAmount",d,"viewInvoiceAmounts"),u("ngAmountRate",{render:["$filter",function(e){var t=e("percentage");return function(e,n,r){return t(r)}}]}),e.directive("ngFloatInput",(function(){return{priority:1,require:"ngModel",link:function(e,t,n,r){e.$eval(n.ngFloatInput);var i,a,o=n.ngFloatInputMaxDigits?e.$eval(n.ngFloatInputMaxDigits):null,s=n.ngFloatInputDecimalPlaces?e.$eval(n.ngFloatInputDecimalPlaces):null,c=n.ngFloatInputMin||n.min;if(c){var l=e.$eval(c);i=function(e){r.$setValidity("min_value",e>=l)}}var u=n.ngFloatInputMax||n.max;if(u){var d=e.$eval(u);a=function(e){r.$setValidity("max_value",e<=d)}}r.$parsers.push((function(e){if("."===e&&(e=""),"-"===e&&(e=""),null!==s){var t=e.indexOf(".");-1!==t&&e.length-(t+1)>s&&(e=e.slice(0,t+1)+e.slice(t+1,t+1+s))}if(null!==o){var n=o;_.startsWith(e,"-")&&(n+=1),_.contains(e,".")&&(n+=1),e.length>n&&(e=e.substring(0,n))}var r=parseFloat(e);return isNaN(r)?e:(i&&i(r),a&&a(r),r)}))}}})),e.directive("ngBooleanSelect",(function(){return{priority:1,require:"ngModel",link:function(e,t,n,r){r.$parsers.push((function(e){return!!_.contains([!0,"True","true","1"],e)||!_.contains([!1,"False","false","0"],e)&&e})),r.$formatters.push((function(e){return!0===e?"True":!1===e?"False":e}))}}})),e.directive("ngIntInput",["$parse","d",function(e,t){return{require:"ngModel",priority:1,compile:function(r,i){var a=e(i.ngIntInputMin),o=e(i.ngIntInputMax);return function(e,r,i,s){if(e.isSet(i.ngIntInput)){var c=_.isUndefined(i.ngIntInputAllowEmpty)||e.isSet(i.ngIntInputAllowEmpty);t.restrictKeypresses(r,/[-0-9]/),s.$parsers.push((function(t){var n=a(e),r=o(e);if(""===t)return c?t:0;var i=parseInt(t,10);return isNaN(i)?t:(_.isUndefined(n)||(i<n&&(i=n),s.$setValidity("min",!0)),_.isUndefined(r)||(i>r&&(i=r),s.$setValidity("max",!0)),i)})),r.on("blur",(function(){n(s)}))}}}}}]),e.directive("ngLoadTime",["$window",function(e){return{restrict:"A",link:function(){var t=new Date;console.info("ng-load-time",(t-e.$$loadTime)/1e3)}}}]),e.directive("ngPlaceholder",[function(){return function(e,t,n){n.$observe("ngPlaceholder",(function(e){if(t.attr("placeholder",e),"SELECT"===t[0].nodeName){var n=t.children("option").first();n.text()||(n.attr("label",e),n.text(e))}}))}}]),e.directive("ngDatepicker",["$parse","d","localization","moment","Pikaday",function(e,t,r,i,a){return{require:"ngModel",priority:1,restrict:"A",compile:function(r,o){var s="YYYY-MM-DD",c=e(o.ngDatepickerYearRange),l=e(o.ngDatepickerMinDate);return function(e,r,u,d){var m=e.isSet(u.ngDatepickerAllowEmpty),p=i.localeData().longDateFormat("L"),f=!e.company||!e.company.features||e.company.features.isSundayBased;_.isUndefined(o.ngDatepickerSundayBased)||(f=e.isSet(o.ngDatepickerSundayBased));var h=$(r),g=_.replaceAll(p,/[a-zA-Z]/,""),y=new RegExp("[0-9]|/|["+g+"]");t.restrictKeypresses(r,y);var v=function(e,t){var n=i(e,t);return n&&n.isValid()?n:m?"":i()},E={field:h[0],format:p,onSelect:function(){e.$apply((function(){d.$setViewValue(b.toString())}))},minDate:l,yearRange:c,onOpen:function(){var e=v(d.$modelValue,s);e&&b.setMoment(e)},firstDay:f?0:1,i18n:{previousMonth:T("Previous Month"),nextMonth:T("Next Month"),months:[T("January"),T("February"),cT("the month of March","March"),T("April"),cT("the month of May","May"),T("June"),T("July"),T("August"),T("September"),T("October"),T("November"),T("December")],weekdays:[T("Sunday"),T("Monday"),T("Tuesday"),T("Wednesday"),T("Thursday"),T("Friday"),T("Saturday")],weekdaysShort:[cT("Abbreviation of Sunday","Sun"),cT("Abbreviation of Monday","Mon"),cT("Abbreviation of Tuesday","Tue"),cT("Abbreviation of Wednesday","Wed"),cT("Abbreviation of Thursday","Thu"),cT("Abbreviation of Friday","Fri"),cT("Abbreviation of Saturday","Sat")]}},b=new a(E),C=function(e,t,n){var r=v(e,t);return r?r.format(n):""};if(d.$parsers.push((function(e){return C(e,p,s)})),d.$formatters.unshift((function(e){return C(e,s,p)})),!e.$eval(u.ngModel)&&!m){var k=d.$pristine;d.$pristine=!1,d.$setViewValue(i().format(p)),d.$render(),d.$pristine=k}r.on("blur",(function(){n(d)})),e.$on("$destroy",(function(){b.destroy()})),l&&e.$watch(l,(function(e){b.config({minDate:e?e.toDate():void 0}),e&&i(d.$modelValue,"YYYY-MM-DD").diff(e)<0&&(d.$modelValue=e.format("YYYY-MM-DD"),d.$$writeModelToScope(),n(d))}))}}}}]);var m="HH:mm";e.directive("ngTimepicker",["$parse","$timeout","d","localization","moment",function(e,t,r,i,a){return{require:"ngModel",restrict:"A",link:function(e,o,s,c){var l=i.current().TIME_FORMATS.default,u=i.current().SERVER_TIME_FORMAT,d=$(o);r.restrictKeypresses(o,/[0-9]|[:amp]/);var p=d.timepicker({timeFormat:u});o.on("selectTime",(function(){e.$safeApply((function(){var e=p.val();e!==c.$viewValue&&c.$setViewValue(e)}))}));var f=function(e,t,n){var r=a(e,t);return e&&r&&r.isValid()?r.format(n):""};c.$parsers.push((function(e){return f(e,l,m)})),c.$formatters.unshift((function(e){var n=f(e,m,l);return t((function(){p.timepicker("setTime",n)})),n})),o.on("blur",(function(){n(c)})),e.$on("$destroy",(function(){p.timepicker("remove")}))}}}]),e.directive("ngInternationalPhoneField",["$compile","$parse","$timeout","auth","localization","models","navigation",function(e,t,n,r,i,a,o){return{require:"ngModel",restrict:"A",link:function(a,s,c,l){var u=t(c.ngModel),d=t(c.ngInternationalPhoneFieldPhoneCountryModel),m=u(a),p=d(a),f=$(s),h=a.$eval(c.ngInternationalPhoneFieldCountries)||[],g=function(){return f.intlTelInput("getSelectedCountryData")},y=function(){var t=g(),n=f.siblings(".flag-container").find(".selected-flag");n.attr("ng-tip",(function(){return T("Country Code")+(_.isEmpty(t)?"":": +"+t.dialCode+" "+t.name)})).attr("ng-tip-classes","tip-indent").attr("title",null),e(n)(a)},v=_.map(h,(function(e){return e[0].toLowerCase()})),E=function(e){return e=e?e.toLowerCase():"",_.contains(v,e)},b=function(e){n((function(){d.assign(a,e.toUpperCase())}),0)},C=[];if(v.length>1){if(!r.currentUser.isAuthenticated){var k=i.browser.ACCEPT_LANGUAGE_COUNTRY_CODE;C.push(k.toLowerCase())}var A=o.currentCompany,P=A.country;"US"!==A.processorCountry&&A.country||(P=A.processorCountry),C.push(P.toLowerCase()),C=_.uniq(C),C=_.filter(C,(function(e){return E(e)}))}var S="";p&&E(p)?S=p.toLowerCase():m||(C.length?S=C[0]:v.length&&(S=v[0]));var O={autoPlaceholder:"off",formatOnDisplay:!1,onlyCountries:v,preferredCountries:C,initialCountry:S};f.intlTelInput(O),b(S),y(),m&&f.intlTelInput("setNumber",m),a.$watch(d,(function(e,t){f.parents(".international-phone-field").toggleClass("no-country",!e),e!==t&&(!e||E(e)?function(e){e=e?e.toLowerCase():"",f.intlTelInput("setCountry",e)}(e):b(S))})),f.on("countrychange",(function(){a.$safeApply((function(){var e,t=(e=g())&&e.iso2?e.iso2.toUpperCase():"";b(t),l.$setDirty(),l.$setViewValue(f.val()),y()}))})),f.on("open:countrydropdown",(function(){a.$safeApply((function(){var e=f.siblings(".flag-container").find(".country-list");e.length&&!e.hasClass("tb-flyout")&&e.addClass("tb-flyout")}))})),a.$on("$destroy",(function(){f.intlTelInput("destroy")}))}}}]),e.directive("ngSlideshow",["$animate","$compile","$templateCache","$timeout",function(e,t,n,r){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,n,r){var i,a,o=t.$eval(r.ngSlideshowDelay)||4500,s=this;s.isPlaying=!1,s.slides=[],s.currentSlide=null,s.addSlide=function(e){var t={element:e};return s.slides.push(t),t},s.removeSlide=function(e){s.slides[a]===e&&(a+=1)>=s.slides.length&&(a=0),_.overwriteWithout(s.slides,e),s.slides[a]||(a=void 0)},s.showSlide=function(t){if(s.slides.length){var n=_.indexOf(s.slides,t);n<0||(_.isUndefined(a)||s.slides[a]===t||function(t){s.currentSlide=null,e.removeClass(t.element,"slideshow-showing")}(s.slides[a]),a=n,function(t){s.currentSlide=t,e.addClass(t.element,"slideshow-showing")}(s.slides[a]),s.isPlaying&&s.play())}},s.next=function(){var e;(_.isUndefined(a)||(e=a+1)>=s.slides.length)&&(e=0),s.showSlide(s.slides[e])},s.previous=function(){var e;_.isUndefined(a)?e=0:(e=a-1)<0&&(e=s.slides.length-1),s.showSlide(s.slides[e])},s.pause=function(){e.removeClass("slideshow-playing"),e.addClass("slideshow-paused"),clearTimeout(i),s.isPlaying=!1};var c=function(){t.$safeApply((function(){i=null,s.slides.length&&s.next()}))};s.play=function(e){s.isPlaying=!0,function(e){i&&clearTimeout(i),i=setTimeout(c,e?0:o)}(e)}}],link:function(e,r,i,a){var o=n.get("slideshow-dots"),s=n.get("slideshow-arrows"),c=e.$new();c.slideshow=a,r.append(t(o)(c)),r.append(t(s)(c)),a.play(!0)}}}]),e.directive("ngSlideshowSlide",[function(){return{restrict:"A",require:"^ngSlideshow",link:function(e,t,n,r){t.addClass("slideshow-slide"),r.slides.length||t.addClass("slideshow-showing");var i=r.addSlide(t);e.$on("$destroy",(function(){r.removeSlide(i)}))}}}]),e.directive("ngDiff",["diff",function(e){return{restrict:"A",link:function(t,n,r){var i=t.$eval(r.ngDiff),a=t.$eval(r.ngDiffWith);(_.isUndefined(i)||null===i)&&(i=""),(_.isUndefined(a)||null===a)&&(a=""),n.addClass("diff"),_.forEach(e.diffWords(a,i),(function(e){var t=$("<span />");e.added?t.addClass("diff-added"):e.removed?t.addClass("diff-removed"):t.addClass("diff-unchanged"),t.text(e.value),n.append(t)}))}}}]),e.directive("ngMarkdownFileUpload",["$timeout","fileuploader","flash",function(e,t,n){return{require:"ngModel",restrict:"A",link:function(r,i,a,o){var s,c=_.first(i);i.bind("keyup click",(function(){_.isUndefined(c.selectionStart)||(s=c.selectionStart)}));var l=a.ngMarkdownParent,u=i.parents(l).first(),d=a.ngMarkdownFileUpload;e((function(){u.find(d).on("click",(function(){t.uploadAsMarkdown().then((function(e){if(e){var t=o.$viewValue||"",r=_.isUndefined(s)?t.length:s,i=t.substr(0,r);i&&!i.match(/\s$/)&&(i+="\n");var a=t.substr(r);a&&!a.match(/^\s/)&&(a="\n"+a);var c=i+e+a;o.$setViewValue(c),o.$render(),n.success(T("Uploaded file"))}}),(function(){n.error(T("File was not uploaded, please try again"))}))}))}))}}}]);var p=function(e){return e?"ngMarkdownBulkFileUpload."+e:null};e.directive("ngMarkdownBulkFileUpload",["events","fileuploader","flash",function(e,t,n){return{restrict:"A",link:function(r,i,a){var o=p(a.ngMarkdownBulkFileUpload);i.on("click",(function(){t.uploadAsMarkdown().then((function(t){t&&(e.broadcast(o,t),n.success(T("Uploaded file")))}))}))}}}]),e.directive("ngMarkdownBulkFileUploadChild",["events",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,r,i){var a=p(r.ngMarkdownBulkFileUploadChild);e.on(t,a,(function(e,t){if(t){var n=i.$viewValue||"",r=t;n&&(r=n+"\n"+t),i.$setViewValue(r),i.$render()}}))}}}]),e.directive("ngMarkdownPreview",["markdownConverter",function(e){return{require:"ngModel",restrict:"A",link:function(t,n,r,i){var a=r.ngMarkdownParent,o=n.parents(a).first(),s=r.ngMarkdownPreview,c=o.find(s),l=r.ngMarkdownPreviewResult,u=o.find(l);c.on("click",(function(){var t=i.$viewValue,n=e.makeHtml(t);u.html(n)}))}}}]),e.directive("ngMarkdown",["markdownConverter",function(e){return{restrict:"A",link:function(t,n,r,i){var a=function(t){var r=e.makeHtml(t);n.html(r)};if(t.isSet(r.ngMarkdownOnce))t.isSet(r.ngMarkdownDebounce)&&console.warn("ngMarkdown: ng-markdown-debounce is ignored when ng-markdown-once is set"),a(t.$eval(r.ngMarkdown));else{var o=a;t.isSet(r.ngMarkdownDebounce)&&(o=_.debounce(a,250,{maxWait:1250})),t.$watch(r.ngMarkdown,o)}}}}]),e.directive("ngMailcheck",["Mailcheck",function(e){return{restrict:"A",scope:{email:"=ngMailcheck"},template:'<a ng-show="suggestedEmail">'+T("Did you mean")+" <b>[[ suggestedEmail ]]</b>?</a>",link:function(t,n,r,i){t.suggestedEmail="",t.$watch("email",(function(n){n?e.run({email:n,suggested:function(e){t.suggestedEmail=e.full},empty:function(){t.suggestedEmail=""}}):t.suggestedEmail=""})),n.on("click",(function(){t.email=t.suggestedEmail}))}}}]);var f=function(t){return e.directive(t.name,[function(){return{restrict:"A",link:function(e,n,r){var i,a="$"+t.name,o=e[a];if(o&&(i=o.isEnabled,o.isEnabled=!1),e.hasOwnProperty(a))throw new Error("lib.directives: multiple copies of "+t.name+" modifier in same scope");var s={isEnabled:!0};e[a]=s;var c=$(t.selector),l=t.get(c),u=l;r.$observe(t.name,(function(e,n){s.isEnabled&&(u=e,t.set(c,e,n))})),e.$on("$destroy",(function(){t.set(c,l,u),o&&(o.isEnabled=i)}))}}}])};f({name:"ngTitle",selector:"title",get:function(e){return document.title},set:function(e,t){return document.title=t,t}}),f({name:"ngMetaViewport",selector:'meta[name="viewport"]',get:function(e){return e.attr("content")},set:function(e,t){return e.attr("content",t)}}),e.directive("ngBodyClass",[function(){return{restrict:"A",link:function(e,t,n){var r=$("body"),i="";e.$watch((function(){var t=e.$eval(n.ngBodyClass);return _.isObject(t)?_.mapObject(t,(function(e){return!!e})):t}),(function(e){r.removeClass(i);var t="";_.isObject(e)?_.forEach(e,(function(e,n){e&&(t+=n+" ")})):t=e,r.addClass(t),i=t}),!0),e.$on("$destroy",(function(){r.removeClass(i)}))}}}]),e.directive("ngBodyClassOnce",[function(){return{restrict:"A",link:function(e,t,n){var r=$("body"),i=e.$eval(n.ngBodyClassOnce),a="";_.isObject(i)?_.forEach(i,(function(e,t){e&&(a+=t+" ")})):a=i,r.addClass(a)}}}]),e.directive("ngInline",["$templateCache",function(e){return{restrict:"A",priority:400,compile:function(t,n){var r=n.ngInline,i=e.get(r);i?t.html(i):console.warn("ng-inline: invalid template",r)}}}]),e.directive("ngLink",["$compile","$templateCache",function(e,t){var n={};return{restrict:"A",priority:400,link:function(r,i,a){var o=r.$interpolate(a.ngLink);if(o){var s=n[o];if(!s){var c=t.get(o);if(!c)return void console.warn("ng-link: invalid template",o);s=e(c),n[o]=s}s(r,(function(e){i.empty().append(e)}))}else console.warn("ng-link: invalid template name",o)}}}]),e.directive("ngLoad",["$compile","$http","$templateCache",function(e,t,n){return{restrict:"A",priority:400,compile:function(r,i){var a="/"+i.ngLoad,o=n.get(a);if(o)return console.info("ng-load: compiled load",a),void r.html(o);var s,c=n.get("ng-load-spinner");return c&&r.html(c),function(r,i,o){var c=function(){s(r,(function(e){i.empty().append(e)}))};if(s)return console.info("ng-load: linked load",a),void c();t.get(a).then(null,(function(){return console.error("ng-load: unable failed to load, retrying...",a),t.get(a)})).then((function(t){var r=t.data;n.put(a,r),console.info("ng-load: downloaded load",a),s=e(r),c()}),(function(){console.error("ng-load: unable to load",a);var t=n.get("ng-load-error");i.empty().append(e(t)(r))}))}}}}]),e.directive("ngNewTransportation",["$parse",function(e){return{restrict:"A",require:"^?form",controller:"lib.shared.NewTransportationCtrl",link:{pre:function(e,t,n,r){if(r){r.$setValidity("loading-transportation",!1);var i=e.$watch("newTransportationCtrl.status",(function(e){"success"!==e&&"error"!==e||(r.$setValidity("loading-transportation",!0),i())}));e.$on("$destroy",(function(){r.$setValidity("loading-transportation",!0)}))}}}}}]),e.directive("ngDebug",[function(){return{restrict:"A",link:function(e,t,n){}}}]),e.directive("ngLog",[function(){return{restrict:"A",link:function(e,t,n){console.log("ng-log: link",e.$eval(n.ngLog)),e.$on("$destroy",(function(){console.log("ng-log: $destroy",e.$eval(n.ngLog))}))}}}]),e.directive("ngCurrentBlock",["$parse",function(e){return{restrict:"A",link:function(t,n,r){var i=e(r.ngCurrentBlockBlocks);t.$watch(r.ngCurrentBlockAffiliation,(function(e){var n;if(e){var r=i(t);n=_.find(r,(function(t){return t.affiliation===e}))}t.currentBlock=n}))}}}]),e.directive("ngStartBooking",["navigation","postBook",function(e,t){return{priority:-1,restrict:"A",link:function(n,r,i){r.on("click",(function(){n.$apply((function(){var r;r=i.ngStartBooking?n.$interpolate(i.ngStartBooking):e.url,t.startBooking(r)}))}))}}}]),e.directive("ngDump",["$parse",function(e){return{restrict:"A",link:function(t,n,r){var i=e(r.ngDump);console.log("ng-dump: link",i(t)),t.isSet(r.ngDumpWatch)&&t.$watch((function(){console.log("ng-dump: $watch",i(t))}))}}}]),e.directive("ngQrCode",["$interpolate","QRCode",function(e,t){return{restrict:"A",compile:function(n,r){var i=e(r.ngQrCode);return function(e,n){var r=i(e);new t(n[0],{text:r,width:256,height:256,colorDark:"#000000"})}}}}]),e.directive("ngModelDependencies",["$parse",function(e){return{restrict:"A",controller:function(){var e=this;e.dependents=[],e.addDependent=function(t){e.dependents.push(t)}},compile:function(t,n){var r=e(n.ngModelDependencies);return function(e,t,n,i){e.$watch(r,(function(e){(e=!!e)?t.prop("disabled",!1):(t.prop("disabled",!0),_.forEach(i.dependents,(function(e){e(!1)})))}))}}}}]),e.directive("ngModel",["$parse",function(e){return{require:"^?ngModelDependencies",link:function(t,n,r,i){if(i){console.info("adding dependent",r.ngModel);var a=e(r.ngModel);i.addDependent((function(e){return a.assign(t,e)}))}}}}]),e.directive("ngModelFormatters",[function(){return{require:"ngModel",link:function(e,t,n,r){var i=r;_.forEach(e.$eval(n.ngModelFormatters),(function(e){i.$formatters.push(e)}))}}}]),e.directive("ngModelParsers",[function(){return{require:"ngModel",link:function(e,t,n,r){var i=r;_.forEach(e.$eval(n.ngModelParsers),(function(e){i.$parsers.push(e)}))}}}]),e.directive("ngModelIgnore",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){r.$setPristine=_.ignore,r.$pristine=!1}}}]),e.directive("ngSelectAll",["$parse",function(e){return{restrict:"A",templateUrl:"ng-select-all",scope:!0,compile:function(t,n){var r=e(n.ngSelectAll),i=e(n.ngSelectAllModel),a=n.ngSelectAllWhen?e(n.ngSelectAllWhen):_.always,o=e(n.ngSelectAllDefaults),s=e(n.ngSelectAllDefaultField);return function(e,t,c){var l=function(o){if(!t.parents("fieldset[disabled]").length){var s=r(e);_.forEach(s,(function(t,n){var r={$element:t,$index:n};a(e,r)&&i.assign(e,o(t),r)}));var c=e.$eval(n.ngSelectAllCallback);c&&c()}};if(e.selectText=e.$interpolate(c.ngSelectAllText),e.selectAll=_.bind(l,null,_.constant(!0)),e.selectNone=_.bind(l,null,_.constant(!1)),e.allowDefaults=!!o(e),e.allowDefaults){var u=_.makeIteratee(s(e));e.selectDefaults=function(){var t=o(e);l((function(e){return!!t[u(e)]}))}}}}}}]),e.directive("ngSelectAllFromObject",["$parse",function(e){return{restrict:"A",templateUrl:"ng-select-all",scope:!0,compile:function(t,n){var r=e(n.ngSelectAllFromObject);return function(e,t,n){var i=function(n){if(!t.parents("fieldset[disabled]").length){var i=r(e);_.forOwn(i,(function(e,t){i[t]=n}))}};e.selectText=e.$interpolate(n.ngSelectAllText),e.selectAll=_.bind(i,null,!0),e.selectNone=_.bind(i,null,!1)}}}}]),e.directive("ngClearInput",["$parse",function(e){return{restrict:"A",compile:function(t,n){t.addClass("ng-clear-input");var r=e(n.ngClearInput);return function(e,t,n){var i=_.isUndefined(n.ngClearInputRefocus)||e.isSet(n.ngClearInputRefocus);e.$watch(r,(function(e){t.toggleClass("ng-hide",!e)})),t.on("click",(function(n){n.preventDefault(),n.stopPropagation(),i&&t.prev().focus(),e.$apply((function(){r.assign(e,"")}))}))}}}}]),e.directive("ngDjangoField",["$parse",function(e){return{restrict:"A",compile:function(t,n){var r=e(n.ngDjangoField),i=e(n.ngDjangoFieldModel),a=_.isUndefined(n.ngDjangoFieldRequired)?_.constant(!1):""===n.ngDjangoFieldRequired?_.constant(!0):e(n.ngDjangoFieldRequired),o=_.isUndefined(n.ngDjangoFieldDisabled)?_.constant(!1):e(n.ngDjangoFieldDisabled);return{pre:function(e,t){t.addClass("field")},post:function(e,t){e.$watch((function(){var t=r(e)||{},n=i(e),s=a(e),c=o(e),l=""===n||_.isUndefined(n);return{"ng-pristine":t.$pristine,"ng-dirty":t.$dirty,"ng-invalid":t.$invalid||l&&s,"ng-disabled":c,"ng-required":s}}),(function(e){var n=_.map(e,(function(e,t){if(e)return t})),r=_.map(e,(function(e,t){if(!e)return t}));t.addClass(n.join(" ")).removeClass(r.join(" "))}),!0)}}}}}]),e.directive("ngNoisyInvalidFields",[function(){return{restrict:"A",require:"ngNoisyInvalidFields",controller:["$scope",function(e){var t=this;t.isShowing=!1;var n=function(){$("body").toggleClass("noisy-invalid-fields",t.isShowing)};t.show=function(e){t.isShowing=!!_.isUndefined(e)||e,n()},t.hide=function(){t.isShowing=!1,n()},e.$on("$destroy",(function(){t.hide()}))}],controllerAs:"noisyInvalidFieldsCtrl"}}]),e.directive("ngFiltered",["$parse","$timeout",function(e,t){return{restrict:"A",scope:!0,controller:["$scope","$attrs","$element",function(n,r,i){var a=this;a.searchTerm="",a.isFiltering=!1,a.objects=[],a.reset=function(){s.assign(n,""),u("")};var o,s=e(r.ngFiltered),c=e(r.ngFilteredObjects);r.ngFilteredSearchDocument&&(o=e(r.ngFilteredSearchDocument));var l=!1;n.isSet(r.ngFilteredElements)&&(l=!0,c=function(){return i.find("[ng-filtered-element]")},o=function(e,t){var n=t.$obj.getAttribute("ng-filtered-element")||"";return t.$obj.innerText+" "+n});var u=function(e){n.$safeApply((function(){a.searchTerm=e,a.isFiltering=!!a.searchTerm,t((function(){a.objects=function(){var e=c(n);if(!a.searchTerm)return l&&(_.forEach(e,(function(e){$(e).removeClass("ng-hide")})),_.forEach(i.find("[ng-filtered-element-group]"),(function(e){$(e).removeClass("ng-hide")}))),e;var t=_.filter(e,(function(e){var t=function(e){var t;return t=o?o(n,{$obj:e}):e,_.contains(t.toLowerCase(),a.searchTerm.toLowerCase())}(e);return l&&$(e).toggleClass("ng-hide",!t),t}));return l&&_.forEach(i.find("[ng-filtered-element-group]"),(function(e){var t=$(e),n=t.find("[ng-filtered-element]:not(.ng-hide)").length>0;t.toggleClass("ng-hide",!n)})),t}()}))}))},d=_.debounce(u,100);n.$watch(s,(function(e){d(e)}))}],controllerAs:"filteredCtrl"}}]),e.directive("ngNegateCheckbox",[function(){return{require:"ngModel",link:function(e,t,n,r){r.$parsers.push((function(e){return!e})),r.$formatters.push((function(e){return!e}))}}}]),e.directive("ngShortcutsOverlay",[function(){return{templateUrl:"lib.shortcutsOverlay"}}]),e.directive("ngSvg",["$document",function(e){return{replace:!0,template:function(t,n){var r=e[0].getElementById(n.ngSvg);return r?(new XMLSerializer).serializeToString(r):(console.warn("ng-svg: unable to find svg:",n.ngSvg),"<span></span>")}}}]),e.directive("ngHoursBeforeMidnight",["$parse",function(e){return{restrict:"A",templateUrl:"ng-hours-before-midnight",controllerAs:"hoursBeforeMidnightCtrl",controller:["$scope","$attrs",function(t,n){var r=this,i=e(n.ngHoursBeforeMidnight);t.$watch(i,(function(e){if(!_.isUndefined(e)&&""!==e){var t=moment().startOf("day").subtract(e,"hours"),n=Math.ceil(e/24);r.time=t,r.days=n}}))}]}}]),e.directive("ngHoursToDays",["$parse",function(e){return{restrict:"A",templateUrl:"ng-hours-to-days",controllerAs:"hoursToDaysCtrl",controller:["$scope","$attrs",function(t,n){var r=this,i=e(n.ngHoursToDays);t.$watch(i,(function(e){if(!_.isUndefined(e)&&""!==e){var t=Math.abs(e),n=t%24,i=Math.floor(t/24);r.hours=e,r.days=i,r.remainderHours=n}}))}]}}]);var h=function(t,n){e.directive(t,["cache","clientOptions","db",function(e,r,i){return{restrict:"A",templateUrl:n,controllerAs:"itemPricingCtrl",controller:["$scope","$attrs",function(n,a){var o=this;if(o.status="loading",o.item=n.$eval(a[t]),o.item.isRetail||!o.item.company.features.isPriceEstimateEnabled||o.item.settings.isPriceEstimateHidden)o.status="hidden";else{var s=function(t){var n={};r.defaultTotalSheetPk?n.totalSheetPk=r.defaultTotalSheetPk:r.defaultTotalSheetUuid?n.totalSheetUuid=r.defaultTotalSheetUuid:r.defaultTotalScheduleUuid&&(n.totalScheduleUuid=r.defaultTotalScheduleUuid),t&&(n.date=t.format("YYYY-MM-DD"));var a=i.item.pricingOverview({shortname:o.item.company.shortname,itemPk:o.item.pk},null,null,n,{flashError:!1,isRatelimited:!0});if(!e.fresh(a))return o.status="success",void(o.pricingOverview=a);o.status=o.pricingOverview?"success":"loading",a.$promise.then((function(){o.pricingOverview=a,o.status="success"}),(function(e){o.pricingOverview=null,o.status=e&&404===e.status?"success":"error"}))},c=a[t+"Date"];c?n.$watch(c,(function(e){s(e)})):s()}}]}}])};h("ngItemPricingEstimate","ng-item-pricing-estimate"),h("ngItemPricingSummary","ng-item-pricing-summary"),e.directive("ngGallery",[function(){return{require:"A",controllerAs:"galleryCtrl",controller:["$scope","$element","$attrs",function(e,t,n){var r,i,a=this,o=function(){var e=a.objects.indexOf(r),n=t.find("[ng-gallery-selects]"),i=t.find("[ng-gallery-select]")[e];n.length&&i&&n.stop().animate({scrollLeft:i.offsetLeft-i.clientWidth/2})},s=function(t){if(a.isAutoAdvance||t){var n=a.objects.indexOf(r);n+=1,n%=a.objects.length,r=a.objects[n],e.$safeApply(),o()}},c=function(e){clearInterval(i),e&&s(),i=setInterval((function(){s()}),4e3)};a.isAutoAdvance=e.isSet(n.ngGalleryAutoAdvance),a.objects=e.$eval(n.ngGallery)||[];var l=e.$eval(n.ngGalleryPreselect)||0;r=a.objects[l],a.isSelected=function(e){return r===e},a.select=function(e){r=e,o()},a.isPaused=!1,a.pause=function(e){e||(a.isPaused=!0),clearInterval(i)},a.unpause=function(e){a.isPaused&&e||(a.isPaused=!1,c(!e))},a.next=function(){s(!0)},t.on("mouseenter",(function(){a.pause(!0)})),t.on("mouseleave",(function(){a.unpause(!0)})),c()}]}}]),e.directive("ngGalleryOverlay",[function(){return{require:"A",controllerAs:"galleryOverlayCtrl",controller:["$scope","$attrs",function(e,t){var n=this;n.isShowing=!1,n.show=function(e){n.isShowing=!0,n.preselectIndex=0,e&&(n.preselectIndex=n.objects.indexOf(e),n.preselectIndex=-1===n.preselectIndex?0:n.preselectIndex)},n.hide=function(){n.isShowing=!1},n.objects=e.$eval(t.ngGalleryOverlay)}]}}]),e.directive("ngGalleryOverlayContent",[function(){return{restrict:"A",require:"ngGalleryOverlay",templateUrl:"ng-gallery-overlay-content"}}]),e.directive("ngPasswordGenerator",["$parse","events",function(e,t){var n=/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/;return{restrict:"A",templateUrl:"ng-password-generator",require:["^form","ngPasswordGenerator"],controller:function(){var e=this;e.model={},e.update=function(t,n){e.model=t,e.field=n},e.password="",e.generate=function(){for(var t="abcdefghijknpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ23456789$#*!@?",r=t.length,i="";!i;){for(var a=0;a<12;a++)i+=t.charAt(Math.floor(Math.random()*r));n.test(i)||(i="")}return e.password=e.model.password=i,e.field&&e.field.$setDirty(),i}},compile:function(t,n){var r=e(n.ngPasswordGenerator),i=e(n.ngPasswordGeneratorField);return function(e,t,n,a){var o=a[0];e.generatorCtrl=a[1],e.generatorCtrl.update(r(e),o[i(e)]),e.$watch(_.bind(r,null,e),(function(){e.generatorCtrl.update(r(e),o[i(e)])}))}}}}])}()},9813:function(){!function(){"use strict";var e=angular.module("lib.filters",["lib.services"]);e.factory("filterFields",[function(){var e=[void 0,"",null,[],{}],t=function(t){return _.any(e,(function(e){return _.isEqual(e,t)}))};return{EMPTY_VALUES:e,isEmpty:t,isSet:function(e,n){return t(n)?!t(e):_.isArray(e)&&_.isArray(n)?!function(e,t){return _.isEqual(e.sort(),t.sort())}(e,n):!_.isEqual(e,n)}}}]),e.filter("isNumber",[function(){return _.isNumber}]),e.filter("isBoolean",[function(){return _.isBoolean}]),e.filter("humanize",["convert",function(e){return e.humanize}]),e.filter("indexOf",[function(){return _.indexOf}]),e.filter("percentage",["localization",function(e){return function(t,n,r,i){var a;_.isUndefined(r)&&(r=1);var o=e.current();return r?(a=t?t/r:0,i?_.isNumber(i)||(i=0):i=5,o.formatPercentage(a,i,!n)):o.formatPercentage(1,0,!n)}}]),e.filter("percentageFromPercentage",["$filter",function(e){return function(t,n,r,i){return e("percentage")(t/100,n,r,i)}}]),e.filter("cssPercentage",[function(){return function(e){return _.isUndefined(e)?"":(e*=100,(e=Math.floor(100*e)/100)+"%")}}]),e.filter("pluralize",[function(){return function(e,t,n){var r=n||"s",i=t||"";return e=parseInt(e||"0",10),1===(e=isNaN(e)?0:e)?i:r}}]).filter("capitalize",[function(){return function(e){return _.capitalize(e)}}]).filter("lowercase",[function(){return function(e){return e.toLowerCase()}}]).filter("uppercase",[function(){return function(e){return e.toUpperCase()}}]).filter("bracketWrap",[function(){return function(e){return"["+e+"]"}}]).filter("aOrAnBefore",[function(){var e=/[aeiouAEIOU]/;return function(t,n){return(t&&e.test(t.charAt(0))?n?"An":"an":n?"A":"a")+" "+t}}]).filter("css",[function(){return function(e){return(e=(e=(e=(e=e||"").replace(/\s+/g,"-")).replace(/-+/g,"-")).replace(/[^-\w]/g,"")).toLowerCase()}}]).filter("addClassIf",[function(){return function(e,t,n){return t=t||"",n=n||"",e?t:n}}]).filter("addClasses",[function(){return function(e){var t=[];return _.forEach(e,(function(e,n){e&&t.push(n)})),t.join(" ")}}]).filter("isDefined",[function(){return function(e){return!_.isUndefined(e)}}]).filter("isUndefined",[function(){return function(e){return _.isUndefined(e)}}]).filter("map",[function(){return function(e,t){return _.map(e,t)}}]).filter("any",[function(){return _.any}]).filter("anyNumbers",[function(){return function(e){return _.any(e,_.isNumber)}}]).filter("keys",[function(){return _.keys}]).filter("exclude",[function(){return function(e,t){return _.filter(e,(function(e){return!t(e)}))}}]).filter("colonless",[function(){var e=/:+\s*$/;return function(t){return(t=t||"").replace(e,"")}}]).filter("commaSeparated",[function(){return function(e){return e?_.filter(e).join(", "):""}}]).filter("replaceAll",[function(){return _.replaceAll}]).filter("ageInYears",[function(){return function(e){return moment().diff(e,"years")}}]).filter("get",[function(){return _.get}]).filter("pluck",[function(){return _.pluck}]).filter("compactObject",[function(){return _.ref.compactObject}]),e.factory("localization",["$browser","$window","auth","convert","db","models","moment","navigation",function(e,t,n,r,i,a,o,s){var c="en-us";o.locale(c);var l=i.slipstream("unitsLanguageFormats"),u=i.slipstream("unitsLanguageCodes"),d=function(e){if(!e)return"";var t=e.toLowerCase().match(/^([a-z]{2}-)?([a-z]{2})$/);if(!t||3!==t.length)return"";var n=t[2];return n?(n=n.toUpperCase(),_.contains(a.Company.COUNTRY_CODES,n)?n:""):""};t.ldmlnum.round=_.roundHalfToEven;var m=(i.slipstream("acceptLanguage")||"").split(","),p=m.length?_.find(m,(function(e){return!!d(e)})):"",f=d(p),h="",g={},y=function(e,t,n){var i,a;(n=n||{}).server&&n.topOfHour&&console.error("localization: unsupported use of `server` and `topOfHour` options in `__getTimeFormat()"),n.server?(i="server",a="exact"):(i="client",a=n.topOfHour?"topOfHour":"exact");var o=l[e];if(o){var s=o[i];if(s){var c=s.time;if(c){var u=c[a];if(u){var d=t||o[i].time[a].default,m=u.values;if(m){var p=m[r.camelKey(d)];return p||console.warn("localization: failed to identify time format for:",e,i,"time",a,"values",d),p}console.warn("localization: failed to identify time format for:",e,i,"time",a,"values")}else console.warn("localization: failed to identify time format for:",e,i,"time",a)}else console.warn("localization: failed to identify time format for:",e,i,"time")}else console.warn("localization: failed to identify time format for:",e,i)}else console.warn("localization: failed to identify time format for:",e)},v=a.Company,E=function(e,t){return(t=t||{}).server&&t.topOfHour&&console.error("localization: unsupported use of `server` and `topOfHour` options in `__fallbackTimeFormat()"),e===v.TWENTY_FOUR_HOUR_TIME_FORMAT_TYPE?t.server?v.FALLBACK_SERVER_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:t.topOfHour?v.FALLBACK_CLIENT_TOP_OF_HOUR_TWENTY_FOUR_HOUR_TIME_FORMAT:v.FALLBACK_CLIENT_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:t.server?v.FALLBACK_SERVER_EXACT_TWELVE_HOUR_TIME_FORMAT:t.topOfHour?v.FALLBACK_CLIENT_TOP_OF_HOUR_TWELVE_HOUR_TIME_FORMAT:v.FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT},b=function(e,t){return n.currentUser.isAuthenticated?function(e,t){var n;return(n=e.timeFormatType===v.COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE?y(e.language,void 0,t):y(e.language,e.timeFormatType,t))||(console.warn("localization: falling back for time format type:",e.timeFormatType,t),n=E(e.timeFormatType,t)),n}(n.currentUser.company.isAdmin&&s.currentCompany?s.currentCompany:n.currentUser.company,t):s.currentCompany?function(e,t,n){var r;return(r=e.anonymousTimeFormatType===v.ANONYMOUS_USER_LOCALE_DEFAULT_TIME_FORMAT_TYPE?y(t,void 0,n):e.anonymousTimeFormatType===v.COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE?y(e.language,void 0,n):y(e.language,e.anonymousTimeFormatType,n))||(console.warn("localization: falling back for anonymous time format type:",e.anonymousTimeFormatType,n),r=E(e.anonymousTimeFormatType,n)),r}(s.currentCompany,e,t):(console.warn("localization: falling back to 12-hour time for an anonymous user with no current company"),v.FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT)},C=function(e,t){if(_.contains(t,e))return e;var n=e.split("-")[0];if(_.contains(t,n))return n;for(var r=0,i=t.length;r<i;r++){var a=t[r];if(n===a.split("-")[0])return a}},k={browser:{ACCEPT_LANGUAGE:p,ACCEPT_LANGUAGE_COUNTRY_CODE:f},setLanguageManuallyForAnonymousUser:function(e,t){var n=function(e,t){var n=C(e,u);if(n)return n;if(t){var r=C(t.language,u);if(r)return r}return c}(e,t);l[n]?(console.log("localization: manually setting units language for anonymous user",n,"based on target language",e),h=n):console.warn("localization: unsupported language",n)},current:function(){var e;e=!n.currentUser.isAuthenticated&&h?h:i.slipstream("unitsLanguage")||c,g[e]=g[e]||function(e){l[e]||(console.warn("localization: unsupported language",e),e=c);var n=l[e],r=T("Today"),i=_.extend({export:"MM/YYYY"},n.client.month),a=_.extend({default:n.client.date.short,export:"YYYY-MM-DD"},n.client.date);t.ldmlnum.locale.xx=t.ldmlnum.locale(n.groupSymbol,n.decimalSymbol,n.plusSignSymbol,n.minusSignSymbol);var o=t.ldmlnum(n.decimalPattern,"xx"),s=t.ldmlnum(n.currencyPattern,"xx"),u=t.ldmlnum(n.percentPattern,"xx"),d=new RegExp("\\"+n.decimalSymbol+"0+");return{language:e,formatNumber:o,formatCurrency:function(e,t,n){t=t||"";var r=s(e).replace("¤¤¤",t).replace("¤¤",t).replace("¤",t);return _.isInteger(e)&&n&&(r=r.replace(d,"")),r},formatPercentage:function(e,t,r){var i=u(e,t);return r&&e>0&&-1===i.indexOf(n.plusSignSymbol)&&(i=n.plusSignSymbol+i),i},PERCENT_SYMBOL:n.percentSymbol,VALID_DATETIME_FORMATS:["default","short","shortNoYear","shortFullYear","dayWithMonthAbbr","long","longNoYear","export","input"],TIME_SEPARATOR:n.timeSeparator,HTML_TIME_SEPARATOR:n.htmlTimeSeparator,RANGE_SEPARATOR:" - ",HTML_RANGE_SEPARATOR:"<br/>- ",TODAY:r,DAY_FORMAT:"dddd",DAYS_FORMATS:{default:"[[ days ]] [days]"},ALL_DAY_FORMATS:{default:"[All day]"},MONTH_FORMATS:i,DATE_FORMATS:a}}(e);var r=g[e];o.locale(e);var a,s=(a=e,{TIME_FORMATS:_.extend({default:"h:mma",export:"hh:mma"},b(a)),TOP_OF_HOUR_TIME_FORMATS:_.extend({default:"ha",export:"hh:mma"},b(a,{topOfHour:!0})),SERVER_TIME_FORMAT:b(a,{server:!0})});return _.extend({},r,s)}};return k.current(),k}]),e.factory("dates",["$interpolate","localization",function(e,t){var n=t.current,r=function(t,n,r,i){var a=n[r.format]||n.default;return a?(_.isUndefined(i)||(a=e(a)(i)),a?t.format(a):""):(console.warn("dates: invalid date format",r.format,"valid formats",n),"")},i={format:"short",isRelative:!1,isRelativeTime:!1,isHtml:!1,endAt:null,hideDate:null},a=function(e,t,n,r){return r?t||"":t&&n?t+e+n:t||n},o=function(e,t){if(!moment.isMoment(e)||!moment.isMoment(t))return!1;var n=e.clone().startOf("day"),r=t.clone().startOf("day");return!n.diff(r)},s=function(e){var t=e.clone().startOf("day");return!e.diff(t)},c=function(e){var t=e.clone().startOf("hour");return!e.diff(t)},l=function(e,t){if(t.isRelative&&t.isRelativeTime){var n=moment(),r=e.diff(n,"hours");if(t.isRelative&&0<=r&&r<6)return e.fromNow()}},u=function(e,t){var a=l(e,t=t||i);if(a)return a;if(t.endAt&&s(e)&&s(t.endAt)){var o=Math.abs(t.endAt.diff(e,"days"));if(o>1)return r(e,n().DAYS_FORMATS,t,{days:o});if(1===o)return r(e,n().ALL_DAY_FORMATS,t)}return c(e)?r(e,n().TOP_OF_HOUR_TIME_FORMATS,t):r(e,n().TIME_FORMATS,t)},d=function(e,t){return(t=t||i).isRelative&&o(e,moment())?n().TODAY:r(e,n().DATE_FORMATS,t)},m=function(e,t){if((t=t||i).endAt&&s(e)&&s(t.endAt))return d(e,t);var r=d(e,t),c=l(e,t);if(c)return c;var m=_.extend({},t);delete m.endAt;var p=u(e,m);return p&&t.isHideDate&&o(e,t.hideDate)?p:a(n().TIME_SEPARATOR,r,p)};return{options:function(e){var t=_.extend({},i);return _.contains(e,"short")?console.warn("date: unnecessary short format specifier"):_.find(n().VALID_DATETIME_FORMATS,(function(n){if(_.contains(e,n))return t.format=n,!0})),t.isRelative=_.contains(e,"relative"),t.isRelativeTime=_.contains(e,"relative-time"),t.isAlwaysHideDate=_.contains(e,"always-hide-date"),t.isHideDate=t.isAlwaysHideDate||_.contains(e,"hide-date"),t.isHtml=_.contains(e,"html"),t.is12amPlus1=_.contains(e,"12am+1"),_.forEach(e,(function(n){moment.isMoment(n)&&(t.endAt?t.isHideDate?t.hideDate=n:console.warn("date: extra moments",e,skipEndAt):t.endAt=n)})),t},isSameDay:o,isMidnight:s,isTopOfHour:c,getMonth:function(e,t){return t=t||i,r(e,n().MONTH_FORMATS,t)},getDay:function(e,t){return(t=t||i).isRelative&&o(e,moment())?n().TODAY:r(e,n().DAY_FORMAT,t)},getDate:d,getDateRange:function(e,t,r){if(r=r||i,o(e,t))return d(e,r);var s=r.isHtml?n().HTML_RANGE_SEPARATOR:n().RANGE_SEPARATOR;return a(s,d(e,r),d(t,r))},getTime:u,getRelativeTime:l,getTimeRange:function(e,t,o){var c=(o=o||i).isHtml?n().HTML_RANGE_SEPARATOR:n().RANGE_SEPARATOR,l=Math.abs(e.diff(t,"days"));return 0===e.diff(t)?u(e,o):s(e)&&s(t)?l>1?r(e,n().DAYS_FORMATS,o,{days:l}):r(e,n().ALL_DAY_FORMATS,o):a(c,u(e,o=null),0===l?u(t,o):1===l?u(t,o)+" "+T("(next day)"):u(t,o)+" "+interpolate(T("(%(count)s days later)"),{count:l.toString()}))},getDatetime:m,getDatetimeRange:function(e,t,r){if(r=r||i,0===e.diff(t))return m(e,r);var c=r.isHtml?n().HTML_RANGE_SEPARATOR:n().RANGE_SEPARATOR;if(s(e)&&s(t))return Math.abs(e.diff(t,"days"))>1?((t=t.clone()).subtract(1,"days"),a(c,d(e,r),d(t,r))):r.isAlwaysHideDate&&o(e,r.hideDate)?u(e,r):d(e,r);var l,p,f,h,g=r.is12amPlus1&&s(t)&&(l=e,p=t,!(!moment.isMoment(l)||!moment.isMoment(p))&&(l=l.clone().startOf("day"),1===(p=p.clone().startOf("day")).diff(l,"days")));if(o(e,t)||g){var y=a(n().RANGE_SEPARATOR,u(e,r),u(t,r));if(g&&(y+="+1"),r.isHideDate&&o(e,r.hideDate))return y;var v=d(e,r),T=r.isHtml?n().HTML_TIME_SEPARATOR:n().TIME_SEPARATOR;return a(T,v,y)}return r.isHideDate?(h=_.defaults({isHideDate:!1,hideDate:null},r),f=r.isAlwaysHideDate?r:h):f=h=r,a(c,m(e,f),m(t,h))}}}]),e.filter("dateOffset",["moment",function(e){return function(t,n,r,i){if(!e.isMoment(t))return"";n=n||0,r=r||"minutes";var a=t.clone();return i?a.add(n,r):a.subtract(n,r)}}]).filter("dateSubtract",["$filter",function(e){return function(t,n,r){return e("dateOffset")(t,n,r,!1)}}]).filter("dateAdd",["$filter",function(e){return function(t,n,r){return e("dateOffset")(t,n,r,!0)}}]),e.filter("dateRange",["dates","moment",function(e,t){return function(n){var r=e.options(_.rest(arguments)),i=r.endAt;return t.isMoment(n)&&t.isMoment(i)?e.getDateRange(n,i,r):(console.log("dateRange: invalid moments",n,i,r),"")}}]).filter("datetimeRange",["dates","moment",function(e,t){return function(n){var r=e.options(_.rest(arguments)),i=r.endAt;return t.isMoment(n)&&t.isMoment(i)?e.getDatetimeRange(n,i,r):(console.log("datetimeRange: invalid moments",n,i,r),"")}}]).filter("timeRange",["dates","moment",function(e,t){return function(n){var r=e.options(_.rest(arguments)),i=r.endAt;return t.isMoment(n)&&t.isMoment(i)?e.getTimeRange(n,i,r):(console.log("timeRange: invalid moments",n,i,r),"")}}]).filter("date",["dates","moment",function(e,t){return function(n){_.isString(n)&&(n=t(n));var r=e.options(_.rest(arguments));return t.isMoment(n)?e.getDate(n,r):(console.log("date: invalid moment",n,r),"")}}]).filter("day",["dates","moment",function(e,t){return function(n){var r=e.options(_.rest(arguments));return t.isMoment(n)?e.getDay(n,r):(console.log("day: invalid moment",n,r),"")}}]).filter("month",["dates","moment",function(e,t){return function(n){var r=e.options(_.rest(arguments));return t.isMoment(n)?e.getMonth(n,r):(console.log("day: invalid moment",n,r),"")}}]).filter("datetime",["dates","moment",function(e,t){return function(n){var r=e.options(_.rest(arguments));return t.isMoment(n)?e.getDatetime(n,r):(console.log("datetime: invalid moment",n,r),"")}}]).filter("datetimeWithTimezone",["dates","moment",function(e,t){return function(n,r){var i=e.options(_.slice(arguments,2));if(!t.isMoment(n))return console.log("datetimeWithTimezone: invalid moment",n,r,i),"";if(!_.isString(r))return console.log("datetimeWithTimezone: invalid timezone",n,r,i),"";var a=t.tz(n.valueOf(),r);return e.getDatetime(a,i)}}]).filter("timeWithTimezone",["dates","moment",function(e,t){return function(n,r){var i=e.options(_.slice(arguments,2));if(!t.isMoment(n))return console.log("timeWithTimezone: invalid moment",n,r,i),"";if(!_.isString(r))return console.log("timeWithTimezone: invalid timezone",n,r,i),"";var a=t.tz(n.valueOf(),r);return e.getTime(a,i)}}]).filter("dateWithTimezone",["dates","moment",function(e,t){return function(n,r){var i=e.options(_.slice(arguments,2));if(!t.isMoment(n))return console.log("dateWithTimezone: invalid moment",n,r,i),"";var a=t.tz(n.valueOf(),r);return e.getDate(a,i)}}]).filter("time",["dates","moment",function(e,t){return function(n){var r=e.options(_.rest(arguments));return n?_.isString(n)&&(n=t(n,"HH:mm"),!t.isMoment(n))?"":e.getTime(n,r):""}}]),e.filter("range",[function(){return function(e,t){return _.range(e,t)}}]),e.filter("firstLineOfMarkdown",[function(){var e=/^\s*$/,t=/^#+/,n=/([*_]{1,3})(\S.*?\S?)\1/;return function(r){if(!r)return"";var i=_.find(r.split("\n"),(function(t){return!e.test(t)}))||"";return _.trim(i.replace(t,"").replace(n,"$2").replace(n,"$2"))}}]),e.filter("encodeURIComponent",[function(){return function(e){return encodeURIComponent(e)}}]),e.filter("hostname",[function(){return function(e){if(!e)return"";var t=e.toLowerCase(),n=document.createElement("a");n.setAttribute("href",t);var r=n.hostname;return r&&-1!==t.indexOf(r)?r=r.replace(/^www./,""):e}}]),e.filter("withLineBreaks",[function(){return function(e){return e.replace(/\n+/g,"\n<br />\n")}}]),e.factory("phoneNumbers",[function(){var e=_.toTrueKeys([201,202,203,205,206,207,208,209,210,212,213,214,215,216,217,218,219,220,224,225,227,228,229,231,234,239,240,248,251,252,253,254,256,260,262,267,269,270,272,274,276,278,281,283,301,302,303,304,305,307,308,309,310,312,313,314,315,316,317,318,319,320,321,323,325,327,330,331,334,336,337,339,341,346,347,351,352,360,361,364,369,380,385,386,401,402,404,405,406,407,408,409,410,412,413,414,415,417,419,423,424,425,430,432,434,435,440,442,443,447,458,464,469,470,475,478,479,480,484,501,502,503,504,505,507,508,509,510,512,513,515,516,517,518,520,530,531,534,539,540,541,551,557,559,561,562,563,564,567,570,571,573,574,575,580,582,585,586,601,602,603,605,606,607,608,609,610,612,614,615,616,617,618,619,620,623,626,627,628,629,630,631,636,641,646,650,651,657,659,660,661,662,667,669,678,679,681,682,689,701,702,703,704,706,707,708,712,713,714,715,716,717,718,719,720,724,725,727,730,731,732,734,737,740,743,747,754,757,760,762,763,764,765,769,770,772,773,774,775,779,781,785,786,801,802,803,804,805,806,808,810,812,813,814,815,816,817,818,828,830,831,832,843,845,847,848,850,854,856,857,858,859,860,862,863,864,865,870,872,878,901,903,904,906,907,908,909,910,912,913,914,915,916,917,918,919,920,925,927,928,929,930,931,934,935,936,937,938,940,941,947,949,951,952,954,956,959,970,971,972,973,975,978,979,980,984,985,989]),t=function(e){return e?e.replace(/\D/g,""):""},n=function(e){return e?("+"===e[0]?"+":"")+t(e):""},r=/^\+?\d{5,15}$/,i=function(n){var r=t(n);if(11===r.length&&"1"===r[0]&&(r=r.slice(1)),10===r.length){var i=r.slice(0,3);if(e[i])return{isUsPhoneNumber:!0,areaCode:i,exchange:r.slice(3,6),suffix:r.slice(6,10)}}return{isUsPhoneNumber:!1}};return{cleanPhoneNumber:n,digits:t,isPossiblyValid:function(e){return r.test(n(e))},parseUsPhoneNumber:i,formatUsPhoneNumber:function(e){if("+"===(e=e||"")[0])return e;var t=i(e);return t.isUsPhoneNumber?"("+t.areaCode+") "+t.exchange+"-"+t.suffix:e}}}]),e.filter("phone",["navigation","phoneNumbers",function(e,t){return function(e){return t.formatUsPhoneNumber(e)}}]),e.filter("contactPhone",["navigation",function(e){return function(t){if(t){var n=e.currentCompany,r=n.country||n.processorCountry;return t.phoneCountry&&t.phoneCountry!==r?t.displayPhoneInternational:t.displayPhoneNational}}}]),e.filter("currencyClass",[function(){return function(e){return(e=_.resolveCurrency(e))?"currency--"+e:""}}]),e.filter("currencySymbol",["auth","db","localization",function(e,t,n){var r=t.slipstream("currencies");return function(t,i){t=_.resolveCurrency(t);var a=r[t];if(!a)return console.warn("currencySymbol filter: unsupported currency",t),"";if(e.currentUser.isAuthenticated&&(i=e.currentUser.company.isAdmin?"long":"short"),"short"===i)return a.symbol;if("long"===i)return a.symbolLong;var o=a.symbolLongByLanguage;return(o?o[n.current().language]:"")||a.symbolLong}}]),e.filter("currencyDisplayName",["db","localization",function(e,t){var n=e.slipstream("currencies");return function(e,t){e=_.resolveCurrency(e);var r=n[e];return r?"short"==t?r.displayName:r.displayNameLong:(console.warn("currencyDisplayName filter: unsupported currency",e),"")}}]),e.filter("amount",["$filter","db","localization","navigation",function(e,t,n,r){var i=t.slipstream("currencies"),a=e("currencySymbol");return function(e,t,o,s,c){if(c&&null===e&&(e=0),!_.isNumber(e))return"";_.isBoolean(t)&&_.isUndefined(s)&&(s=!o,o=t,t=null),(t=_.resolveCurrency(t))||(r.currentCompany?(console.warn("amount filter: not passed currency, falling back to currentCompany"),t=r.currentCompany.processorCurrency):(console.warn("amount filter: not passed currency, no currentCompany to fall back to"),t="",s=!1)),_.isUndefined(s)&&(s=!0);var l,u=n.current(),d=i[t];d?l=d.decimalPlaces:(console.warn("amount filter: passed unsupported currency:",t),s=!1,l=2),e/=Math.pow(10,l);var m=s?a(t,s):"";return u.formatCurrency(e,m,o)}}]),e.filter("count",["localization",function(e){return function(t,n){return null==t?"":e.current().formatNumber(t,n||4)}}]),e.filter("stripNewlines",[function(){return function(e){return e.replace(/\r|\n/g,"").replace(/\s+/g," ")}}]),e.filter("yesno",[function(){return function(e,t,n){return t=_.isUndefined(t)?"Yes":t,n=_.isUndefined(n)?"No":n,e?t:n}}]),e.filter("name",[function(){return function(e,t,n,r){return t=t||"",_.isUndefined(r)&&(r=t),_.isUndefined(e)?r:_.isString(e)?e||t:_.isObject(e)?(e.shortName||e.name||e.unicode||t)+(e.isArchived&&!n?" ("+T("archived")+")":""):t}}]),e.filter("primaryImageUrl",[function(){return function(e){return e.imageCdnUrl||(e.images&&e.images.length?e.images[0].croppedCdnUrl:"")}}]),e.filter("availabilityOrItemImageUrl",[function(){return function(e){return e.availabilityHeadline&&e.availabilityHeadline.imageCdnUrl?e.availabilityHeadline.imageCdnUrl:e.item.images&&e.item.images.length?e.item.images[0].croppedCdnUrl:e.item.imageCdnUrl||""}}]),e.filter("value",[function(){return function(e){return _.isString(e)?e:e.value}}]),e.filter("personalizeCollectedByText",["$filter","auth",function(e,t){var n=e("name");return function(e){return t.isCompanyUser(e)?T("Collected by you"):interpolate(T("Collected by %(companyName)s"),{companyName:n(e)})}}]),e.filter("lastNameFirst",[function(){return function(e){var t=e.split(/\s+/),n=t.pop();return t.length&&(n+=","),t.unshift(n),t.join(" ")}}]);var t="ava-is-empty",n="ava-is-booked",r="ava-is-full",i="ava-is-overbooked";e.filter("isOnlineStatusFlag",["models",function(e){return function(t,n){var r="";return!!t&&(e.Availability.isCancelled(t)?r="cancelled":t.isBookableOnlyByPhone?r="phone":t.isBookable&&t.isUnlisted?r="unlisted":t.isBookable||!t.isResourcesAvailable&&!t.item.company.companyFeatures.isResourceBookableCapacityEnabled?t.item.company.companyFeatures.isResourceBookableCapacityEnabled||t.isResourcesAvailable||(r="noResources"):r="lock",r===n)}}]),e.filter("capacityIndicatorClass",[function(){return function(e){var t=_.contains(arguments,"filled"),n=_.contains(arguments,"large"),r="cb-square",i=n?"icon-user":"icon-user-small";return e.companyFeatures.isResourceBookableCapacityEnabled?t?r+" filled":r:t?i+" full":i+" empty"}}]),e.filter("blockedCapacityClass",[function(){return function(e,a){return 0===e?t:e===a?r:e>a?i:n}}]),e.filter("capacityClass",["models",function(e){return function(a,o,s){var c,l=a.customerCount,u=a.capacity;if(_.isUndefined(o)||(l=o),_.isUndefined(s)&&(s=!0),a.cls===e.ItemGroup.cls)return(a.bookingCount||0)>0?n:t;if(a.cls===e.Block.cls&&(c=a.reservedCapacity-l),a.cls===e.CustomerTypeRate.cls&&(c=u-l),a.cls===e.Availability.cls){var d=s?"bookableCapacity":"blocksIncludedBookableCapacity",m=s?"nonResourceBookableCapacity":"blocksIncludedNonResourceBookableCapacity";if(!l)return t;if(a.company.companyFeatures.isResourceBookableCapacityEnabled){if(c=a[d],_.isUndefined(c))return console.log("capacityClass: no capacity information for object",a.uri),t;if(a.isOverusingResources)return i;if(a[m]<0)return i}else{if(c=a[m],_.isUndefined(c))return console.log("capacityClass: no capacity information for object",a.uri),t;null!==c&&(c+=a.customerCount-l)}}return l<=0?t:c<0?i:0===c?r:null===c||c>0?n:t}}]),e.filter("liveCapacityClass",["models",function(e){return function(e,a){if(!e||e.$fresh)return t;var o=a.bookCountsCtrl.liveCapacity.availabilityCustomerCount;return o?0===a.bookCountsCtrl.customerCount&&(a.availability.isOverbooked||a.availability.isOverusingResources)||e.isOverbookingAvailability||e.isOverusingResources?i:0===e.availabilityLiveBookableCapacity?r:o>0&&(null===e.availabilityLiveBookableCapacity||e.availabilityLiveBookableCapacity>0)?n:(console.log("liveCapacityClass: no capacity information.",e,o),t):t}}]),e.filter("availableClass",[function(){return function(e,t){var n=e.customerCount,r=e.capacity-n;return _.isUndefined(t)||(r=t),r<=0?"ava-is-unbookable":"ava-is-bookable"}}]),e.filter("paymentAmountClass",["models",function(e){return function(t){return t.disputeStatus===e.Payment.LOST_DISPUTE_STATUS?"strike":e.Payment.isPaymentFailed(t)?"negative":t.expiresAt?"fh-grey":"positive"}}]),e.filter("hasCustomersClass",[function(){return function(e){return e.customerCount>0?n:t}}]),e.filter("abs",[function(){return function(e){return Math.abs(e||0)}}]),e.filter("isAllDay",["dates",function(e){return function(t){return t?!(!t.startAt||!t.endAt)&&+t.startAt!=+t.endAt&&e.isMidnight(t.startAt)&&e.isMidnight(t.endAt):(console.warn("isAllDay: invalid range"),!1)}}]),e.filter("isMidnight",["dates","moment",function(e,t){return function(n){return t.isMoment(n)?e.isMidnight(n):(console.warn("isMidnight: invalid date",n),!1)}}]),e.filter("contains",[function(){return function(e,t){return _.contains(e,t)}}]),e.filter("bookingUrl",["auth","navigation","urls",function(e,t,n){return function(r,i){var a=r.company;if(r.isPending&&!e.currentUser.isAuthenticated){var o=r.$url(n.embeds.book.wait.booking);return t.extendQuery(o,{status:"initial"})}return e.permissions.can("viewDashboardSection",a)?(o=r.$url(n.dashboard.overlay.contact.booking),i&&(o=t.extendQuery(o,{action:i})),o):r.affiliation&&e.permissions.can("viewDashboardSection",r.affiliation.affiliateCompany)?(o=r.$url(n.dashboard.bookings.contact.affiliateBookingPermalink),i&&(o=t.extendQuery(o,{action:i})),o):r.$url(n.company.item.booking)}}]),e.filter("orderUrl",["auth","navigation","urls",function(e,t,n){return function(t){var r=t.company;if(e.permissions.can("viewDashboardSection",r))return t.$url(n.dashboard.overlay.contact.order);var i=_.filter(t.allBookings,(function(t){return t.affiliation&&e.permissions.can("viewDashboardSection",t.affiliation.affiliateCompany)}));return i.length>0?n.populate(n.dashboard.bookings.contact.affiliateOrderPermalink,{affiliateShortname:i[0].affiliation.affiliateCompany.shortname,shortname:t.company.shortname,contactPk:t.contact.pk,orderUuid:t.uuid}):t.$url(n.company.order.index)}}]),e.filter("contactUrl",["auth","navigation","urls","require",function(e,t,n,r){return function(t){var r=t.company;if(e.permissions.can("viewDashboardSection",r))return t.$url(n.dashboard.overlay.contact.index);var i=_.findWhere(e.currentUser.company.partners,{company:t.company});return i&&i.affiliateGroup&&e.permissions.can("viewDashboardSection",e.currentUser.company)?n.populate(n.dashboard.bookings.contact.affiliateContactPermalink,{affiliateShortname:e.currentUser.company.shortname,shortname:t.company.shortname,contactPk:t.pk}):t.$url(n.company.index)}}]),e.filter("availabilityUrl",["auth","models","urls",function(e,t,n){return function(t){return e.permissions.can("viewDashboardSection",t.item.company)?t.$url(n.dashboard.overlay.availability.index):t.$url(n.company.item.book)}}]),e.filter("itemGroupUrl",["auth","flows","models","urls",function(e,t,n,r){return function(n,i){var a=e.permissions.can("viewDashboardSection",n.item.company)?r.dashboard.overlay.item.date:r.company.item.date,o=r.populate(a,{shortname:n.item.company.shortname,itemPk:n.item.pk,date:i.format("YYYY-MM-DD")});return t.extendWithFlow(o)}}]),e.filter("itemUrl",["auth","urls",function(e,t){return function(n){return e.permissions.can("viewItemsSection",n.company)?n.$url(t.dashboard.items.item.index):n.$url(t.company.item.index)}}]),e.filter("checkinUrl",["db","urls",function(e,t){return function(n){return n?e.slipstream("checkinDomain")+t.populate(t.embeds.checkin.qr,{encodedCustomerPk:n.encodedPk}):""}}]),e.filter("waiverUrl",[function(){return function(e,t){return t.company.smartwaiverUrl+e.waiverUuid+"/web/?auto_tag=fh_id_"+t.pk.toString()}}]),e.filter("invoiceUrl",["auth","navigation","urls",function(e,t,n){return function(r,i){var a;if(i=i||"index",!(a=t.currentCompany===r.company&&e.permissions.can("viewDashboardSection",r.company)?n.dashboard.reports.invoices.invoice[i]:r.affiliation&&e.permissions.can("viewDashboardSection",r.affiliation.affiliateCompany)?n.dashboard.reports.invoices.partnerInvoice[i]:n.company.invoice.index))throw new Error("invoiceUrl: invalid view "+i);return r.$url(a)}}]),e.filter("uploadUrl",["navigation","urls",function(e,t){return function(n){var r=e.currentCompany;return t.populate(t.dashboard.reports.accounts.upload,{shortname:r.shortname,uploadPk:n.pk})}}]),e.filter("companyDefaultIntegrationsUrl",["navigation","urls","auth","models",function(e,t,n,r){return function(e){var i={shortname:e.shortname};return n.permissions.canList(r.ResellerCompany,e)?e.isAdmin?t.populate(t.dashboard.settings.reseller.apps.index,i):t.populate(t.dashboard.settings.reseller.index,i):t.populate(t.dashboard.settings.integrations.subscribe,i)}}]),e.filter("key",[function(){return function(e){return e.cls+"."+e.pk}}]),e.filter("summary",[function(){return function(e,t,n){return n=n||0,_.reduce(e,(function(e,n){return e+(_.getDotted(n,t)||0)}),n)}}]),e.filter("uniqueCount",["$filter",function(e){var t=e("pluralize");return function(e,n,r,i){var a={};_.forEach(e,(function(e){var t=_.get(e,n);_.isObject(t)&&t.uri&&(t=t.uri),a[t]=1}));var o=_.sum(a);return r||i?o.toString()+" "+t(o,r,i):o}}]),e.filter("uncamel",[function(){var e=/([a-z])([A-Z])/g,t=function(e,t,n){return t+" "+n};return function(n){return n.replace(e,t)}}]),e.filter("activityChange",["$filter","models",function(e,t){var n=e("amount"),r=e("percentage"),i=function(e){return moment.isMoment(e)||(e=moment.parseZone(e)),e},a={AmountField:n,BooleanField:function(e){return e?T("true"):T("false")},PositiveAmountField:n,PercentField:r,PositivePercentField:r,DateTimeField:function(t){return e("datetime")(i(t))},DateField:function(t){return e("date")(i(t))},ColumnWidthField:function(e){return t.FlowNode.WIDTH_LABELS[e]||e},PKListField:function(e){return e||T("all")},ArrayField:function(e){return _.isArray(e)?e.join(", "):""}};return function(t,n){var r=a[n];return r?r(t):_.isObject(t)?e("name")(t):t}}]),e.filter("defaultIfUndefined",[function(){return function(e,t){return _.isUndefined(e)?t:e}}]),e.filter("displayFilterValue",["$filter",function(e){return function(t){if(!0===t)return T("is set");if(!1===t)return T("is empty");var n="";return _.isString(t)&&"{"===t[0]&&("contains"===(t=_.parseJSON(t)).type&&(n=T("contains")+" "),t=t.value),n+e("name")(t)}}]),e.filter("fieldOrBoolean",["$filter",function(e){return function(t){return!0===t?"is set":!1===t?"is empty":_.isObject(t)?e("name")(t):t}}]),e.filter("names",["$filter",function(e){return function(t){return _.map(t,e("name")).join(", ")}}]),e.filter("isEmptyFilter",["filterFields",function(e){return function(t){return _.any(e.EMPTY_VALUES,(function(e){return _.isEqual(e,t)}))}}]),e.filter("defaults",[function(){return _.defaults}]),e.filter("parsePresetDateRange",["dateUtils",function(e){return function(t,n){return e.dateRange(t,n)}}]),e.filter("colorClass",["models",function(e){return function(t,n,r){return n=n||"",r=r||"",t?(t.cls===e.Booking.cls?t=t.availability.item:t.item&&(t=t.item),t.color&&(t=t.color),t&&_.isNumber(t)?(n&&"-"!==n.charAt(0)&&(n=" "+n),"color-"+t+n):r):r}}]),e.filter("approximate",["$filter",function(e){return function(t,n){var r,i=1,a=n?"+":"";if(t>=1e3)r=100,i=1e3,a="k"+a;else if(t>=100)r=100;else{if(!(t>=10))return t;r=10}var o=(t-t%r)/i;return e("count")(o,1)+a}}]),e.filter("displayLanguage",["models",function(e){return function(t){return e.SupportedLanguage.display(t)}}]),e.filter("bankAccountDescription",[function(){return function(e){return e?e.bankName+" "+e.accountLast4:""}}])}()},9895:function(){!function(){"use strict";var e=angular.module("lib.models",[]);e.factory("models",["$filter","$injector","convert","require",function(e,t,n,r){var i=e("orderBy"),a=e("pluralize"),o=e("name"),s="US",c=[[s,cT('"USA" acronym for United States of America',"USA")],["AF",T("Afghanistan")],["AL",T("Albania")],["DZ",T("Algeria")],["AS",T("American Samoa")],["AD",T("Andorra")],["AO",T("Angola")],["AI",T("Anguilla")],["AQ",T("Antarctica")],["AG",T("Antigua & Barbuda")],["AR",T("Argentina")],["AM",T("Armenia")],["AW",T("Aruba")],["AU",T("Australia")],["AT",T("Austria")],["AZ",T("Azerbaijan")],["BS",T("Bahamas")],["BH",T("Bahrain")],["BD",T("Bangladesh")],["BB",T("Barbados")],["BY",T("Belarus")],["BE",T("Belgium")],["BZ",T("Belize")],["BJ",T("Benin")],["BM",T("Bermuda")],["BT",T("Bhutan")],["BO",T("Bolivia")],["BA",T("Bosnia and Herzegovina")],["BW",T("Botswana")],["BV",T("Bouvet Island")],["BR",T("Brazil")],["IO",T("British Indian Ocean Territory")],["VG",T("British Virgin Islands")],["BN",T("Brunei Darussalam")],["BG",T("Bulgaria")],["BF",T("Burkina Faso")],["BI",T("Burundi")],["KH",T("Cambodia")],["CM",T("Cameroon")],["CA",T("Canada")],["CV",T("Cape Verde")],["KY",T("Cayman Islands")],["CF",T("Central African Republic")],["TD",T("Chad")],["CL",T("Chile")],["CN",T("China")],["CX",T("Christmas Island")],["CC",T("Cocos (Keeling) Islands")],["CO",T("Colombia")],["KM",T("Comoros")],["CG",T("Congo")],["CK",T("Cook Iislands")],["CR",T("Costa Rica")],["HR",T("Croatia")],["CU",T("Cuba")],["CY",T("Cyprus")],["CZ",T("Czech Republic")],["DK",T("Denmark")],["DJ",T("Djibouti")],["DM",T("Dominica")],["DO",T("Dominican Republic")],["TP",T("East Timor")],["EC",T("Ecuador")],["EG",T("Egypt")],["SV",T("El Salvador")],["GQ",T("Equatorial Guinea")],["ER",T("Eritrea")],["EE",T("Estonia")],["ET",T("Ethiopia")],["FK",T("Falkland Islands (Malvinas)")],["FO",T("Faroe Islands")],["FJ",T("Fiji")],["FI",T("Finland")],["FR",T("France")],["FX",T("France, Metropolitan")],["GF",T("French Guiana")],["PF",T("French Polynesia")],["TF",T("French Southern Territories")],["GA",T("Gabon")],["GM",T("Gambia")],["GE",T("Georgia")],["DE",T("Germany")],["GH",T("Ghana")],["GI",T("Gibraltar")],["GR",T("Greece")],["GL",T("Greenland")],["GD",T("Grenada")],["GP",T("Guadeloupe")],["GU",T("Guam")],["GT",T("Guatemala")],["GN",T("Guinea")],["GW",T("Guinea-Bissau")],["GY",T("Guyana")],["HT",T("Haiti")],["HM",T("Heard & McDonald Islands")],["HN",T("Honduras")],["HK",T("Hong Kong")],["HU",T("Hungary")],["IS",T("Iceland")],["IN",T("India")],["ID",T("Indonesia")],["IQ",T("Iraq")],["IE",T("Ireland")],["IR",T("Islamic Republic of Iran")],["IL",T("Israel")],["IT",T("Italy")],["CI",T("Ivory Coast")],["JM",T("Jamaica")],["JP",T("Japan")],["JO",T("Jordan")],["KZ",T("Kazakhstan")],["KE",T("Kenya")],["KI",T("Kiribati")],["KP",T("Korea, Democratic People's Republic of")],["KR",T("Korea, Republic of")],["KW",T("Kuwait")],["KG",T("Kyrgyzstan")],["LA",T("Lao People's Democratic Republic")],["LV",T("Latvia")],["LB",T("Lebanon")],["LS",T("Lesotho")],["LR",T("Liberia")],["LY",T("Libyan Arab Jamahiriya")],["LI",T("Liechtenstein")],["LT",T("Lithuania")],["LU",T("Luxembourg")],["MO",T("Macau")],["MG",T("Madagascar")],["MW",T("Malawi")],["MY",T("Malaysia")],["MV",T("Maldives")],["ML",T("Mali")],["MT",T("Malta")],["MH",T("Marshall Islands")],["MQ",T("Martinique")],["MR",T("Mauritania")],["MU",T("Mauritius")],["YT",T("Mayotte")],["MX",T("Mexico")],["FM",T("Micronesia")],["MD",T("Moldova, Republic of")],["MC",T("Monaco")],["MN",T("Mongolia")],["MS",T("Monserrat")],["MA",T("Morocco")],["MZ",T("Mozambique")],["MM",T("Myanmar")],["NA",T("Namibia")],["NR",T("Nauru")],["NP",T("Nepal")],["NL",T("Netherlands")],["AN",T("Netherlands Antilles")],["NC",T("New Caledonia")],["NZ",T("New Zealand")],["NI",T("Nicaragua")],["NE",T("Niger")],["NG",T("Nigeria")],["NU",T("Niue")],["NF",T("Norfolk Island")],["MP",T("Northern Mariana Islands")],["NO",T("Norway")],["OM",T("Oman")],["PK",T("Pakistan")],["PW",T("Palau")],["PA",T("Panama")],["PG",T("Papua New Guinea")],["PY",T("Paraguay")],["PE",T("Peru")],["PH",T("Philippines")],["PN",T("Pitcairn")],["PL",T("Poland")],["PT",T("Portugal")],["PR",T("Puerto Rico")],["QA",T("Qatar")],["RE",T("Reunion")],["RO",T("Romania")],["RU",T("Russian Federation")],["RW",T("Rwanda")],["LC",T("Saint Lucia")],["WS",T("Samoa")],["SM",T("San Marino")],["ST",T("Sao Tome & Principe")],["SA",T("Saudi Arabia")],["SN",T("Senegal")],["RS",T("Serbia")],["SC",T("Seychelles")],["SL",T("Sierra Leone")],["SG",T("Singapore")],["SK",T("Slovakia")],["SI",T("Slovenia")],["SB",T("Solomon Islands")],["SO",T("Somalia")],["ZA",T("South Africa")],["GS",T("South Georgia and the South Sandwich Islands")],["ES",T("Spain")],["LK",T("Sri Lanka")],["SH",T("St. Helena")],["KN",T("St. Kitts and Nevis")],["PM",T("St. Pierre & Miquelon")],["VC",T("St. Vincent & the Grenadines")],["SD",T("Sudan")],["SR",T("Suriname")],["SJ",T("Svalbard & Jan Mayen Islands")],["SZ",T("Swaziland")],["SE",T("Sweden")],["CH",T("Switzerland")],["SY",T("Syrian Arab Republic")],["TW",T("Taiwan")],["TJ",T("Tajikistan")],["TZ",T("Tanzania, United Republic of")],["TH",T("Thailand")],["TG",T("Togo")],["TK",T("Tokelau")],["TO",T("Tonga")],["TT",T("Trinidad & Tobago")],["TN",T("Tunisia")],["TR",T("Turkey")],["TM",T("Turkmenistan")],["TC",T("Turks & Caicos Islands")],["TV",T("Tuvalu")],["UG",T("Uganda")],["UA",T("Ukraine")],["AE",T("United Arab Emirates")],["GB",T("United Kingdom (Great Britain)")],["UM",T("United States Minor Outlying Islands")],["VI",T("United States Virgin Islands")],[s,cT('"USA" acronym for United States of America',"USA")],["ZZ",T("Unknown or unspecified country")],["UY",T("Uruguay")],["UZ",T("Uzbekistan")],["VU",T("Vanuatu")],["VA",T("Vatican City State (Holy See)")],["VE",T("Venezuela")],["VN",T("Viet Nam")],["WF",T("Wallis & Futuna Islands")],["EH",T("Western Sahara")],["YE",T("Yemen")],["YU",T("Yugoslavia")],["ZR",T("Zaire")],["ZM",T("Zambia")],["ZW",T("Zimbabwe")]],l=_.map(c,(function(e){return e[0]})),u=function(e){var n=t.get("db").slipstream("currencyChoices");return _.isUndefined(n)?(console.warn("getCurrencyChoices: currency choices undefined"),[]):e?_.filter(n,(function(t){var n=t[0];return _.contains(e,n)})):n},d={NETWORK_FILTER:"#network",COMPANY_FILTER:"#company",ADMIN_FILTER:{},filterUrl:function(e){return e===d.COMPANY_FILTER?"":e===d.ADMIN_FILTER?"admin/":e===d.NETWORK_FILTER?"network/":"network/"+e.shortname+"/"}},m=function(e,t,n,r){return function(i){return i[e]===t?i[n]:r}},p={US_COUNTRY_CODE:s,ADMIN_TYPE:"admin",CHARTER_TYPE:"charter",AFFILIATE_TYPE:"affiliate",CALL_CENTER_SHORTNAME:"fhcallcenter",NO_FEE_TYPE:"no-fee",PERCENTAGE_FEE_TYPE:"percentage-fee",FLAT_FEE_TYPE:"flat-fee",TIERED_FEE_TYPE:"tiered-fee",WATERFALL_FEE_TYPE:"waterfall-fee",ROLLING_WINDOW_PERIOD_TYPE:"rolling-window-period",IMMEDIATE_PERIOD_TYPE:"immediate-period",REFUND_RESERVE_AMOUNT_FORMAT:"fixed",REFUND_RESERVE_PERCENT_FORMAT:"percent",US_PROCESSOR_COUNTRY:"US",ADMIN_SHORTNAME:"admin",isAdmin:function(e){return e&&e.shortname===p.ADMIN_SHORTNAME},MONTH_VIEW:"month",DAY_VIEW:"day",AGENDA_VIEW:"agenda",GRID_VIEW:"grid",TIMELINE_VIEW:"timeline",AVAILABILITY_TIMELINE:"availability",RESOURCE_TIMELINE:"resource",MANIFEST_AVAILABILITIES_VIEW:"availabilities",MANIFEST_ITEMS_VIEW:"items",MANIFEST_BOOKINGS_VIEW:"bookings",MANIFEST_RUNS_VIEW:"runs",MANIFEST_RESOURCES_VIEW:"resources",TAKE_PAYMENT_PREFERENCE:"take",INFO_PAYMENT_PREFERENCE:"info",SKIP_PAYMENT_PREFERENCE:"skip",DEPOSIT_PAYMENT_PREFERENCE:"deposit",FH_BLUE:"#0a6ece",DEFAULT_TIERED_FEE_SCHEDULE:[{cutoff:0,rate:"0.06"}],DEFAULT_PRE_LOCATION_HEADING:T("Before we begin:"),DEFAULT_START_LOCATION_HEADING:T("Please meet us at:"),DEFAULT_PRIMARY_LOCATION_HEADING:T("We're headed to:"),DEFAULT_END_LOCATION_HEADING:T("We will end at:"),forObject:function(e){if(e)return e.cls===p.cls?e:e.cls===le.cls?e.payment.company:e.company},INVOICE_FEE_RATE:1.9,INVOICE_FLAT_FEE:30,ONLINE_INSTALLMENTS_FEE_RATE:3,ONLINE_INSTALLMENTS_MINIMUM_FEE:100,COUNTRIES:c,COUNTRY_CODES:l,getCountryDefaults:function(e){var n=t.get("db").slipstream("countryDefaults");return _.isUndefined(n)?(console.warn("getCountryDefaults: country defaults data undefined"),[]):n[e]},getCurrencyChoices:u,getCurrencyCodes:function(){var e=t.get("db").slipstream("currencies");return _.isUndefined(e)?(console.warn("getCurrencyCodes: currency data undefined"),[]):_.keys(e)},DEFAULT_LANGUAGE:"en-us",DEFAULT_INCLUDED_TAX_PERCENTAGE_BY_COUNTRY:{AU:10},DEFAULT_TAX_DISPLAY_NAME:T("Taxes"),DEFAULT_TAX_DISPLAY_NAMES:{AU:"GST"},IDEAL_COUNTRY_CODES:["NL"],IDEAL_CURRENCIES:["eur"],SOFORT_COUNTRY_CODES:["AT","BE","DE","IT","NL","ES"],SOFORT_CURRENCIES:["eur"],BANCONTACT_CURRENCIES:["eur"],taxDisplayName:function(e){return e.features.taxDisplayName?e.features.taxDisplayName:p.DEFAULT_TAX_DISPLAY_NAMES[e.processorCountry]||p.DEFAULT_TAX_DISPLAY_NAME},COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE:"company_locale_default",ANONYMOUS_USER_LOCALE_DEFAULT_TIME_FORMAT_TYPE:"user_locale_default",TWELVE_HOUR_TIME_FORMAT_TYPE:"12_hour",TWENTY_FOUR_HOUR_TIME_FORMAT_TYPE:"24_hour",FALLBACK_SERVER_EXACT_TWELVE_HOUR_TIME_FORMAT:"g:iA",FALLBACK_SERVER_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:"H:i",FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT:"h:mma",FALLBACK_CLIENT_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:"HH:mm",FALLBACK_CLIENT_TOP_OF_HOUR_TWELVE_HOUR_TIME_FORMAT:"ha",FALLBACK_CLIENT_TOP_OF_HOUR_TWENTY_FOUR_HOUR_TIME_FORMAT:"HH:mm",FAST_PAYOUT_TIMEZONES:["US/Eastern","US/Central","US/Mountain","US/Arizona","US/Pacific"],isFastPayoutsAvailable:function(e){return!1},isSofortPaymentSupported:function(e){return _.contains(p.SOFORT_CURRENCIES,e.processorCurrency)},isBancontactPaymentSupported:function(e){return _.contains(p.BANCONTACT_CURRENCIES,e.processorCurrency)},hasMultipleProcessorsEnabled:function(e){return e.enabledProcessorTypes.length>1},isAnyWaiverEnabled:function(e){return e.isSmartwaiverEnabled||e.features.isWherewolfEnabled},effectiveIsCartEnabled:function(e){var n=t.get("rebook");return void 0!==e&&e.features.isCartEnabled&&null===n.currentBooking}},f=_.map([p.MONTH_VIEW,p.DAY_VIEW,p.AGENDA_VIEW,p.GRID_VIEW,p.TIMELINE_VIEW],(function(e){return[e,_.capitalize(e)]})),h=_.filter(f,(function(e){return e[0]!==p.DAY_VIEW}));p.dashboardBookingsViewChoices=function(e){return e?f:h},p.rollingWindowDays=m("payoutPeriodType",p.ROLLING_WINDOW_PERIOD_TYPE,"rollingWindowDays",0),p.flatFee=m("feeType",p.FLAT_FEE_TYPE,"flatFee",0),p.percentageFeeRate=m("feeType",p.PERCENTAGE_FEE_TYPE,"percentageFeeRate",0);var g={OWNER_TYPE:"owner",ADMIN_TYPE:"admin",EMPLOYEE_TYPE:"employee",ONLINE_TYPE:"online",ICS_RESELLER_KEY_NAME:"ICS Calendar",ACTIVE_PASSWORD_STATUS:"active",EXPIRED_PASSWORD_STATUS:"expired",INVALIDATED_PASSWORD_STATUS:"invalidated",TEMPORARY_PASSWORD_STATUS:"temporary",showNag:function(e,t,n){if(!e)return console.error("User.showNag: No user."),!1;var r=e.nags[t];return!(!r||!n&&r.isDismissed)},hasAnyNags:function(e){return!_.all(e.nags,"isDismissed")},getActive:function(e){return _.filter(e,"isInactive",!1)},sortActiveFirst:function(e){return _.sortBy(e,(function(e){return[e.isInactive,e.name.toLowerCase()]}))},displayName:function(e){return e.isInactive?e.name+" "+T("(deactivated)"):e.name}},y={verboseName:T("resource"),verboseNamePlural:T("resources"),NONE_GRANULARITY:"none",bookingResources:function(e){return _.sortBy(_.unique(_.flatten(_.map(e.customers,(function(e){return _.pluck(e.resourceUses,"resourceRequirement.resource")})))),"name")},displayName:function(e){return e.name+(e.isArchived?" "+T("(archived)"):"")}},v={verboseName:T("resource requirement"),verboseNamePlural:T("resource requirements"),name:function(e){return e.isItemLevel?e.shortName+" ("+e.item.name+")":e.shortName}},E={BOOKING_TYPE:"booking",CUSTOMERS_TYPE:"customers",FOR_ALL_CUSTOMER_PROTOTYPES:T("Every customer"),isApplicable:function(e,t){if(t=_.isArray(t)?t:[t],e.type!==E.CUSTOMERS_TYPE)return!1;if(e.requirementGroup.isItemLevel){var n=_.pluck(e.customerPrototypeRequirements,"customerPrototype");return!n.length||_.intersection(n,_.pluck(t,"customerPrototype")).length>0}var r=_.pluck(e.customerTypeRequirements,"customerType");return!r.length||_.intersection(r,_.pluck(t,"customerPrototype.customerType")).length>0},forCustomerPrototypes:function(t){return t.type===E.BOOKING_TYPE?T("Whole booking"):t.customerPrototypeRequirements.length||t.customerTypeRequirements.length?t.requirementGroup.isItemLevel?_.map(t.customerPrototypeRequirements,(function(t){var n=t.customerPrototype;return n.customerType.isHidden?n.customerType.name+" "+T("(deleted)"):n.name||e("name")(n.customerType)})).join(", "):_.map(t.customerTypeRequirements,(function(t){var n=t.customerType;return n.isHidden?n.name+" "+T("(deleted)"):e("name")(n)})).join(", "):E.FOR_ALL_CUSTOMER_PROTOTYPES}},b={START_TIMING:"start-timing",END_TIMING:"end-timing",DATE_TIMING:"date-timing",PADDING_END_AT_KIND:"padding-kind",LENGTH_END_AT_KIND:"length-kind",SEATING_LABELS:{isSingleSeatGroupRequired:cT("party refers to people on a booking, groups refers to groups of seats in a venue","don't allow split parties across groups"),isEmptySeatGroupRequired:T("make groups exclusive"),isEntireSeatMapRequired:T("fill all seats once booked")},times:function(e,t){var n,r,i=e.timing;i===b.START_TIMING?n=t.startAt.clone():i===b.END_TIMING?n=t.endAt.clone():i===b.DATE_TIMING?n=t.startAt.clone().startOf("day"):console.error("ResourceRequirement.times: invalid timing "+i),n.subtract(e.startAtHours,"hours");var a=e.endAtKind,o=e.endAtHours;return a===b.PADDING_END_AT_KIND?r=t.endAt.clone().add(o,"hours"):a===b.LENGTH_END_AT_KIND?r=n.clone().add(e.hours,"hours"):console.error("ResourceRequirement.times: invalid endAtKind "+a),{startAt:n,endAt:r}},allowedZones:function(e){var t=e.resource.settings.seatZones,n=e.settings.seatZones;return n.length&&(t=_.intersection(t,n)),_.toTrueKeys(t)},displayableSeatingSettings:function(e){return _.reduce(e.settings,(function(e,t,n){var r=b.SEATING_LABELS[n];return r&&t&&e.push(_.capitalize(r)),e}),[])}},C="seat",k={displayOption:function(e){return e?e.isIgnoreOveruse?T("Create uses, don't check overuse"):e.isSkipResourceUseCreation?T("Don't create uses, check overuse"):T("Create uses, check overuse"):""},equals:function(e,t){return _.isUndefined(e.customerTypeRate)||_.isUndefined(t.customerTypeRate)?e.booking.pk===t.booking.pk&&e.resourceRequirement.pk===t.resourceRequirement.pk&&e.useCount===t.useCount:e.customerTypeRate.pk===t.customerTypeRate.pk&&e.resourceRequirement.pk===t.resourceRequirement.pk&&e.useCount===t.useCount},resourceUseSummaryKey:function(e,t){return e+"-"+t},isSeatResource:function(e){return!(!e.company.features.isSeatingEnabled||!e.seat&&!e.resourceRequirement.resource.seatMapPk)},isAnySeatableResourceUses:function(e){return!!e.company.features.isSeatingEnabled&&_.any(e.customers,(function(e){return _.any(e.resourceUses,k.isSeatResource)}))},seatableResourceUses:function(e){return _.filter(_.flatten(_.pluck(e.customers,"resourceUses")),k.isSeatResource)},seatedResourceUses:function(e){return _.filter(_.flatten(_.pluck(e.customers,"resourceUses")),"seat")},newResourceUseKey:function(e){return[C,e.requirementPk,e.customerTypeRatePk,e.customerIndex,e.seatIndex].join(":")},isNewResourceUseKey:function(e){return _.isString(e)&&_.startsWith(e,C)},isNewResourceUseKeyForCustomerTypeRate:function(e,t){return k.isNewResourceUseKey(e)&&_.int(_.split(e,":")[2])===t.pk},setNewResourceUseKeySeatIndexToZero:function(e){var t=_.split(e,":");return k.newResourceUseKey({requirementPk:t[1],customerTypeRatePk:t[2],customerIndex:t[3],seatIndex:0})},useCountsTotal:function(e){return _.sum(e,"useCount")},displayArchivedResource:function(e){return e.resourceRequirement.resource.isArchived?T("(archived)"):""}},A={RELATED_FEATURE_FLAG:"isSeatingEnabled",DEFAULT_SEAT_SIZE:28,MAX_SEAT_SIZE:40,MIN_SEAT_SIZE:20,style:function(e,t){t?(delete t.$center,delete t.$index):_.forEach(e.seats,(function(e){e.seatGroup&&(delete e.seatGroup.$center,delete e.seatGroup.$index)})),_.forEach(e.seats,(function(e){t&&e.seatGroupPk!==t.pk||e.$style&&e.$style()}))},maxZoom:function(e){return A.MAX_SEAT_SIZE-e.settings.seatSize},minZoom:function(e){return A.MIN_SEAT_SIZE-e.settings.seatSize}},P={verboseName:T("group"),FORM_FIELDS:["rotation","xNudge","yNudge"],RELATED_FEATURE_FLAG:"isSeatingEnabled"},S={forBooking:function(e){return _.flatten(_.pluck(e.customers,"seatAssignments"))},isAnyForBooking:function(e){return _.any(S.forBooking(e))},sortBySeatMap:function(e){return _.sortBy(_.compact(S.forBooking(e)),"seat.seatMap.settings.displayName")},displayableSeatAssignment:function(e){var t=e.seatMap.settings,n=[];return t.isSeatZoneVisible&&n.push(e.seatZone.name),t.isSeatGroupVisible&&n.push(e.seatGroup.name),t.isSeatNameVisible&&n.push(e.name),n.join(", ")},fromResourceUse:function(e){return{seat:e.seat}}},O={UNLIMITED:"unlimited",CAPACITY_CHOICES:[[0,0],[1,1],["unlimited",T("Unlimited")]],FORM_FIELDS:["name","isNameVisible","width","height","rotation","xNudge","yNudge","capacity","seatZonePk","seatGroupPk"],RELATED_FEATURE_FLAG:"isSeatingEnabled",verboseName:T("seat"),getOverlappingSeat:function(e,t){return _.find(t,(function(t){return O.isOverlappingOtherSeat(e,t)?t:null}))},isOverlappingOtherSeat:function(e,t){if(e===t)return!1;var n=e.xCoord+e.width-1,r=e.yCoord+e.height-1;if(n<t.xCoord||r<t.yCoord)return!1;var i=t.xCoord+t.width-1,a=t.yCoord+t.height-1;return!(i<e.xCoord||a<e.yCoord)},newPositions:function(e,t,n){var r=0,i=0,a=_.min(e,(function(e){return e.xCoord+e.yCoord})),o=_.map(e,(function(e){var o=t+(e.xCoord-a.xCoord),s=n+(e.yCoord-a.yCoord);return r=o<r?o:r,i=s<i?s:i,{xCoord:o,yCoord:s}}));return(r<0||i<0)&&_.forEach(o,(function(e){e.xCoord-=r,e.yCoord-=i})),o},defaultSeat:function(e,t,n,r){return{name:"",isNameVisible:!1,width:1,height:1,capacity:1,rotation:0,xNudge:0,yNudge:0,seatZonePk:n,seatGroupPk:r,xCoord:e,yCoord:t}},commonSeatGroup:function(e,t){var n=_.unique(_.pluck(e,"seatGroupPk"));if(1!==n.length)return null;var r=n[0];return _.findWhere(t,{pk:r})},isBookable:function(e){return _.filter(e,(function(e){return 0!==e.capacity}))}},I={verboseName:T("zone"),RELATED_FEATURE_FLAG:"isSeatingEnabled"},R={MAX_COLOR:12,DEFAULT_RECEIPT_FOOTER:cT('"order" as in sales order',"Thanks for your order!"),FOLLOW_UP_AFTER_END_TYPE:"availability-end",FOLLOW_UP_AFTER_START_TYPE:"availability-start",isValidColor:function(e){return _.isNumber(e)&&0<=e&&e<=R.MAX_COLOR},images:function(e,t){var n=[];return e.images.length?n=[].concat(e.images):e.imageCdnUrl&&(n=[{croppedUrl:e.imageCdnUrl,imageCdnUrl:e.imageCdnUrl}]),t&&t.availabilityHeadline&&t.availabilityHeadline.imageCdnUrl&&n.unshift({croppedUrl:t.availabilityHeadline.imageCdnUrl,imageCdnUrl:t.availabilityHeadline.imageCdnUrl}),n},checklistName:function(e){var t=e.name;return e.isPrivate?t="<span class='badge badge-lock ghost'>"+T("Private")+"</span> "+t:e.isUnlisted&&(t="<span class='badge'>"+T("Unlisted")+"</span> "+t),e.shortName&&(t=t+" <span class='fh-grey'>("+e.shortName+")</span>"),t},isSeatingConfirmationsEnabled:function(e){return e.company.features.isSeatingEnabled&&e.settings.isSeatingConfirmationsEnabled},isDepositRequired:function(e){return e.effectiveIsDepositEnabled&&e.settings.isDepositRequired&&!e.settings.isBookingFeeOnly},verboseName:T("item"),verboseNamePlural:T("items")},N={NO_FLOW:{pk:!1,name:T("None")},PAGE_TYPE:"page",LINK_TYPE:"link",ITEM_TYPE:"item",FLOW_QUERY:"flow",IS_FROM_CART_QUERY:"from-cart",WIDTH_ONE_THIRD:"1-3",WIDTH_HALF:"1-2",WIDTH_TWO_THIRDS:"2-3",WIDTH_FULL:"1-1",HEIGHT_1:1,HEIGHT_2:2,HEIGHT_3:3,singleItemRedirect:function(e){return e&&e!==N.NO_FLOW&&N.isAllItems(e)&&e.emptyPageChildren&&1===e.emptyPageChildren.length?e.emptyPageChildren[0].item:null},effectiveChildren:function(e){var t=e.children;return N.isAllItems(e)&&(t=e.emptyPageChildren),t||[]},childItems:function(e){return _.compact(_.pluck(N.effectiveChildren(e),"item"))},childPages:function(e){return _.filter(e.children,{type:N.PAGE_TYPE})},isCalendarIncluded:function(e){if(!e.isCalendarIncluded)return!1;var t=N.effectiveChildren(e);return _.any(t,(function(e){return e.type===N.PAGE_TYPE||e.type===N.ITEM_TYPE&&!e.item.isRetail}))},breadcrumbName:function(e){return e.shortName||e.name},isAllItems:function(e){return 0===e.childrenCount},isSingleLevelFlow:function(e){return r.assert(e.children&&e.breadcrumbs,"Flow node must be fully loaded"),!(e.breadcrumbs.length>0||N.childPages(e).length>0)},gridColumnCount:function(e){var t=N.effectiveChildren(e).length;return t>=6||3===t?3:t>=4||2===t?2:1},defaultBlockWidth:function(e){if(!N.isAllItems(e))return N.WIDTH_ONE_THIRD;var t=N.gridColumnCount(e);return 3===t?N.WIDTH_ONE_THIRD:2===t?N.WIDTH_HALF:N.WIDTH_FULL},emptyGridBlockCount:function(e){if(!N.isAllItems(e))return 0;var t=N.gridColumnCount(e),n=N.effectiveChildren(e).length%t;return n?t-n:0},heading:function(e){return e.properties.heading||(e.item?e.item.name:e.name)},subheading:function(e){return e.properties.subheading?e.properties.subheading:e.item?e.item.headline:""},imageUrl:function(e){return e.imageCdnUrl?e.imageCdnUrl:e.item?e.item.imageCdnUrl||(e.item.images.length?e.item.images[0].croppedCdnUrl:null):null},imageMaxWidth:function(e){return e.properties.width?N.isTallBlock(e)?null:N.imageMinWidth(e):550},imageMaxHeight:function(e){return e.properties.width&&N.isTallBlock(e)?N.imageMinHeight(e):null},imageMinWidth:function(e){switch(e.properties.width){case N.WIDTH_ONE_THIRD:return 604;case N.WIDTH_HALF:return 920;case N.WIDTH_TWO_THIRDS:return 1236;case N.WIDTH_FULL:return 1868;default:return 0}},imageMinHeight:function(e){switch(e.properties.height){case N.HEIGHT_1:return 332;case N.HEIGHT_2:return 692;case N.HEIGHT_3:return 1052;default:return 0}},isTallBlock:function(e){return e.properties.height>N.HEIGHT_1&&(e.properties.width===N.WIDTH_ONE_THIRD||e.properties.width===N.WIDTH_HALF)||e.properties.width===N.WIDTH_TWO_THIRDS&&e.properties.height===N.HEIGHT_3},WIDTH_LABELS:{}};N.WIDTH_LABELS[N.WIDTH_ONE_THIRD]="one-third",N.WIDTH_LABELS[N.WIDTH_HALF]="half",N.WIDTH_LABELS[N.WIDTH_TWO_THIRDS]="two-thirds",N.WIDTH_LABELS[N.WIDTH_FULL]="full";var w={includeArchivedAndHiddenOnRequirement:function(e,t){if(!t)return e;var n=_.pluck(t.customerTypeRequirements,"customerType");return _.union(_.reject(e,"isHidden"),n)},suffix:function(e){return e.isHidden?T("(deleted)"):e.isArchived?T("(archived)"):""}},U={includeArchivedAndHiddenOnRequirement:function(e,t){if(!t)return e;var n=_.pluck(t.customerPrototypeRequirements,"customerPrototype");return _.union(_.reject(e,"isHidden"),n)},name:function(e){return e.displayName},customerTypeSuffix:function(e){var t=e.customerType;if(t.isHidden)return T("(deleted)");var n=e.isExclusive?T("exclusive"):"",r=t.isArchived?T("archived"):"",i="";e.name&&(i=t.shortName||t.singular);var a=_.compact([i,n,r]).join(", ");return a&&(a="("+a+")"),a},group:function(e){return e.customerType.isArchived?T("Archived"):e.isHidden?T("Deleted"):T("Active")},groupOrder:function(e){return e.customerType.isArchived?3:e.isHidden?2:1}},F={effectiveMinimumPartySize:function(e){return null!==e.minimumPartySize?e.minimumPartySize:e.customerPrototype.minimumPartySize},effectiveMaximumPartySize:function(e){return null!=e.maximumPartySize?e.maximumPartySize:e.customerPrototype.maximumPartySize},find:function(e,t,n){var r;return n||(r=_.find(e,(function(e){return e.customerPrototype===t.customerPrototype}))),r||(r=_.find(e,(function(e){return e.customerPrototype.customerType===t.customerPrototype.customerType}))),r}},D={dropdownLabel:function(e,t){var n=e.name;return e!==t||e.item||(n+=" "+T("(shared)")),e.isArchived&&(n+=" "+T("(archived)")),n}},L={ANY_CONDITIONS_TYPE:"any",ALL_CONDITIONS_TYPE:"all",isVisibleDueToConditions:function(e,t,n){return!e.isHidden&&(!e.customFieldInstanceConditions.length||(e.conditionsType===L.ANY_CONDITIONS_TYPE?_.any:_.all)(e.customFieldInstanceConditions,(function(e){return M.isMatch(e,t,n)})))},find:function(e,t){return _.contains(e,t)?t:_.find(e,{customField:t.customField})}},M={SELECTED_TYPE:"selected",NOT_SELECTED_TYPE:"not-selected",EXACT_TYPE:"exact",NOT_EXACT_TYPE:"not-exact",SELECTED_NOT_EXACT_TYPE:"selected-ne",RANGE_TYPE:"range",SELECTED_OPTIONS:[{name:T("is not empty"),value:"selected"},{name:T("is empty"),value:"not-selected"}],EXACT_OPTIONS:[{name:T("is not empty"),value:"selected"},{name:T("is empty"),value:"not-selected"},{name:T("is:"),value:"exact"},{name:T("is not:"),value:"selected-ne"},{name:T("is empty or not:"),value:"not-exact"}],RANGE_OPTIONS:[{name:T("is in range:"),value:"range"}],isValidParent:function(e){return _.contains([Q.SHORT_TYPE,Q.YES_NO_TYPE,Q.CODE_GENERATOR_TYPE,Q.EXTENDED_OPTION_TYPE,Q.MULTI_CAMPAIGN_TYPE,Q.COUNT_TYPE],e.customField.type)},types:function(e){if(M.needsExactValue(e)){var t=M.EXACT_OPTIONS;return e.customField.type===Q.COUNT_TYPE&&(t=t.concat(M.RANGE_OPTIONS)),t}return M.SELECTED_OPTIONS},needsExactValue:function(e){return _.contains([Q.SHORT_TYPE,Q.EXTENDED_OPTION_TYPE,Q.COUNT_TYPE],e.customField.type)},needsCustomField:function(e){return _.contains([M.EXACT_TYPE,M.NOT_EXACT_TYPE,M.SELECTED_NOT_EXACT_TYPE,M.RANGE_TYPE],e.type)},isMatch:function(e,t,n){var r=(n=n||{})[e.uri];if(!_.isUndefined(r))return r;n[e.uri]=!1;var i=e.parentCustomFieldInstance;if(!i||i.isHidden)return!1;if(!L.isVisibleDueToConditions(i,t,n))return!1;var a=e.type,o=t(i);if(a===M.SELECTED_TYPE)r=!!o;else if(a===M.NOT_SELECTED_TYPE)r=!o;else if(a===M.EXACT_TYPE)r=e.exactValue===o;else if(a===M.NOT_EXACT_TYPE)r=!o||e.exactValue!==o;else if(a===M.SELECTED_NOT_EXACT_TYPE)r=!!o&&e.exactValue!==o;else if(a===M.RANGE_TYPE){var s=e.properties;r=s.rangeStart<=o&&o<=s.rangeEnd}else r=!1;return n[e.uri]=r,r},rawValue:function(e){return e.type===M.RANGE_TYPE?e.properties:e.exactValue}},x={CHECKED_IN_TYPE:"checked-in",NO_SHOW_TYPE:"no-show",MIXED_CHECKIN_STATUS:{pk:"mixed",name:T("Set check-in per customer..."),type:"mixed"},EMPTY_CHECKIN_STATUS:{pk:"",name:T("Not yet checked in")},RELATED_FEATURE_FLAG:"isCheckinEnabled",isCheckedIn:function(e){return e&&e.type===x.CHECKED_IN_TYPE},isNoShow:function(e){return e&&e.type===x.NO_SHOW_TYPE},isMixed:function(e){return e===x.MIXED_CHECKIN_STATUS},bookingCheckinStatus:function(e){if(e&&e.customers&&e.customers.length){var t=e.customers[0]?e.customers[0].checkinStatus:null;return _.every(e.customers,{checkinStatus:t})?t:x.MIXED_CHECKIN_STATUS}},bookingCheckinStatusObject:function(e){return x.bookingCheckinStatus(e)||x.EMPTY_CHECKIN_STATUS},bookingCheckinBreakdown:function(e){var t={};_.forEach(e.customers,(function(e){var n=e.customerTypeRate.customerPrototype.customerType,r=e.checkinStatus||null,i=n.uri+":"+(r?r.uri:""),a=t[i]||{count:0,customerType:n,checkinStatus:r};a.count+=1,t[i]=a}));var n=i(_.values(t),(function(e){return e.checkinStatus?[0,e.checkinStatus.type===je.CheckinStatus.NOT_CHECKED_IN_TYPE?1:0,e.checkinStatus.sortableIndex,e.customerType.sortableIndex]:[1,2,0,e.customerType.sortableIndex]}));return _.map(n,(function(e){var t=e.customerType.shortName||a(e.count,e.customerType.singular,e.customerType.plural),n=e.checkinStatus?e.checkinStatus.name:T("not checked in");return e.count.toString()+" "+t+" "+n})).join(", ")},checkinStatusClass:function(e){return e?e.type:"not-checked-in"},checkinStatusSort:function(e){return[!!e,x.isCheckedIn(e),x.isMixed(e),x.isNoShow(e),e?e.sortableIndex:0]}},B=function(e){return function(t){return $.effectiveBookingRestriction(t,e)}},$={AUTO_STATUS:"auto",OPEN_STATUS:"open",CALL_STATUS:"call",CLOSED_STATUS:"closed",CANCELLED_STATUS:"cancelled",DISPLAY_STATUS_BY_STATUS:{auto:T("Auto close"),open:T("Open"),call:T("Closed & Call to book"),closed:T("Closed & hidden"),cancelled:T("Cancelled")},displayStatus:function(e){return $.DISPLAY_STATUS_BY_STATUS[e]},cutoffReachedStart:function(e){var t=$.cutoffReachedKind(e),n=$.cutoffReachedHours(e);return We.cutoffStart(t,n,e.utcStartAt)},cutoffUnreachedStart:function(e){var t=$.cutoffUnreachedKind(e),n=$.cutoffUnreachedHours(e);return We.cutoffStart(t,n,e.utcStartAt)},effectiveBookingRestriction:function(e,t){return e.bookingRestriction?e.bookingRestriction[t]:e.item.bookingRestriction?e.item.bookingRestriction[t]:e.item[t]},soldOutText:B("soldOutText"),isBookableEverByPhone:B("isBookableEverByPhone"),cutoffReachedKind:B("cutoffReachedKind"),cutoffReachedHours:B("cutoffReachedHours"),cutoffUnreachedKind:B("cutoffUnreachedKind"),cutoffUnreachedHours:B("cutoffUnreachedHours"),isInPast:function(e){var t=e.utcEndAt,n=e.hasCustomers?$.cutoffReachedStart(e):$.cutoffUnreachedStart(e);return Math.max(t.unix(),n.unix())<moment().unix()},isCancelled:function(e){return e.status===$.CANCELLED_STATUS},isBookableByDashboardUser:function(e){var n=t.get("auth");return!$.isCancelled(e)||n.permissions.can("bookCancelled",$,e.company)},minimumPartySize:function(e){return e.hasCustomers?$.effectiveBookingRestriction(e,"minimumSubsequentPartySize"):$.effectiveBookingRestriction(e,"minimumInitialPartySize")},maximumPartySize:function(e){return e.hasCustomers?$.effectiveBookingRestriction(e,"maximumSubsequentPartySize"):$.effectiveBookingRestriction(e,"maximumInitialPartySize")},blockedCustomerCount:function(e){return _.sum(e.blocks,"customerCount")},reservedCapacity:function(e){return _.sum(e.blocks,"reservedCapacity")},customFieldInstances:function(e){var t=[];return _.forEach(e.customerTypeRates,(function(e){_.ref.append(t,e.customerPrototype.customFieldInstances)})),_.ref.append(t,_.get(e.customFieldInstanceGroup,"customFieldInstances")),t},isEligibleForAutoFollowUpEmail:function(e){return e.item.isFollowUpEnabled},isEligibleForAutoReminderEmail:function(e){return e.item.isReminderEnabled},isEligibleForAutoReminderSms:function(e){return e.company.isSmsEnabled&&e.item.isSmsReminderEnabled},hasBookingWaiver:function(e){var t=e.bookings;return _.any(t,(function(e){return H.hasBookingLevelWaiver(e)||q.hasCustomerLevelWaiver(e.customers)}))},AFFILIATE_SORT_ORDER:"affiliate",LAST_BOOKED_AT_SORT_ORDER:"lastBookedAt",LAST_BOOKED_BY_SORT_ORDER:"lastBookedBy",CONTACT_NAME_SORT_ORDER:"name",PAID_STATUS_SORT_ORDER:"status",PAX_COUNT_SORT_ORDER:"paxCount"},G={COMPLETED_TYPE:"completed",PENDING_TYPE:"pending",items:function(e){return H.uniqueItems(e.allBookings)},isNoTax:function(e){return _.all(e.contributingBookings,"availability.item.isNoTax")},receiptFooter:function(e){var t=_.uniq(_.map(G.items(e),"receiptFooter"));return 1===t.length&&t[0]?t[0]:R.DEFAULT_RECEIPT_FOOTER},showTaxByType:function(e){return e.company.features.isTaxTypeBreakdownEnabled&&!(Ge.LEGACY_TAX_TYPE_PK in e.contributingBookingCosts.totalCost.taxByType)}},Y={COUNTRIES:c},V="rebook",K="cancel",H={CANCELLED_STATUS:"cancelled",UNCANCELLED_STATUS:"uncancelled",PAID_PAID_STATUS:"paid",UNPAID_PAID_STATUS:"unpaid",OVERPAID_PAID_STATUS:"overpaid",UNDERPAID_PAID_STATUS:"underpaid",COMPLETED_TYPE:"completed",PENDING_TYPE:"pending",nonZeroGeneratedStoredValueCards:function(e){return _.filter(e.generatedStoredValueCards,(function(e){return e.balance>0}))},isEligibleForDeposit:function(e,t,n){return e.effectiveIsDepositEnabled&&t>0&&t<n&&(e.settings.depositModifierKind===Ce.PERCENTAGE_MODIFIER_KIND||e.settings.depositOffset<n)&&(!e.settings.isMinimumBookingAmountForDepositOptionRequired||e.settings.minimumBookingAmountForDepositOption<=n)},effectiveDeposit:function(e,t){if(t<=0)return 0;var n=0;return e.settings.depositModifierKind===je.PriceLine.OFFSET_MODIFIER_KIND?n=e.settings.depositOffset:e.settings.depositModifierKind===je.PriceLine.PERCENTAGE_MODIFIER_KIND&&(n=_.roundHalfToEven(e.settings.depositRate*t)),n},paymentsAndRefunds:function(e){var t=_.append.apply(null,_.map(_.reject(e.payments,"isHold"),"refunds"));return _.ref.append(t,e.payments),_.sortBy(t,"createdAt")},adjustBookingFee:function(e,t,n,r){var i=t+n;if(!i)return e;if(!r)return e;if(r<i){var a=i-r;return _.roundHalfToEven(e*(a/i))}return 0},affiliateCompany:function(e){return e.affiliation?e.affiliation.affiliateCompany:void 0},newTransportation:function(e){if(e.customFieldValues)return _.find(e.customFieldValues,(function(e){return e.customFieldInstance.customField.type===Q.NEW_TRANSPORTATION_TYPE}));console.warn("models.Booking.newTransportation: booking has no custom field values")},waiverCustomFields:function(e){var t=[],n=function(e){return Q.isWaiverType(e.customFieldInstance.customField)},r=function(e){return e.customFieldInstance.customField},i=_.map(_.filter(e.customFieldValues,n),r),a=[];if(_.forEach(e.customers,(function(e){a.push(_.map(_.filter(e.customFieldValues,n),r))})),a=_.flatten(a),(t=t.concat(a,i)).length)return _.uniq(t,"pk");console.warn("models.Booking.waivers: booking has no waiver custom fields")},hasBookingLevelWaiver:function(e){var t=e.customFieldValues;return _.any(t,(function(e){return je.CustomField.isWaiverType(e.customFieldInstance.customField)}))},hasWaiverType:function(e){return this.hasBookingLevelWaiver(e)||je.Customer.hasCustomerLevelWaiver(e.customers)},generatedCustomFields:function(e){var t={};_.forEach(e.generatedCodes,(function(e){var n=e.generatingCampaign,r=n.customField,i=t[r.uri]||{customField:r,generatedCampaigns:{}};t[r.uri]=i;var a=i.generatedCampaigns[n.uri]||{generatingCampaign:n,generatedCodes:[]};i.generatedCampaigns[n.uri]=a,a.generatedCodes.push(e)}));var n=_.sortBy(_.values(t,(function(e){return e.customField.name})));return _.forEach(n,(function(e){e.generatedCampaigns=_.sortBy(_.values(e.generatedCampaigns,(function(e){return e.generatingCampaign.campaign.name})))})),n},isEligibleForAutoFollowUpEmail:function(e){return e.item.isFollowUpEnabled&&!e.availability.isFollowUpDisabled&&e.contact.email},isEligibleForAutoReminderEmail:function(e){return e.item.isReminderEnabled&&!e.availability.isReminderDisabled&&e.contact.email},isEligibleForAutoReminderSms:function(e){return e.company.isSmsEnabled&&e.item.isSmsReminderEnabled&&!e.availability.isSmsReminderDisabled&&e.isSmsEnabled&&te.isEligiblePhoneNumber(e.contact.phone,e.contact.phoneCountry,e.contact.company)},isEligibleForReviewExpress:function(e){return e.item.isReviewExpressEnabled&&e.contact.email},isEligibleForOnlineBookingAction:function(e,t){var n=e.paidStatus===H.PAID_PAID_STATUS,r=_.filter(e.payments,(function(e){return!e.isRefunded&&!e.isProcessorBasedType})),i=!1;return t===V?i=e.company.features.isOnlineRebookingEnabled:t===K&&(i=e.company.features.isOnlineCancellationEnabled),!e.isCancelled&&n&&!r.length&&e.company.features.isCancellationPoliciesEnabled&&i&&!!e.effectiveCancellationRule&&e.effectiveCancellationRule.isCancellationAllowed&&!!e.contact&&!!e.contact.email},isEligibleForOnlineCancellation:function(e){return(!$.isInPast(e.availability)||$.isCancelled(e.availability))&&H.isEligibleForOnlineBookingAction(e,K)},isEligibleForOnlineRebooking:function(e){if(e.isAffiliate)return!1;if($.isInPast(e.availability)||e.availability.item.isRetail)return!1;var t=_.filter(e.payments,(function(e){return!e.isRefunded&&!!e.processorType}));return!(_.uniq(_.pluck(t,"processorType")).length>1)&&H.isEligibleForOnlineBookingAction(e,V)},charterInvoiceRevenue:function(e){return e.affiliation?e.invoicedToCharter+e.invoiceableToCharter:null},charterInvoiceOwed:function(e){return e.affiliation?e.invoicedToAffiliate+e.invoiceableToAffiliate:null},isEligibleForCancellation:function(e,t){if(!e.company.features.isCancellationPoliciesEnabled)return!1;if(!e.effectiveCancellationRule)return!1;if(!e.effectiveCancellationRule.isCancellationAllowed)return!1;var n=t?t.company:null;return!e.affiliation||e.affiliation.affiliateCompany!==n||!_.any(e.payments,(function(e){return!e.isDeferred&&!e.isCollectedByAffiliate}))},isEligibleForRebook:function(e,t){return H.isEligibleForCancellation(e,t)},itemsInOrder:function(e){return e.isOrder?_.uniq(_.pluck(e.order.allBookings,"item")):[e.item]},hasEmailableDisputes:function(e){return _.some(e.payments,(function(e){return ce.isOpenDisputeStatus(e)}))},customerTypeRateCountKey:function(e){return"customerTypeRate:"+e.pk+"-count"},customerCardKey:function(e,t){return e.pk.toString()+"-"+t.toString()},customFieldInstanceKeyPrefix:function(e,t,n,r){var i;return i=_.isObject(t)?t.cls===F.cls?H.customerCardKey(t,n):t.key:_.isString(t)?t:"booking",_.isNumber(r)&&(i+="-pushed-"+r),"customFieldInstance"+e.pk+"For:"+i},customFieldInstanceKey:function(e,t,n,r){return H.customFieldInstanceKeyPrefix(e,t,n,r)+"-value"},adjustedPriceKeyPrefix:function(e,t,n){var r=_.isModelObject(e)?H.customFieldInstanceKeyPrefix(e,t,null,n):e;return r?r+"-"+$e.ADJUSTED_PRICE_KEY_PREFIX:$e.ADJUSTED_PRICE_KEY_PREFIX},clearCustomFieldValuesFromModel:function(e,t,n,r){var i=je.Booking.customFieldInstanceKey(t,n,null,r);delete e[i];var a=H.adjustedPriceKeyPrefix(t,n,r);_.forEach(["offset","rate","invoiceOffset","invoiceRate"],(function(t){delete e[a+t]}))},uniqueItems:function(e){return _.uniq(_.map(e,"item"))},effectivePrimaryLocation:function(e){var t=e.availability.item,n=t.startLocation,r=t.primaryLocation;return r||t.isCustomPrimaryLocation||(r=e.company.defaultItemPrimaryLocation),r&&n&&r.pk===n.pk&&(r=null),r},showTaxByType:function(e){return e.company.features.isTaxTypeBreakdownEnabled&&null===e.explicitGross&&!(Ge.LEGACY_TAX_TYPE_PK in e.costs.totalCost.taxByType)},hasPushedCustomFieldInstancesNotOnAvailability:function(e,t){var n=[];return _.forEach(e.customers,(function(e){_.ref.append(n,_.filter(e.customFieldValues,"isPushed"))})),_.ref.append(n,_.filter(e.customFieldValues,"isPushed")),!!n.length&&_.difference(_.pluck(n,"customFieldInstance"),$.customFieldInstances(t)).length>0},calculateOnlineInstallmentAmounts:function(e,t,n,i,a,o){if(!i||0===n)return{gross:0,fee:0,tax:0};var s=e.features.onlineInstallmentsMinimumFee,c=t.tax>0&&i>0&&0==t.price,l=1;t.price>0&&(l=t.tax/t.price);var u=t.tax/t.total,d=i*u,m=0;t.price>0&&(m=t.feeable/t.price);var p=i*(t.feeable/t.total),f=e.features.onlineInstallmentsFeeRate,h=f*m,g=a||0==p?0:Math.max(p*f,s),y=n===_.roundHalfToEven(i+g);if(!n)return console.log("Preview installment amounts"),console.log("Calculated gross:",i),console.log("Calculated fee:",g),{gross:i,fee:_.roundHalfToEven(g),tax:_.roundHalfToEven(d)};if(a||c)return d=_.roundHalfToEven(n*u),console.log("Online deposits / tax only installment amounts"),console.log("Calculated gross:",n),console.log("Calculated fee:",0),{gross:n,fee:0,tax:d};var v=0,T=n;y?(console.log("Pay in full installment amounts"),T=(v=i/(l+1))*(h+l+1),v*h<s&&t.feeable>0&&(T=v+v*l+s)):(console.log("Partial payment installment amounts"),(v=n/(h+l+1))*h<s&&t.feeable>0&&(v=(n-s)/(l+1)));var E=_.roundHalfToEven(v*l),b=_.roundHalfToEven(v+E),C=_.roundHalfToEven(T-b);if(o=o||c,C=je.Company._minimumFee(C,t.price,o,s),!y){var k=n-(b+C);k>0?b+=k:k<0&&(C+=k)}console.log("Calculated gross:",b),console.log("Calculated fee:",C),console.log("Calculated tax:",E),console.log("Calculated rounded total:",_.roundHalfToEven(T));var A="Online installment:"+n+" must equal gross ("+b+") + booking fee ("+C+")";return r.assert(C+b===n,A),{gross:b,fee:b>0?C:0,tax:E}},onlineInstallmentAmountsPreview:function(e,t,n,r,i){return H.calculateOnlineInstallmentAmounts(e,t,null,n,r,i)},onlineInstallmentMinimumAmount:function(e,t){var n=t.company.features.onlineInstallmentsMinimumFee,r=t.costs.totalCost.feeable,i=t.isDeposit,a=t.isOnline;return!r||i&&a?e:n+e},onlineInstallmentMaximumAmount:function(e){var t=H.onlineInstallmentAmountsPreview(e.company,e.costs.totalCost,e.amountDue,je.Booking.isOnlineDeposit(e),e.item.isFreeAllowed);return t.gross+t.fee},isOnlineDeposit:function(e){return e.isDeposit&&e.originalUserType===je.User.ONLINE_TYPE},updateResourceUses:function(e,t){var n=_.groupBy(t,"booking.pk");_.forEach(e,(function(e){e.resourceUses=n[e.pk];var t=_.groupBy(e.resourceUses,"customer.pk");e.bookingLevelResourceUses=t[void 0],_.forEach(e.customers,(function(e){e.resourceUses=t[e.pk]}))}))}},q={hasCustomerLevelWaiver:function(e){return _.any(e,(function(e){var t=e.customFieldValues;return je.CustomerCustomFieldValue.hasWaiverType(t)}))}},W={OTHER_AGENT:{name:T("Add new agent"),pk:-1}},j={OTHER_DESK:{name:T("Add new desk"),pk:-1}},z={PERCENTAGE_COMMISSION_TYPE:"percentage",FLAT_COMMISSION_TYPE:"flat",AFFILIATE_TAKE_PAYMENT_PREFERENCE:"affiliate-take",CARD_ON_FILE_PAYMENT_PREFERENCE:"card-on-file",TAKE_PAYMENT_PREFERENCE:p.TAKE_PAYMENT_PREFERENCE,INFO_PAYMENT_PREFERENCE:p.INFO_PAYMENT_PREFERENCE,SKIP_PAYMENT_PREFERENCE:p.SKIP_PAYMENT_PREFERENCE,MAX_SELECTABLE_AFFILIATES:400,isOnlineBookingEnabled:function(e){var t=e.affiliateGroup&&e.affiliateGroup.groupPermissions;return t&&t.canCreateBookings},verboseName:T("affiliate"),verboseNamePlural:T("affiliates"),name:function(e){return e?e.affiliateCompany?e.affiliateCompany.name:e.unicode:""}},X={NEW_STATUS:"new",PENDING_STATUS:"pending",RUNNING_STATUS:"running",FAILED_STATUS:"failed",SUCCEEDED_STATUS:"succeeded",CANCELLED_STATUS:"cancelled",ALL_PARTNER_FILTER_OPTION:"all",DIRECT_PARTNER_FILTER_OPTION:"direct",ALL_AFFILIATE_FILTER_OPTION:"all",DIRECT_AFFILIATE_FILTER_OPTION:"direct",ALL_ITEM_FILTER_OPTION:"all",ALL_USER_FILTER_OPTION:"all",ONLINE_USER_FILTER_OPTION:"online",ORIGINAL_USER_TYPE_FILTER_OPTION:"original",CURRENT_USER_TYPE_FILTER_OPTION:"current",ALL_CANCELLED_BOOKINGS_FILTER_OPTION:"all",NO_CANCELLED_BOOKINGS_FILTER_OPTION:"none",NON_REFUNDED_CANCELLED_BOOKINGS_FILTER_OPTION:"non-refunded",ONLY_CANCELLED_BOOKINGS_FILTER_OPTION:"only",ALL_TRANSACTION_TAG_FILTER_OPTION:"all",ALL_SALESPERSON_FILTER_OPTION:"all",ALL_DISPUTE_STATUS_FILTER_OPTION:"all",ALL_CLOSED_DISPUTE_STATUS_FILTER_OPTION:"all-closed",ALL_OPEN_DISPUTE_STATUS_FILTER_OPTION:"all-open",ALL_CURRENCY_FILTER_OPTION:"all",UNCANCELLED_FILTER_OPTION:"uncancelled",REFUNDED_CANCELLED_FILTER_OPTION:"refunded",UNREFUNDED_CANCELLED_FILTER_OPTION:"unrefunded",ADVANCED_TYPE:"advanced",emptyFilters:function(){return _.mapValues(je.Report.MODELS,(function(){return[]}))},emptyColumns:function(){return _.mapValues(je.Report.MODELS,(function(){return{}}))},emptyCompanyOptions:function(e){return _.keyBy(e,"pk",(function(e){var t={};return e.isCharter&&(t.filters=X.emptyFilters()),e.isAffiliate&&(t.selectedAllPartners=void 0,t.allPartnerFilters=X.emptyFilters(),t.partners={},t.selectedPartners={}),t}))},emptyReportOptions:function(e){return{modelName:"",presetDateRange:"",startDate:"",endDate:"",dateType:"",filters:X.emptyFilters(),companies:X.emptyCompanyOptions(e),selectedCharters:{},selectedAffiliates:{},groups:[],isDetailed:"",columns:X.emptyColumns(),isOpened:!1,customFieldValueModel:""}},defaultGroups:function(){return[X.ITEM_GROUP]},datetimeGroups:function(){return[X.BOOKING_CREATED_AT_HOUR_GROUP,X.BOOKING_CANCELLED_AT_HOUR_GROUP,X.CUSTOMER_CHECKIN_STATUS_LAST_MODIFIED_AT_HOUR_GROUP,X.LINE_ITEM_CREATED_AT_HOUR_GROUP,X.AVAILABILITY_START_AT_HOUR_GROUP,X.PAYMENT_OR_REFUND_CREATED_AT_HOUR_GROUP,X.STORED_VALUE_CARD_CREATED_AT_HOUR_GROUP]},defaultBookingCancelledStatusFilter:function(){return{type:X.CANCELLED_STATUS_FILTER_TYPE,data:{value:[X.UNCANCELLED_FILTER_OPTION,X.UNREFUNDED_CANCELLED_FILTER_OPTION]}}},defaultFilters:function(){return _.extend(X.emptyFilters(),{Booking:[X.defaultBookingCancelledStatusFilter()]})},defaultBookingColumns:function(){return _.toTrueKeys([X.BOOKING_COUNT_COLUMN,X.BOOKING_ID_COLUMN,X.BOOKING_BOOKED_BY_COLUMN,X.CREATED_AT_COLUMN,X.AVAILABILITY_DATETIME_COLUMN,X.TOTAL_COST_PRICE_COLUMN,X.TOTAL_COST_TAX_COLUMN,X.TOTAL_COST_TOTAL_COLUMN,X.CONTACT_NAME_COLUMN,X.CUSTOMER_COUNT_COLUMN,X.AFFILIATE_COLUMN,X.VOUCHER_NUMBER_COLUMN,X.INVOICEABLE_TO_CHARTER_COLUMN,X.INVOICEABLE_TO_AFFILIATE_COLUMN,X.RECEIPT_PROCESSING_FEE_COLUMN,X.COLLECTED_TOTAL_COST_TOTAL_COLUMN,X.RECEIPT_NET_COLUMN])},defaultCustomerColumns:function(){return _.toTrueKeys([X.CUSTOMER_COUNT_COLUMN,X.TOTAL_COST_PRICE_COLUMN,X.TOTAL_COST_TAX_COLUMN,X.TOTAL_COST_TOTAL_COLUMN,X.COLLECTED_TOTAL_COST_PRICE_COLOUMN,X.COLLECTED_TOTAL_COST_TAX_COLOUMN,X.COLLECTED_TOTAL_COST_TOTAL_COLUMN])},defaultCustomFieldValueColumns:function(){return _.toTrueKeys([X.USE_COUNT_COLUMN,X.TOTAL_COST_PRICE_COLUMN,X.TOTAL_COST_TAX_COLUMN,X.TOTAL_COST_TOTAL_COLUMN,X.COLLECTED_TOTAL_COST_PRICE_COLOUMN,X.COLLECTED_TOTAL_COST_TAX_COLOUMN,X.COLLECTED_TOTAL_COST_TOTAL_COLUMN])},defaultResourceUseColumns:function(){return _.toTrueKeys([X.USE_COUNT_COLUMN])},defaultLineItemColumns:function(){return _.toTrueKeys([X.CREATED_AT_COLUMN,X.TOTAL_COST_PRICE_COLUMN,X.TOTAL_COST_TAX_COLUMN,X.TOTAL_COST_TOTAL_COLUMN,X.LINE_ITEM_DESCRIPTION_COLUMN])},defaultStoredValueCardColumns:function(){return _.toTrueKeys([X.CREATED_AT_COLUMN,X.STORED_VALUE_CARD_TYPE_COLUMN,X.STORED_VALUE_CARD_NUMBER_COLUMN])},defaultPaymentProcessingDocumentColumns:function(){return _.toTrueKeys([X.PAYMENT_PROCESSING_DOCUMENT_NUMBER_COLUMN,X.PAYMENT_PROCESSING_DOCUMENT_TOTAL_COLUMN,X.PAYMENT_PROCESSING_DOCUMENT_PERIOD_COLUMN])},defaultPaymentColumns:function(){return _.toTrueKeys([X.CREATED_AT_COLUMN,X.PAYMENT_OR_REFUND_COLUMN,X.PAYMENT_OR_REFUND_ID_COLUMN,X.PAYMENT_TYPE_COLUMN,X.PAYMENT_AND_REFUND_GROSS_COLUMN,X.PAYMENT_AND_REFUND_PROCESSING_FEE_COLUMN,X.PAYMENT_AND_REFUND_NET_COLUMN,X.PAYMENT_COUNT_COLUMN,X.REFUND_COUNT_COLUMN,X.PAYMENT_TOTAL_TAX_COLUMN,X.REFUND_TOTAL_PRICE_COLUMN])},defaultPaymentColumnsWithTax:function(){return _.extend(X.defaultPaymentColumns(),_.toTrueKeys([X.PAYMENT_AND_REFUND_TOTAL_TAX_COLUMN]))},defaultCustomerReportColumns:function(){return _.extend(X.emptyColumns(),{Customer:X.defaultCustomerColumns(),Booking:_.toTrueKeys([X.BOOKING_ID_COLUMN,X.BOOKING_COUNT_COLUMN,X.CUSTOMER_COUNT_COLUMN,X.TOTAL_COST_TOTAL_COLUMN])})},defaultColumns:function(){return _.extend(X.emptyColumns(),{Booking:X.defaultBookingColumns(),Customer:X.defaultCustomerColumns(),CustomFieldValue:X.defaultCustomFieldValueColumns(),ResourceUse:X.defaultResourceUseColumns(),LineItem:X.defaultLineItemColumns(),StoredValueCard:X.defaultStoredValueCardColumns(),PaymentProcessingDocument:X.defaultPaymentProcessingDocumentColumns()})},paymentTypeChoicesForCompany:function(e,t){var n={};return n[ce.IDEAL_PROCESSOR_BASED_TYPE]="isIdealPaymentsEnabled",n[ce.SOFORT_PROCESSOR_BASED_TYPE]="isSofortPaymentsEnabled",n[ce.BANCONTACT_PROCESSOR_BASED_TYPE]="isBancontactPaymentsEnabled",_.filter(e,(function(e){if(_.has(n,e.value)){var r=n[e.value];return t.features[r]}return!0}))},defaultReportOptions:function(e){var t=_.defaults({dateType:X.AVAILABILITY_DATE_TYPE,presetDateRange:X.YESTERDAY_DATE_RANGE,isDetailed:!1,groups:X.defaultGroups(),columns:X.defaultColumns(),filters:X.defaultFilters(),customFieldValueModel:Ye.cls},X.emptyReportOptions(e)),n=e[0];return t.selectedCharters[n.pk]=n.isCharter,t.selectedAffiliates[n.pk]=!n.isCharter&&n.isAffiliate,t}},Q={STACK_PRICING_TYPE:"stack",CURRENT_PRICING_TYPE:"current",INITIAL_PRICING_TYPE:"initial",ZERO_PRICING_TYPE:"zero",SHORT_TYPE:"short",LONG_TYPE:"long",YES_NO_TYPE:"yes-no",EXTENDED_OPTION_TYPE:"extended-option",HEADER_TYPE:"header",NOTE_TYPE:"note",TRANSPORTATION_TYPE:"transportation",NEW_TRANSPORTATION_TYPE:"new-transportation",CODE_TYPE:"code",MULTI_CAMPAIGN_TYPE:"multi-campaign",CODE_GENERATOR_TYPE:"code-generator",CARD_GENERATOR_TYPE:"card-generator",COUNT_TYPE:"count",SMARTWAIVER_TYPE:"waiver",WHEREWOLF_TYPE:"wherewolf-waiver",WAIVER_TYPES:["waiver","wherewolf-waiver"],DISPLAY_ONLY_TYPES:["note","header"],isWaiverType:function(e){return _.contains(Q.WAIVER_TYPES,e.type)},defaultCount:function(e){return e.type!==Q.COUNT_TYPE?"":e.countMin<=0&&e.countMax>=0?0:e.countMin},suggestedAmounts:function(e){if(e.type!==Q.CARD_GENERATOR_TYPE)return[];var t=e.cardSuggestedAmount||2500;return[t,2*t,4*t]},isDisplayOnly:function(e){return _.contains(Q.DISPLAY_ONLY_TYPES,e.type)},isManifestField:function(e){return!Q.isDisplayOnly(e)&&!_.contains([Q.NEW_TRANSPORTATION_TYPE,Q.CODE_GENERATOR_TYPE,Q.SMARTWAIVER_TYPE,Q.WHEREWOLF_TYPE],e.type)},isAggregatable:function(e){return _.contains([je.CustomField.EXTENDED_OPTION_TYPE,je.CustomField.CODE_TYPE,je.CustomField.MULTI_CAMPAIGN_TYPE,je.CustomField.YES_NO_TYPE,je.CustomField.TRANSPORTATION_TYPE,je.CustomField.COUNT_TYPE],e.type)},usesCheckbox:function(e){return _.contains([Q.YES_NO_TYPE,Q.CODE_GENERATOR_TYPE],e.type)},needsRequired:function(e){return!Q.isDisplayOnly(e)&&!_.contains([Q.TRANSPORTATION_TYPE,Q.COUNT_TYPE],e.type)},needsPricing:function(e){return _.contains([Q.YES_NO_TYPE,Q.CODE_TYPE,Q.CODE_GENERATOR_TYPE,Q.CARD_GENERATOR_TYPE,Q.NEW_TRANSPORTATION_TYPE,Q.COUNT_TYPE],e.type)},needsAlwaysPerCustomer:function(e){return Q.needsPricing(e)||_.contains([Q.EXTENDED_OPTION_TYPE],e.type)},pricedByValue:function(e){return e.type===Q.CARD_GENERATOR_TYPE},pricedByOptions:function(e){return _.contains([Q.EXTENDED_OPTION_TYPE,Q.MULTI_CAMPAIGN_TYPE],e.type)},isAdjustableType:function(e){return _.contains([Q.YES_NO_TYPE,Q.EXTENDED_OPTION_TYPE,Q.COUNT_TYPE],e.type)},needsBookingNotes:function(e){return _.contains([Q.CODE_TYPE,Q.CODE_GENERATOR_TYPE,Q.CARD_GENERATOR_TYPE,Q.MULTI_CAMPAIGN_TYPE,Q.YES_NO_TYPE,Q.TRANSPORTATION_TYPE,Q.NEW_TRANSPORTATION_TYPE,Q.EXTENDED_OPTION_TYPE,Q.COUNT_TYPE],e.type)},needsHint:function(e){return _.contains([Q.SHORT_TYPE,Q.LONG_TYPE,Q.CODE_TYPE,Q.NEW_TRANSPORTATION_TYPE,Q.MULTI_CAMPAIGN_TYPE],e.type)},hasExtraOptions:function(e){return _.contains([Q.EXTENDED_OPTION_TYPE,Q.TRANSPORTATION_TYPE,Q.MULTI_CAMPAIGN_TYPE],e.type)},isDefaultValueAllowed:function(e){return _.contains(Q.DEFAULT_VALUE_TYPES,e.type)},isValidRawValue:function(e,t,n){return e.type===Q.EXTENDED_OPTION_TYPE?""===t||_.isNumber(t)&&_.find(e.extendedOptions,{pk:t}):e.type!==Q.COUNT_TYPE||(n===M.RANGE_TYPE?!(t.rangeStart>e.countMax||t.rangeEnd<e.countMin):_.isNumber(t)&&t>=e.countMin&&t<=e.countMax)},displayForRawValue:function(e,t,n){if(e.type===Q.EXTENDED_OPTION_TYPE){if(""===t)return"";var r=_.find(e.extendedOptions,{pk:t});return r?o(r):"Deleted option"}return e.type===Q.YES_NO_TYPE?t?"Yes":"No":n===M.RANGE_TYPE?t.rangeStart+" — "+t.rangeEnd:_.isUndefined(t)||null===t?"":t.toString()},isOptionAvailable:function(e,t){if(""===t)return!0;var n=e.type;return n===Q.EXTENDED_OPTION_TYPE?_.some(e.extendedOptions,(function(e){return e.pk===t})):n===Q.TRANSPORTATION_TYPE?_.some(e.transportationOptions,(function(e){return e.pk===t})):n!==Q.COUNT_TYPE||t>=e.countMin&&t<=e.countMax},autofillValue:function(e,t,n){if(!_.isUndefined(t)){var r=e.customField;if(Q.isOptionAvailable(r,t))return n&&r.type===Q.NEW_TRANSPORTATION_TYPE&&(t=void 0),_.clone(t)}},verboseName:T("custom field"),verboseNamePlural:T("custom fields"),dropdownName:function(e){return"["+e.shortDisplayType+"] "+e.name}};_.extend(Q,{GROUPED_TYPES:{text:[Q.SHORT_TYPE,Q.LONG_TYPE],checkbox:[Q.YES_NO_TYPE,Q.CODE_GENERATOR_TYPE],dropdown:[Q.EXTENDED_OPTION_TYPE],quantity:[Q.COUNT_TYPE],transportation:[Q.NEW_TRANSPORTATION_TYPE,Q.TRANSPORTATION_TYPE],code:[Q.MULTI_CAMPAIGN_TYPE,Q.CODE_TYPE],label:[Q.HEADER_TYPE],waiver:[Q.SMARTWAIVER_TYPE,Q.WHEREWOLF_TYPE],"gift-card":[Q.CARD_GENERATOR_TYPE]},groupedType:function(e){return _.findKey(Q.GROUPED_TYPES,(function(t){return _.contains(t,e)}))},DEFAULT_VALUE_TYPES:[Q.SHORT_TYPE,Q.YES_NO_TYPE,Q.CODE_GENERATOR_TYPE,Q.EXTENDED_OPTION_TYPE,Q.COUNT_TYPE],DEPRECATED_TYPES:[Q.NOTE_TYPE,Q.CODE_TYPE,Q.TRANSPORTATION_TYPE],disabledTypes:function(e){var t=[].concat(Q.DEPRECATED_TYPES);return e.features.isTransportationEnabled||t.push(je.CustomField.NEW_TRANSPORTATION_TYPE),t},enabledTypesForCompany:function(e){var n=t.get("db").slipstream("customFieldChoices");return _.filter(n,(function(t){return!_.includes(Q.disabledTypes(e),t[0])}))},group:function(e){return e.isArchived?T("Archived"):e.isHidden?T("Deleted"):T("Active")}});var Z=function(e){return _.some(e.payments,(function(e){return e.type!==ce.AFFILIATE_TYPE&&!e.isDeferred&&!e.isRefunded}))},J=function(e){return _.some(e.payments,(function(e){return e.type!==ce.AFFILIATE_TYPE&&!e.isDeferred&&!!e.refundCount}))},ee={AVAILABILITY_MANIFEST_TYPE:"availability-manifest",ORDER_CONFIRMATION_TYPE:"order-confirmation",ORDER_CANCELLATION_TYPE:"order-cancellation",ORDER_RECEIPT_TYPE:"order-receipt",ORDER_REFUNDED_TYPE:"order-refunded",ORDER_SHARE_TYPE:"order-share",BANK_ACCOUNT_CHANGE_TYPE:"bank-account-change",BOOKING_CANCELLATION_TYPE:"booking-cancellation",BOOKING_CONFIRMATION_TYPE:"booking-confirmation",BOOKING_FOLLOW_UP_TYPE:"booking-follow-up",BOOKING_MESSAGE_TYPE:"booking-message",BOOKING_RECEIPT_TYPE:"booking-receipt",BOOKING_REBOOKED_TYPE:"booking-rebooked",BOOKING_REFUNDED_TYPE:"booking-refunded",BOOKING_REMINDER_TYPE:"booking-reminder",BOOKING_SHARE_TYPE:"booking-share",NOTIFICATION_FAILURE_TYPE:"notification-failure",CREW_CHANGE_TYPE:"crew-change",CREW_REMINDER_TYPE:"crew-reminder",DAILY_MANIFEST_TYPE:"daily-manifest",DISPUTE_TYPE:"dispute",INVOICE_PAYMENT_REQUEST_TYPE:"invoice-payment-request",INVOICE_UPLOAD_STATUS_UPDATE_TYPE:"invoice-upload-status-update",STORED_VALUE_CARD_TYPE:"stored-value-card",FAILED_ONLINE_PAYMENTS_TYPE:"failed-online-payments",PROCESSOR_VERIFICATION_REQUIRED_TYPE:"processor-verification-required",displayType:function(e){var t=e.replace("booking-","").replace("order-","");return _.capitalize(t)},notificationTypesForOrder:function(e){var t=[];return e.contributingBookingCount&&t.push(ee.ORDER_CONFIRMATION_TYPE),_.any(e.allBookings,Z)&&t.push(ee.ORDER_RECEIPT_TYPE),_.any(e.allBookings,J)&&t.push(ee.ORDER_REFUNDED_TYPE),_.any(e.allBookings,"isCancelled")&&t.push(ee.ORDER_CANCELLATION_TYPE),t},notificationTypesForBooking:function(e){if(e.rebookedTo)return[];var t=[];return e.isCancelled?t.push(ee.BOOKING_CANCELLATION_TYPE):e.rebookedFrom?(t.push(ee.BOOKING_REBOOKED_TYPE),t.push(ee.BOOKING_REMINDER_TYPE),t.push(ee.BOOKING_CONFIRMATION_TYPE)):(t.push(ee.BOOKING_CONFIRMATION_TYPE),t.push(ee.BOOKING_REMINDER_TYPE)),Z(e)&&t.push(ee.BOOKING_RECEIPT_TYPE),J(e)&&t.push(ee.BOOKING_REFUNDED_TYPE),t.push(ee.BOOKING_MESSAGE_TYPE),t.push(ee.BOOKING_FOLLOW_UP_TYPE),t},isPreviewable:function(e){return _.contains([ee.ORDER_CANCELLATION_TYPE,ee.ORDER_CONFIRMATION_TYPE,ee.BOOKING_CANCELLATION_TYPE,ee.BOOKING_CONFIRMATION_TYPE,ee.BOOKING_FOLLOW_UP_TYPE,ee.BOOKING_MESSAGE_TYPE,ee.BOOKING_REMINDER_TYPE,ee.INVOICE_PAYMENT_REQUEST_TYPE,ee.BOOKING_RECEIPT_TYPE],e)},isSubjectEditable:function(e){return _.contains([ee.BOOKING_CANCELLATION_TYPE,ee.BOOKING_FOLLOW_UP_TYPE,ee.BOOKING_MESSAGE_TYPE,ee.BOOKING_REBOOKED_TYPE,ee.BOOKING_RECEIPT_TYPE,ee.BOOKING_REFUNDED_TYPE,ee.ORDER_RECEIPT_TYPE,ee.ORDER_REFUNDED_TYPE],e)},filterByType:function(e,t){return _.filter(e,(function(e){return e.type===t}))},bookingConfirmationNotifications:function(e){return ee.filterByType(e,ee.BOOKING_CONFIRMATION_TYPE)},bookingFollowUpNotifications:function(e){return ee.filterByType(e,ee.BOOKING_FOLLOW_UP_TYPE)},bookingRebookedNotifications:function(e){return ee.filterByType(e,ee.BOOKING_REBOOKED_TYPE)},bookingReminderNotifications:function(e){return ee.filterByType(e,ee.BOOKING_REMINDER_TYPE)},invoicePaymentRequestNotifications:function(e){return ee.filterByType(e,ee.INVOICE_PAYMENT_REQUEST_TYPE)},UNKNOWN_STATUS:"unknown",PROCESSED_STATUS:"processed",DEFERRED_STATUS:"deferred",DELIVERED_STATUS:"delivered",USER_OPENED_STATUS:"open",USER_CLICKED_URL_STATUS:"click",BOUNCE_STATUS:"bounce",DROPPED_STATUS:"dropped",USER_REPORTED_SPAM_STATUS:"spamreport",USER_UNSUBSCRIBED_STATUS:"unsubscribe",isOpened:function(e){return _.contains([ee.USER_OPENED_STATUS,ee.USER_CLICKED_URL_STATUS,ee.USER_REPORTED_SPAM_STATUS,ee.USER_UNSUBSCRIBED_STATUS],e)},isFailed:function(e){return _.contains([ee.BOUNCE_STATUS,ee.DROPPED_STATUS],e)},subjectForDisputeType:function(e){return interpolate(T("[Response Needed] New Dispute for Booking #%(bookingId)s (%(personName)s)"),{bookingId:e.pk,personName:e.contact.name})}},te={US_COUNTRY_CODE:s,INTERNATIONAL_ENABLED_COUNTRIES:c,INTERNATIONAL_DISABLED_COUNTRIES:[[s,"USA"]],TEST_NUMBERS:["+15005550001","+15005550002","+15005550003","+15005550004","+15005550006","+15005550009"],INTERNATIONAL_ENABLED_NUMBER_REGEX:/^\+?\d{5,15}$/,INTERNATIONAL_DISABLED_NUMBER_REGEX:/^(\+1|1)?\d{10}$/,INTERNATIONAL_ENABLED_NUMBER_MAX_LENGTH:16,INTERNATIONAL_DISABLED_NUMBER_MAX_LENGTH:12,isTestNumber:function(e){var n="+"+t.get("phoneNumbers").digits(e);return _.contains(te.TEST_NUMBERS,n)},isTestNumberAllowed:function(){return window.slipstream&&"production"!=window.slipstream.configuration&&window.slipstream.isTwilioTestAccountEnabled},isEligiblePhoneNumber:function(e,n,r){if(te.isTestNumberAllowed()&&te.isTestNumber(e))return!0;var i=t.get("phoneNumbers");return!!i.isPossiblyValid(e)&&(n?n===s?i.parseUsPhoneNumber(e).isUsPhoneNumber:r?r.features.isInternationalSmsEnabled:(console.warn("SmsNotification.isEligiblePhoneNumber: company not provided"),!1):!!i.parseUsPhoneNumber(e).isUsPhoneNumber||(r?r.features.isInternationalSmsEnabled:(console.warn("SmsNotification.isEligiblePhoneNumber: company not provided"),!1)))},groupByStatus:function(e){var t=_.groupBy(e,"status"),n=[];return _.forEach(["delivered","sent","pending","queued","sending","rejected","undelivered","failed","invalid"],(function(e){var r=t[e];r&&r.length&&n.push({status:e,displayStatus:r[0].displayStatus,items:r})})),n}},ne={AVAILABILITY_MANIFEST_TYPE:ee.AVAILABILITY_MANIFEST_TYPE,BANK_ACCOUNT_CHANGE_TYPE:ee.BANK_ACCOUNT_CHANGE_TYPE,BOOKING_CONFIRMATION_TYPE:ee.BOOKING_CONFIRMATION_TYPE,BOOKING_CANCELLATION_TYPE:ee.BOOKING_CANCELLATION_TYPE,NOTIFICATION_FAILURE_TYPE:ee.NOTIFICATION_FAILURE_TYPE,CREW_CHANGE_TYPE:ee.CREW_CHANGE_TYPE,CREW_REMINDER_TYPE:ee.CREW_REMINDER_TYPE,DAILY_MANIFEST_TYPE:ee.DAILY_MANIFEST_TYPE,DISPUTE_TYPE:ee.DISPUTE_TYPE,INVOICE_UPLOAD_STATUS_UPDATE_TYPE:ee.INVOICE_UPLOAD_STATUS_UPDATE_TYPE,FAILED_ONLINE_PAYMENTS_TYPE:ee.FAILED_ONLINE_PAYMENTS_TYPE,PROCESSOR_VERIFICATION_REQUIRED_TYPE:ee.PROCESSOR_VERIFICATION_REQUIRED_TYPE,DIRECT_BOOKING_OPTION:"isDirect",ONLINE_BOOKING_OPTION:"isOnline",AFFILIATE_BOOKING_OPTION:"isAffiliate",REBOOKED_BOOKING_OPTION:"isRebooked",isTypeSupported:function(e,t){return t===ne.BANK_ACCOUNT_CHANGE_TYPE||t===ne.PROCESSOR_VERIFICATION_REQUIRED_TYPE?e.isAffiliate||e.isCharter:t===ne.INVOICE_UPLOAD_STATUS_UPDATE_TYPE?(e.isAffiliate||e.isCharter)&&e.isInvoicingEnabled:t===ne.FAILED_ONLINE_PAYMENTS_TYPE?"eur"===e.processorCurrency:e.isCharter},isAnyTypeSupported:function(e){return _.some(ne.TYPES,(function(t){return ne.isTypeSupported(e,t)}))},isUserSubscribed:function(e,t,n){return _.some(e,(function(e){return e.user===t&&e.type===n}))}};ne.TYPES=[ne.AVAILABILITY_MANIFEST_TYPE,ne.BANK_ACCOUNT_CHANGE_TYPE,ne.BOOKING_CANCELLATION_TYPE,ne.BOOKING_CONFIRMATION_TYPE,ne.NOTIFICATION_FAILURE_TYPE,ne.CREW_CHANGE_TYPE,ne.CREW_REMINDER_TYPE,ne.DAILY_MANIFEST_TYPE,ne.DISPUTE_TYPE,ne.INVOICE_UPLOAD_STATUS_UPDATE_TYPE,ne.FAILED_ONLINE_PAYMENTS_TYPE,ne.PROCESSOR_VERIFICATION_REQUIRED_TYPE],ne.ITEM_SUBSCRIPTION_TYPES=[ne.AVAILABILITY_MANIFEST_TYPE,ne.BOOKING_CONFIRMATION_TYPE,ne.BOOKING_CANCELLATION_TYPE,ne.NOTIFICATION_FAILURE_TYPE,ne.CREW_CHANGE_TYPE,ne.CREW_REMINDER_TYPE,ne.DISPUTE_TYPE],ne.HOURS_BEFORE_SUBSCRIPTION_TYPES=[ne.AVAILABILITY_MANIFEST_TYPE,ne.CREW_REMINDER_TYPE,ne.DAILY_MANIFEST_TYPE],ne.HOURS_BEFORE_DEFAULTS={},ne.HOURS_BEFORE_DEFAULTS[ne.AVAILABILITY_MANIFEST_TYPE]=24,ne.HOURS_BEFORE_DEFAULTS[ne.CREW_REMINDER_TYPE]=24,ne.HOURS_BEFORE_DEFAULTS[ne.DAILY_MANIFEST_TYPE]=-6,ne.CREW_AVAILABILITIES_ONLY_TYPES=[ne.AVAILABILITY_MANIFEST_TYPE,ne.BOOKING_CONFIRMATION_TYPE],ne.BOOKING_OPTION_TYPES=[ne.BOOKING_CANCELLATION_TYPE,ne.BOOKING_CONFIRMATION_TYPE],ne.BOOKING_OPTIONS=[ne.DIRECT_BOOKING_OPTION,ne.ONLINE_BOOKING_OPTION,ne.AFFILIATE_BOOKING_OPTION,ne.REBOOKED_BOOKING_OPTION],ne.BOOKING_OPTIONS_BY_TYPE={},ne.BOOKING_OPTIONS_BY_TYPE[ne.BOOKING_CANCELLATION_TYPE]=[ne.DIRECT_BOOKING_OPTION,ne.ONLINE_BOOKING_OPTION,ne.AFFILIATE_BOOKING_OPTION],ne.BOOKING_OPTIONS_BY_TYPE[ne.BOOKING_CONFIRMATION_TYPE]=[ne.DIRECT_BOOKING_OPTION,ne.ONLINE_BOOKING_OPTION,ne.AFFILIATE_BOOKING_OPTION,ne.REBOOKED_BOOKING_OPTION];var re={verboseName:T("public headline"),verboseNamePlural:T("public headlines"),CUSTOM:{name:T("Custom"),pk:-1},NONE:{name:T("None"),pk:null},group:function(e){return e.pk&&e.pk!==re.CUSTOM.pk?T("Public Headlines"):void 0}},ie={CUSTOM:{pk:-1,name:T("Custom"),type:"custom",displayType:T("Other")},ORDER_CONFIRMATION_TYPE:ee.ORDER_CONFIRMATION_TYPE,CANCELLATION_TYPE:ee.BOOKING_CANCELLATION_TYPE,CONFIRMATION_TYPE:ee.BOOKING_CONFIRMATION_TYPE,FOLLOW_UP_TYPE:ee.BOOKING_FOLLOW_UP_TYPE,MESSAGE_TYPE:ee.BOOKING_MESSAGE_TYPE,RECEIPT_TYPE:ee.BOOKING_RECEIPT_TYPE,REBOOKED_TYPE:ee.BOOKING_REBOOKED_TYPE,REFUNDED_TYPE:ee.BOOKING_REFUNDED_TYPE,CUSTOM_TYPE:"custom",INVOICE_PAYMENT_REQUEST_TYPE:ee.INVOICE_PAYMENT_REQUEST_TYPE,TYPES:[ee.BOOKING_CANCELLATION_TYPE,ee.BOOKING_CONFIRMATION_TYPE,ee.BOOKING_FOLLOW_UP_TYPE,ee.BOOKING_MESSAGE_TYPE,ee.BOOKING_RECEIPT_TYPE,ee.BOOKING_REBOOKED_TYPE,ee.BOOKING_REFUNDED_TYPE,ee.INVOICE_PAYMENT_REQUEST_TYPE,"CUSTOM"],BOOKING_TYPES:[ee.BOOKING_CANCELLATION_TYPE,ee.BOOKING_CONFIRMATION_TYPE,ee.BOOKING_FOLLOW_UP_TYPE,ee.BOOKING_MESSAGE_TYPE,ee.BOOKING_RECEIPT_TYPE,ee.BOOKING_REBOOKED_TYPE,ee.BOOKING_REFUNDED_TYPE],ORDER_TYPES:[ee.BOOKING_CANCELLATION_TYPE,ee.BOOKING_CONFIRMATION_TYPE,ee.BOOKING_MESSAGE_TYPE,ee.BOOKING_RECEIPT_TYPE,ee.BOOKING_REFUNDED_TYPE],displayType:ee.displayType},ae={isUsable:function(e,t){var n=t.isAffiliate&&e.isVisibleWhenCollectedByAffiliate,r=t.isCharter&&e.isVisibleWhenCollectedByCharter;return n||r},isVisibleWhenCollectedByCharter:function(e){return _.filter(e,"isVisibleWhenCollectedByCharter")},isVisibleWhenCollectedByAffiliate:function(e){return _.filter(e,"isVisibleWhenCollectedByAffiliate")}},oe={OFFLINE_STATUS:"offline",ONLINE_STATUS:"online",STRIPE_ERRORS:{reader_error:T("Device error."),canceled:T("Payment cancelled."),no_established_connection:T("Device not connected."),no_active_collect_payment_method_attempt:T("Unable to cancel payment."),cancelable_already_completed:T("Unable to cancel payment."),network_error:T("Error connecting to device."),card_declined:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),requires_payment_method:T("Card declined, try a different card (or try again with the same card)."),requires_confirmation:T("Temporary connectivity problem, please try again."),already_connected:T("Connect to reader failed because the reader is already connected."),cancelable_already_canceled:T("Cancellation failed because the operation has already been cancelled."),discovery_too_many_readers:T("Please try again, or contact FareHarbor Support. (S-READERS)"),failed_fetch_connection_token:T("Could not fetch a connection token."),invalid_reader_version:T("Please update the EMV card reader."),network_timeout:T("Network timeout."),no_active_read_reusable_card_attempt:T("An error occurred, please try again."),expired_card:T("Could not process payment because the card is cancelled or expired. Please try a different card."),insufficient_funds:T("Could not process payment because the account has insufficient funds. Please call the card issuer or try another card."),lost_card:T("Could not process payment because the card was reported lost or stolen. Please try a different card."),stolen_card:T("Could not process payment because the card was reported lost or stolen. Please try a different card."),incorrect_pin:cT("PIN is short for Personal Identification Number, used when making card payments","Card declined due to invalid PIN."),call_issuer:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),withdrawal_count_limit_exceeded:T("Could not process payment because the account has insufficient funds. Please call the card issuer or try another card."),payment_intent_is_null:T("Request timed out, please try again.")},ADYEN_ERRORS:{Aborted:T("Payment cancelled."),Busy:T("Device is currently in use."),Cancel:T("Payment cancelled."),DeviceOut:T("Device unexpectedly disconnected, or battery level is too low."),InvalidCard:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),NotAllowed:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),Refusal:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),UnreachableHost:T("Network timeout, please try again"),WrongPIN:cT("PIN is short for Personal Identification Number, used when making card payments","Card declined due to invalid PIN.")},CONNECT_READER_ERROR_CODE:"reader_error",READER_IN_USE_ERROR_MESSAGE:"Reader is currently in use.",UNKNOWN_ERROR:T("Unknown error. Please refresh the page and try again."),CANCELLED_ERROR:T("Payment cancelled")},se={PENDING_STATUS:"pending",DISPUTED_STATUS:"disputed",WON_STATUS:"won",LOST_STATUS:"lost",REFUNDED_STATUS:"refunded",displayStatus:function(e){return _.capitalize(e)}};se.OPEN_STATUSES=[se.PENDING_STATUS,se.DISPUTED_STATUS],se.CLOSED_STATUSES=[se.WON_STATUS,se.LOST_STATUS,se.REFUNDED_STATUS],se.STATUSES=se.OPEN_STATUSES.concat(se.CLOSED_STATUSES);var ce={CC_TYPE:"balanced-cc",LEGACY_CC_TYPE:"cc",IN_STORE_TYPE:"in-store",AFFILIATE_TYPE:"affiliate",STORED_VALUE_CARD_TYPE:"stored-value-card",PENDING_DISPUTE_STATUS:"pending",DISPUTED_DISPUTE_STATUS:"disputed",WON_DISPUTE_STATUS:"won",LOST_DISPUTE_STATUS:"lost",REFUNDED_DISPUTE_STATUS:"refunded",INITIATED_PAYMENT_STATUS:"initiated",PENDING_PAYMENT_STATUS:"pending",FAILED_PAYMENT_STATUS:"failed",SUCCEEDED_PAYMENT_STATUS:"succeeded",IDEAL_PROCESSOR_BASED_TYPE:"ideal",SOFORT_PROCESSOR_BASED_TYPE:"sofort",BANCONTACT_PROCESSOR_BASED_TYPE:"bancontact",AFFILIATE_PAYMENT_TYPE:"affiliate",AFFILIATE_PAYMENT_DISPLAY_TEXT:T("Collected by affiliate"),SOFORT_COUNTRY_CHOICES:[["AT",T("Austria")],["BE",T("Belgium")],["DE",T("Germany")],["IT",T("Italy")],["NL",T("Netherlands")],["ES",T("Spain")]],isOpenDisputeStatus:function(e){return _.contains(ce.OPEN_DISPUTE_STATUES,e.disputeStatus)},isClosedDisputeStatus:function(e){return _.contains(ce.CLOSED_DISPUTE_STATUSES,e.disputeStatus)},isDisputedAndNonRefundable:function(e){return e.disputeStatus===ce.DISPUTED_DISPUTE_STATUS||e.disputeStatus===ce.LOST_DISPUTE_STATUS||e.disputeStatus===ce.REFUNDED_DISPUTE_STATUS},isPaymentInitiated:function(e){return e.status===ce.INITIATED_PAYMENT_STATUS},isPaymentSucceeded:function(e){return e.status===ce.SUCCEEDED_PAYMENT_STATUS},isPaymentPending:function(e){return e.status===ce.PENDING_PAYMENT_STATUS},isPaymentFailed:function(e){return e.status===ce.FAILED_PAYMENT_STATUS},isEmv:function(e){return e.type===ce.CC_TYPE&&e.metadata&&e.metadata.isEmv},isEmvSignatureRequired:function(e){return ce.isEmv(e)&&e.metadata.isEmvSignatureRequired},isPartialRefundAllowed:function(e){return!(!e.receipt.gross||e.isProcessorBasedType&&e.isDisputed&&e.disputeStatus!==ce.WON_DISPUTE_STATUS&&e.disputeStatus!==ce.PENDING_DISPUTE_STATUS)},POSTAL_CODE_VERIFIED_COUNTRIES:["US"],DEMO_CARD_NUMBERS:["4111111111111111","5105105105105100","341111111111111","4242424242424242"],isNotCardOnFileProcessorBasedType:function(e){return ce.isProcessorBasedType(e)&&!e.isCardOnFile},isProcessorBasedType:function(e){return e.type===ce.CC_TYPE||e.type===ce.LEGACY_CC_TYPE},isDemoCardNumber:function(e){return _.contains(ce.DEMO_CARD_NUMBERS,e)},isPostalCodeRequired:function(e,t){return!!_.contains(ce.POSTAL_CODE_VERIFIED_COUNTRIES,e)||"CA"===e&&t},isPostalCodeVerified:function(e){return _.contains(ce.POSTAL_CODE_VERIFIED_COUNTRIES,e)},cardPayments:function(e,t){var n={};return _.forEach(e,(function(e){if(!t&&e.type===ce.CC_TYPE||t&&e.isProcessorBasedType){var r=e.processorBasedType+"-"+e.processorBasedIdentifier;n[r]||(n[r]=e)}})),_.values(n)},relatedCardPayments:function(e,t){return _.union.apply(null,_.map(e.contact.relatedBookings,(function(e){return ce.cardPayments(e.payments,t)})))},isGratuityEnabled:function(e){var t=e.bookings?e.bookings:[e.booking];return _.any(_.map(t,"item"),{isGratuityEnabled:!0})},receiptFooters:function(e){return _.filter(_.map(ce.items(e),"receiptFooter"))},order:function(e){return e.bookings&&e.bookings.length?e.bookings[0].order:null},hasMultipleVisibleContributingBookings:function(e){return!!e.bookings&&e.bookings.length+ +!!e.invisibleBookingCount>1},items:function(e){return e.booking?[e.booking.item]:H.uniqueItems(e.bookings)},sortByCreatedAt:function(e){return _.sortByOrder(e,(function(e){return moment.isMoment(e.createdAt)?e.createdAt.unix():0}),!1)},printablePayments:function(e){var t=_.map(e,(function(e){return e.aggregatedPayment&&e.aggregatedPayment.isAggregated?e.aggregatedPayment:e}));return _.filter(t,(function(e){return!e.isDeferred&&e.type!==ce.AFFILIATE_TYPE}))},taxByType:function(e,t){if(!e.company.features.isTaxTypeBreakdownEnabled)return null;var n,r=t?"initialCosts":"costs";return n=_.isArray(e.payments)?_.reduce(e.payments,(function(e,t){return _.sumObjectValues(e,t[r].totalCost.taxByType)}),{}):e[r].totalCost.taxByType,Ge.LEGACY_TAX_TYPE_PK in n?null:n},holds:function(e){return _.filter(e,(function(e){return e.isHold||e.holdReleasedOn}))},nonHoldPayments:function(e){return _.reject(e,(function(e){return e.isHold||e.holdReleasedOn}))},isActiveHold:function(e){return e.isHold&&e.expiresAt.isAfter(moment())}};ce.OPEN_DISPUTE_STATUES=[ce.PENDING_DISPUTE_STATUS,ce.DISPUTED_DISPUTE_STATUS],ce.CLOSED_DISPUTE_STATUSES=[ce.WON_DISPUTE_STATUS,ce.LOST_DISPUTE_STATUS,ce.REFUNDED_DISPUTE_STATUS];var le={FAILED_TRANSFER_STATUS:"failed",SUCCEEDED_TRANSFER_STATUS:"succeeded",taxByType:function(e){if(!e.payment.company.features.isTaxTypeBreakdownEnabled)return null;var t=e.costs.totalCost.taxByType;return Ge.LEGACY_TAX_TYPE_PK in t?null:t}},ue={ALL_PAYMENT_RECEIPTS:"all",printedAt:function(){return moment()}},de={NO_REPEAT:"none",WEEKLY_REPEAT:"weekly",MONTHLY_REPEAT:"monthly",ALL_DAY_PERIOD:"all-day",TIME_RANGE_PERIOD:"time-range",DAY_RANGE_PERIOD:"day-range",FAILED_STATUS:"failed",SUCCEEDED_STATUS:"succeeded",WEEK_DAYS_KEYS:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],WEEK_DAYS:{sunday:T("Sunday"),monday:T("Monday"),tuesday:T("Tuesday"),wednesday:T("Wednesday"),thursday:T("Thursday"),friday:T("Friday"),saturday:T("Saturday")},WEEK_DAYS_SHORT:{sunday:cT("Abbreviation of Sunday","Su"),monday:cT("Abbreviation of Monday","M"),tuesday:cT("Abbreviation of Tuesday","T"),wednesday:cT("Abbreviation of Wednesday","W"),thursday:cT("Abbreviation of Thursday","Th"),friday:cT("Abbreviation of Friday","F"),saturday:cT("Abbreviation of Saturday","S")},weekDays:function(e){var t=_.clone(de.WEEK_DAYS_KEYS);return e.features.isSundayBased||t.push(t.shift()),t},weekDayShort:function(e){return de.WEEK_DAYS_SHORT[e]},weekDaysDefaultModel:function(){var e={};return _.forEach(de.WEEK_DAYS_KEYS,(function(t){e[t]=!0})),e},defaultRule:function(){var e={period:de.TIME_RANGE_PERIOD,repeat:de.NO_REPEAT,hours:"",time:"",startOn:null,endOn:null};return _.extend(e,de.weekDaysDefaultModel()),e}},me={ADJUSTMENT_TAG:"adjustment",FUND_BOOKING_FEE_PROCESSING_FEE_TAG:"fund-booking-fee",FUND_PROCESSING_FEE_TAG:"fund-processing-fee",OTHER_TAG:"other",PAYMENT_BOOKING_FEE_TAG:"payment-booking-fee",PAYMENT_BOOKING_FEE_PROCESSING_FEE_TAG:"payment-booking-fee-processing-fee",PAYMENT_GROSS_TAG:"payment-gross",PAYMENT_PROCESSING_FEE_TAG:"payment-processing-fee",PAYOUT_TAG:"payout",REFUND_GROSS_TAG:"refund-gross",REFUND_BOOKING_FEE_TAG:"refund-booking-fee",REFUND_BOOKING_FEE_PROCESSING_FEE_TAG:"refund-booking-fee-processing-fee",REFUND_PROCESSING_FEE_TAG:"refund-processing-fee",TRANSFER_TAG:"transfer",UPLOAD_TAG:"upload",UNKNOWN_TAG:"",displayTag:function(e){return e===me.UNKNOWN_TAG?"Unknown":_.capitalize(e.split("-").join(" "))}};me.TAGS=[me.ADJUSTMENT_TAG,me.FUND_BOOKING_FEE_PROCESSING_FEE_TAG,me.FUND_PROCESSING_FEE_TAG,me.OTHER_TAG,me.PAYMENT_BOOKING_FEE_TAG,me.PAYMENT_BOOKING_FEE_PROCESSING_FEE_TAG,me.PAYMENT_GROSS_TAG,me.PAYMENT_PROCESSING_FEE_TAG,me.PAYOUT_TAG,me.REFUND_GROSS_TAG,me.REFUND_BOOKING_FEE_TAG,me.REFUND_BOOKING_FEE_PROCESSING_FEE_TAG,me.REFUND_PROCESSING_FEE_TAG,me.TRANSFER_TAG,me.UPLOAD_TAG,me.UNKNOWN_TAG];var pe=function(e,n,r){if(!n)return!1;var i=t.get("db").slipstream(r);if(!i[e])return!1;var a=i[e];return _.isArray(a)?_.contains(a,n):(console.warn("isCountryApplicable: invalid value",a,r),!1)},fe={INDIVIDUAL_ACCOUNT_HOLDER_TYPE:"individual",COMPANY_ACCOUNT_HOLDER_TYPE:"company",ROUTING_NUMBER_REGEX_BY_COUNTRY:{AU:/^[\d]{6}$/,CA:/^0?[\d]{5}-?[\d]{3}$/,GB:/^[\d]{2}-?[\d]{2}-?[\d]{2}$/,NZ:/^[\d]{6}$/,US:/^[\d]{9}$/},isIbanRequired:function(e,t){return pe(e,t,"processorIbanBankAccountCountries")},isRoutingNumberRequired:function(e,t){return!pe(e,t,"processorIgnoreRoutingNumberCountries")}},he={getCurrencyChoices:u},ge={VALID_VALIDITY:"valid",INVALID_VALIDITY:"invalid",DATE_RANGE_FOR_AVAILABILITY_TYPE:"range-for-booking",DATE_RANGE_FOR_BOOKING_TYPE:"range-for-availability",displayDayPattern:function(e){var t=[ge.DATE_RANGE_FOR_AVAILABILITY_TYPE,ge.DATE_RANGE_FOR_BOOKING_TYPE];if(!_.contains(t,e.type))return"";var n=e.dayPattern||[];return n.length&&n.length!==de.WEEK_DAYS_KEYS.length?_.map(n,(function(e){return de.WEEK_DAYS_SHORT[e]})).join(", "):""}},ye={FLAT_FEE_RULE_TYPE:"flat",MAXIMUM_FEE_RULE_TYPE:"maximum",calculateFeeableForFee:function(e,t){return _.roundHalfToEven(e/t)},calculateFeeableForRule:function(e,t,n){if(e.feeType!==p.PERCENTAGE_FEE_TYPE||!e.percentageFeeRate)return 0;var r=e.percentageFeeRate;if(n.type===ye.FLAT_FEE_RULE_TYPE){var i=n.amount;return ye.calculateFeeableForFee(i,r)}if(n.type===ye.MAXIMUM_FEE_RULE_TYPE){var a=_.roundHalfToEven(t*r),o=n.amount;return a>o?ye.calculateFeeableForFee(o,r):t}return console.warn("StoredValueCard.calculateFeeableForRule: invalid rule type",n.type),0},calculateFeeable:function(e,n){if(!e.features.isStoredValueCardBookingFeesEnabled)return 0;var r=t.get("db").slipstream("storedValueCardFeeableRules");if(_.isUndefined(r))return console.warn("StoredValueCard.calculateFeeable: rules are not defined"),0;var i=e.primaryLocation,a=r[_.get(i,"country")];if(!a)return 0;if(a.isUnrestricted)return n;var o=_.get(i,"province");if(_.contains(a.unrestrictedProvinces,o))return n;var s=a.provinceRules[o];return s?ye.calculateFeeableForRule(e,n,s):0},NUMBER_REGEX:/^[a-zA-Z0-9\-_\#\%$]+$/,isNumberValid:function(e){return ye.NUMBER_REGEX.test(e)}},ve={INVOICE_TYPE:"invoice",CREDIT_NOTE_TYPE:"credit note",AU_B2C_10_FLAVOR:"AU B2C 10",NZ_15_FLAVOR:"NZ 15",CA_5_FLAVOR:"CA 5",CA_13_FLAVOR:"CA 13",CA_15_FLAVOR:"CA 15",NL_21_FLAVOR:"NL 21",EU_0_FLAVOR:"EU 0",OTHER_0_FLAVOR:"OTHER 0",AUS_TAX_RATE:"10%",NL_TAX_RATE:"21%",NZ_TAX_RATE:"15%",CA_5_TAX_RATE:"5%",CA_13_TAX_RATE:"13%",CA_15_TAX_RATE:"15%",CA_PROVINCES:["AB","BC","MB","NB","NL","NS","NT","NU","ON","PE","SK","YT"],statementIdentifier:function(e,t){var n="FHXXX"+("0000000000"+e).slice(-10);return t===ve.INVOICE_TYPE?"I"+n:"C"+n}},Te={MIN_QR_CODE_SIZE:1,MAX_QR_CODE_SIZE:1.3,STANDARD:{name:"Standard",settings:{isCompanyInformationIncluded:!0,isRotated:!1,len:5.5,height:2,marginTop:.125,marginRight:.125,marginBottom:.125,marginLeft:.125,hasLeadingStub:!0,leadingStubLength:1,leadingStubMarginTop:.125,leadingStubMarginBottom:.125,hasTrailingStub:!1,trailingStubLength:1,trailingStubMarginTop:.125,trailingStubMarginBottom:.125,hasCustomFields:!1,hasStubCustomFields:!1}},BLANK:{name:"",settings:{isCompanyInformationIncluded:!0,isRotated:!1,len:5.5,height:2,marginTop:.125,marginRight:.125,marginBottom:.125,marginLeft:.125,hasLeadingStub:!0,leadingStubLength:1,leadingStubMarginTop:.125,leadingStubMarginBottom:.125,hasTrailingStub:!1,trailingStubLength:1,trailingStubMarginTop:.125,trailingStubMarginBottom:.125,hasCustomFields:!1,hasStubCustomFields:!1}},mainLeft:function(e){var t=e.settings.marginLeft;return e.settings.hasTrailingStub&&(t+=e.settings.trailingStubLength),t},mainRight:function(e){var t=e.settings.marginRight;return e.settings.hasLeadingStub&&(t+=e.settings.leadingStubLength),t},qrCodeSize:function(e){var t=e.settings.height-e.settings.marginTop-e.settings.marginBottom;return t<Te.MIN_QR_CODE_SIZE&&(t=Te.MIN_QR_CODE_SIZE),t>Te.MAX_QR_CODE_SIZE&&(t=Te.MAX_QR_CODE_SIZE),t},BOCA_PRINT_FORMAT:"boca",RECEIPT_PRINT_FORMAT:"receipt"},Ee={ADMIN_ONLY_TYPE:"admin",ADMIN_ONLY_TYPES:["admin","admin-charge-disputed","admin-dispute-closed","duplicated-x-companies","duplicated-x-companies-single","generated-report","ran-report","rejected-sms","updated-sms-notification-status","card-error","processor-webhook-error","transferred-payment","was-transferred-payment","webhook-request-failed","webhook-request-succeeded"],CHANGED_TYPES:["changed","changed-company-admin-notes","changed-booking-note","changed-customer-checkin-status"],isAdminOnly:function(e){return _.contains(Ee.ADMIN_ONLY_TYPES,e.type)},isChangedType:function(e){return _.contains(Ee.CHANGED_TYPES,e)},objectUrl:function(e){var t;return e.object&&(t="created"===e.type&&e.object&&e.object.cls===je.Company.cls&&e.context&&e.context.instance?e.context.instance.$url():e.object.cls===je.Item.cls&&"created-availabilities"===e.type?je.Item.calendarUrl(e.object):e.object.$url()),t||(t=e.company.$url()),t},_changesByFieldName:{},changesByFieldName:function(e){var t=Ee._changesByFieldName[e.uri];return t||(t={},_.forEach(e.context.changes,(function(e){t[n.camelKey(e.field)]=e})),Ee._changesByFieldName[e.uri]=t,t)}},_e={isSignedWherewolfWaiver:function(e){return _.isEqual(e.waiverType,"wherewolf")}},be={companyLevelOverrides:function(e){return _.filter(e,(function(e){return null===e.relatedUser}))}},Ce={NO_CUSTOM_TAX:"no",ONLY_TAXED_CUSTOM_TAX:"only-taxed",ALL_CUSTOM_TAX:"all",ALWAYS_CUSTOM_TAX:"always",INHERIT_TAX_INCLUSION:"inherit",INCLUDED_TAX_INCLUSION:"included",NOT_INCLUDED_TAX_INCLUSION:"not-included",INHERIT_PRICE_TYPE:"inherit",CHANGE_PRICE_TYPE:"change",INHERIT_SHEET_RATE_TYPE:"inherit",CHANGE_SHEET_RATE_TYPE:"change",OFFSET_MODIFIER_KIND:"offset",PERCENTAGE_MODIFIER_KIND:"percentage",ADJUST_MODIFIER_TYPE:"adjust",SET_MODIFIER_TYPE:"set",NONE_MODIFIER_TYPE:"none",INHERIT_IS_TAXABLE:"",INHERIT_IS_TAXABLE_LABEL:T("Inherit"),ON_IS_TAXABLE:!0,ON_IS_TAXABLE_LABEL:T("On"),OFF_IS_TAXABLE:!1,OFF_IS_TAXABLE_LABEL:T("Off"),displayTaxInclusion:function(e){var t={};return t[Ce.INHERIT_TAX_INCLUSION]=T("Inherit"),t[Ce.INCLUDED_TAX_INCLUSION]=T("Tax included"),t[Ce.NOT_INCLUDED_TAX_INCLUSION]=T("Tax not included"),t[e]},displayCustomTax:function(e){var t={};return t[Ce.NO_CUSTOM_TAX]=T("Standard tax"),t[Ce.ONLY_TAXED_CUSTOM_TAX]=T("Custom tax"),t[Ce.ALL_CUSTOM_TAX]=T("Custom tax (include untaxed)"),t[Ce.ALWAYS_CUSTOM_TAX]=T("Custom tax (include untaxed, even on untaxed sheets)"),t[e]||t[Ce.NO_CUSTOM_TAX]},isInheritTaxability:function(e){return e.isTaxable!==Ce.OFF_IS_TAXABLE&&e.isTaxable!==Ce.ON_IS_TAXABLE&&!_.any(e.taxTypes,_.isBoolean)},isCustomTaxAllowed:function(e,t){return t.features.isCustomTaxEnabled&&!t.features.isAggregateTaxEnabled&&e.modifierType!==Ce.NONE_MODIFIER_TYPE},isTaxInclusionAllowed:function(e,t){return t.features.isTaxInclusionEnabled&&e.modifierType!==Ce.NONE_MODIFIER_TYPE&&e.customTax===Ce.NO_CUSTOM_TAX&&e.modifierKind!==Ce.PERCENTAGE_MODIFIER_KIND},displayTaxable:function(e){return e===Ce.ON_IS_TAXABLE?Ce.ON_IS_TAXABLE_LABEL:e===Ce.OFF_IS_TAXABLE?Ce.OFF_IS_TAXABLE_LABEL:Ce.INHERIT_IS_TAXABLE_LABEL},isAggregateTaxableObject:function(e){return _.contains([$.cls,R.cls,p.cls],e.cls)},isTaxTypesAllowed:function(e,t,n){return e.isTaxable!==Ce.OFF_IS_TAXABLE&&(e.isTaxable!==Ce.INHERIT_IS_TAXABLE||t.cls===R.cls)&&(!n.company.features.isAggregateTaxEnabled||Ce.isAggregateTaxableObject(t))},showOffset:function(e,t){return!(e.price.customTax!==Ce.NO_CUSTOM_TAX||e.price.modifierType===Ce.NONE_MODIFIER_TYPE||(!t||!_.isNumber(t.offset))&&(e.price.modifierKind!==Ce.OFFSET_MODIFIER_KIND||!e.price.offset&&e.price.modifierType!==Ce.SET_MODIFIER_TYPE))},showRate:function(e,t){return!(e.price.customTax!==Ce.NO_CUSTOM_TAX||e.price.modifierType===Ce.NONE_MODIFIER_TYPE||(!t||!_.isNumber(t.rate))&&(e.price.modifierKind!==Ce.PERCENTAGE_MODIFIER_KIND||!e.price.rate&&e.price.modifierType!==Ce.SET_MODIFIER_TYPE))},effectiveOffset:function(e,t){return e.price.modifierType===Ce.NONE_MODIFIER_TYPE?0:(t=_.isUndefined(t)?1:t,_.roundHalfToEven(e.price.offset*e.sheetRate.sheetRate*t))},effectiveRate:function(e,t){return e.price.modifierType===Ce.NONE_MODIFIER_TYPE?0:(t=_.isUndefined(t)?1:t,e.price.rate*t)},modifierKindChoices:function(e){var n,r=t.get("db").slipstream("currencies");if(r){var i=r[_.resolveCurrency(e)];i&&(n=i.symbol)}return n||(console.warn("modifierKindChoices: unable to determine currency symbol",e),n="$"),[[Ce.PERCENTAGE_MODIFIER_KIND,"%"],[Ce.OFFSET_MODIFIER_KIND,n]]},isTaxIncluded:function(e){return e.price.taxInclusion===je.PriceLine.INCLUDED_TAX_INCLUSION&&e.taxes.taxability!==je.PriceSheet.NONE_TAXABILITY&&e.price.customTax===je.PriceLine.NO_CUSTOM_TAX&&e.price.modifierKind!==je.PriceLine.PERCENTAGE_MODIFIER_KIND},isCompanyBaseLine:function(e,t){return t.isBase&&e.cls===p.cls},effectiveTaxTypes:function(e){return _.unique(_.append(_.keys(e.taxes.ratesByType),_.keys(e.taxes.offsetsByType)))},adjustedPriceFromModel:function(e,t,n){t&&(t+="-");var r=t+$e.ADJUSTED_PRICE_KEY_PREFIX,i=e[r+(n?"invoiceRate":"rate")],a=e[r+(n?"invoiceOffset":"offset")];return _.isNumber(i)||_.isNumber(a)?{rate:Ie.sheetRateFromModel(i),offset:a,modifierKind:_.isNumber(i)?Ce.PERCENTAGE_MODIFIER_KIND:Ce.OFFSET_MODIFIER_KIND}:null},extendModelWithAdjustedPrice:function(e,t,n){t&&_.forEach(["offset","rate","invoiceOffset","invoiceRate"],(function(r){var i=t[r];if(_.isNumber(i)){"rate"!==r&&"invoiceRate"!==r||(i=Ie.sheetRateToModel(i));var a=(n?n+"-":"")+$e.ADJUSTED_PRICE_KEY_PREFIX;e[a+r]=i}}))},adjustPrice:function(e,t){if(!t||!_.isNumber(t.rate)&&!_.isNumber(t.offset))return e;var n=_.clone(e);return n.price=_.clone(e.price),n.price.rate=t.rate,n.price.offset=t.offset,n.price.modifierKind=t.modifierKind,n}};Ce.IS_TAXABLE_CHOICES=[{label:Ce.INHERIT_IS_TAXABLE_LABEL,value:Ce.INHERIT_IS_TAXABLE},{label:Ce.ON_IS_TAXABLE_LABEL,value:Ce.ON_IS_TAXABLE},{label:Ce.OFF_IS_TAXABLE_LABEL,value:Ce.OFF_IS_TAXABLE}],Ce.isTaxableChoices=function(e,t){return Ce.isCompanyBaseLine(e,t)?_.slice(Ce.IS_TAXABLE_CHOICES,1):Ce.IS_TAXABLE_CHOICES};var ke=_.property("isOnline"),Ae=_.property("isBase"),Pe=_.property("isTotalBase"),Se=_.property("isInvoiceBase"),Oe=function(e){return!e.isBase&&!e.isTotalBase&&!e.isInvoiceBase},Ie={NONE_TAXABILITY:"none",PRO_RATE_TAXABILITY:"pro-rate",FULL_TAXABILITY:"full",OFFSET_MODIFIER_KIND:"offset",PERCENTAGE_MODIFIER_KIND:"percentage",ADJUST_MODIFIER_TYPE:"adjust",SET_MODIFIER_TYPE:"set",baseSheet:function(e){return _.find(e,Ae)},nonBaseSheets:function(e){return _.filter(e,Oe)},sheetRateToModel:function(e){return _.roundHalfToEven(100*e,7)},sheetRateFromModel:function(e){return _.isNumber(e)?e/100:e},isInvoiceSheet:function(e){return e.cls===je.InvoiceSheet.cls},taxable:function(e){if(e.price.modifierType===Ce.NONE_MODIFIER_TYPE)return 0;var t=e.taxes.taxability;return t===Ie.NONE_TAXABILITY?0:t===Ie.PRO_RATE_TAXABILITY?Ce.effectiveOffset(e):t===Ie.FULL_TAXABILITY?e.price.offset:(console.warn("invalid taxability",t),0)},isNonBase:Oe,dropdownLabel:function(e){var t=e.displayName;return e.cls.endsWith("Schedule")&&(t+=" "+T("(schedule)")),e.isArchived&&(t+=" "+T("(archived)")),t},displayName:function(e){return e.displayName+(e.isArchived?" "+T("(archived)"):"")}};Ce.NONE_PRICING={visibility:{isVisible:!0,isHiddenWhenBooking:!1,isHiddenOnReceipts:!1,isRequired:!1},price:{modifierType:Ce.NONE_MODIFIER_TYPE,customTax:Ce.NO_CUSTOM_TAX},taxes:{taxability:Ie.PRO_RATE_TAXABILITY},sheetRate:{sheetRate:1}};var Re,Ne,we=_.extend({baseSheet:Ie.baseSheet,totalBaseSheet:function(e){return _.find(e,Pe)},nonBaseSheets:Ie.nonBaseSheets,onlineSheets:function(e){return _.filter(e,ke)},displaySheetRate:function(e){return e-1},fromDisplaySheetRate:function(e){return e+1},isOnlineDefault:function(e){return!(!e||!e.pk)&&(e==e.company.defaultOnlineTotalSheet||e.company.defaultOnlineTotalSchedule&&e==_.last(e.company.defaultOnlineTotalSchedule.entries).sheet)}},Ie),Ue=_.extend({INHERIT_VISIBILITY:"inherit",VISIBLE_VISIBILITY:"visible",HIDDEN_VISIBILITY:"hidden"},Ce),Fe=_.extend({AFFILIATE_RELATIONSHIP:"affiliate",CHARTER_RELATIONSHIP:"charter",invoiceBaseSheet:function(e){return _.find(e,Se)},nonBaseSheets:Ie.nonBaseSheets,displaySheetRate:function(e,t){return t===Fe.CHARTER_RELATIONSHIP?1-e:t===Fe.AFFILIATE_RELATIONSHIP?e:void 0},fromDisplaySheetRate:function(e,t){return t===Fe.CHARTER_RELATIONSHIP?1-e:t===Fe.AFFILIATE_RELATIONSHIP?e:void 0},displayRelationship:function(e){return e===Fe.CHARTER_RELATIONSHIP?"reseller":e===Fe.AFFILIATE_RELATIONSHIP?"referral":"none"}},Ie),De=_.extend({},Ce),Le={isOnlineFallback:function(e){return!!_.get(_.last(e.entries).sheet,"isOnline",!1)},verboseName:T("schedule"),verboseNamePlural:T("schedules")},Me={verboseName:T("schedule"),verboseNamePlural:T("schedules")},xe={isFallbackEntry:function(e){return e.rules[0]&&e.rules[0].type===Be.FALLBACK},hasFallbackEntry:function(e){var t=_.last(e);return t&&xe.isFallbackEntry(t)}},Be={groupRules:function(e,t){var n={};return _.forEach(Be.RULE_TYPES,(function(e){n[e]=[]})),_.forEach(e,(function(e){n[e.type].push(e)})),t&&Be.sortDayOfWeekType(n,t),n},sortDayOfWeekType:function(e,t){var n=de.weekDays(t);_.forEach(e,(function(t,r){_.contains(Be.DAY_OF_WEEK_TYPES,r)&&(e[r]=_.sortBy(t,(function(e){return n.indexOf(e.dayPattern[0])})))}))},displayType:function(e){return Be.TYPE_CHOICES_MAP[e.type]},isDateType:function(e){return _.contains(Be.DATE_TYPES,e.type)},isDayOfWeekType:function(e){return _.contains(Be.DAY_OF_WEEK_TYPES,e.type)},isHourType:function(e){return _.contains(Be.HOUR_TYPES,e.type)},isCapacityType:function(e){return _.contains(Be.CAPACITY_TYPES,e.type)},isPercentageCapacityType:function(e){return _.contains([Be.REMAINING_CAPACITY_PERCENTAGE,Be.FILLED_CAPACITY_PERCENTAGE],e.type)},display:function(e){return e.type===Be.FALLBACK?T("Fallback"):Be.displayType(e)+": "+e.details},combinedDayPattern:function(e){var t=_.flatten(_.pluck(e,"dayPattern")),n=[];return _.forEach(de.WEEK_DAYS_KEYS,(function(e){_.contains(t,e)&&n.push(de.weekDayShort(e))})),n},typeGroup:function(e){return _.contains([Be.DATE_BASED_ON_BOOKING,Be.DATE_BASED_ON_AVAILABILITY,Be.DAY_OF_WEEK_BASED_ON_BOOKING,Be.DAY_OF_WEEK_BASED_ON_AVAILABILITY,Be.HOURS_BEFORE_AVAILABILITY_START,Be.HOURS_BEFORE_AVAILABILITY_MIDNIGHT],e)?_("Date & Time Based"):_("Capacity Based")},dropdownTypeDisplay:function(e){var t=e[0];return e[1]+(_.contains(Be.HOUR_TYPES+Be.CAPACITY_TYPES,t)?"<i class='p-l-5 text-small fh-grey-new'>⚡Dynamic</i>":"")},detailDisplay:function(e){if(Be.isHourType(e)){var t=e.countMin,n=e.countMax;return _.isNumber(t)&&_.isNumber(n)?r=t<-1?T("between %(start)s hours after and %(end)s hours after"):-1===t?T("between %(start)s hour after and %(end)s hours after"):0===t&&-1===n?T("between %(start)s hours before and %(end)s hour after"):0===t?T("between %(start)s hours before and %(end)s hours after"):1===t&&n<-1?T("between %(start)s hour before and %(end)s hours after"):1===t&&-1===n?T("between %(start)s hour before and %(end)s hour after"):1===t&&0===n?T("between %(start)s hour before and %(end)s hours before"):t>1&&n<-1?T("between %(start)s hours before and %(end)s hours after"):t>1&&-1===n?T("between %(start)s hours before and %(end)s hour after"):t>1&&1===n?T("between %(start)s hours before and %(end)s hour before"):T("between %(start)s hours before and %(end)s hours before"):_.isNumber(t)?r=t<-1?T("starting %(start)s hours after"):-1===t?T("starting %(start)s hour after"):0===t?T("anytime after"):1===t?T("starting %(start)s hour before"):T("starting %(start)s hours before"):_.isNumber(n)&&(r=n<-1?T("until %(end)s hours after"):-1===n?T("until %(end)s hour after"):0===n?T("anytime before"):1===n?T("until %(end)s hour before"):T("until %(end)s hours before")),interpolate(r,{start:Math.abs(t),end:Math.abs(n)})}if(Be.isCapacityType(e)){var r,i=e.countMin,a=e.countMax;return e.type===Be.REMAINING_CAPACITY_PERCENTAGE?r=_.isNumber(i)?_.isNumber(a)?i===a?T("%(countMin)s% of capacity is remaining"):T("between %(countMin)s% and %(countMax)s% of capacity is remaining"):T("at least %(countMin)s% of capacity is remaining"):T("up to %(countMax)s% of capacity is remaining"):e.type===Be.FILLED_CAPACITY_PERCENTAGE?r=_.isNumber(i)?_.isNumber(a)?i===a?T("%(countMin)s% of capacity is full"):T("between %(countMin)s% and %(countMax)s% of capacity is full"):T("at least %(countMin)s% of capacity is full"):T("up to %(countMax)s% of capacity is full"):e.type===Be.REMAINING_CAPACITY_COUNT?r=_.isNumber(i)?_.isNumber(a)?i===a?1==i?T("%(countMin)s spot is remaining"):T("%(countMin)s spots are remaining"):T("between %(countMin)s and %(countMax)s spots are remaining"):1===i?T("at least %(countMin)s spot is remaining"):T("at least %(countMin)s spots are remaining"):1===a?T("up to %(countMax)s spot is remaining"):T("up to %(countMax)s spots are remaining"):e.type===Be.FILLED_CAPACITY_COUNT&&(r=_.isNumber(i)?_.isNumber(a)?i===a?1==i?T("%(countMin)s spot is filled"):T("%(countMin)s spots are filled"):T("between %(countMin)s and %(countMax)s spots are filled"):1===i?T("at least %(countMin)s spot is filled"):T("at least %(countMin)s spots are filled"):1===a?T("up to %(countMax)s spot is filled"):T("up to %(countMax)s spots are filled")),interpolate(r,{countMin:i,countMax:a})}}},$e={ADJUSTED_PRICE_KEY_PREFIX:"adjustedPrice-",aggregationKey:function(e){return e.customFieldInstance.customField.type===je.CustomField.TRANSPORTATION_TYPE?e.transportationOption&&!e.transportationOption.isSelfTransportation?e.transportationOption.value:T("Self transportation"):e.value?e.value.toString():""},displayValue:function(e){return e.customFieldInstance.customField.type!==je.CustomField.COUNT_TYPE||e.value?e.displayValue:""},aggregationDisplayValue:function(e){var t=e.customFieldInstance.customField.type;return _.contains([je.CustomField.TRANSPORTATION_TYPE,je.CustomField.COUNT_TYPE],t)?"":e.displayValue},aggregationCount:function(e){return e.customFieldInstance.customField.type===je.CustomField.TRANSPORTATION_TYPE?e.transportationOption&&!e.transportationOption.isSelfTransportation?e.booking.customerCount:0:e.customFieldInstance.customField.type===je.CustomField.COUNT_TYPE?e.value:e.value?1:0},annotate:function(t,n,r){var i=e("time"),a={},o=[],s=[],c=function(e,t){s.push(e);var n=$e.aggregationKey(e),i=$e.aggregationCount(e),c=je.CustomField.isAggregatable(e.customFieldInstance.customField),l=e.customer?e.customer.pk:e.pk;if(t||!c||r){var u=$e.displayValue(e);""!==u&&o.push({customFieldValue:e,key:n,count:i,displayValue:u,transportationOption:e.transportationOption||null,isAggregated:!1,sortableIndex:l})}else{var d=a[n]||{customFieldValue:e,key:n,count:0,displayValue:$e.aggregationDisplayValue(e),transportationOption:null,isAggregated:!0,sortableIndex:l};i&&(d.count+=i,a[n]=d)}};_.forEach(n.customers,(function(e){_.forEach(e.customFieldValues,(function(e){e.customFieldInstance.customField===t&&c(e,!1)}))})),_.forEach(n.customFieldValues,(function(e){e.customFieldInstance.customField===t&&c(e,n.cls===H.cls)}));var l=_.append(_.values(a),o);return l=_.sortBy(l,"sortableIndex"),_.forEach(l,(function(e){var t="",n=e.customFieldValue,r=n.transportationOption;if(r){var a=n.booking.availability.startAt.clone();a.subtract(r.minutesBeforeStart,"minutes"),t=interpolate(T("%(time)s at %(name)s"),{time:i(a),name:n.displayValue})}else t=e.isAggregated&&e.count?e.displayValue?e.count.toString()+" "+e.displayValue:e.count.toString():e.displayValue;e.renderedValue=t})),{annotatedCustomFieldValues:l,customFieldValues:s}},isCustomerLevelWherewolfCustomField:function(e){return e.customFieldInstance.customField.type===Q.WHEREWOLF_TYPE&&e.cls===Ve.cls}},Ge={LEGACY_TAX_TYPE_PK:-1,RATE_TYPE:"rate",OFFSET_TYPE:"offset",displayName:function(t){return interpolate(T("%(name)s (%(rate)s)"),{name:e("name")(t),rate:Ge.displayRate(t)})},displayRate:function(t){return t.type===Ge.RATE_TYPE?e("percentage")(t.rate,"hideplus"):t.type===Ge.OFFSET_TYPE?e("amount")(t.offset,t.company):void 0}},Ye={},Ve={hasWaiverType:function(e){return _.any(e,(function(e){return je.CustomField.isWaiverType(e.customFieldInstance.customField)}))}},Ke=((Ne=(Re={GOOGLE_ANALYTICS_TYPE:"google-analytics",FACEBOOK_TYPE:"facebook",ADROLL_TYPE:"adroll",OPTIMIZELY_TYPE:"optimizely",CUSTOM_CODE_TYPE:"custom-code",IDENTIFIERS_BY_TYPE:{},IDENTIFIER_LABELS:{googleAnalyticsUa:"UA Code",facebookPixel:"Pixel ID",facebookAccessToken:"Access Token",facebookEventSourceURL:"Facebook Event Source URL",adrollAdvertiser:"Advertiser ID",adrollPixel:"Pixel ID",optimizelyAccount:"Account ID",optimizelyProject:"Project ID",optimizelyEventKey:"Goal Event",optimizelyGoals:"Goal ID(s)",customCode:"Code",customIdentifiers:"Identifiers"},needsCrossDomainField:function(e){return _.includes([Re.GOOGLE_ANALYTICS_TYPE,Re.FACEBOOK_TYPE,Re.ADROLL_TYPE,Re.OPTIMIZELY_TYPE],e)},displayIdentifier:function(e){return Re.IDENTIFIER_LABELS[e]}}).IDENTIFIERS_BY_TYPE)[Re.GOOGLE_ANALYTICS_TYPE]=["googleAnalyticsUa"],Ne[Re.FACEBOOK_TYPE]=["facebookPixel","facebookAccessToken","facebookEventSourceURL"],Ne[Re.ADROLL_TYPE]=["adrollAdvertiser","adrollPixel"],Ne[Re.OPTIMIZELY_TYPE]=["optimizelyAccount","optimizelyProject","optimizelyEventKey","optimizelyGoals"],Ne[Re.CUSTOM_CODE_TYPE]=["customCode","customIdentifiers"],Re),He=function(e,t){if(!e)return console.warn("supported language: invalid empty language code"),"";var n=e.split("-")[0],r=qe.DISPLAY_LANGUAGES[e]||qe.DISPLAY_LANGUAGES[n];return r?r[t]:""},qe={isRecognizedLanguage:function(e){return _.contains(qe.LANGUAGE_CODES_SORTED,e)},rootLanguage:function(e){return e.split("-")[0]},display:function(e){return He(e,"name")},displayLocal:function(e){return He(e,"nameLocal")},shareRootLanguage:function(e,t){return e&&t&&qe.rootLanguage(e)===qe.rootLanguage(t)},SCROLL_TO_LANGUAGE_PARAM:"highlight-language"},We={BEFORE_MIDNIGHT_CUTOFF_KIND:"before-midnight",BEFORE_START_CUTOFF_KIND:"before-start",RESTRICTION_FIELDS:["minimumInitialPartySize","minimumSubsequentPartySize","maximumInitialPartySize","maximumSubsequentPartySize","isBookableEverByPhone","soldOutText","cutoffUnreachedKind","cutoffUnreachedHours","isCutoffUnreachedCallToBook","cutoffReachedKind","cutoffReachedHours","isCutoffReachedCallToBook","autoOpenHours","autoOpenKind"],DEFAULT_AUTO_OPEN_HOURS:720,cutoffStart:function(e,t,n){return e===We.BEFORE_START_CUTOFF_KIND?n.clone().subtract(t,"hours"):e===We.BEFORE_MIDNIGHT_CUTOFF_KIND?n.clone().startOf("day").subtract(t,"hours"):void console.error("BookingRestriction.cutoffStart: invalid kind "+e)}},je={Order:G,Contact:Y,Booking:H,Customer:q,LineItem:{},ItemGroup:{},Availability:$,Company:p,User:g,TagGroup:{},Tag:{},TagInstance:{},Item:R,FlowNode:N,CustomFieldInstanceGroup:D,CustomFieldInstanceCondition:M,CustomFieldInstance:L,CustomerType:w,CustomerPrototype:U,CustomerTypeRate:F,CheckinStatus:x,Image:{CAROUSEL_GALLERY:"carousel"},CustomField:Q,ExtendedOption:{},TransportationOption:{},ConnectedCampaign:{},GeneratingCampaign:{},CannedMessage:ie,AvailabilityHeadline:re,Notification:ee,SmsNotification:te,ReviewExpressNotification:{},Subscription:ne,Payment:ce,Dispute:se,InStorePaymentType:ae,EmvDevice:oe,Refund:le,Receipt:ue,Rule:de,Payout:{SUCCEEDED_STATUS:"succeeded",PAID_STATUS:"paid",PENDING_STATUS:"pending",FAILED_STATUS:"failed",PROCESSED_STATUS:"processed"},Fund:{},Transfer:{},Upload:{SUCCEEDED_STATUS:"succeeded",PENDING_STATUS:"pending",FAILED_STATUS:"failed"},Transaction:me,Account:{BANK_TYPE:"bank",DEPOSIT_TYPE:"deposit",ESCROW_TYPE:"escrow"},Adjustment:he,Campaign:{},CampaignValidityRule:ge,Code:{},StoredValueType:{},StoredValueCard:ye,StoredValueAdjustment:{},PaymentProcessingDocument:ve,TicketLayout:Te,CustomCalendar:{},CustomManifest:{},CustomReport:{QUERY_PARAM:"saved",QUERY_PARAM_KEY:"pk"},SuggestedReport:{QUERY_PARAM:"suggested",QUERY_PARAM_KEY:"slug",DEFAULT_SLUG:"default"},Activity:Ee,Block:{},Agent:W,Desk:j,Affiliation:z,CrewMember:{},Role:{},Hotel:{},Lodging:{RELATED_FEATURE_FLAG:"isTransportationEnabled"},PreferredPickup:{},Pickup:{RELATED_FEATURE_FLAG:"isTransportationEnabled"},Route:{RELATED_FEATURE_FLAG:"isTransportationEnabled"},Stop:{},Run:{},Report:X,Invoice:{PAID_STATUS:"paid",PENDING_STATUS:"pending",UNPAID_STATUS:"unpaid",OVERDUE_STATUS:"overdue",isInvoicedToCharter:function(e){return e>0}},InvoiceEntry:{},Location:{RELATED_FEATURE_FLAG:"isLocationsEnabled"},SupportedLanguage:qe,Translation:{displayNameForInstance:function(e){return e.name||e.displayName||e.title||e.unicode},fieldDisplayValue:function(e,t,n){var r=_.camelCase(e.fieldName);return n?t[r][n]:t[r]},modelNameForUrl:function(e){return _.kebabCase(e)},modelNameFromUrl:function(e){return _.startCase(e).replace(/ /g,"")},fieldNameForUrl:function(e){return _.kebabCase(e)},fieldNameFromUrl:function(e){return _.snakeCase(e)},isEnglishSpeaker:function(){return document.cookie.match(/fh-content-language\s*=\s*en/)}},Waiver:{RELATED_FEATURE_FLAG:"isSmartwaiverEnabled"},ConnectedWaiver:{},WaiverInstance:_e,Group:{AFFILIATE_TYPE:"affiliate",COMPANY_TYPE:"company",PARTNER_TYPE:"partner"},GroupOverride:be,PriceSheet:Ie,PriceLine:Ce,TotalSheet:we,TotalLine:Ue,InvoiceSheet:Fe,InvoiceLine:De,TotalSchedule:Le,InvoiceSchedule:Me,ScheduleEntry:xe,TotalScheduleEntry:{},InvoiceScheduleEntry:{},ScheduleEntryRule:Be,TotalScheduleEntryRule:{},InvoiceScheduleEntryRule:{},TaxType:Ge,BankAccount:fe,Ledger:{RELATED_FEATURE_FLAG:"isLedgersEnabled"},Card:{},CardAffiliation:{},CustomFieldValue:$e,BookingCustomFieldValue:Ye,CustomerCustomFieldValue:Ve,Resource:y,RequirementGroup:v,Requirement:E,CustomerPrototypeRequirement:{},CustomerTypeRequirement:{},ResourceRequirement:b,ResourceUse:k,ResourceOverride:{},SeatMap:A,SeatGroup:P,Seat:O,SeatAssignment:S,SeatZone:I,Calendar:d,ResellerCompany:{},ResellerCompanyMapping:{},ResellerItem:{RelatedLocationType:{RELATED_NO_ADMISSION:"RELATION_TYPE_RELATED_NO_ADMISSION",ADMISSION_TICKET:"RELATION_TYPE_ADMISSION_TICKET",SUPPLEMENTARY_ADDON:"RELATION_TYPE_SUPPLEMENTARY_ADDON"}},ResellerItemMapping:{},ResellerCustomerType:{},ResellerCustomerTypeMapping:{},ResellerOption:{},ResellerOptionMapping:{},ResellerKey:{SEND_BOOKINGS_SCHEMA:"send_bookings",SEND_BOOKINGS_WITH_PAYMENTS_SCHEMA:"send_booking_with_payments"},ResellerApp:{},ResellerAppRequest:{PENDING_STATUS:"pending",CONNECTED_STATUS:"connected"},ResellerAppCompany:{},AnalyticsService:Ke,CancellationPolicy:{},CancellationRule:{ALWAYS_TYPE:"always",HOURS_BEFORE_AVAILABILITY_START_TYPE:"hours-before-start",HOURS_BEFORE_AVAILABILITY_MIDNIGHT_TYPE:"hours-before-midnight",HOURS_BEFORE_PSEUDO_TYPE:"hours-before"},BookingRestriction:We},ze=_.keys(je);return _.forEach(ze,(function(e){je[e].cls=e})),je.models=_.sortBy(_.values(je),"cls"),je.inject=function(e){_.forEach(ze,(function(t){e[t]=je[t]}))},je}]),e.run(["$filter","$rootScope","auth","db","emv","models","navigation","processors","urls",function(e,t,n,r,i,a,o,s,c){a.inject(t),t.nullModel={};var l=r.slipstream("models.verboseNames");_.forEach(l,(function(e,t){_.defaults(a[t],e)})),a.Company._isFeeable=function(e){return!n.currentUser.isAuthenticated||!n.permissions.canBookWithNoFee(e)},a.Company._minimumBookingFee=function(e,t){return t?s.get(t).minimumBookingFee(e):e.minimumFee},a.Company._tieredFeeRate=function(e,t){var n=_.find(_.reversed(e.tieredFeeSchedule),(function(e){return t>=e.cutoff}));if(!n)throw new Error("Company._tieredFeeRate: invalid tiered fee schedule");return n.rate},a.Company._minimumFee=function(e,t,n,r){return e<r?!e&&n||!e&&t?0:r:e},a.Company.bookingFee=function(e,t,n,r,i){if(!a.Company._isFeeable(e))return 0;if("no-fee"===e.feeType)return 0;if("flat-fee"===e.feeType)return e.flatFee;var o;if("percentage-fee"===e.feeType)o=e.percentageFeeRate;else{if("tiered-fee"!==e.feeType)throw new Error("Company.bookingFee: invalid fee type "+e.feeType);o=a.Company._tieredFeeRate(e,t)}var s=_.roundHalfToEven(t*o),c=a.Company._minimumBookingFee(e,i);return a.Company._minimumFee(s,r,n,c)},a.Company.taxDisplayRate=function(t){return t.features.includedTaxRate?e("percentage")(t.features.includedTaxRate,!0):""},a.Rule.WEEK_DAYS_DISPLAY=_.map(a.Rule.WEEK_DAYS_KEYS,(function(e){return a.Rule.WEEK_DAYS[e]})),a.Availability.manifestUrl=function(e){return o.compose(c.populate(c.dashboard.manifest.availabilities,{shortname:e.company.shortname,date:e.startAt?e.startAt.format("YYYY-MM-DD"):void 0}),{items:e.item.pk,availabilities:e.pk})},a.Run.manifestUrl=function(e){return o.compose(c.populate(c.dashboard.manifest.runs,{shortname:e.route.company.shortname,date:e.startAt?e.startAt.format("YYYY-MM-DD"):void 0}),{routes:e.route.pk})},a.Item.manifestUrl=function(e,t){return o.compose(c.populate(c.dashboard.manifest.availabilities,{shortname:e.company.shortname,date:t}),{items:e.pk})},a.Resource.manifestUrl=function(e,t){return o.compose(c.populate(c.dashboard.manifest.resources,{shortname:e.company.shortname,date:t}),{resources:e.pk})},a.Booking.processorTypes=function(e){return e=e||[],_.filter(_.sortBy(_.uniq(_.pluck(e,"processorType"))))},a.Booking.statementText=function(e,t){var n=a.Booking.processorTypes(t);return _.map(n,(function(t){var n=s.get(t);return'"'+n.STATEMENT_TEXT_PREFIX+n.statementText(e)+'"'})).join(" or ")},a.Booking.pendingStatementText=function(e){var t=a.Booking.processorTypes([e]);return _.map(t,(function(e){return'"'+s.get(e).PENDING_STATEMENT_TEXT+'"'})).join(" or ")},a.Payment.isDefaultProcessorBasedType=function(e){return e.type===a.Payment.CC_TYPE&&e.processorType===s.DEFAULT_PROCESSOR_TYPE},a.Payment.isLegacyProcessorBasedType=function(e){return a.Payment.isProcessorBasedType(e)&&_.contains(s.LEGACY_PROCESSOR_TYPES,e.processorType)},a.Payment.minimumChargeAmounts=function(e,t){var n=r.slipstream("processorMinimumChargeAmounts");return _.get(n[t],e,n[t][s.DEFAULT_CURRENCY])},a.Payment.emvDetails=function(e){if(!a.Payment.isEmv(e))return[];var t=_.toTrueKeys(["Date","Time","Amount","Description","Name","Address","Zip","City","Country","Contact","Additional Information","Account"]),n=_.filter(e.metadata.emvDetails,(function(e){return!t[e.key]}));return s.get(e.processorType).filterEmvDetails(n)};var u=function(e){return r.slipstream("processorIdealBankTypeChoices")[e]||[]};a.Payment.STRIPE_IDEAL_BANK_TYPE_CHOICES=u(s.STRIPE_PROCESSOR_TYPE),a.Payment.ADYEN_IDEAL_BANK_TYPE_CHOICES=u(s.ADYEN_PROCESSOR_TYPE);var d=a.Report;d.MODELS={},d.MODELS[a.StoredValueCard.cls]={name:T("Gift Cards"),singular:T("Gift Card"),slug:"stored-value-cards",model:a.StoredValueCard,submodels:[]},d.MODELS[a.PaymentProcessingDocument.cls]={name:T("Payment Processing Documents"),singular:T("Payment Processing Document"),slug:"payment-processing-documents",model:a.PaymentProcessingDocument,submodels:[]},d.MODELS[a.Booking.cls]={name:T("Bookings"),singular:T("Booking"),slug:"bookings",model:a.Booking,submodels:[]},d.MODELS[a.Customer.cls]={name:T("Customers"),singular:T("Customer"),slug:"customers",model:a.Customer,submodels:[a.Booking]},d.MODELS[a.LineItem.cls]={name:T("Expenses and Discounts"),singular:T("Expense and discount"),slug:"expenses-and-discounts",model:a.LineItem,submodels:[a.Booking]},d.MODELS[a.CustomFieldValue.cls]={name:T("Custom Field Answers"),singular:T("Custom field answer"),slug:"custom-field-answers",model:a.CustomFieldValue,submodels:[a.Customer,a.Booking]},d.MODELS[a.Payment.cls]={name:T("Sales"),singular:T("Sales"),slug:"payments-and-refunds",model:a.Payment,submodels:[a.Booking]},d.MODELS[a.ResourceUse.cls]={name:T("Resource Uses"),singular:T("Resource Use"),slug:"resource-uses",model:a.ResourceUse,submodels:[a.Customer,a.Booking]},d.ORDERED_MODELS=[a.Payment,a.Booking,a.Customer,a.CustomFieldValue,a.ResourceUse,a.LineItem,a.StoredValueCard,a.PaymentProcessingDocument],d.UNSOUND_AGGREGATES={Payment:[a.Booking],Booking:[],Customer:[a.Booking],CustomFieldValue:[a.Booking,a.Customer],LineItem:[a.Booking],ResourceUse:[a.Booking,a.Customer]},d.advancedUrl=function(e,t){var n=c.dashboard.reports.advanced.index;return c.populate(n,{shortname:e.shortname,modelSlug:d.MODELS[t].slug})},d.SWITCH_QUERY_PARAM_KEY="switch",d.advancedSwitchUrl=function(e,t){var n={};return n[d.SWITCH_QUERY_PARAM_KEY]=!0,o.compose(d.advancedUrl(e,t),n)},d.VALID_COLUMNS=r.slipstream("reports.validColumns"),d.VALID_GROUPS=r.slipstream("reports.validGroups"),d.VALID_FILTERS=r.slipstream("reports.validFilters"),d.PROHIBITED_GROUPS=r.slipstream("reports.prohibitedGroups"),d.PROHIBITED_HIGHER_GROUPS=r.slipstream("reports.prohibitedHigherGroups"),d.ALWAYS_UNSOUND_GROUPINGS=r.slipstream("reports.alwaysUnsoundGroupings"),d.ALLOWED_DATE_TYPES=r.slipstream("reports.allowedDateTypes"),d.DEFAULT_DATE_TYPES=r.slipstream("reports.defaultDateTypes"),_.extend(d,r.slipstream("reports.allColumns")),_.extend(d,r.slipstream("reports.allGroups")),_.extend(d,r.slipstream("reports.allFilters")),_.extend(d,r.slipstream("reports.allDateTypes")),_.extend(d,r.slipstream("reports.allDateRanges")),d.MODELS_BY_GROUP={},_.forEach(d.VALID_GROUPS,(function(e,t){_.forEach(e,(function(e){d.MODELS_BY_GROUP[e]=d.MODELS_BY_GROUP[e]||[],d.MODELS_BY_GROUP[e].push(a[t])}))})),a.ResourceOverride.collapseSeatOverrides=function(e){var t={};return _.forEach(_.filter(e,"seat"),(function(n){var r=n.startAt.format()+"-"+n.endAt.format()+"-"+n.resource.pk;t[r]=t[r]||[],t[r].push(n),_.ref.remove(e,n)})),_.forEach(t,(function(t){e.push({startAt:t[0].startAt,endAt:t[0].endAt,resource:t[0].resource,seatCount:t.length})})),e};var m=a.ScheduleEntryRule;if(m.TYPE_CHOICES=r.slipstream("scheduleEntryRule.typeChoices"),m.TYPE_CHOICES_MAP=_.reduce(m.TYPE_CHOICES,(function(e,t){return e[t[0]]=t[1],e}),{}),m.typeChoicesForCompany=function(e){return e.features.isDynamicPricingEnabled?m.TYPE_CHOICES:_.filter(m.TYPE_CHOICES,(function(e){return!_.contains(m.HOUR_TYPES+m.CAPACITY_TYPES,e[0])}))},m.FALLBACK="fallback",m.DATE_BASED_ON_BOOKING="booking",m.DATE_BASED_ON_AVAILABILITY="availability",m.DAY_OF_WEEK_BASED_ON_BOOKING="dow-booking",m.DAY_OF_WEEK_BASED_ON_AVAILABILITY="dow-availability",m.HOURS_BEFORE_AVAILABILITY_START="hours-bf-ava-start",m.HOURS_BEFORE_AVAILABILITY_MIDNIGHT="hours-bf-ava-mn",m.REMAINING_CAPACITY_PERCENTAGE="rem-cap-per",m.REMAINING_CAPACITY_COUNT="rem-cap-count",m.FILLED_CAPACITY_PERCENTAGE="fill-cap-per",m.FILLED_CAPACITY_COUNT="fill-cap-count",m.RULE_TYPES=[m.FALLBACK,m.DATE_BASED_ON_BOOKING,m.DATE_BASED_ON_AVAILABILITY,m.DAY_OF_WEEK_BASED_ON_BOOKING,m.DAY_OF_WEEK_BASED_ON_AVAILABILITY,m.HOURS_BEFORE_AVAILABILITY_START,m.HOURS_BEFORE_AVAILABILITY_MIDNIGHT,m.REMAINING_CAPACITY_PERCENTAGE,m.REMAINING_CAPACITY_COUNT,m.FILLED_CAPACITY_PERCENTAGE,m.FILLED_CAPACITY_COUNT],m.DATE_TYPES=[m.DATE_BASED_ON_BOOKING,m.DATE_BASED_ON_AVAILABILITY],m.DAY_OF_WEEK_TYPES=[m.DAY_OF_WEEK_BASED_ON_BOOKING,m.DAY_OF_WEEK_BASED_ON_AVAILABILITY],m.HOUR_TYPES=[m.HOURS_BEFORE_AVAILABILITY_START,m.HOURS_BEFORE_AVAILABILITY_MIDNIGHT],m.CAPACITY_TYPES=[m.REMAINING_CAPACITY_PERCENTAGE,m.REMAINING_CAPACITY_COUNT,m.FILLED_CAPACITY_PERCENTAGE,m.FILLED_CAPACITY_COUNT],a.ResourceUse.OPTIONS=r.slipstream("resourceUse.options"),a.ResourceUse.OPTIONS_VALUES_KEYS_MAP=_.reduce(a.ResourceUse.OPTIONS,(function(e,t){return e[t.value]=t.key,e}),{}),a.ResourceUse.OPTIONS_KEYS_DISPLAY_TEXT_MAP=_.reduce(a.ResourceUse.OPTIONS,(function(e,t){return e[t.key]=t.displayText,e}),{}),a.ResourceUse.getUseSettings=function(e){var t;return e.cls===a.ResourceRequirement.cls?t=[String(e.isSkipCreation),String(e.isIgnoreResourceOveruse)].join("-"):e.cls===a.Resource.cls?t=[String(e.isSkipResourceUseCreation),String(e.isIgnoreOveruse)].join("-"):console.error("invalid object passed to ResourceUse.getUseSettings"),a.ResourceUse.OPTIONS_VALUES_KEYS_MAP[t]},a.ResourceUse.getDisplayText=function(e){var t=a.ResourceUse.getUseSettings(e);return a.ResourceUse.OPTIONS_KEYS_DISPLAY_TEXT_MAP[t]},a.ResourceUse.resourceUseSummaries=function(e,t){return t=t||[],_.reduce(function(e){return _.reduce(e,(function(e,t){var n=t.resourceRequirement.resource;return e[n.pk]=e[n.pk]||[],e[n.pk].push(t),e}),{})}(e),(function(e,n,r){e[r]=e[r]||{},e[r].totalUseCount=parseFloat(_.sum(n,"useCount").toFixed(2)),e[r].totalSeatCount=_.filter(n,"seat").length,e[r].resourcePk=r,e[r].resourceName=n[0].resourceRequirement.resource.name,e[r].isResourceArchived=n[0].resourceRequirement.resource.isArchived,e[r].isOverused=_.map(t,"pk").indexOf(parseInt(r))>-1;var i=n[0].resourceRequirement.company||n[0].company;return e[r].url=c.populate(c.dashboard.resources.resource.uses.day,{shortname:i.shortname,resourcePk:r,date:_.min(_.pluck(n,"startAt")).format("YYYY-MM-DD")}),e}),{})},a.CustomReport.url=function(e){var t=d.advancedUrl(e.company,e.options.modelName),n={};return n[a.CustomReport.QUERY_PARAM]=e[a.CustomReport.QUERY_PARAM_KEY],o.compose(t,n)},a.SuggestedReport.url=function(e,t){var n=d.advancedUrl(t,e.options.modelName),r={};return r[a.SuggestedReport.QUERY_PARAM]=e.slug,o.compose(n,r)},a.Item.frontendUrl=function(e,t){return t&&!e.isRetail?c.populate(c.company.item.month,{shortname:e.company.shortname,itemPk:e.pk,year:t.format("YYYY"),month:t.format("MM")}):e.$url(c.company.item.index)},a.Item.calendarUrl=function(e){return e.$url(c.dashboard.items.item.calendar)},a.FlowNode.frontendUrl=function(e,t){return e.externalUrl?e.externalUrl:e.item?a.Item.frontendUrl(e.item,t):e.$url(c.company.flowNode.index)},a.FlowNode.suggestedItemUrl=function(e,t,n){var r;r=e.item&&e.item.externalUrl&&!e.externalUrl?e.item.externalUrl:a.FlowNode.frontendUrl(e,t);var i={};return e.type!==a.FlowNode.PAGE_TYPE&&(i[a.FlowNode.FLOW_QUERY]=e.parent.pk),i[a.FlowNode.IS_FROM_CART_QUERY]=n,o.compose(r,i,!0)},_.extend(a.CampaignValidityRule,r.slipstream("campaignValidityRules.allTypes")),i.isDebugging){a.Payment.isEmv=function(e){return e.type===a.Payment.CC_TYPE},a.Payment.isEmvSignatureRequired=function(e){return e.pk%2==0};var p=a.Payment.emvDetails;a.Payment.emvDetails=function(e){return e.metadata||(e.metadata={}),e.metadata.emvDetails=i.debugDetails,p(e)}}a.SupportedLanguage.DISPLAY_LANGUAGES=r.slipstream("displayLanguages"),a.SupportedLanguage.LANGUAGE_CODES_SORTED=r.slipstream("languageCodesSorted"),a.Translation.translationOverlayUrl=function(e,t,n,r,i){var s={shortname:n,objectType:t.cls,objectId:t.pk,objectField:a.Translation.fieldNameForUrl(e)},l="";i?(s.subfield=a.Translation.fieldNameForUrl(i),l=c.populate(c.dashboard.translationsOverlay.forSubfield,s)):l=c.populate(c.dashboard.translationsOverlay.forField,s);var u={};return u[a.SupportedLanguage.SCROLL_TO_LANGUAGE_PARAM]=r,o.compose(l,u)},a.Seat.editUrl=function(e,t){return c.populate(c.dashboard.settings.seating.seatMap.layout.seats,{shortname:t.company.shortname,seatMapPk:t.pk,seatPks:_.isString(e)?e:_.pluck(e,"pk").join(",")})},a.Seat.duplicateUrl=function(e,t){return c.populate(c.dashboard.settings.seating.seatMap.layout.duplicate,{shortname:t.company.shortname,seatMapPk:t.pk,seatPks:_.isString(e)?e:_.pluck(e,"pk").join(",")})},a.Seat.createUrl=function(e,t,n){return c.populate(c.dashboard.settings.seating.seatMap.layout.new,{shortname:n.company.shortname,seatMapPk:n.seatMap.pk,seatGroupPk:n.pk,xCoord:e,yCoord:t})}}])}()},4981:function(){!function(){"use strict";var e=angular.module("lib.processors",["auth.services","db.services","lib.services","navigation.services"]),t={UNSUPPORTED:T("Unsupported processor. Please refresh the page and try again. If you continue to have trouble please contact support@fareharbor.com."),SCRIPT:T("Could not contact processor. Please refresh the page and try again."),TIMEOUT:T("Connection error. Please check your internet connection and try again."),WAIT:T("Please wait a few moments and try again."),TRY_AGAIN:T("Please try again."),REFRESH:T("Please refresh the page and try again."),UNKNOWN:T("Unknown error. Please refresh the page and try again."),GENERIC_BANK_ACCOUNT:T("Could not update bank account. Please make sure all details have been entered correctly and try again."),REFRESH_BANK_ACCOUNT:T("Could not update bank account. Please refresh the page and try again."),TRY_AGAIN_BANK_ACCOUNT:T("Could not update bank account. Please try again."),GENERIC_CARD:T("Could not process payment. Please refresh the page and try again ensuring all card details have been entered correctly. If you continue to have trouble please contact support@fareharbor.com."),REFRESH_CARD:T("Could not process payment. Please refresh the page and try again."),BAD_CARD:T("Could not process payment. Please make sure all card details have been entered correctly. If you are still unsuccessful you may need to call the card issuer or try a different card."),INVALID_ROUTING_NUMBER:T("Invalid routing number."),INVALID_CARD_NUMBER:T("Invalid card number. Please check that you have entered your card number correctly and try again."),BAD_CARD_NUMBER:T("Incorrect card number. Please check that you have entered your card number correctly and try again."),INVALID_DEMO_CARD_NUMBER:T("Only demo card numbers can be used while demo mode is enabled."),INVALID_EXPIRATION:T("Invalid card expiration date. Please check that you've selected the correct expiration date for your card and try again."),BAD_EXPIRATION:T("Expired card. Please enter a valid card."),INVALID_SECURITY_CODE:T("Invalid CVC (card security code). Please check that you've entered your card's security code correctly and try again."),BAD_SECURITY_CODE:T("Incorrect CVC (card security code). Please check that you've entered your card's security code correctly and try again."),INVALID_COUNTRY_CODE:T("Invalid country. Plesae check that your billing country is correct and try again."),INVALID_POSTAL_CODE:T("Invalid postal (zip) code. Please check that your billing postal code is correct and try again."),BAD_POSTAL_CODE:T("Incorrect postal (zip) code. Please check that your billing postal code is correct and try again.")},n={pending:T("Verification Pending"),failed:T("Verification Failed"),submitted:T("Information submitted. Awaiting reply.")},r="adyen",i="stripe",a="balanced",o="paypal",s=i;e.factory("processors",["$injector","auth","convert","db",function(e,c,l,u){var d={INDIVIDUAL_ENTITY_TYPE:"individual",COMPANY_ENTITY_TYPE:"company",DEFAULT_PROCESSOR_TYPE:s,DEFAULT_CURRENCY:"usd",ADYEN_PROCESSOR_TYPE:r,STRIPE_PROCESSOR_TYPE:i,BALANCED_PROCESSOR_TYPE:a,PAYPAL_PROCESSOR_TYPE:o,PROCESSOR_TYPES:[i,o],LEGACY_PROCESSOR_TYPES:[a],ACCOUNT_CREATION_REQUIREMENTS:u.slipstream("accountCreationRequirements"),ACCOUNT_CREATION_REQUIREMENT_TO_FORM_FIELD:u.slipstream("processorAccountCreationFormField",{doNotConvert:!0}),SUPPORTED_BANK_ACCOUNT_COUNTRIES:u.slipstream("processorSupportedBankAccountCountries"),BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES:u.slipstream("processorBankAccountVerificationEnabledCountries"),BANK_ACCOUNT_ADDITIONAL_REQUIRED_FORM_FIELDS:u.slipstream("processorBankAccountAdditionalRequiredFields"),SUPPORTED_CURRENCIES:u.slipstream("processorSupportedCurrencies"),PROCESSOR_CHOICES:u.slipstream("processorChoices"),COUNTRY_CHOICES:u.slipstream("countryChoices"),UNVERIFIED_VERIFICATION_STATUS:"unverified",SUBMITTED_VERIFICATION_STATUS:"submitted",PENDING_VERIFICATION_STATUS:"pending",VERIFIED_VERIFICATION_STATUS:"verified",FAILED_VERIFICATION_STATUS:"failed",TO_BE_REVERIFIED_VERIFICATION_STATUS:"to_be_reverified",APPLE_PAY_WALLET_TYPE:"apple_pay",GOOGLE_PAY_WALLET_TYPE:"google_pay",ERRORS:t,ONBOARDING_MESSAGES:n,SECRET_FIELD:"••••••••",secretField:function(e){return e=e||"",new Array(Math.max(e.length,d.SECRET_FIELD.length)+1).join(d.SECRET_FIELD[0])},cardType:function(e){if(!e)return"";e=e.toString().trim();var t={};return t[2]=t[51]=t[52]=t[53]=t[54]=t[55]="mastercard",t[34]=t[37]="american express",t[62]=t[81]="unionpay",t[4]="visa",t[6]="discover",t[35]="jcb",t[30]=t[36]=t[38]="diners club",t[e.substring(0,2)]||t[e.substring(0,1)]||"unknown"},cardTypeAbbreviation:function(e){return{visa:"visa",mastercard:"mc","american express":"amex",discover:"discover","diners club":"diners",jcb:"jcb",unknown:"unknown",unionpay:"cup"}[e]||""},cardLast4:function(e){return e.substr(e.length-4)},accountCreationRequirements:function(e,t,n,r){if(d.ACCOUNT_CREATION_REQUIREMENTS){var i=[e,n].join("."),a=_.get(d.ACCOUNT_CREATION_REQUIREMENTS,i);if(r&&(a=a.filter((function(e){return"legal_entity.business_name"!==e}))),a)return a}var o="processors: account creation requirements not identified for "+e+" "+t+" "+n;console.error(o)},requiredAccountCreationFields:function(e,t){try{if(!t)throw new Error("missing account creation requirements");if(!d.ACCOUNT_CREATION_REQUIREMENT_TO_FORM_FIELD)throw new Error("missing account creation requirements");var n=d.ACCOUNT_CREATION_REQUIREMENT_TO_FORM_FIELD[e];if(!n)throw new Error("missing account creation mapping for processor type");var r={};if(_.each(t,(function(e){var t=n[e];t&&(r[l.camelKey(t)]=!0)})),_.isEmpty(r))throw new Error("no required fields");return r}catch(t){var i="processors: account creation fields not identified for "+e+": "+t.message;console.warn(i)}},bankAccountAdditionalRequiredFields:function(e,t){if(d.BANK_ACCOUNT_ADDITIONAL_REQUIRED_FORM_FIELDS){var n=[e,t].join(".");return _.get(d.BANK_ACCOUNT_ADDITIONAL_REQUIRED_FORM_FIELDS,n,{})}var r="processors: bank account additional required form fields not identified for "+e+" "+t;console.error(r)},supportedBankAccountCountries:function(e,t,n){if(d.SUPPORTED_BANK_ACCOUNT_COUNTRIES){var r=[e,t,n].join("."),i=_.get(d.SUPPORTED_BANK_ACCOUNT_COUNTRIES,r);if(i)return i}var a="processors: supported bank account countries not identified for "+e+" "+t+" "+n;console.error(a)},verificationEnabledBankAccountCountries:function(e,t){if(d.BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES){var n=[e,t].join("."),r=_.get(d.BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES,n);if(r)return r}var i="processors: unable to identify verification enabled bank account countries for "+e+" "+t;console.error(i)},isVerificationEnabledForBankAccountCountry:function(e,t,n){var r=d.verificationEnabledBankAccountCountries(e,t);if(r)return _.contains(r,n);var i="processors: unable to identify whether bank account verification is enabled for "+e+" "+t+" "+n;console.error(i)},isBankAccountVerificationEnabled:function(e,t,n){var r=d.verificationEnabledBankAccountCountries(e,t);if(r){if(!r.length)return!1;var i=d.supportedBankAccountCountries(e,t,n);if(i)return!!_.intersection(i,r).length}var a="processors: unable to identify whether bank account verification is enabled for "+e+" "+t+" "+n;console.error(a)},supportedCurrencies:function(e,t){var n;if(d.SUPPORTED_CURRENCIES){if(null===e)return n={},_.forOwn(d.SUPPORTED_CURRENCIES,(function(e){_.transform(e[t],(function(e,t){e[t]=!0}),n)})),_.keys(n);var r=[e,t].join(".");if(n=_.get(d.SUPPORTED_CURRENCIES,r))return n}var i="processors: unable to determine supported currencies for "+e+" "+t;console.error(i)},INFO:"info",ERROR:"error",log:function(e,t,n,r){t=t||{},n=n||{},r=r||d.INFO;var i=_.get(console,r,console.info);_.isFunction(i)&&i("processors: "+e,t,n)},get:function(t){return t=t||s,e.get(t)},isProcessorEnabled:function(e,t){return _.contains(e.enabledProcessorTypes,t)},_isProcessor:function(e,t,n){var r="is"+_.capitalize(n)+"Processor"+_.capitalize(e);return _.get(t,r)},isProcessorBankAccountConnected:function(e,t){return d._isProcessor("bankAccountConnected",e,t)},isProcessorConnected:function(e,t){return d._isProcessor("connected",e,t)},isProcessorTosAccepted:function(e,t){return d._isProcessor("tosAccepted",e,t)},processorVerificationStatus:function(e,t){return _.get(e,t+"ProcessorVerificationStatus")},processorVerificationStatusDetails:function(e,t){return _.get(e,t+"ProcessorVerificationStatusDetails")},isProcessorVerificationFailed:function(e,t){return d.processorVerificationStatus(e,t)===d.FAILED_VERIFICATION_STATUS},isProcessorVerificationPending:function(e,t){return d.processorVerificationStatus(e,t)===d.PENDING_VERIFICATION_STATUS},isProcessorVerificationSubmitted:function(e,t){var n=d.processorVerificationStatus(e,t);return _.contains([d.SUBMITTED_VERIFICATION_STATUS,d.PENDING_VERIFICATION_STATUS],n)},isProcessorVerified:function(e,t){var n=d.processorVerificationStatus(e,t);return d.VERIFIED_VERIFICATION_STATUS===n},isProcessorPaymentSetupComplete:function(e,t){return d._isProcessor("paymentSetupComplete",e,t)},processorIdentifier:function(e,t){return _.get(e,t+"ProcessorIdentifier")},isProcessorDefaultBankAccountReadyForUpload:function(e,t){return d._isProcessor("defaultBankAccountReadyForUpload",e,t)},isProcessorDefaultBankAccountReadyForPayout:function(e,t){return d._isProcessor("defaultBankAccountReadyForPayout",e,t)},isProcessorDefaultBankAccountVerificationEnabled:function(e,t){return d._isProcessor("defaultBankAccountVerificationEnabled",e,t)},isProcessorAccountInformationSubmitted:function(e,t){return d._isProcessor("accountInformationSubmitted",e,t)},processorAdditionalAccountSetupStatus:function(e,t){return _.get(e,t+"ProcessorAdditionalAccountSetupStatus")},isProcessorAdditionalAccountSetupInitiated:function(e,t){return d.processorAdditionalAccountSetupStatus(e,t)!==d.UNVERIFIED_VERIFICATION_STATUS},isProcessorAdditionalAccountSetupCompleted:function(e,t){return d.processorAdditionalAccountSetupStatus(e,t)===d.VERIFIED_VERIFICATION_STATUS},isProcessorAdditionalAccountSetupFailed:function(e,t){return d.processorAdditionalAccountSetupStatus(e,t)===d.FAILED_VERIFICATION_STATUS},processorEmvLocationStatus:function(e,t){return e[t+"ProcessorEmvLocationStatus"]},isProcessorEmvLocationRequested:function(e,t){return d.processorEmvLocationStatus(e,t)!==d.UNVERIFIED_VERIFICATION_STATUS},isProcessorEmvLocationFailed:function(e,t){return d.processorEmvLocationStatus(e,t)===d.FAILED_VERIFICATION_STATUS},isProcessorEmvLocationCompleted:function(e,t){return d.processorEmvLocationStatus(e,t)===d.VERIFIED_VERIFICATION_STATUS},isPaymentSetupCompleteForAllEnabledProcessors:function(e){return _.all(e.enabledProcessorTypes,(function(t){return d.isProcessorPaymentSetupComplete(e,t)}))},applicableProcessorTypes:function(e,t,n){var r=[];return d.SUPPORTED_CURRENCIES&&_.forOwn(d.SUPPORTED_CURRENCIES,(function(n,i){_.contains(n[e],t)&&r.push(i)})),_.union(r,n)},getProcessorChoices:function(e){return _.filter(d.PROCESSOR_CHOICES,(function(t){return _.contains(e,t[0])}))},getCountryChoices:function(e){return _.get(d.COUNTRY_CHOICES,e,[])},isCapabilityEnabledForAnyEnabledProcessor:function(e,t){return _.any(e.enabledProcessorTypes,(function(e){var n=d.get(e),r=_.get(n,t,null);return null===r?(console.error("processors.isCapabilityEnabledForAnyEnabledProcessor: service is missing capability flag:",e,t),!1):r}))},processorTypesForCapability:function(e){return _.filter(d.PROCESSOR_TYPES,(function(t){var n=d.get(t),r=_.get(n,e,null);return null===r?(console.error("processors.isCapabilityEnabledForAnyEnabledProcessor: service is missing capability flag:",t,e),!1):r}))},isAddingEmvDevicePossibleForSelectedProcessor:function(e,t){return(d.get(t).isAddingEmvDevicePossible||_.always)(e)},processorReverificationDate:function(e){return _.get(e,e.defaultProcessorType+"ProcessorReverificationDeadline")}};return d}]),e.factory("stripe",["$injector","$q","$rootScope","db","models","processors","Stripe",function(e,r,a,o,s,c,l){var u={invalid_number:c.ERRORS.INVALID_CARD_NUMBER,incorrect_number:c.ERRORS.BAD_CARD_NUMBER,invalid_expiry_month:c.ERRORS.INVALID_EXPIRATION,invalid_expiry_year:c.ERRORS.INVALID_EXPIRATION,expired_card:c.ERRORS.BAD_EXPIRATION,invalid_cvc:c.ERRORS.INVALID_SECURITY_CODE,incorrect_cvc:c.ERRORS.BAD_SECURITY_CODE,incorrect_zip:c.ERRORS.BAD_POSTAL_CODE,card_declined:c.ERRORS.BAD_CARD,processing_error:c.ERRORS.TRY_AGAIN,rate_limit:c.ERRORS.WAIT},d=[{regex:/^Expired API Key provided/i,message:c.ERRORS.REFRESH}],m=o.slipstream("stripeLivePublishableKey"),p=o.slipstream("stripeTestPublishableKey"),f=function(e){return e?p:m},h=function(e,t,n){var o=r.defer();l.setPublishableKey(m);var s={currency:e.processorCurrency,country:t.processorCountry,account_number:t.accountNumber,account_holder_name:t.accountHolderName,account_holder_type:t.accountHolderType};return t.routingNumber&&(s.routing_number=t.routingNumber),l.bankAccount.createToken(s,(function(e,t){a.$safeApply((function(){if(t.error){c.log("Stripe client-side error ("+(t.status||"unknown error")+")",_.extend({stripeResponse:t},n));var e=t.error.message+".";return t.error.code&&(e=u[t.error.code]||e),o.reject([e])}return o.resolve({processorType:i,stripeBankAccountToken:t.id})}))})),o.promise},g=function(t,n,o,s,m){var p=r.defer();if(m=m||!1,!l)return c.log("Stripe: unable to load stripe.js"),p.reject([c.ERRORS.SCRIPT]),p.promise;var h=function(e){var t;e.error.code?t=u[e.error.code]:e.error.message&&_.forEach(d,(function(n){if(e.error.message.match(n.regex))return t=n.message,!1})),t||(t=c.ERRORS.GENERIC_CARD);var n="card_error"===e.error.type?c.INFO:c.ERROR,r="Stripe client-side "+(e.status||"")+" error";return r+=" ("+(e.error.type||"unknown error")+")",e.error.message&&(r+=" - "+e.error.message),c.log(r,_.extend({stripeResponse:e,error:t},s),{type:e.error.type},n),p.reject([t])};l.setPublishableKey(f(o));var g={number:n.number,exp_month:n.expirationMonth,exp_year:n.expirationYear};n.cvc&&(g.cvc=n.cvc),g.name=n.name||"",g.address_zip=n.postalCode||"",g.address_country=n.countryCode||"";var y=e.get("auth");if(!t.isStripePerformanceModeSupported||m||y.currentUser.isAuthenticated)l.card.createToken(g,(function(e,t){a.$safeApply((function(){return t?t.error?h(t):p.resolve({processorType:i,stripeToken:t.id,stripePaymentIntentId:null,stripePaymentMethodId:null,stripeIsRetryingPayment:m}):p.reject([c.ERRORS.TIMEOUT])}))}));else{var v=l(f(o),{apiVersion:"2020-08-27; api_performance_mode_beta=v1"}),T={number:g.number,exp_month:g.exp_month,exp_year:g.exp_year,cvc:g.cvc};v.createPaymentMethod({type:"card",card:T,billing_details:{name:g.name}}).then((function(e){a.$safeApply((function(){return e?e.error?h(e):e.paymentMethod?p.resolve({processorType:i,stripeToken:null,stripePaymentIntentId:null,stripePaymentMethodId:e.paymentMethod.id,stripeIsRetryingPayment:m}):p.reject([c.ERRORS.UNKNOWN]):p.reject([c.ERRORS.TIMEOUT])}))}))}return p.promise};return{ERRORS:t,ONBOARDING_MESSAGES:n,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/",DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/refunding-a-disputed-charge/",NAME:"Stripe",PROCESSOR_TYPE:i,PENDING_STATEMENT_TEXT:"STRIPE",STATEMENT_TEXT_PREFIX:"FH* ",STATEMENT_TEXT_REGEX:/^[a-zA-Z0-9\.\(\)\{\}\[\]&!\$;\-%_\?:\#@\~=\^\+| ]+$/,PROCESSOR_FIELDS:["stripeToken","stripePaymentIntentId","stripePaymentMethodId","stripeIsRetryingPayment"],tokenizeBankAccount:function(e,t,n){if(!l){var a=r.defer();return c.log("Stripe: unable to load stripe.js"),a.reject([c.ERRORS.SCRIPT]),a.promise}var o=h(e,t,n),s=h(e,t,n);return r.all([o,s]).then((function(e){var t=e[0],n=e[1];return{processorType:i,stripeAccountBankAccountToken:t.stripeBankAccountToken,stripeCustomerBankAccountToken:n.stripeBankAccountToken}}),(function(e){return r.reject(_.unique(_.append(e)))}))},tokenizeCard:g,tokenizedCard:function(e){return{processorType:i,stripeToken:e}},testToken:function(e,t){var n={number:"4242424242424242",expirationMonth:1,expirationYear:moment().year()+1,cvc:"123"};return t=_.extend(t,{testing:!0}),g(e,n,e.isDemoModeEnabled,t,!1).then((function(e){var t=e.stripeToken;return console.info("stripe: test token",t),t}))},chargedCard:function(e){var t={processorType:i,stripePaymentIntentId:e.processorId};return _.extend(t,e),t},completeClientAction:function(e,t,n,a,o){var s=r.defer();return function(e,t,n){var r=l(f(t));return(n?r.handleCardSetup:r.handleCardAction)(e)}(t,a,n).then((function(e){if(e.error)s.reject(T("Authorization failed"));else{var t=function(e,t){var n={processorType:i,stripeToken:null,stripePaymentMethodId:null};return t?n.stripeSetupIntentId=e.setupIntent.id:n.stripePaymentIntentId=e.paymentIntent.id,n}(e,n);s.resolve(t)}}),(function(){s.reject(T("Authorization failed"))})),s.promise},isAdjustmentValid:function(e,t){return!e.isProcessable||"from-company"!==e.direction||!t.isAdmin},minimumBookingFee:function(e){return e.minimumFee},minimumChargeAmount:function(e){return s.Payment.minimumChargeAmounts(e,i)},isAutomaticCreationOfAccountsEnabled:!0,isBankAccountsEnabled:!0,isRefundReserveEnabled:!0,isBankAccountCreationEnabled:_.constant(!0),isBankAccountTokenizationNeeded:!0,isBankAccountVerificationDoneViaDeposits:!0,isBookingFeeProratedForRefunds:!1,isCardsEnabled:!0,isCardOnFileEnabled:!0,isConnectedAfterOnboarding:!1,isCreditCardsEnabled:!0,isDeferredChargesEnabled:!0,isDemoCardNumberCheckSupported:!0,isDisputesEnabled:!0,isEmvEnabled:!0,isFileChargesEnabled:!0,isHoldsEnabled:!0,isSofortEnabled:!0,isIdealEnabled:!0,isBancontactEnabled:!0,isWalletsEnabled:!0,isPaypalEnabled:!1,isPayoutsEnabled:!0,isTosEnabled:!0,isTransactionsEnabled:!0,isAccountIdentifierVisibleToCompanyUsersWithPermission:!1,isAdditionalAccountSetupRequired:!1,statementText:function(e){return e.features.stripeStatementText||e.statementText},filterEmvDetails:function(e){var t=_.toTrueKeys(["File Name","Preferred Name"]);return _.filter(e,(function(e){return t[e.key]}))},getAvailableWalletType:function(e){var t=l(f(!1)).paymentRequest({country:e.processorCountry,currency:e.processorCurrency,total:{label:"Wallet availability check",amount:0}});return r.when(t.canMakePayment(),(function(e){if(null!==e){var t=_.keys(_.pick(e,_.identity))[0];if("applePay"===t)return c.APPLE_PAY_WALLET_TYPE;if("googlePay"===t)return c.GOOGLE_PAY_WALLET_TYPE}return null}),(function(){return null}))}}}]),e.factory("balanced",["$rootScope","$timeout","$q","processors",function(e,r,i,o){var s=function(){var e=i.defer();return e.reject([o.ERRORS.UNSUPPORTED]),e.promise};return{ERRORS:t,ONBOARDING_MESSAGES:n,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/",DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/refunding-a-disputed-charge/",NAME:"Balanced",PROCESSOR_TYPE:a,PENDING_STATEMENT_TEXT:"BALANCED",STATEMENT_TEXT_PREFIX:"BAL*",STATEMENT_TEXT_REGEX:/^.*$/,tokenizeBankAccount:s,tokenizeCard:s,isAutomaticCreationOfAccountsEnabled:!1,isBankAccountsEnabled:!1,isRefundReserveEnabled:!1,isBankAccountCreationEnabled:_.constant(!0),isBankAccountTokenizationNeeded:!1,isBankAccountVerificationDoneViaDeposits:!1,isCardsEnabled:!1,isCardOnFileEnabled:!1,isConnectedAfterOnboarding:!1,isCreditCardsEnabled:!1,isDemoCardNumberCheckSupported:!0,isDisputesEnabled:!1,isSofortEnabled:!1,isIdealEnabled:!1,isBancontactEnabled:!1,isWalletsEnabled:!1,isPaypalEnabled:!1,isPayoutsEnabled:!0,isTosEnabled:!1,isTransactionsEnabled:!0,isAccountIdentifierVisibleToCompanyUsersWithPermission:!1,isAdditionalAccountSetupRequired:!1,statementText:function(e){return e.statementText},filterEmvDetails:function(e){return e}}}]),e.factory("cardflight",(function(){return{isTestToken:function(e){return/^test_/.test(e)}}})),e.factory("Stripe",(function(){return window.Stripe||null})),e.factory("stripeEmv",_.optional(["$q","$filter","$rootScope","$window","auth","db","events","flash","models","?native",function(e,t,n,r,i,a,o,s,c,l){if(!r.StripeTerminal||!r.StripeTerminal.PaymentStatus)return null;var u=t("amount"),d={};d[r.StripeTerminal.PaymentStatus.READY]=T("Waiting..."),d[r.StripeTerminal.PaymentStatus.NOT_READY]=cT("Status shown when a card reader is not ready to accept payment","Not ready..."),d[r.StripeTerminal.PaymentStatus.PROCESSING]=T("Charging card..."),d[r.StripeTerminal.PaymentStatus.WAITING_FOR_INPUT]=T("Waiting for card..."),d.DISCONNECTED=T("Not connected."),d.UNKNOWN=T("Not connected."),d.NATIVE=T("Waiting...");var m,p,f,h=r.slipstream&&"production"!==r.slipstream.configuration&&r.slipstream.isStripeEmvSimulatorEnabled,g={cls:"EmvDevice",name:"EMV Simulator",pk:-1},y=function(e){return function(){return new r.Promise((function(t,n){a.emvDevice.authenticate({shortname:e.shortname},null,null,{}).$promise.then((function(e){t(e.data.connectionToken)}),(function(e){console.error("stripeEmv: failed to retrieve connection token",e),n(new Error("failed to retrieve activation token from Stripe."))}))}))}},v=function(){n.$safeApply()},E=function(){n.$safeApply((function(){s.error(T("Reader has been disconnected unexpectedly."))}))},b=function(){n.$safeApply()},C=l&&l.isNative,k=!1,A=l.EMV_TYPES.BLUETOOTH_EMV;C&&(o.on(n,"fareharbor.native.emv.createConnection",(function(){if(!f)return console.error("stripeEmv: native: no current company"),void l.broadcast("fareharbor.native.emv.connectionCreated",{token:"",location:"",processor_id:""});console.info("stripeEmv: native: requesting connection token",f.shortname),a.emvDevice.authenticate({shortname:f.shortname},null,null,{}).$promise.then((function(e){console.info("stripeEmv: native: created connection token"),l.broadcast("fareharbor.native.emv.connectionCreated",{token:e.data.connectionToken,location:f.stripeEmvLocationId,processor_id:f.stripeProcessorIdentifier})}),(function(e){console.error("stripeEmv: native: failed to connect",e.data),l.broadcast("fareharbor.native.emv.connectionCreated",{token:"",location:"",processor_id:""})}))})),o.on(n,"fareharbor.native.emv.connected",(function(e,t){console.info("stripeEmv: native: connected"),k=!0,p=null,A=(t=t||{}).reader||l.EMV_TYPES.BLUETOOTH_EMV})),o.on(n,"fareharbor.native.emv.disconnected",(function(){console.info("stripeEmv: native: disconnected"),k=!1})),o.on(n,"fareharbor.native.emv.completed",(function(e,t){if(console.info("stripeEmv: native: completed",t),l.broadcast("fareharbor.native.emv.completed.received",{intent_id:t.stripePaymentIntentId}),!p)return console.error("stripeEmv: attempting to complete EMV without a current deferred",t),void l.broadcast("fareharbor.native.emv.charge.failed",{error:"attempting to complete EMV without a current deferred"});if(t.stripePaymentIntentId)p.resolve({processorId:t.stripePaymentIntentId}),l.broadcast("fareharbor.native.emv.charge.succeeded",{intent_id:t.stripePaymentIntentId});else{var n=t.code||c.EmvDevice.UNKNOWN_ERROR,r=c.EmvDevice.STRIPE_ERRORS[n]||c.EmvDevice.STRIPE_ERRORS[c.EmvDevice.UNKNOWN_ERROR];l.broadcast("fareharbor.native.emv.charge.failed",{error:r}),p.reject(r)}p=null})));var P={isSimulatorEnabled:h,STORAGE_KEY:"stripeEmvDevicePk",providerType:"stripe",selectDevice:function(t){return k?e.reject():t&&t.reader?(m||P.connect(t.emvDevice.company),m.connectReader(t.reader,{fail_if_in_use:!0}).then((function(n){return n.error?(n.error.code!==c.EmvDevice.CONNECT_READER_ERROR_CODE&&console.error("stripeEmv: failed to connect",n),e.reject(n.error)):(t.status=c.EmvDevice.ONLINE_STATUS,e.when(t))}))):e.reject()},discoverEmvDevices:function(t,n){if(k)return e.when([]);m||P.connect(t);var r={};return h&&(r.simulated=!0),m.discoverReaders(r).then((function(r){return r.error?(console.warn("stripeEmv: failed to discover",r.error),e.reject(r.error)):(console.log("stripeEmv: successfully discovered readers",r.discoveredReaders),h?(g.company=t,i=[{emvDevice:g,status:c.EmvDevice.ONLINE_STATUS,reader:r.discoveredReaders[0]}]):i=_.map(n,(function(e){var t=_.find(r.discoveredReaders,{id:e.identifier});return{emvDevice:e,status:t&&t.status===c.EmvDevice.ONLINE_STATUS?c.EmvDevice.ONLINE_STATUS:c.EmvDevice.OFFLINE_STATUS,reader:t}})),e.when(i));var i}),(function(t){return console.warn("stripeEmv: failed reader discovery",t),e.reject()}))},connect:function(e){i.permissions.canList(c.EmvDevice,e)&&(C&&(f=e,l.isEmvConnected(e)?(k=!0,A=l.readerType,console.info("stripeEmv: native: the native application is already connected. EMV device serial number: ",l.serialNumber)):(console.info("stripeEmv: native: requesting the native application connect"),l.broadcast("fareharbor.native.emv.connect"))),m=r.StripeTerminal.create({onFetchConnectionToken:y(e),onCheckoutStatusChanged:v,onUnexpectedReaderDisconnect:E,onConnectionStatusChange:b}))},disconnect:function(){C&&(l.disconnectEmv(),f=null,k=!1),m&&(m.disconnectReader(),m=null)},isConnected:function(){return!!k||m&&"connected"===m.getConnectionStatus()},isNFC:function(){return A===l.EMV_TYPES.NFC},charge:function(t,i,o,s,d,g){var y=g.emvAsyncSuccessCallback||_.ignore;if(k){var v=e.defer();return p?(console.warn("stripeEmv: native: already charging natively"),v.reject(c.EmvDevice.STRIPE_ERRORS[c.EmvDevice.UNKNOWN_ERROR]),v.promise):(console.info("stripeEmv: native: creating interaction token"),a.emvDevice.createInteractionToken({shortname:t.shortname},{description:i.unicode,bookingGrosses:s}).$promise.then((function(e){console.info("stripeEmv: native: created interaction token"),l.broadcast("fareharbor.native.emv.begin",{clientSecret:e.primaryData,amount:o,formattedAmount:u(o,f.processorCurrency)})}),(function(e){console.error("stripeEmv: native: failed to create interaction token",e.primaryData),v.reject(c.EmvDevice.STRIPE_ERRORS[c.EmvDevice.UNKNOWN_ERROR])})),p=v,v.promise)}if(!m)return e.reject(c.EmvDevice.STRIPE_ERRORS[c.EmvDevice.UNKNOWN_ERROR]);h&&m.setSimulatorConfiguration({testCardNumber:"4242424242424242",testPaymentMethod:"visa"});var T={line_items:[{description:i.unicode,amount:o,quantity:1}],tax:0,total:o,currency:t.processorCurrency},E=r.slipstream.isStripeAsyncEmvEnabled;return m.setReaderDisplay({type:"cart",cart:T}).then((function(){return n.$apply(),a.emvDevice.createInteractionToken({shortname:t.shortname},{description:i.unicode,bookingGrosses:s}).$promise})).then((function(e){return n.$apply(),m.collectPaymentMethod(e.primaryData)})).then((function(t){if(n.$apply(),t.error)return e.reject(t.error);if(null===t.paymentIntent)return e.reject({code:"payment_intent_is_null"});if(E){var r=e.defer();return y({processorId:t.paymentIntent.id}).then((function(){return r.resolve(t.paymentIntent)})),r.promise}return e.when(t.paymentIntent)})).then((function(e){return n.$apply(),m.processPayment(e)})).then((function(t){if(n.$apply(),t.error)return e.reject(t.error);var r=E;return e.when({processorId:t.paymentIntent.id,isEmvAsyncSuccessCallbackCalled:r})})).catch((function(t){n.$apply();var r=c.EmvDevice.UNKNOWN_ERROR;return t.decline_code&&c.EmvDevice.STRIPE_ERRORS[t.decline_code]?r=c.EmvDevice.STRIPE_ERRORS[t.decline_code]:t.code&&(r=c.EmvDevice.STRIPE_ERRORS[t.code]||r),t.data&&t.data.createEmvInteractionTokenForm&&(r=t.data.createEmvInteractionTokenForm.all[0]),console.error("stripeEmv: unhandled error",t,r),e.reject(r)}))},cancel:function(){k?l.broadcast("fareharbor.native.emv.cancel"):m&&m.cancelCollectPaymentMethod()},information:function(){return k?d[p?"NATIVE":r.StripeTerminal.PaymentStatus.READY]:m?d[m.getPaymentStatus()]||d.UNKNOWN:d.DISCONNECTED},lastDecline:function(){return null}};return P}])),e.factory("adyenEmv",["$q","db","models",function(e,t,n){var r=function(e,t){return e.primaryData[t.identifier]?n.EmvDevice.ONLINE_STATUS:n.EmvDevice.OFFLINE_STATUS},i={providerType:"adyen",STORAGE_KEY:"adyenEmvDevicePk",currentDevice:null,currentTransactionId:null,connect:_.noop,disconnect:function(){i.currentDevice=null},isConnected:function(){return!_.isNull(i.currentDevice)},charge:function(t,n,r,a,o){return e.when({emvDeviceId:i.currentDevice.identifier})},information:_.noop,cancel:function(){var e=i.currentDevice,n=e.identifier,r=i.currentTransactionId;_.isNull(r)?console.warn("adyenEmv: no EMV transaction is in progress"):(console.log("adyenEmv: attempting to cancel EMV transaction for device",n," transactionId",r),t.emvDevice.cancelCharge({shortname:e.company.shortname},{emvDeviceId:n,tokenId:r}).$promise.then((function(){i.currentTransactionId=null})))},lastDecline:_.noop,discoverEmvDevices:function(n,i){return t.emvDevice.checkConnections({shortname:n.shortname},null,null,null).$promise.then((function(t){var n=_.map(i,(function(e){return{emvDevice:e,status:r(t,e)}}));return e.when(n)}))},selectDevice:function(a){if(!a)return e.reject("no discovered emv device");var o=a.emvDevice,s=o.company;return t.emvDevice.checkConnection({shortname:s.shortname,emvDevicePk:o.pk},null,null,null).$promise.then((function(t){var s=r(t,o);return a.status=s,s===n.EmvDevice.ONLINE_STATUS?(i.currentDevice=o,e.when(a)):e.reject("emv device is offline")}))},isSimulatorEnabled:!1};return i}]),e.factory("loginProviders",[function(){return{NAMES_BY_TYPE:{google:"Google",marriott:"Marriott",amazon:"Amazon",auth0:"Auth0"}}}]),e.factory("emv",["$q","$rootScope","auth","db","events","models","stripeEmv","adyenEmv","storage","native",function(e,t,n,r,i,a,o,s,c,l){var u=null,d=null,m=_.map(r.slipstream("emvProviderChoices"),"0"),p={};p.adyen=s,p.stripe=o;var f=_.filter([o,s]),h=_.filter(f,(function(e){return _.find(m,(function(t){return e&&e.providerType===t}))})),g=function(e){return _.find(h,(function(t){if(t.providerType===e)return t}))},y=function(){if(!d||!u)return"";var e=d.STORAGE_KEY+":"+u.shortname;return d.isSimulatorEnabled&&(e="simulator:"+e),e},v={ADYEN_PROVIDER:s,STRIPE_PROVIDER:o,SUPPORTED_PROVIDERS:h,currentDevice:null,setProvider:function(e){d=g(e.features.emvProvider)},getDefaultProviderForProcessorType:function(e){return p[e]},disconnect:function(){if(d)return d.disconnect()},isConnectedToDevice:function(e){return v.isConnected()&&e===v.currentDevice},isConnected:function(){if(d)return d.isConnected()},isNFC:function(){return!(!d||!d.isNFC)&&d.isNFC()},storeDeviceSelection:function(e){d&&u&&c.set(y(),e.pk)},selectDevice:function(t){return d&&t?(v.currentDevice!==t.emvDevice&&v.disconnect(),d.selectDevice(t).then((function(e){v.currentDevice=e.emvDevice,v.storeDeviceSelection(v.currentDevice)}))):e.reject()},previouslySelectedDevicePk:function(){if(d&&u)return c.get(y())},connect:function(e){e&&e.features.isEmvEnabled&&(d=g(e.features.emvProvider))&&d.connect(e)},charge:function(t,n,r,i,a,o){return d?d.charge(t,n,r,i,a,o):e.reject()},discoverEmvDevices:function(t){if(!n.permissions.canList(a.EmvDevice,t))return e.when([]);if(!t||!t.features.isEmvEnabled)return e.when([]);var i=r.emvDevices({shortname:t.shortname},null,null,null,{flashError:!1}),o=function(e){return _.map(e,(function(e){return{emvDevice:e,status:a.EmvDevice.OFFLINE_STATUS}}))};return v.isConnected()||(l.isEmvConnected(t)||v.disconnect(),v.connect(t)),i.$promise.then((function(){return d?i.length||d.isSimulatorEnabled?d.discoverEmvDevices(t,i).then((function(t){return e.when(t)})).catch((function(t){return console.warn("emv: failed to discover emv devices",t),e.when(o(i))})):(console.log("emv: no emv devices registered yet"),e.when([])):e.when(o(i))}))},information:function(){return d?d.information():""},lastDecline:function(){return d?v.isDebugging?v.debugDecline:d.isConnected()?d.lastDecline():null:null},cancel:function(){if(d)return d.cancel()}};return i.on(t,"auth.logout",(function(){d&&d.disconnect()})),i.on(t,"navigation.company.updated",(function(e,t){var r=t.company;u&&!r||r&&u===r&&d&&d.isConnected()||(u=r,d&&d.disconnect(),r.features.isEmvEnabled&&(d=g(r.features.emvProvider))&&n.currentUser.isAuthenticated&&v.discoverEmvDevices(r).then((function(e){var t,n=_.filter(e,(function(e){return"online"===e.status})),r=v.previouslySelectedDevicePk();r&&(t=_.find(n,(function(e){return e.emvDevice.pk===r}))||_.first(n)),v.selectDevice(t).catch((function(){console.warn("emv: unable to connect to device.")}))})).catch((function(){console.warn("emv: unable to connect to device: EMV provider not loaded.")})))})),v.isDebugging=!1,v.debugDecline={customerReceipt:[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"}],merchantReceipt:[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"}]},v.debugDetails=[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"},{key:"Name",value:"Adeventure Extremer"},{key:"Address",value:"12:32pm"},{key:"Zip",value:"12321"},{key:"City",value:"Aina Haina"},{key:"Country",value:"USA"},{key:"Contact",value:"4155551212"},{key:"Transaction",value:"ch_1BLzcrL4FOCDmmKvrGbjEG2t"},{key:"Authorization",value:"123212321"},{key:"Scheme",value:"super sweet VISA"},{key:"Account",value:"**** **** **** 4242"},{key:"AID",value:"A0000000031010"},{key:"Entry Mode",value:"Chip"},{key:"Verification",value:"Signature"}],v}]),e.factory("paypal",["db","models",function(e,r){var i=e.slipstream("paypalLiveClientId"),a=e.slipstream("paypalLivePlatformFeesPayeeMerchantId");return{ERRORS:_.extend({},t,{"country-mismatch":T("PayPal account country invalid."),"onboard-incomplete":T("PayPal onboard not completed."),"permissions-mismatch":T("PayPal permissions not granted."),"email-unconfirmed":T("Please confirm your email address in order to receive payments."),"payments-unreceivable":T("You currently cannot receive payments due to a restriction on your PayPal account.")}),ONBOARDING_MESSAGES:n,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/paypal/",DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/paypal",NAME:"PayPal",PROCESSOR_TYPE:o,PENDING_STATEMENT_TEXT:"PAYPAL * ",STATEMENT_TEXT_PREFIX:"PAYPAL * ",STATEMENT_TEXT_REGEX:/^[a-zA-Z0-9\.\-\* ]+$/,LIVE_CLIENT_ID:i,LIVE_PLATFORM_FEES_PAYEE_MERCHANT_ID:a,isAutomaticCreationOfAccountsEnabled:!1,isBankAccountsEnabled:!1,isRefundReserveEnabled:!1,isBankAccountCreationEnabled:_.constant(!0),isBankAccountTokenizationNeeded:!1,isBankAccountVerificationDoneViaDeposits:!1,isBookingFeeProratedForRefunds:!0,isCardsEnabled:!1,isCardOnFileEnabled:!1,isConnectedAfterOnboarding:!0,isCreditCardsEnabled:!1,isDeferredChargesEnabled:!1,isDemoCardNumberCheckSupported:!1,isDisputesEnabled:!0,isEmvEnabled:!1,isFileChargesEnabled:!1,isHoldsEnabled:!1,isSofortEnabled:!1,isIdealEnabled:!1,isBancontactEnabled:!1,isWalletsEnabled:!1,isPaypalEnabled:!0,isPayoutsEnabled:!1,isTosEnabled:!1,isTransactionsEnabled:!1,minimumBookingFee:function(e){return 0},minimumChargeAmount:function(e){return r.Payment.minimumChargeAmounts(e,o)},isAccountIdentifierVisibleToCompanyUsersWithPermission:!0,isAdditionalAccountSetupRequired:!1,statementText:function(e){return e.features.paypalStatementText||e.statementText.slice(0,14)},filterEmvDetails:function(e){return e}}}]),e.directive("ngPaypalCheckout",["$document","$filter","$window","db","navigation","paypal","processors",function(e,t,n,r,i,a,s){var c={},l=function(e){return(e/100).toFixed(2)},u=["credit","bancontact","blik","eps","giropay","ideal","mercadopago","mybank","p24","sepa","sofort","venmo"];return{restrict:"A",templateUrl:"ng-paypal-checkout",controllerAs:"paypalCtrl",controller:["$scope",function(t){var n=this;n.status="loading";var d=t.paymentCtrl.company;if(d.paypalMerchantId){var m=null;t.bookForm?(m=t.bookForm,t.submit=t.bookCtrl.submit):t.orderForm?(m=t.orderForm,t.submit=t.cartCtrl.submit):t.paymentsForm&&(m=t.paymentsForm);var p=s.get(o).statementText(d),f=function(){g.Buttons({createOrder:function(e,n){return n.order.create({intent:"CAPTURE",purchase_units:[{amount:{currency_code:d.processorCurrency.toUpperCase(),value:l(t.paymentCtrl.amount()),breakdown:{item_total:{currency_code:d.processorCurrency.toUpperCase(),value:l(t.paymentCtrl.amount())}}},payee:{merchant_id:d.paypalMerchantId},payment_instruction:{disbursement_mode:"INSTANT",platform_fees:[{amount:{currency_code:d.processorCurrency.toUpperCase(),value:l(t.paymentCtrl.bookingFee())},payee:{merchant_id:a.LIVE_PLATFORM_FEES_PAYEE_MERCHANT_ID}}]},soft_descriptor:p}],application_context:{brand_name:d.name,payment_method:{payee_preferred:"IMMEDIATE_PAYMENT_REQUIRED"},shipping_preference:"NO_SHIPPING"}})},onApprove:function(e){t.$apply((function(){t.paymentCtrl.processorType(a.PROCESSOR_TYPE),t.paymentCtrl.paypalOrderId(e.orderID),t.submit(m)}))},onCancel:function(){t.$apply((function(){console.info("PayPal checkout cancelled")}))},onError:function(e){t.$apply((function(){console.error("PayPal checkout error",e),t.paymentCtrl.addErrorMessage(m,s.ERRORS.UNKNOWN)}))}}).render("#ng-paypal-checkout-button"),n.status="success"},h="PayPal-"+d.shortname,g=c[h];if(g)f();else{var y={"client-id":a.LIVE_CLIENT_ID,"merchant-id":d.paypalMerchantId,currency:d.processorCurrency.toUpperCase(),"integration-date":"2020-03-10",debug:r.slipstream("isDebug")?"true":"false"},v=function(e){var t=["credit"];if(e.defaultProcessorType!==a.PROCESSOR_TYPE){var n=s.get(e.defaultProcessorType),r={isBancontactEnabled:"isBancontactPaymentsEnabled",isCreditCardsEnabled:null,isIdealEnabled:"isIdealPaymentsEnabled",isSofortEnabled:"isSofortPaymentsEnabled"};_.forEach({isBancontactEnabled:"bancontact",isCreditCardsEnabled:"card",isIdealEnabled:"ideal",isSofortEnabled:"sofort"},(function(i,a){var o,s=_.get(n,a,null);null===s&&console.error("ngPaypalCheckout.fundingSourcesToDisable: service is missing capability flag:",n.PROCESSOR_TYPE,a);var c=r[a];null===(o=!c||_.get(e.features,c,null))&&console.error("ngPaypalCheckout.fundingSourcesToDisable: feature is missing for commpany:",e,c),s&&o&&t.push(i)}))}return(t=_.unique(t.concat(u))).length?t.join():null}(d);v&&(y["disable-funding"]=v);var T=i.compose("https://www.paypal.com/sdk/js",y),E=document.createElement("script");E.setAttribute("data-namespace",h),E.src=T,E.onload=function(){t.$apply((function(){g=c[h]=window[h],f()}))},E.onerror=function(){n.status="error"},e[0].body.appendChild(E)}}else n.status="error"}]}}]),e.factory("adyen",["$q","models","processors",function(e,i,a){var o=_.extend({},n,{failed:T("More information required")});return{ERRORS:t,ONBOARDING_MESSAGES:o,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/",DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/refunding-a-disputed-charge/",NAME:"Adyen",PROCESSOR_TYPE:r,PENDING_STATEMENT_TEXT:"ADYEN",STATEMENT_TEXT_PREFIX:"",STATEMENT_TEXT_REGEX:/^[a-zA-Z0-9 ]+$/,isAddingEmvDevicePossible:function(e){return a.isProcessorPaymentSetupComplete(e,r)},isAdjustmentValid:function(e,t){return!e.isProcessable||"from-company"!==e.direction||!t.isAdmin},isAutomaticCreationOfAccountsEnabled:!1,isBankAccountsEnabled:!0,isRefundReserveEnabled:!0,isBankAccountCreationEnabled:function(e){return a.isProcessorVerified(e,r)},isBankAccountTokenizationNeeded:!1,isBankAccountVerificationDoneViaDeposits:!1,isBookingFeeProratedForRefunds:!1,isCardsEnabled:!1,isCardOnFileEnabled:!0,isCreditCardsEnabled:!0,isConnectedAfterOnboarding:!1,isDeferredChargesEnabled:!0,isDemoCardNumberCheckSupported:!1,isDisputesEnabled:!0,isEmvEnabled:!0,isFileChargesEnabled:!0,isHoldsEnabled:!0,isSofortEnabled:!1,isIdealEnabled:!0,isBancontactEnabled:!0,isWalletsEnabled:!1,isPaypalEnabled:!1,isPayoutsEnabled:!0,isTosEnabled:!0,isTransactionsEnabled:!0,isAccountIdentifierVisibleToCompanyUsersWithPermission:!1,isAdditionalAccountSetupRequired:!0,minimumBookingFee:function(e){return e.minimumFee},minimumChargeAmount:function(e){return i.Payment.minimumChargeAmounts(e,r)},tokenizeCard:function(){var t=e.defer();return t.resolve({processorType:r}),t.promise},chargedCard:function(e){var t={processorType:r,adyenEmvDeviceId:e.emvDeviceId};return _.extend(t,e),t},statementText:function(e){return e.features.adyenStatementText||e.statementText},filterEmvDetails:function(e){return e},handleRedirect:function(e){(new AdyenCheckout).createFromAction(e).mount("#adyen-redirect-component-container")},updateCompanyFieldForBankAccountVerification:function(e,t){e.isAdyenProcessorDefaultBankAccountReadyForPayout=t.isVerified}}}]),e.directive("ngAdyenCheckout",["db",function(e){var t=e.slipstream("adyenCheckoutLiveOriginKey"),n=e.slipstream("adyenCheckoutTestOriginKey"),r=e.slipstream("targetLanguage"),i=e.slipstream("configuration"),a={"en-us":"en-US","en-au":"en-US","en-ca":"en-US","en-gb":"en-US","zh-cn":"zh-CN",da:"da-DK",nl:"nl-NL",fi:"fi-FI",fr:"fr-FR","fr-ca":"fr-FR",de:"de-DE",it:"it-IT",ja:"ja-JP",ko:"ko-KR",no:"no-NO",pl:"pl-PL",pt:"pt-BR",ru:"ru-RU",es:"es-ES",sv:"sv-SE"},o={"creditCard.numberField.placeholder":"","creditCard.cvcField.placeholder":"","creditCard.expiryDateField.placeholder":""},s={};_.forEach(["en-US","zh-CN","da-DK","nl-NL","fi-FI","fr-FR","de-DE","it-IT","ja-JP","ko-KR","no-NO","pl-PL","pt-BR","ru-RU","es-ES","sv-SE"],(function(e){s[e]=o}));var c=a[r]?a[r]:"en-US";return{restrict:"A",controller:["$scope",function(e){e.adyenCheckoutClasses={encryptedCardNumber:{focus:!1,valid:!1,touched:!1,brand:"card"},encryptedExpiryDate:{focus:!1,valid:!1,touched:!1},encryptedSecurityCode:{focus:!1,valid:!1,touched:!1}};var r="production"!==i||e.paymentCtrl.company.isDemoModeEnabled?"test":"live",a=e.paymentCtrl.company.isDemoModeEnabled?n:t,o={brands:["mc","visa","discover","amex","jcb","diners","cup"],locale:c,translations:s,environment:r,originKey:a,onChange:function(t){var n="",r="";e.paymentCtrl.isAdyenCheckoutDataValid=t.isValid,t.isValid&&(n=_.stringifyJSON(t.data.paymentMethod),r=_.stringifyJSON(t.data.browserInfo),e.paymentCtrl.cardCvc(t.data.paymentMethod.encryptedSecurityCode),e.paymentCtrl.cardNumber(t.data.paymentMethod.encryptedCardNumber)),e.paymentCtrl.adyenPaymentMethod(n),e.paymentCtrl.adyenBrowserInfo(r),e.$apply()},onFocus:function(t){e.adyenCheckoutClasses[t.fieldType].focus=t.focus,e.$apply()},onBrand:function(t){e.adyenCheckoutClasses.encryptedCardNumber.brand=t.brand,e.adyenCheckoutClasses.encryptedCardNumber.touched=!0,e.$apply()},onFieldValid:function(t){e.adyenCheckoutClasses[t.fieldType].valid=t.valid,e.adyenCheckoutClasses[t.fieldType].touched=!0,e.$apply()}},l={fontWeight:"normal",padding:"0 12px"};window.matchMedia("(min-width: 680px)").matches&&(l={fontSize:"13px",fontWeight:"normal",padding:"0 12px"}),new AdyenCheckout(o).create("securedfields",{hasHolderName:!0,holderNameRequired:!0,autoFocus:!1,styles:{base:l,placeholder:{fontWeight:"normal",color:"#768593"}}}).mount("#adyen-checkout-component-container")}]}}]),e.directive("ngStripeWallet",["$q","db","processors","Stripe",function(e,t,n,r){var i=t.slipstream("stripeLivePublishableKey");return{restrict:"A",templateUrl:"ng-stripe-wallet",controllerAs:"stripeWalletCtrl",controller:["$scope",function(t){var a=this;a.status="loading";var o=t.paymentCtrl.company,s=null;t.bookForm?(s=t.bookForm,t.submit=t.bookCtrl.submit):t.orderForm?(s=t.orderForm,t.submit=t.cartCtrl.submit):t.paymentsForm&&(s=t.paymentsForm);var c=r(i),l=c.paymentRequest({country:o.processorCountry,currency:o.processorCurrency,total:{label:o.name,amount:t.paymentCtrl.amount()},requestPayerName:!0});t.$watch(t.paymentCtrl.amount,(function(e,t){e!==t&&l.update({total:{label:o.name,amount:e}})}));var u=c.elements().create("paymentRequestButton",{paymentRequest:l,style:{paymentRequestButton:{height:"54px"}}});e.when(l.canMakePayment(),(function(e){e?(u.mount("#ng-stripe-wallet-button"),a.status="success"):(t.paymentCtrl.addErrorMessage(s,n.ERRORS.UNKNOWN),a.status="error")}),(function(){t.paymentCtrl.addErrorMessage(s,n.ERRORS.UNKNOWN),a.status="error"})),l.on("paymentmethod",(function(e){t.paymentCtrl.resetProcessorFields(),t.paymentCtrl.stripePaymentMethodId(e.paymentMethod.id),e.complete("success"),t.submit(s)}))}]}}]),e.run(["$rootScope","emv","loginProviders","processors",function(e,t,n,r){e.emv=t,e.loginProviders=n,e.processors=r}])}()},9619:function(){!function(){"use strict";var e=angular.module("lightframe.services",[]);e.factory("lightframe",["$browser","$sniffer","$window","clientOptions","navigation","xmessage",function(e,t,n,r,i,a){var o="",s=!1,c=!1,l=null,u={},d=function(e){try{e=decodeURIComponent(e),u=JSON.parse(e)||{},l=u.parentUrl||null}catch(e){}};/^fareharbor-embed:/.test(n.name)?(d(window.name.substr("fareharbor-embed:".length)),o=u.embedId||"",s=u.isLightframed||!1):/^fareharbor-lightframe/.test(n.name)&&(d(window.name.substr("fareharbor-lightframe:".length)),c=!0);var m={embedId:o,isLightframe:function(){return n.top!==n&&c},isEmbed:function(){return n.top!==n&&m.embedId},isLightframed:function(){return m.isEmbed()&&s},parentUrl:function(){return l},broadcast:function(e,t){t=_.extend({embedId:m.embedId},t),a.broadcast(e,t)},updateHeight:function(e){m.isEmbed()&&e&&m.broadcast("fareharbor.height",{height:e})},open:function(e){if(e=r.extendUrl(e),m.isEmbed())m.broadcast("fareharbor.open",{url:e});else{var t=n.location.protocol+"//"+n.location.hostname+(n.location.port?":"+n.location.port:"");n.top.location.href=t+e}},close:function(){m.broadcast("fareharbor.close")},ready:function(){m.broadcast("fareharbor.ready")},isDirectAccess:function(){return n.top===n},listenForTouch:function(){var e=function(){m.broadcast("fareharbor.touchDetected")};window.addEventListener("touchstart",(function t(){e(),window.removeEventListener("touchstart",t)}),!1),window.addEventListener("pointerdown",(function t(n){"touch"==n.pointerType&&(e(),window.removeEventListener("pointerdown",t))}),!1)}};return m}]),e.run(["$rootScope","lightframe",function(e,t){e.lightframe=t,e.isLightframe=t.isLightframe(),t.ready(),t.listenForTouch()}])}()},7828:function(){!function(){"use strict";var e=angular.module("native.services",[]);e.factory("native",["$rootScope","$window","auth","db","events","navigation","urls","models",function(e,t,n,r,i,a,o,s){var c={STRONG_SUCCESS_INDICATION:"fareharbor.native.indicate.strongSuccessIndication",WEAK_SUCCESS_INDICATION:"fareharbor.native.indicate.weakSuccessIndication",STRONG_ERROR_INDICATION:"fareharbor.native.indicate.strongErrorIndication",WEAK_ERROR_INDICATION:"fareharbor.native.indicate.weakErrorIndication"},l={NFC:"nfc",BLUETOOTH_EMV:"bluetooth_emv"},u=r.slipstream("isNative")||!1,d=r.slipstream("nativeClient")||"",m=r.slipstream("nativeClientVersion")||"",p=r.slipstream("isDebug"),f=r.slipstream("domain"),h=r.slipstream("protocol"),g="fareharborExtended",y=function(e,t){t=t||{},e.shortname=t.shortname||null,e.emvConnected=t.emvConnected||!1,e.serialNumber=t.serialNumber||null,e.readerType=t.reader||l.BLUETOOTH_EMV},v={isNative:u,client:d,version:m,EMV_TYPES:l,broadcast:function(e,n,r){if(r=r||"fareharbor",console.info("native: triggering",e,n,r),t.webkit&&t.webkit.messageHandlers&&t.webkit.messageHandlers[r])return n=_.extend({type:e},n),void t.webkit.messageHandlers[r].postMessage(n);t.fhdroid?n?fhdroid.postMessage(e,_.stringifyJSON(n)):fhdroid.postMessage(e):console.warn("native: native client unavailable")},indicate:function(e){e=e||c.WEAK_SUCCESS_INDICATION,v.broadcast("fareharbor.native.indicate",{indication:e})},print:function(e){var t={};if(e){var n=["<!DOCTYPE html>",'<html class="native-print">',"<head>",'<meta name="viewport" content="initial-scale=1.0" />'];_.forEach($('head link[type="text/css"][href^="/"]'),(function(e){var t=$(e).attr("href");t=_.startsWith(t,"//")?h+":"+t:h+"://"+f+t,n.push('<link rel="stylesheet" href="'+t+'" type="text/css">')})),n.push("</head>"),n.push("<body>"),n.push(e.outerHTML),n.push("</body>"),n.push("</html>"),t.html=n.join("\n")}console.info("native: print",t),v.broadcast("fareharbor.native.print",t)},isEmvConnected:function(e){return v.shortname===e.shortname&&v.emvConnected},connectEmv:function(e){y(v,e),console.info("stripeEmv: native: setting up EmvConnection",e)},disconnectEmv:function(){y(v),v.broadcast("fareharbor.native.emv.disconnect"),console.info("stripeEmv: native: requesting the native application disconnect")}};_.extend(v,c),i.on(e,"auth.logout",(function(){v.broadcast("fareharbor.native.loggedOut")})),n.currentUser.isAuthenticated||v.broadcast("fareharbor.native.logOut"),t.FH={nativeEvent:function(t){e.$safeApply((function(){i.broadcast(t.type,t)}))}},v.broadcast("fareharbor.native.ready",{sonarKey:r.slipstream("pusherKey")},g),i.on(e,"fareharbor.native.inApp",(function(e,t){v.isNative=!0,t=t||{},v.client=t.client||v.client||"unknown",v.version=t.version||v.version||"unknown",t.shortname===s.Company.ADMIN_SHORTNAME?v.disconnectEmv():v.connectEmv(t)})),i.on(e,"navigation.company.updated",(function(e,t){if(t&&t.company){var r=t.company,i=n.effectiveGroup({},r),a=_.pick(r,["shortname","name","language","imageCdnUrl","imageEmailCdnUrl","features","processorCurrency","processorCountry","timezone","timeFormatType","isAffiliate","isCharter"]),o=_.pick(i,["pk","groupPermissions"]);v.broadcast("fareharbor.native.companyChanged",{company:a,group:o},g)}}));var T=function(){var e=n.effectiveGroup({},n.currentUser.company);v.broadcast("fareharbor.native.userPermissionsChanged",{group:_.pick(e,["pk","groupPermissions"])},g)};return i.on(e,"dashboard.shared.userPermissionsChanged",T),i.on(e,"dashboard.shared.permissionsGroupChanged",T),i.on(e,"fareharbor.native.booking.open",(function(e,t){var n=o.populate(o.dashboard.overlay.contact.booking,{shortname:t.shortname,contactPk:t.contactPk,bookingUuid:t.bookingUuid});a.navigate(n)})),i.on(e,"fareharbor.native.navigate",(function(e,t){a.navigate(t.url)})),p&&i.on(e,"fareharbor.native.test",(function(e,n){t.confirm("fareharbor.native.test triggered; respond?")&&v.broadcast("fareharbor.native.testSucceeded",{number:42})})),v}]),e.run(["$rootScope","native",function(e,t){e.native=t}])}()},5564:function(){!function(){"use strict";var e=angular.module("navigation.directives",["clientOptions.services","lib.services"]);e.directive("ngNavigationActive",["d","navigation",function(e,t){return{restrict:"A",link:function(n,r,i){var a,o=n.isSet(i.ngNavigationExact)?t.pathEquals:t.pathStartsWith,s=function(){var e=a();if(!e)return console.warn("ng-navigation-active: no url",e,i.ngNavigationActive,i.ngHref),void r.removeClass("current");_.isString(e)?r.toggleClass("current",!!o(e)):_.isArray(e)?r.toggleClass("current",_.any(e,(function(t){return t?!!o(t):(console.warn("ng-navigation-active: empty url in list",t,e,i.ngNavigationActive,i.ngHref),!1)}))):console.warn("ng-navigation-active: invalid url",e,i.ngNavigationActive,i.ngHref)};if(i.ngNavigationActive)a=e.watcher(n,i.ngNavigationActive,"",s,!0);else{if(!i.ngHref)return void console.warn("invalid use of ng-navigation-active");a=e.observer(i,"ngHref","",s)}t.watch(n,s),s()}}}]);var t=function(t,n){e.directive(t,["$injector","$parse","navigation",function(e,r,i){var a=e.invoke(n);return{transclude:"element",priority:1e3,terminal:!0,restrict:"A",compile:function(e,n,i){var o=t+"When",s=n[o]?r(n[o]):null;return function(e,t,n){var r,o,c=a(e,t,n);e.$watch((function(){return!(s&&!s(e))&&(c()||!1)}),(function(a,s){var c;n.ngThen&&(e[n.ngThen]=!!a),a&&s||a?(c=a,o&&o.$destroy(),(o=e.$new()).route={bindings:c},i(o,(function(e){r&&r.remove(),t.after(e),r=e}))):s&&(o&&o.$destroy(),r&&(r.remove(),r=null))}),!0)}}}}])};t("ngNavigationSpec",["$parse","navigation",function(e,t){var n={prefix:"pathStartsWith",path:"pathEquals"};return function(r,i,a){var o=_.bind(e(a.ngNavigationSpec),null,r),s=function(e){var r=e[0],i=e[1];return t[n[r]](i)};return function(){var e=o();return _.chooseFirst(e,s)}}}]),t("ngNavigationPrefix",["$parse","navigation",function(e,t){return function(n,r,i){var a=_.bind(e(i.ngNavigationPrefix),null,n),o=function(e){if(!e)throw new Error("ng-navigation-prefix: invalid paths: "+i.ngNavigationPrefix);return t.pathStartsWith(e)};return function(){var e=a();if(_.isUndefined(e))throw new Error("ng-navigation-prefix: undefined paths: "+i.ngNavigationPrefix);if(_.isArray(e)||(e=[e]),!e.length)throw new Error("ng-navigation-prefix: empty paths: "+i.ngNavigationPrefix);return _.chooseFirst(e,o)}}}]),t("ngNavigationPath",["$parse","navigation",function(e,t){return function(n,r,i){var a=_.bind(e(i.ngNavigationPath),null,n),o=function(e){if(!e)throw new Error("ng-navigation-path: invalid paths: "+i.ngNavigationPath);return t.pathEquals(e)};return function(){var e=a();if(_.isUndefined(e))throw new Error("ng-navigation-path: undefined paths: "+i.ngNavigationPath);if(_.isArray(e)||(e=[e]),!e.length)throw new Error("ng-navigation-path: empty paths: "+i.ngNavigationPath);return _.chooseFirst(e,o)}}}]),t("ngNavigationSection",["navigation",function(e){var t={root:"inRootSection",company:"inCompanySection",manifest:"inManifestSection",dashboard:"inDashboardSection"};return function(n,r,i){return function(){var n=i.ngNavigationSection;return e[t[n]]()}}}]),t("ngNavigationInvoiceLogin",["navigation","urls",function(e,t){var n=t.dashboard.reports.invoices.partnerInvoice.index,r=function(t){var n=e.get("next");return!!n&&e.parseQuery(n).source===t};return function(t,i,a){return function(){return e.nextPathEquals(n)&&(r("uuid-invoice")||r("email"))}}}]),e.directive("ngConfirmNavigateAway",["$parse","$rootScope","$window","auth","navigation",function(e,t,n,r,i){return{restrict:"A",require:"?form",compile:function(t,a){var o=a.ngConfirmNavigateAwayWhen?e(a.ngConfirmNavigateAwayWhen):null,s=a.ngConfirmNavigateAwayComplete?e(a.ngConfirmNavigateAwayComplete):null;return function(e,t,a,c){var l=i.url,u=i.stripQuery(l),d=i.parseQuery(l);if(!n.slipstream.isEmbedded||n.slipstream.isBookEmbed){var m=function(){return a.ngConfirmNavigateAway?a.ngConfirmNavigateAway:T("Your changes will be lost.")},p=function(t){return!r.isSessionExpirationInProgress&&(o?o(e,{$url:t}):function(e){var t=_.isUndefined(e)?"":i.stripPrefix(e),n=i.stripQuery(t);if(u!==n)return!0;var r=i.parseQuery(t);return!_.isEmpty(d)&&!_.isEqual(d,r)}(t)&&c.$dirty)},f=function(){if(p())return m()};e.$on("$locationChangeStart",(function(t,i){if(p(i)){var a=n.confirm(T("Are you sure you want to leave this page?")+" "+m());a||(r.isLogoutInProgress=!1,t.preventDefault()),s&&s(e,{$complete:a})}}));var h=angular.element(n);h.on("beforeunload",f),e.$on("$destroy",(function(){h.off("beforeunload",f)}))}}}}}]),e.config(["$provide",function(e){e.decorator("ngHrefDirective",["$delegate",function(e){return e.shift(),e}])}]),e.directive("ngHref",["$browser","$location","$parse","clientOptions","d","navigation",function(e,t,n,r,i,a){return{restrict:"A",link:function(e,t,n){var o=!1,s=function(){var e=c();o&&(e=a.multiUrl(e)),e=r.reflectUrl(e),n.$set("href",e)},c=i.observer(n,"ngHref","",(function(t){if(!o&&a.parseMultiUrl(t))return o=!0,void a.watch(e,s);s()}))}}}]);var n=function(t,n){return e.directive(t,["d","navigation","$parse",function(e,r,i){return{restrict:"A",link:function(a,o,s){var c=a.isSet(s[t+"Strict"]),l=t+"When",u=s[l]?i(s[l]):_.noop,d=e.observer(s,t);o.on("click",(function(e){var t=$(e.target),i=d();i&&n.test(e)&&(s[l]&&!u(a)||e.defaultPrevented||c&&!o.is(t)||t.is("a")&&!o.is(t)||(a.$apply((function(){r.navigate(i)})),n.preventDefault&&e.preventDefault()))}))}}}])};n("ngNavigate",{test:function(e){return!(e.shiftKey||e.controlKey||e.metaKey||e.altKey)}}),n("ngShiftNavigate",{test:function(e){return e.shiftKey&&!e.controlKey&&!e.metaKey&&!e.altKey}}),n("ngControlNavigate",{test:function(e){return!e.shiftKey&&e.ctrlKey&&!e.metaKey&&!e.altKey}}),n("ngMetaNavigate",{test:function(e){return!e.shiftKey&&!e.controlKey&&e.metaKey&&!e.altKey}}),n("ngAltNavigate",{test:function(e){return!e.shiftKey&&!e.controlKey&&!e.metaKey&&e.altKey},preventDefault:!0}),n("ngShiftOrAltNavigate",{test:function(e){return(e.shiftKey||e.altKey)&&!e.controlKey&&!e.metaKey}}),e.directive("ngRedirect",["navigation",function(e){return{restrict:"A",link:function(t,n,r){var i=t.$eval(r.ngRedirect),a=t.$eval(r.ngRedirectMode)||"";if(!i)throw new Error("ng-redirect: no url: "+r.ngRedirect);e.redirect(i,a)}}}]),e.directive("ngReload",["navigation",function(e){return{restrict:"A",link:function(t,n,r){e.reload()}}}]),e.directive("ngReloadRoot",["$location","$window","navigation","urls",function(e,t,n,r){return{restrict:"A",link:function(){var i=n.compose(r.root.index,e.search());t.location.replace(i)}}}])}()},9919:function(){!function(){"use strict";var e=angular.module("navigation.services",["auth.services","db.services","lib.services","urls.services"]);e.factory("navigation",["$rootScope","$browser","$injector","$location","$timeout","$window","auth","db","events","models","urls",function(e,t,n,r,i,a,o,s,c,l,u){s.slipstream("isDebug");var d=s.slipstream("protocol"),m=s.slipstream("domain"),p=t.baseHref();"/"===p[p.length-1]&&(p=p.slice(0,p.length-1));var f="/embeds/",h=function(e){return!(!p&&e.slice(0,f.length)===f||!p&&"/"!==e.slice(0,1)||e.slice(0,p.length)!==p)},g=function(e){return h(e)?e.slice(p.length):e},y=function(e){return h(e)?e:p+e},v="_top"===$("base").attr("target"),T=function(e,t){var n=a;v&&(n=a.top),t?n.location.replace(e):n.location.assign(e)},E={admin:"admin-section",company:"company-section",dashboard:"dashboard-section",root:"root-section"};E.all=_.values(E).join(" ");var b=function(e,t){t?($("body").removeClass(E.all),$("body").addClass(E[e])):$("body").removeClass(E[e])},C={glob:"([a-zA-Z0-9-_.]+)",slug:"([a-z0-9-_.]+)",path:"([a-z-/]+)",pk:"(-?[0-9]+)",pks:"((-?[0-9]+)(,-?[0-9]+)*)"},k=function(e,t,n){return e=(e=e.replace(/\//g,"\\/")).replace(/:(\w+)(\((\w+)\))?/g,(function(e,t,r,i){return n.push(t),r?C[i]:C.glob})),new RegExp("^"+e+(t?"$":""))},A={},P=function(e,t){if(!e)throw new Error("navigation: matcher not given path");if(!_.isString(e))throw console.error("navigation: matcher not given a string path",e,t),new Error("navigation: matcher not given string path");var n,i=e+(t?"$":""),a=A[i];if(a)return a;var o,s=[],c=F.parseMultiUrl(e);if(c&&c.multiPath){o=k(c.path,!1,s);var l=[],u=k(c.multiPath,t,l);n=function(){var e=r.search()[c.key];if(_.isUndefined(e))return!1;"/"!==(e=e||"/")[e.length-1]&&(e+="/");var t=F.path;"/"!==t[t.length-1]&&(t+="/");var n=_.toArray(o.exec(t));if(!n.length)return!1;var i=_.toArray(u.exec(e));if(!i.length)return!1;var a={};return _.forEach(_.rest(n),(function(e,t){a[s[t]]=e})),_.forEach(_.rest(i),(function(e,t){a[l[t]]=e})),a}}else o=k(e,t,s),n=function(){var e=F.path;"/"!==e[e.length-1]&&(e+="/");var t=_.toArray(o.exec(e));if(!t.length)return!1;var n={};return _.forEach(_.rest(t),(function(e,t){n[s[t]]=e})),n};return A[i]=n,n},S={},O=function(e,t){return function(n,r){var i=e+n;if(!r&&!_.isUndefined(S[i]))return S[i];var a=t(n);return S[i]=a,a}},I=function(e,t){return function(){var n=e;if(!_.isUndefined(S[n]))return S[n];var r=t();return S[n]=r,r}},R=function(e){try{return decodeURIComponent(e)}catch(e){}},N=function(e){var t,n,r={};return _.forEach((e||"").split("&"),(function(e){if(e&&(t=e.replace(/\+/g,"%20").split("="),n=R(t[0]),!_.isUndefined(n))){var i=!!_.isUndefined(t[1])||R(t[1]);Object.hasOwnProperty.call(r,n)?_.isArray(r[n])?r[n].push(i):r[n]=[r[n],i]:r[n]=i}})),r},w=function(e){var t=e.replace("%3F","?");return _.contains(t,"?")?t.split("?")[0]:e},U=function(e){if(e){var t=e.replace("%3F","?");if(_.contains(t,"?")){var n=t.split("?")[1];return N(n)}}return{}},F={base:p,url:y(r.url()||"/"),path:y(r.path()||"/"),compose:function(e,t,n){t=_.pick(t,(function(t,r){try{return!new RegExp("[&\\?]"+r+"="+(n?"":t)).test(e)}catch(e){return!0}}));var r=s.toKeyValue(t);if(r){var i="",a=e.indexOf("#");return-1!==a&&(i=e.slice(a),e=e.slice(0,a)),_.contains(e,"?")?e+"&"+r+i:e+"?"+r+i}return e},parseQuery:U,stripQuery:w,stripPrefix:function(e){return e.replace(/^https?:\/\/[^\/]+/,"")},extendQuery:function(e,t){var n=F.parseQuery(e);return _.extend(n,t),e=w(e),F.compose(e,n)},pathStartsWith:O("pathStartsWith",(function(e){return P(e)()})),pathEquals:O("pathEquals",(function(e){return P(e,!0)()})),nextPathEquals:O("nextPathEquals",(function(e){var t=k(e,!0,[]),n=r.search().next;if(_.isUndefined(n))return!1;n=w(n);var i=t.exec(n);return i&&i.length})),inCompanySection:I("inCompanySection",(function(){var e,t=!(F.inRootSection()||F.inDashboardSection()||F.inLegacyManifestSection()||!(e=F.pathStartsWith(u.company.index)));return b("company",t),e})),inDashboardSection:I("inDashboardSection",(function(){var e,t=!F.inRootSection()&&!!(e=F.pathStartsWith(u.dashboard.index));return b("dashboard",t),e})),inLegacyManifestSection:I("inLegacyManifestSection",(function(){var e,t=!F.inRootSection()&&!!(e=F.pathStartsWith(u.legacyManifest));return b("dashboard",t),e})),inRootSection:I("inRootSection",(function(){var e=!1;return _.forEach(u.root,(function(t){e=t===u.root.index?e||F.pathEquals(t):_.isObject(t)?e||F.pathStartsWith(t.index):e||F.pathStartsWith(t)})),b("root",e),e})),reload:function(){i((function(){location.reload()}))},redirect:function(e,t,n){if(r.$$replace)i(_.bind(F.redirect,F,e,t,n));else{if(e=e||"/",t=t||"extend",e=F.multiUrl(e,t),h(e)&&!n)return e=g(e),r.replace(),r.url(e),e;T(e,!0)}},navigate:function(e,t,n){if(e=e||"/",t=t||"replace",e=F.multiUrl(e,t),h(e)&&!n)return e=g(e),r.url(e),e;T(e)},forceNavigate:function(t){return e.$apply((function(){return F.navigate(t)}))},open:function(e,t,n){n&&(n.stopPropagation(),n.preventDefault()),t=_.extend({},{status:1,scrollbars:1,resizable:1},t);var r=_.map(t,(function(e,t){return t+"="+e})).join(",");a.open(e,"$$window",r)},get:function(e){return r.search()[e]},set:function(e,t,n){return n&&r.replace(),r.search(e,t)},clear:function(e,t){return t&&r.replace(),r.search(e,null)},getInt:function(e){var t=_.int(this.get(e));if(!isNaN(t))return t},getPk:function(e){var t=F.getInt(e);if(!(_.isUndefined(t)||t<=0))return t},getPks:function(e){return _.splitPks(this.get(e))},parseMultiUrl:function(e){if(_.isUndefined(e))console.warn("navigation: invalid multi-url",e);else if(!/^(https?|ftp|mailto|tel)/.test(e)){var t=_.split(e,"@",2);if(2===t.length){var n=t[0],r=t[1];if(!r)return;var i=(t=_.split(r,"=",2))[0],a=t[1]||"",o={};return 2===(t=_.split(a,"?",2)).length&&(a=t[0],o=N(t[1])),{path:n,key:i,multiPath:a,search:o}}}},multiUrl:function(e,t,n){if(!e)throw new Error("navigation: bad url to multi");t=t||"replace";var i,a=F.parseMultiUrl(e),o={};return a&&(t="extend",a.multiPath&&(o[a.key]=a.multiPath),_.extend(o,a.search)),"extend"===t&&(o=_.extend({},r.search(),o),a&&!a.multiPath&&delete o[a.key]),a?(i=a.path,n?i=n:F.pathStartsWith(a.path)&&(i=F.path)):i=e,F.compose(i,o)},watch:function(e,t,n){var r=function(){e.$safeApply((function(){t(F.path,F.url)}))};return"path"===n?e.$watch((function(){var e=F.parseMultiUrl(F.url);return e?e.path:F.path}),r):"multiPath"===n?e.$watch((function(){var e=F.parseMultiUrl(F.url);return e?e.key+"="+e.multiPath:""}),r):e.$watch((function(){return F.url}),(function(e,t){if(_.isObject(n)&&n.search)return function(e,t){var i,a,o,s,c;e===t?r():(i=e,a=t,o=n.search,s=U(i),c=U(a),o&&(s=_.pick(s,o),c=_.pick(c,o)),_.isEqual(s,c)||r())}(e,t);r()}))},currentCompany:null,updateCurrentCompany:function(e,t){var r=n.get("analytics");F.currentCompany=t,r.trackCompany(F.currentCompany),c.broadcast("navigation.company.updated",{company:F.currentCompany}),e.$on("$destroy",(function(){F.currentCompany=null,r.trackCompany(null),c.broadcast("navigation.company.updated",{company:F.currentCompany})}))},isCurrentCompany:function(e){return F.currentCompany&&_.isUriEqual(F.currentCompany,e)},absoluteUrl:function(e){return e=_.isUndefined(e)?F.url:y(e),d+"://"+m+e},loginRedirectUrl:function(e){var t;t=F.currentCompany?F.currentCompany.$url(u.company.login):u.root.login;var n=F.path,i=_.extend({},r.search());delete i.next;var a=F.compose(n,i),o={};return/\/login\//g.test(n)||(o.next=a,e&&(o.require="yes")),F.compose(t,o)},startBookingUrl:function(e,t){if(!e)return t.company.$url(u.dashboard.bookings.index);var n,r=e.availability.startAt,i=e.company,a=moment().startOf("day");if(r.diff(a)<0&&(r=a),e.affiliation&&e.affiliation.affiliateCompany===o.currentUser.company&&(o.storage.set("currentPartnerSelection",e.company.uri),i=e.affiliation.affiliateCompany),F.pathStartsWith(u.dashboard.bookings.day.index))n=u.dashboard.bookings.day.date;else if(F.pathStartsWith(u.dashboard.bookings.agenda.index))n=u.dashboard.bookings.agenda.date;else if(F.pathStartsWith(u.dashboard.bookings.calendar))n=u.calendarUrls(u.dashboard.bookings.calendar).month;else if(F.pathStartsWith(u.dashboard.bookings.grid.index))n=u.dashboard.bookings.grid.date;else{if(!F.pathStartsWith(u.dashboard.bookings.timeline.index))return F.compose(u.populate(u.dashboard.bookings.index,{shortname:i.shortname}),{date:r.format("YYYY-MM-DD")});n=u.dashboard.bookings.timeline.date}return u.populate(n,{shortname:i.shortname,year:r.format("YYYY"),month:r.format("MM"),date:r.format("YYYY-MM-DD")})}},D=!0;return e.$on("$locationChangeStart",(function(t){e.$evalAsync((function(){e.$broadcast("$locationChangeComplete",!t.defaultPrevented),t.defaultPrevented&&e.$broadcast("$locationChangeCancelled")}))})),e.$on("$locationChangeSuccess",(function(e,a,o){a=a?F.stripPrefix(a):"/",a=y(a),o=o?F.stripPrefix(o):"/",o=y(o);var s=r.path();"/"===(s=y(s=s||"/"))[s.length-1]?(S={},F.url=a,F.path=s,(a!==o||D)&&i((function(){console.info("navigation: navigation complete",F.url,a),t.notifyWhenNoOutstandingRequests((function(){var e,t,r,i;F.url!==a||(e=F.path,t=F.currentCompany?F.currentCompany.shortname:"",r=[u.embeds.calendar.index,u.embeds.items.index,u.embeds.cart.index,u.embeds.checkin.index,u.embeds.partners.index],i=_.map(r,(function(e){return e.replace(":shortname/",t)})),_.some(i,(function(t){return _.includes(e,t)})))||n.get("analytics").trackView(a)}))})),D=!1):F.redirect(F.compose(s+"/",r.search()))})),a.$$navigation=F,a.$$location=r,F}]),e.run(["$rootScope","navigation",function(e,t){e.navigation=t}])}()},6146:function(){!function(){"use strict";var e=angular.module("tracking.directives",[]),t=function(t,n){e.directive(t,["$injector","$parse","d","models","navigation","tracking","tracking.geo",function(e,r,i,a,o,s,c){_.isArray(n)&&(n=e.invoke(n));var l=n.require||[],u={Company:function(e){return{company:e.shortname,"company-id":e.pk}},Item:function(e){return{item:e.name,"item-id":e.pk,company:e.company.shortname,"company-id":e.company.pk}},FlowNode:function(e){var t={company:e.company.shortname,"company-id":e.company.pk,"flow-page":e.unicode,"flow-page-block-count":a.FlowNode.effectiveChildren(e).length,"flow-page-includes-calendar":a.FlowNode.isCalendarIncluded(e),"flow-page-breadcrumb-count":e.breadcrumbs?e.breadcrumbs.length:void 0,"flow-page-breadcrumbs":_.pluck(e.breadcrumbs,"name").join(",")};return e.item&&_.extend(t,u.Item(e.item)),t},Availability:function(e){return{availability:e.pk,item:e.item.name,"item-id":e.item.pk,company:e.company.shortname,"company-id":e.company.pk}},CustomerType:function(e){return{"customer-type":e.plural,company:e.company.shortname,"company-id":e.company.pk}},CustomerPrototype:function(e){return{"customer-prototype":e.name,"customer-type":e.customerType.plural,company:e.company.shortname,"company-id":e.company.pk}},CustomerTypeRate:function(e){return{item:e.availability.item.name,"item-id":e.availability.item.pk,availability:e.availability.pk,"customer-prototype":e.customerPrototype.name,"customer-type":e.customerPrototype.customerType.plural,company:e.company.shortname,"company-id":e.company.pk}},Booking:function(e){var t={gross:e.costs.totalCost.total,customerCount:e.customerCount,company:e.company.shortname,"company-id":e.company.pk};return!1===c.isEU&&(t.booking=e.uuid),t}},d=function(e){if(e&&e.cls){var t=u[e.cls];if(t)return t(e)}},m={ngMxDataCompany:d,ngMxDataItem:d,ngMxDataItems:function(e){return _.isArray(e)&&0!=e.length?{items:_.unique(_.pluck(e,"name")),"item-ids":_.unique(_.pluck(e,"pk"))}:{}},ngMxDataCartEntries:function(e){if(!_.isArray(e)||0==e.length)return{};var t=_.map(e,"availability.item");return _.isArray(t)&&0!=t.length?{items:_.unique(_.pluck(t,"name")),"item-ids":_.unique(_.pluck(t,"pk"))}:{}},ngMxDataFlowNode:d,ngMxDataAvailability:d,ngMxDataBooking:d,ngMxDataCustomerType:d,ngMxDataCustomerTypeRate:d,ngMxDataUrl:function(){return{url:o.url}}};return{restrict:"A",require:l,compile:function(a,o){var c=o.ngMxWhen?r(o.ngMxWhen):_.always,u=n.compile?i.safeInvoke(e,n.compile)(a,o):i.safeInvoke(e,n.link);return function(e,r,i,a){var o=!1;if(u){var p=[e,r,i];l.length&&p.push(a),p.push((function(r,a){if(!1!==r){_.isObject(r)&&(a=r,r=void 0);var l=r||i[t];if(l)if(c(e)){if(!n.once||!o){o=!0;var u={};_.forEach(m,(function(t,n){_.extend(u,t(e.$eval(i[n])||null))})),_.extend(u,e.$eval(i.ngMxData)),_.forEach(a,(function(e,t){_.isObject(e)?_.extend(u,d(e)):u[t]=e})),s.track(e,l,u)}}else console.log("tracking: ng-mx-when cancelled tracking",l);else console.warn("tracking: invalid action",t)}else console.log("tracking: mx() cancelled tracking")})),u.apply(null,p)}}}}}])};e.directive("ngMxScopeData",["tracking",function(e){return{priority:1,restrict:"A",scope:!0,link:{pre:function(t,n,r){if(!r.ngMxWhen||t.$eval(r.ngMxWhen)){var i=t.$eval(r.ngMxScopeData);e.extendScopeProperties(t,i)}}}}}]),t("ngMxView",{once:!0,link:["tracking",function(e){return function(t,n,r,i){if(!_.isUndefined(r.ngMxViewInitial)){var a=r.ngMxViewInitial||r.ngMxView;e.initialView(a)}i()}}]}),t("ngMxClick",{link:function(e,t,n,r){t.on("click",(function(){e.$apply((function(){r()}))}))}}),t("ngMxChange",{require:"ngModel",compile:["$parse",function(e){return function(t,n){var r=n.ngMxChangeWhen?e(n.ngMxChangeWhen):_.always;return function(e,t,n,i,a){e.$watch((function(){return i.$modelValue}),(function(t,n){t!==n&&r(e,{$value:t,$oldValue:n})&&a({"new-value":t,"old-value":n})}))}}}]}),t("ngMxForm",{require:"form",link:function(e,t,n,r,i){var a=r,o=n.ngMxForm.split(","),s=o[0]||"";s=s.trim();var c=o[1]||"";c=c.trim();var l=function(e){var t={};return _.forEach(e,(function(e,n){e.length&&(t[n]=e)})),JSON.stringify(t)};a.$successCallbacks||(a.$successCallbacks=[]),a.$successCallbacks.push((function(e){i(s,{object:e})})),c&&(a.$errorCallbacks||(a.$errorCallbacks=[]),a.$errorCallbacks.push((function(e){i(c,{formErrors:l(e)})})))}}),t("ngMxFormValid",{require:"^form",link:[function(){return function(e,t,n,r,i){var a,o=e.$watch((function(){a||(a=setTimeout((function(){a=null;var n=t.find("[ng-model]");if(n.length){var r=t.find("[ng-mx-form-valid-async]"),s=t.find("[ng-mx-form-valid-async-success]");if(r.length===s.length){var c=_.map(n,(function(e){return angular.element(e).controller("ngModel")}));_.all(c,"$valid")&&(o(),e.$apply((function(){i({"form-was-edited":_.any(c,"$dirty")})})))}}})))}))}}]})}()},3986:function(){!function(){"use strict";var e=angular.module("tracking.services",["clientOptions.services"]);e.factory("tracking.geo",[function(){var e=!1,t=[],n=function(){e=!0,_.forEach(t,(function(e){e()})),t=[],console.info("geo: complete")},r={isEU:null,then:function(n){e?n():t.push(n)},geolocate:function(){var e;try{e=localStorage.getItem("isEU")}catch(e){}var t="true"===e||"false"!==e&&null;if(null!==t)return r.isEU=t,console.info("geo: cached isEU",t),void n();console.info("geo: locating..."),window.geoip2.country((function(e){if(r.isEU=_.get(e,"country.is_in_european_union",!1),null!==r.isEU)try{localStorage.setItem("isEU",r.isEU.toString())}catch(e){}console.info("geo: located isEU",r.isEU),n()}),(function(e){console.warn("geo: unable to load",e),n()}))}};return r}]),e.factory("tracking.iframes",["navigation","urls",function(e,t){var n={},r=$('<div class="a-embed-iframes-container"></div>');return{requestForBooking:function(e,t,r){n[t.uuid]||(n[t.uuid]=[]),n[t.uuid].push({servicePk:e.pk,uniqueType:r?e.type:null})},loadForBooking:function(i){var a=[],o={};_.forEach(n[i.uuid],(function(e){var t=0;e.uniqueType&&(_.isUndefined(o[e.uniqueType])?o[e.uniqueType]=0:t=++o[e.uniqueType]),a[t]||(a[t]=[]),a[t].push(e)}));var s=i.$url(t.embeds.analytics.booking);console.info("analytics: removing iframes"),r.detach().empty(),_.forEach(a,(function(t){var n={"selected-services":_.pluck(t,"servicePk").join(",")};!function(e){console.info("analytics: enqueuing iframe",e);var t=$('<iframe class="a-embed-iframe"></iframe>');t.attr("src",e),r.append(t)}(e.compose(s,n))})),console.info("analytics: loading iframes"),$("body").append(r),delete n[i.uuid]}}}]),e.factory("tracking.pixels",[function(){return{load:function(e){console.info("analytics: loading pixel",e);var t=$('<img class="a-pixel-img" width="1" height="1"/>');t.on("load",(function(){console.info("analytics: loaded pixel",e),t.remove()})),$("body").append(t),t.attr("src",e)}}}]),e.factory("analytics",["$location","$q","$window","auth","clientOptions","db","models","navigation","optimizely","persistentStorage","tracking","tracking.geo","tracking.iframes","tracking.pixels","urls",function(e,t,n,r,i,a,o,s,c,l,u,d,m,p,f){window._gaSetup&&window._gaSetup();var h=a.slipstream("googleAnalyticsFhMeIds"),g={source:"campaignSource",campaign:"campaignName",medium:"campaignMedium",term:"campaignKeyword",content:"campaignContent"},y=["boatamsterdam","boomchicago","dinnertrain","funcenteramstelveen","pureboats"],v=function(e){return(e/100).toFixed(2)},E=function(e,t){var n=s.get(e)||t||"";return s.clear(e,!0),n},b=function(e){e=e||"utm",e+="_";var t={};if(_.forEach(g,(function(n,r){t[r]=E(e+r)})),_.any(t))return t},C=function(e){if(_.isString(e))return _.reduce(e.split(";"),(function(e,t){var n=t.split(",");return 2===n.length&&n[0]&&n[1]&&(e[n[0]]=n[1]),e}),{})},k=function(e,t){var n="analytics: "+e+" ("+t+"):";return function(){var e=_.toArray(arguments);e.unshift(n),console.info.apply(window.console,e)}},A={},P=C(E("ga"));_.any(P)&&console.info("analytics: Google: received cross-domain link identifiers:",P),n._gaTracker||console.info("analytics: Google: tracking disabled"),A[o.AnalyticsService.GOOGLE_ANALYTICS_TYPE]=function(e,t,r){if(!n._gaTracker)return this;var i,a=e.googleAnalyticsUa,o=k("Google",a),s=!_.isUndefined(t);if(s)i=t;else{var c=e.company.shortname.replace(/[-]+/g,"_");i="company_"+c+"_"+e.company.pk.toString()+"_"+e.pk.toString()}var l=function(e){return i?i+"."+e:e};if(!r){var u={cookieFlags:"samesite=none;secure",name:i};if(P[a])o("cross-domain link succeeded"),u.clientId=P[a],u.storage="none";else{if(e.isCrossDomainOnly)return o("not reporting; no cross-domain link"),this;o("no cross-domain link")}n._gaTracker("create",a,"auto",u),n._gaTracker(l("require"),"ecommerce"),n._gaTracker(l("set"),"anonymizeIp",!0)}o("enabling tracking and ecommerce integration"),this.setUserId=function(e){if(!d.isEU&&null!==d.isEU){var t=l("set");o(t,"userId",e),n._gaTracker(t,"userId",e)}},this.trackView=function(e){var t=l("send");o("tracking",t,"pageview",e);var r={page:e},i=/[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}/gi;e.match(i)&&(r.page=e.replace(i,"ID"),r.title=T("Confirmation")),n._gaTracker(l("set"),"page",r.page),n._gaTracker(t,"pageview",r)},this.trackUtm=function(e){var t=l("set");_.forEach(g,(function(r,i){var a=e[i];a&&(a=a.toString(),o("tracking",t,r,a),n._gaTracker(t,r,a))}))},this.trackBooking=function(e){var t=e.pk.toString();(d.isEU||null===d.isEU)&&(t=_.uuid());var r={id:t,affiliation:e.company.affiliation?e.company.affiliation.affiliateCompany.shortname:"FareHarbor",currency:e.company.processorCurrency.toUpperCase(),revenue:v(e.costs.totalCost.total),shipping:"0.00",tax:v(e.costs.totalCost.tax)},i={};_.forEach(e.customers,(function(n){var r=n.customerTypeRate.uri;i[r]||(i[r]={id:t,name:e.availability.item.name,sku:n.customerTypeRate.customerPrototype.customerType.plural,price:v(n.costs.totalCost.price),quantity:0},s&&(i[r].category=e.company.shortname)),i[r].quantity+=1}));var a=_.values(i);o("tracking booking",r,a),n._gaTracker(l("ecommerce:addTransaction"),r),_.forEach(a,(function(e){n._gaTracker(l("ecommerce:addItem"),e)})),n._gaTracker(l("ecommerce:send"))},this.serializeContext=function(){var e=n._gaTracker.getByName(i);return{trackingId:a,clientId:e.get("clientId")}}};var S={account:E("o-aid"),project:E("o-pid"),user:E("o-uid"),experiments:C(E("o-x"))};_.any(_.omit(S,"experiments"))&&console.info("analytics: Optimizely: received cross-domain link identifiers:",S),A[o.AnalyticsService.OPTIMIZELY_TYPE]=function(e){var t=e.optimizelyAccount,n=e.optimizelyProject,r=k("Optimizley","account: "+t+", project: "+n);return _.every(S)&&_.any(S.experiments)?t!==S.account||n!==S.project?(r("not reporting; no cross-domain link"),this):(r("enabling"),void(this.trackBooking=function(i){var a={a:n,d:t,n:e.optimizelyEventKey,g:e.optimizelyGoals,u:S.user,v:i.receipt.gross,time:i.createdAt.unix()};_.forEach(S.experiments,(function(e,t){a["x"+t]=e}));var o="http://"+n+".log.optimizely.com/event";r("tracking booking",i),p.load(s.compose(o,a))})):(r("not reporting; no cross-domain link or no active experiments"),this)};var O={pixel:E("fb-pix")};_.any(O)&&console.info("analytics: Facebook: received cross-domain link identifiers",O),A[o.AnalyticsService.FACEBOOK_TYPE]=function(e){var t=k("Facebook",e.facebookPixel);if(e.isCrossDomainOnly){if(e.facebookPixel!==O.pixel)return t("not reporting; no cross-domain link"),this;t("cross-domain link succeeded")}t("enabling"),this.trackBooking=function(n){t("intitializing booking tracking",n),m.requestForBooking(e,n,!0)}};var I={advertiser:E("ad-adv"),pixel:E("ad-pix")};_.any(I)&&console.info("analytics: Adroll: received cross-domain link identifiers",I),A[o.AnalyticsService.ADROLL_TYPE]=function(e){var t=k("Adroll","advertiser: "+e.adrollAdvertiser+", pixel: "+e.adrollPixel);if(e.isCrossDomainOnly){var n=e.adrollAdvertiser===I.advertiser,r=e.adrollPixel===I.pixel;if(!n||!r)return t("not reporting; no cross-domain link"),this;t("cross-domain link succeeded")}t("enabling"),this.trackBooking=function(n){t("intitializing booking tracking",n),m.requestForBooking(e,n,!0)}},A[o.AnalyticsService.CUSTOM_CODE_TYPE]=function(e){var t=k("Custom Code","#"+e.pk);this.trackBooking=function(n){t("intitializing booking tracking"),m.requestForBooking(e,n)}};var R=A[o.AnalyticsService.GOOGLE_ANALYTICS_TYPE],N={ANONYMOUS:new R({googleAnalyticsUa:a.slipstream("googleAnalyticsAnonymousId")},"anonymous",!0),ADMIN:new R({googleAnalyticsUa:a.slipstream("googleAnalyticsAdminId")},"admin",!0),COMPANY:new R({googleAnalyticsUa:a.slipstream("googleAnalyticsCompanyId")},"company",!0),EVERYONE:new R({googleAnalyticsUa:a.slipstream("googleAnalyticsId")},"",!0)},w=_.map(h,(function(e,t){return new R({googleAnalyticsUa:e,isCrossDomainOnly:!0},"fh_dotme_"+t)})),U=w.concat(N.ANONYMOUS),F=b("fh");F&&!r.currentUser.isAuthenticated&&"/"!==s.path&&N.ANONYMOUS.trackUtm&&(console.info("analytics: tracking FareHarbor utm",F),N.ANONYMOUS.trackUtm(F));var D=function(e,t){var n=_.rest(arguments,2);d.then((function(){_.forEach(e,(function(e){e[t]&&e[t].apply(e,n)}))}))};D(N,"setUserId",l.getIdentifier());var L,M,x=b(),B=[],$=[],G=[],Y={},V={},K={},H=function(){var e=!s.pathStartsWith(f.company.login),t=!s.pathStartsWith(f.dashboard.index),n=i.asnAffiliateCompany,r=!n||n!==o.Company.CALL_CENTER_SHORTNAME;return e&&t&&r},q=function(e){return 0===e.indexOf("/#!")&&(e=e.substr(3)),e},W={trackCompany:function(e){!function(e){if(B=[],e){if(Y[e.shortname])return B=Y[e.shortname],G=V[e.shortname],void($=K[e.shortname]);var n=a.analyticsServices({shortname:e.shortname},null,null,null,{flashError:!1});t.all([l.get("analytics"),n.$promise]).then((function(t){var r=t[0],i=r&&r[o.AnalyticsService.GOOGLE_ANALYTICS_TYPE],a=r&&r["google-ads"];if(a){var c=s.extendQuery(s.url,{gclid:a.gclid});s.navigate(c,"extend",!1)}_.forEach(n,(function(e){if(e.type===o.AnalyticsService.GOOGLE_ANALYTICS_TYPE&&i){var t=e.googleAnalyticsUa,n=_.find(i,{trackingId:e.googleAnalyticsUa});n&&(P[t]=n.clientId)}if(A[e.type]){var r=new A[e.type](e);B.push(r),e.type===o.AnalyticsService.GOOGLE_ANALYTICS_TYPE?G.push(r):$.push(r)}else console.error("analytics: invalid service type:",e.type,"(#",e.pk,")")})),Y[e.shortname]=B,V[e.shortname]=G,K[e.shortname]=$,x&&(D(B,"trackUtm",x),x=null)}),(function(){console.error("analytics: unable to load services")}))}}(e);var n=e?e.shortname:null,r=e?e.pk:null;if(u.extendSessionProperties({"current-company":n,"current-company-id":r}),M&&H()){var i=q(M);D(B,"trackView",i)}},trackView:function(e){if(e)if(e!==L){L=e,e=q(e),console.info("analytics: tracking view",e);var t=[];r.currentUser.isAuthenticated?r.currentUser.company.isAdmin?t.push(N.ADMIN):t.push(N.COMPANY):("/"!==e&&t.push(N.ANONYMOUS),H()&&(M=e,t=t.concat(w).concat(B))),t.push(N.EVERYONE),D(t,"trackView",e)}else console.info("analytics: not re-tracking",e);else console.warn("analytics: invalid url, not tracking",e)},trackBooking:function(e,t){var n,i=(t=t||{}).trackGAOnly||!1,a=t.skipGATracking||!1;if(n=e.company.shortname,-1!==_.indexOf(y,n)){if(i)return;a&&(a=!1)}if(!r.currentUser.isAuthenticated){console.info("analytics: tracking booking",e);var o=U;H()&&(o=i?G:a?o.concat($):o.concat(B),c.trackBooking(e)),D(o,"trackBooking",e),m.loadForBooking(e)}},trackOrder:function(e,t){r.currentUser.isAuthenticated||_.forEach(e.contributingBookings,(function(e){W.trackBooking(e,t)}))},storeContext:function(){var e=[];_.forEach(B,(function(t){t.serializeContext&&e.push(t.serializeContext())}));var t={};return t[o.AnalyticsService.GOOGLE_ANALYTICS_TYPE]=e,i.gclid&&(t["google-ads"]={gclid:i.gclid}),l.set("analytics",t)}};return W}]),e.factory("tracking",["$rootScope","auth","clientOptions","db",function(e,t,n,r){var i="$persistentTrackingProperties",a="$parentPersistentTrackingProperties",o=r.slipstream("isMixpanelEnabled"),s=r.slipstream("isDebug"),c=!1,l=moment(window.$$loadTime),u=_.mapValues({track:"track",identify:"identify",register:"register",unregister:"unregister",name:"name_tag"},(function(e,n){return function(){if(o){var r,i=window.mixpanel||{};if(t.currentUser.isAuthenticated?t.currentUser.company.isAdmin||(r=i.company):r=i.anonymous,r){var a=e;if(_.isString(e)&&(a=r[e]),a){if(console.info("tracking: mixpanel."+n,_.toArray(arguments)),!s)try{return a.apply(r,arguments)}catch(e){console.error("tracking: mixpanel."+n,"exception",e)}}else console.error("tracking: mixpanel."+n,"invalid method")}else console.info("tracking: mixpanel."+n,_.toArray(arguments),"skipping: no library for user")}else console.info("tracking: mixpanel."+n,_.toArray(arguments),"skipping: disabled")}})),d={isIdentified:function(e){return _.isUndefined(e)||(c=e),c},identify:u.identify,name:u.name,initialView:function(e){t.currentUser.isAuthenticated||d.sessionProperties["initial-view"]||(console.log("tracking: setting initial view:",e),d.extendSessionProperties({"initial-view":e}))},sessionProperties:{configuration:r.slipstream("configuration"),whitelisted:r.slipstream("isWhitelisted")},extendProperties:u.register,extendSessionProperties:function(e){_.extend(d.sessionProperties,e)},extendScopeProperties:function(e,t){var n=e[i];Object.defineProperty(t,a,{value:n,enumerable:!1}),e[i]=t},track:function(t,n,r,o){for(var s,c=[r],m=(t=t||e)[i];m;)c.push(m),m=m[a];c.push(d.sessionProperties),c.push((s=moment(),{"elapsed-time-seconds":_.roundHalfToEven(s.diff(l)/1e3,2),"local-time-decimal":parseFloat(s.format("H.mm")),"local-day-of-week":s.format("dddd"),"local-date":s.format("YYYY-MM-DDTHH:mm:ss")})),c.reverse(),c.unshift({});var p=_.extend.apply(_,c);u.track(n,p,o)},trackEmbed:function(e){if(!t.currentUser.isAuthenticated){var r={"embed-type":e};_.isUndefined(n.trackingFromEmbed)||(r["from-embed-type"]=n.trackingFromEmbed);var i=function(e,t){var i=n[e];i&&(i=_.filter(_.map(i.split(","),_.compose(_.camelCase,$.trim)))).length&&(r[t]=i)};i("trackingSiteTags","site-tags"),i("trackingPageTags","page-tags"),i("trackingButtonTags","button-tags"),_.isUndefined(n.trackingIsFromSsl)||(r["from-ssl"]=n.trackingIsFromSsl),d.extendSessionProperties(r),console.log("tracking: set up embed tracking",r)}}};return d}]),e.factory("labs",["$window","db","navigation","storage",function(e,t,n,r){var i=function(e){return(e=e||n.currentCompany).features.isLabsEnabled};return{initialize:function(){var t=r.get("fhLabsExperiments")||{},n=r.get("fhLabsData")||{};e.fhLabsExperiments=_.extend({},e.fhLabsExperiments),e.fhLabsData=_.extend({},e.fhLabsData),_.isEmpty(t)||(console.info("labs: Using experiment assignments from local storage",t),e.fhLabsExperiments=_.extend(e.fhLabsExperiments,t)),_.isEmpty(n)||(console.info("labs: Using labs data from local storage",n),e.fhLabsData=_.extend(e.fhLabsData,n)),e.$$overrideFhLabsExperiment=function(t,n){e.fhLabsExperiments[t]=n,r.set("fhLabsExperiments",e.fhLabsExperiments)},e.$$overrideFhLabsData=function(t,n){e.fhLabsExperiments[t]=n,r.set("fhLabsData",e.fhLabsExperiments)},console.info("labs: service active")},data:function(t){return e.fhLabsData[t]},isInVariation:function(t,n){if(!i())return!1;var r=e.fhLabsExperiments[t];return n?_.isString(r)&&r===n:_.isString(r)&&"control"!==r},isInControl:function(t){return!i()||"control"===e.fhLabsExperiments[t]},isLabsEnabled:i}}]),e.factory("optimizely",["$window","tracking",function(e,t){return{initialize:function(){if(e.optimizely&&e.optimizely.activate){console.info("optimizely: activating experiments"),e.optimizely.activate(),console.info("optimizely: all experiments",e.optimizely.allExperiments),console.info("optimizely: active experiments",e.optimizely.activeExperiments);var n={};_.forEach(e.optimizely.activeExperiments,(function(t){var r=e.optimizely.allExperiments[t],i=e.optimizely.variationIdsMap[t],a=e.optimizely.allVariations[i],o="optimizely "+r.name;n[o]=a.name})),t.extendSessionProperties(n)}else console.warn("optimizely: not loaded")},trackBooking:function(t){console.info("optimizely: tracking booking with revenue",t.receipt.bookingFee),e.optimizely&&(e.optimizely.push(["trackEvent","booked"]),e.optimizely.push(["trackEvent","bookingFee",{revenue:t.receipt.bookingFee}]))}}}]),e.run(["$rootScope","auth","events","labs","optimizely","persistentStorage","tracking","tracking.geo",function(e,t,n,r,i,a,o,s){e.optimizely=i,e.labs=r,s.geolocate(),i.initialize(),r.initialize();var c=function(){t.currentUser.isAuthenticated?(o.isIdentified(!0),o.identify(t.currentUser.identifier),o.extendProperties({company:t.currentUser.company.shortname,userType:t.currentUser.type}),o.name(t.currentUser.identifier)):(o.isIdentified(!1),o.identify(a.getIdentifier()),o.extendProperties({company:null,userType:"anonymous"}),o.name("Guest"))};n.on(e,"auth.login",(function(){c()})),n.on(e,"auth.logout",(function(){c()})),c()}])}()},4802:function(){!function(){"use strict";var e=angular.module("urls.services",["lib.services"]);e.factory("urls",["models","require",function(e,t){var n={},r=function(e,t,r){var i,a,o=e;for(var s in t)if(t.hasOwnProperty(s)){var c=t[s];s&&void 0!==c&&((i=n[a=":"+s+"(?:\\([^\\)/]+\\))?"])||(i=n[a]=new RegExp(a)),o=o.replace(i,c))}if(r||-1===o.indexOf(":"))return o},i={Company:function(e){return{shortname:e.shortname,canonical:{company:"company.index",dashboard:"dashboard.index"}}},Hotel:function(e){return{shortname:e.company.shortname,hotelPk:e.pk,canonical:{dashboard:"dashboard.settings.hotels.hotel"}}},Lodging:function(e){return{shortname:e.company.shortname,lodgingPk:e.pk,canonical:{dashboard:"dashboard.settings.lodgings.lodging"}}},PreferredPickup:function(e){return{shortname:e.company.shortname,lodgingPk:e.lodging.pk,preferredPickupPk:e.pk,canonical:{dashboard:"dashboard.settings.lodgings.lodging"}}},Route:function(e){return{shortname:e.company.shortname,routePk:e.pk,canonical:{dashboard:"dashboard.settings.routes.route"}}},Run:function(e){return{shortname:e.route.company.shortname,routePk:e.route.pk,runPk:e.pk,canonical:{dashboard:"dashboard.settings.routes.route"}}},Stop:function(e){return{shortname:e.company.shortname,routePk:e.route.pk,stopPk:e.pk,canonical:{dashboard:"dashboard.settings.routes.route"}}},Pickup:function(e){return{shortname:e.company.shortname,pickupPk:e.pk,canonical:{dashboard:"dashboard.settings.pickups.pickup"}}},User:function(e){return{username:e.username,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.index"}}},CustomManifest:function(e){return{customManifestPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.index"}}},CustomCalendar:function(e){return{customCalendarPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.index"}}},CustomReport:function(e){return{customReportPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.reports.index"}}},Image:function(e){return{imagePk:e.pk,itemPk:e.item?e.item.pk:void 0,shortname:e.company.shortname,canonical:{dashboard:"dashboard.items.item.index"}}},Resource:function(e){return{resourcePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.resources.resource.index"}}},ResourceOverride:function(e){return{resourceOverridePk:e.pk,resourcePk:e.resource.pk,shortname:e.resource.company.shortname,canonical:{dashboard:"dashboard.resources.resource.uses.index"}}},SeatMap:function(e){return{seatMapPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.layout.index"}}},SeatGroup:function(e){return{seatGroupPk:e.pk,seatMapPk:e.seatMap.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.layout.seatGroup"}}},SeatZone:function(e){return{seatZonePk:e.pk,seatMapPk:e.seatMap.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.seatZones.seatZone"}}},Seat:function(e){return{seatPks:e.pk,seatMapPk:e.seatMap.pk,shortname:e.seatMap.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.layout.seats"}}},TagGroup:function(e){return{tagGroupPk:e.pk,shortname:e.company.shortname}},Tag:function(e){return{tagPk:e.pk,tagGroupPk:e.tagGroup.pk,shortname:e.tagGroup.company.shortname}},Item:function(e){return{itemPk:e.pk,shortname:e.company.shortname,canonical:{company:"company.item.index",dashboard:"dashboard.items.item.index"}}},FlowNode:function(e){return{flowNodePk:e.pk,shortname:e.company.shortname,canonical:{company:"company.flowNode.index",dashboard:"dashboard.settings.flows.flowNode.index"}}},CustomerPrototype:function(e){return{customerPrototypePk:e.pk,itemPk:e.item.pk,shortname:e.item.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.customerTypes"}}},Availability:function(e){return{availabilityPk:e.pk,itemPk:e.item.pk,shortname:e.item.company.shortname,date:e.startAt?e.startAt.format("YYYY-MM-DD"):void 0,canonical:{company:"company.item.availability",dashboard:"dashboard.overlay.availability.index"}}},Block:function(e){return{blockPk:e.pk,availabilityPk:e.availability.pk,itemPk:e.availability.item.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.availability.index"}}},Contact:function(e){return{contactPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.index"}}},Order:function(e){return{contactPk:e.contact.pk,orderUuid:e.uuid,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.order",company:"company.order.index"}}},Booking:function(e){return{bookingUuid:e.uuid,itemPk:e.item.pk,contactPk:e.contact.pk,shortname:e.company.shortname,affiliateShortname:e.affiliation?e.affiliation.affiliateCompany.shortname:void 0,canonical:{company:"company.item.booking",dashboard:"dashboard.overlay.contact.booking"}}},Campaign:function(e){return{campaignPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.index"}}},CampaignValidityRule:function(e){return{campaignValidityRulePk:e.pk,campaignPk:e.campaign.pk,shortname:e.campaign.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.settings"}}},Code:function(e){return{codePk:e.pk,campaignPk:e.campaign.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.code"}}},StoredValueType:function(e){return{storedValueTypePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueType"}}},StoredValueCard:function(e){return{storedValueCardPk:e.pk,storedValueCardNumber:e.number,shortname:e.storedValueType.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueCard.index"}}},StoredValueAdjustment:function(e){return{storedValueAdjustmentPk:e.pk,storedValueCardPk:e.storedValueCard.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueCard.storedValueAdjustment"}}},PaymentProcessingDocument:function(e){return{paymentProcessingDocumentPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.document.index"}}},Customer:function(e){return{customerPk:e.pk,bookingUuid:e.booking.uuid,shortname:e.company.shortname,contactPk:_.get(e,"booking.contact.pk"),canonical:{dashboard:"dashboard.overlay.contact.booking"}}},CheckinStatus:function(e){return{checkinStatusPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.checkinStatuses"}}},CustomerType:function(e){return{customerTypePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.customerTypes.customerType"}}},CustomerTypeRate:function(e){return{customerTypeRatePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.availability.prices"}}},CannedMessage:function(e){return{cannedMessagePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.cannedMessages.cannedMessage"}}},AvailabilityHeadline:function(e){return{availabilityHeadlinePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.availabilityHeadlines.availabilityHeadline"}}},InStorePaymentType:function(e){return{inStorePaymentTypePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.payments.inStorePaymentTypes"}}},TaxType:function(e){return{taxTypePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.payments.taxTypes.taxType"}}},Ledger:function(e){return{ledgerPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.payments.ledgers.ledger"}}},EmvDevice:function(e){return{inStorePaymentTypePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.payments.emvDevices"}}},BankAccount:function(e){return{bankAccountPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.payments.bankAccounts"}}},Card:function(e){return{cardPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.payments.cards.card.index"}}},CardAffiliation:function(e){return{cardAffiliationPk:e.pk,cardPk:e.card.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.payments.cards.card.index"}}},Payment:function(e){return{paymentPk:e.pk,contactPk:e.booking.contact.pk,bookingUuid:e.booking.uuid,itemPk:e.item.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Refund:function(e){return{refundPk:e.pk,paymentPk:e.payment.pk,contactPk:e.payment.booking.contact.pk,bookingUuid:e.payment.booking.uuid,itemPk:e.payment.booking.item.pk,shortname:e.payment.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},LegacyTransfer:function(e){return{transferPk:e.pk,shortname:e.company.shortname}},LegacyTransaction:function(e){return{transactionPk:e.pk}},Account:function(e){return{accountPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.reports.transactions.index"}}},Payout:function(e){return{payoutPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.reports.payouts.payout"}}},Transfer:function(e){return{transferPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.reports.accounts.transfer"}}},Upload:function(e){return{uploadPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.reports.accounts.upload"}}},Adjustment:function(e){return{adjustmentPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.reports.transactions.adjustment"}}},Transaction:function(t){return{transactionPk:t.pk,shortname:e.Company.ADMIN_SHORTNAME,canonical:{dashboard:"dashboard.reports.transactions.index"}}},LineItem:function(e){return{lineItemPk:e.pk,contactPk:e.booking.contact.pk,bookingUuid:e.booking.uuid,itemPk:e.item.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Agent:function(e){return{agentPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.agents.agent"}}},Desk:function(e){return{deskPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.desks.desk"}}},Role:function(e){return{rolePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.index"}}},CrewMember:function(e){return{crewMemberPk:e.pk,availabilityPk:e.availability.pk,itemPk:e.availability.item.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.availability.index"}}},CustomField:function(e){return{customFieldPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},TransportationOption:function(e){return{transportationOptionPk:e.pk,customFieldPk:e.customField.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ExtendedOption:function(e){return{extendedOptionPk:e.pk,customFieldPk:e.customField.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ConnectedCampaign:function(e){return{connectedCampaignPk:e.pk,customFieldPk:e.customField.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ConnectedWaiver:function(e){return{connectedWaiverPk:e.pk,customFieldPk:e.customField.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},GeneratingCampaign:function(e){return{generatingCampaignPk:e.pk,customFieldPk:e.customField.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},CustomFieldInstance:function(e){return{customFieldInstancePk:e.pk,itemPk:e.item?e.item.pk:"",shortname:e.company.shortname,customFieldInstanceGroupPk:e.customFieldInstanceGroup?e.customFieldInstanceGroup.pk:"",canonical:{dashboard:e.item?"dashboard.items.item.prices.index":"dashboard.settings.customFieldInstanceGroups.customFieldInstanceGroup"}}},CustomFieldInstanceCondition:function(e){return{customFieldInstanceConditionPk:e.pk,customFieldInstancePk:e.customFieldInstance.pk,shortname:e.customFieldInstance.company.shortname,customFieldInstanceGroupPk:e.customFieldInstanceGroup?e.customFieldInstanceGroup.pk:"",canonical:{dashboard:e.customFieldInstance.item?"dashboard.items.item.prices.index":"dashboard.settings.customFieldInstanceGroups.customFieldInstanceGroup"}}},CustomFieldInstanceGroup:function(e){return{customFieldInstanceGroupPk:e.pk,itemPk:e.item?e.item.pk:null,shortname:e.company.shortname,canonical:{dashboard:e.item?"dashboard.items.item.prices.fieldGroups":"dashboard.settings.customFieldInstanceGroups.customFieldInstanceGroup"}}},RequirementGroup:function(e){return{requirementGroupPk:e.pk,shortname:e.company.shortname,itemPk:e.isItemLevel?e.item.pk:null,canonical:{dashboard:e.isItemLevel?"dashboard.items.item.prices.resources":"dashboard.settings.requirementGroups.requirementGroup"}}},Requirement:function(e){return{requirementPk:e.pk,requirementGroupPk:e.requirementGroup.pk,itemPk:e.requirementGroup.isItemLevel?e.requirementGroup.item.pk:null,shortname:e.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},CustomerPrototypeRequirement:function(e){return{customerPrototypeRequirementPk:e.pk,requirementPk:e.requirement.pk,requirementGroupPk:e.requirement.requirementGroup.pk,itemPk:e.requirement.requirementGroup.isItemLevel?e.requirement.requirementGroup.item.pk:null,shortname:e.requirement.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},ResourceRequirement:function(e){return{resourceRequirementPk:e.pk,requirementPk:e.requirement.pk,requirementGroupPk:e.requirement.requirementGroup.pk,itemPk:e.requirement.requirementGroup.isItemLevel?e.requirement.requirementGroup.item.pk:null,shortname:e.requirement.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},CustomerCustomFieldValue:function(e){return{customerCustomFieldValuePk:e.pk,contactPk:e.booking.contact.pk,bookingUuid:e.booking.uuid,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},BookingCustomFieldValue:function(e){return{bookingCustomFieldValuePk:e.pk,contactPk:e.booking.contact.pk,bookingUuid:e.booking.uuid,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Group:function(e){return{groupPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.group"}}},GroupOverride:function(e){return{groupOverridePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.groupOverride"}}},ResourceUse:function(e){return{resourceUsePk:e.pk,customerPk:e.customer?e.customer.pk:void 0,contactPk:e.booking.contact.pk,bookingUuid:e.booking.uuid,shortname:e.booking.contact.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Affiliation:function(e){return{affiliationPk:e.pk,shortname:e.company.shortname,affiliateShortname:e.affiliateCompany.shortname,canonical:{dashboard:"dashboard.settings.network.affiliates.affiliate.index"}}},Activity:function(e){return{activityPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.activity.index"}}},Notification:function(e){return{notificationPk:e.pk,shortname:e.company.shortname,contactPk:e.booking?e.booking.contact.pk:void 0,bookingUuid:e.booking?e.booking.uuid:void 0,availabilityPk:e.availability?e.availability.pk:void 0,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},SmsNotification:function(e){return{smsNotificationPk:e.pk,shortname:e.company.shortname,contactPk:e.booking?e.booking.contact.pk:void 0,bookingUuid:e.booking?e.booking.uuid:void 0,availabilityPk:e.availability?e.availability.pk:void 0,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Subscription:function(e){return{subscriptionPk:e.pk,username:e.user.username,shortname:e.user.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.settings"}}},Invoice:function(e){return{invoicePk:e.pk,invoiceUuid:e.uuid,shortname:e.company.shortname,affiliateShortname:e.affiliation?e.affiliation.affiliateCompany.shortname:void 0,canonical:{dashboard:"dashboard.reports.invoices.invoice.index"}}},InvoiceEntry:function(e){return{invoiceEntryPk:e.pk,invoiceUuid:e.invoice.uuid,invoicePk:e.invoice.pk,shortname:e.invoice.company.shortname,canonical:{dashboard:"dashboard.reports.invoices.invoice.index"}}},Report:function(t){return{reportPk:t.pk,shortname:t.company.shortname,modelSlug:t.type===e.Report.ADVANCED_TYPE?e.Report.MODELS[t.options.modelName].slug:void 0,canonical:{dashboard:"dashboard.reports.advanced.permalink"}}},Waiver:function(e){return{waiverPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.waivers.waiver.index"}}},WaiverInstance:function(e){return{waiverPk:e.waiver.pk,waiverInstancePk:e.pk,bookingUuid:e.booking.uuid,contactPk:e.booking.contact.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},TotalSchedule:function(e){return{shortname:e.company.shortname,totalSchedulePk:e.pk,totalScheduleUuid:e.uuid,canonical:{dashboard:"dashboard.settings.pricing.totalSchedules.index"}}},TotalScheduleEntry:function(e){return{shortname:e.company.shortname,totalSchedulePk:e.schedule.pk,totalScheduleEntryPk:e.pk,canonical:{dashboard:"dashboard.settings.pricing.totalSchedules.entry.index"}}},TotalScheduleEntryRule:function(t){return{shortname:t.entry.schedule.company.shortname,totalSchedulePk:t.entry.schedule.pk,totalScheduleEntryPk:t.entry.pk,totalScheduleEntryRulePk:t.pk,canonical:{dashboard:t.type===e.ScheduleEntryRule.FALLBACK?"dashboard.settings.pricing.totalSchedules.settings":"dashboard.settings.pricing.totalSchedules.entry.index"}}},InvoiceSchedule:function(e){return{shortname:e.company.shortname,invoiceSchedulePk:e.pk,canonical:{dashboard:"dashboard.settings.pricing.invoiceSchedules.index"}}},InvoiceScheduleEntry:function(e){return{shortname:e.company.shortname,invoiceSchedulePk:e.schedule.pk,invoiceScheduleEntryPk:e.pk,canonical:{dashboard:"dashboard.settings.pricing.invoiceSchedules.entry.index"}}},InvoiceScheduleEntryRule:function(e){return{shortname:e.company.shortname,invoiceSchedulePk:e.entry.schedule.pk,invoiceScheduleEntryPk:e.entry.pk,invoiceScheduleEntryRulePk:e.pk,canonical:{dashboard:"dashboard.settings.pricing.invoiceSchedules.entry.index"}}},TotalSheet:function(e){return{totalSheetPk:e.pk,totalSheetUuid:e.uuid,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.totalSheet"}}},TotalLine:function(e){return{totalSheetPk:e.sheet.pk,totalSheetUuid:e.sheet.uuid,shortname:e.sheet.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.totalSheet"}}},InvoiceSheet:function(e){return{invoiceSheetPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.invoiceSheet"}}},InvoiceLine:function(e){return{invoiceSheetPk:e.sheet.pk,shortname:e.sheet.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.invoiceSheet"}}},SupportedLanguage:function(t){return{languagePk:t.pk,shortname:t.company.shortname,modelName:e.Translation.modelNameForUrl(t.modelName),canonical:{dashboard:"dashboard.settings.translations.language.translations.index"}}},Translation:function(e){return{translationPk:e.pk,languagePk:e.supportedLanguage.pk,shortname:e.supportedLanguage.company.shortname,canonical:{dashboard:"dashboard.settings.translations.language.translations.index"}}},Location:function(e){return{locationPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.locations.location"}}},ResellerCompany:function(e){return{resellerCompanyPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.company.index"}}},ResellerCompanyMapping:function(e){return{resellerCompanyMappingPk:e.pk,resellerCompanyPk:e.resellerCompany.pk,shortname:e.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.company.index"}}},ResellerItem:function(e){return{resellerItemPk:e.pk,resellerCompanyPk:e.resellerCompany.pk,shortname:e.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.item.index"}}},ResellerItemMapping:function(e){return{resellerItemMappingPk:e.pk,resellerItemPk:e.resellerItem.pk,resellerCompanyPk:e.resellerItem.resellerCompany.pk,shortname:e.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.item.index"}}},ResellerCustomerType:function(e){return{resellerCustomerTypePk:e.pk,resellerItemPk:e.resellerItem.pk,resellerCompanyPk:e.resellerItem.resellerCompany.pk,shortname:e.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.customerType.index"}}},ResellerCustomerTypeMapping:function(e){return{resellerCustomerTypeMappingPk:e.pk,resellerCustomerTypePk:e.resellerCustomerType.pk,resellerItemPk:e.resellerCustomerType.resellerItem.pk,resellerCompanyPk:e.resellerCustomerType.resellerItem.resellerCompany.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.customerType.index"}}},ResellerOption:function(e){return{resellerOptionPk:e.pk,resellerItemPk:e.resellerItem.pk,resellerCompanyPk:e.resellerItem.resellerCompany.pk,shortname:e.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.option.index"}}},ResellerOptionMapping:function(e){return{resellerOptionMappingPk:e.pk,resellerOptionPk:e.resellerOption.pk,resellerItemPk:e.resellerOption.resellerItem.pk,resellerCompanyPk:e.resellerOption.resellerItem.resellerCompany.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.option.index"}}},ResellerKey:function(e){return{resellerKeyPk:e.pk,username:e.user.username,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.apiKeys.apiKey"}}},ResellerApp:function(e){return{resellerAppPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.apps.app.index"}}},ResellerAppRequest:function(e){return{resellerAppRequestPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.connect"}}},ResellerAppCompany:function(e){return{resellerAppCompanyPk:e.pk,resellerAppPk:e.resellerApp.pk,shortname:e.resellerApp.company.shortname}},AnalyticsService:function(e){return{analyticsServicePk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.analyticsServices.analyticsService"}}},CancellationPolicy:function(e){return{cancellationPolicyPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.cancellationPolicy.index"}}},CancellationRule:function(e){return{cancellationPolicyPk:e.cancellationPolicy.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.cancellationPolicy.index"}}},BookingRestriction:function(e){return{bookingRestrictionPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.bookingRestrictions.bookingRestriction"}}},TicketLayout:function(e){return{ticketLayoutPk:e.pk,shortname:e.company.shortname,canonical:{dashboard:"dashboard.settings.ticketLayouts.ticketLayout.index"}}}},a={populate:r,populateForObject:function(e){var t;if(e=e||"",this.$urls){if(t=this.$urls[e])return t}else this.$urls={},this.$params=a.extract(this);if(e)t=r(e,this.$params);else{if(!this.$params.canonical)return"";var n=this.$params.canonical.dashboard||this.$params.canonical.company;if(!n)return"";t=r(_.getDotted(a,n),this.$params)}return this.$urls[e]=t,t},extract:function(e){t.assert(e,"urls: unable to extract from object",e),t.defined(i,e.cls,"urls: unable to extract cls",e);try{return i[e.cls](e)}catch(t){return console.warn("urls: unable to extract",e,t),{}}},calendarUrls:function(e){return{index:e,month:e+":year/:month/",day:e+":year/:month/:day/",agenda:e+":year/:month/:day/",grid:e+":year/:month/:day/",timeline:e+":year/:month/:day/"}},dayUrlForCompany:function(t,n){var i=t.features.isDayViewEnabled?a.dashboard.bookings.day.date:a.dashboard.bookings.timeline.date+"?timeline-type="+e.Company.AVAILABILITY_TIMELINE;return r(i,{shortname:t.shortname,date:n.format("YYYY-MM-DD")})},legacyManifest:"/:shortname/manifest/",company:{index:"/:shortname/",login:"/:shortname/login/",about:"/:shortname/about/",faq:"/:shortname/faq/",policies:"/:shortname/policies/",items:{index:"/:shortname/items/",calendar:"/:shortname/items/calendar/",date:{index:"/:shortname/items/date/",date:"/:shortname/items/date/:date/"}},item:{index:"/:shortname/items/:itemPk(pk)/",calendar:"/:shortname/items/:itemPk(pk)/calendar/",month:"/:shortname/items/:itemPk(pk)/calendar/:year/:month/",date:"/:shortname/items/:itemPk(pk)/date/:date/",availability:"/:shortname/items/:itemPk(pk)/availability/:availabilityPk/",book:"/:shortname/items/:itemPk(pk)/availability/:availabilityPk/book/",booking:"/:shortname/items/:itemPk(pk)/booking/:bookingUuid/"},storedValueCard:{index:"/:shortname/gift-cards/:storedValueCardNumber/"},cart:{index:"/:shortname/cart/",permalink:"/:shortname/cart/?u=:cartUuid"},order:{index:"/:shortname/orders/:orderUuid/"},invoice:{index:"/:shortname/invoices/:invoiceUuid/"},flowNode:{index:"/:shortname/items/?flow=:flowNodePk",calendar:"/:shortname/items/calendar/?flow=:flowNodePk",date:{index:"/:shortname/items/date/?flow=:flowNodePk",date:"/:shortname/items/date/:date/?flow=:flowNodePk"}}},dashboard:{index:"/:shortname/dashboard/",overlay:{index:"/:shortname/dashboard/@overlay=/",item:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/",date:"/:shortname/dashboard/@overlay=/items/:itemPk/date/:date/"},availability:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/",bookings:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/bookings/",cancelled:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/bookings/cancelled/"},message:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/message/",settings:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/settings/",prices:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/prices/",integrations:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/integrations/"},contact:{index:"/:shortname/dashboard/@overlay=/contacts/:contactPk/",booking:"/:shortname/dashboard/@overlay=/contacts/:contactPk/bookings/:bookingUuid/",order:"/:shortname/dashboard/@overlay=/contacts/:contactPk/orders/:orderUuid/"},deprecatedBooking:{index:"/:shortname/dashboard/@overlay=/bookings/:bookingUuid/"},activity:{index:"/:shortname/dashboard/@overlay=/activities/:activityPk/"},translation:{index:"/:shortname/dashboard/@overlayTop=/translations/:objectType/:objectId/:objectField/"},document:{index:"/:shortname/dashboard/@overlay=/documents/:paymentProcessingDocumentPk"},close:"/:shortname/dashboard/@overlay"},translationsOverlay:{index:"/:shortname/dashboard/@translations-overlay=/",forSubfield:"/:shortname/dashboard/@translations-overlay=/for-field/:objectType/:objectId/:objectField/:subfield/",forField:"/:shortname/dashboard/@translations-overlay=/for-field/:objectType/:objectId/:objectField/",close:"/:shortname/dashboard/@translations-overlay"},admin:{index:"/:shortname/dashboard/admin/"},manifest:{index:"/:shortname/dashboard/manifest/",date:"/:shortname/dashboard/manifest/date/:date/",bookings:"/:shortname/dashboard/manifest/date/:date/bookings/",availabilities:"/:shortname/dashboard/manifest/date/:date/availabilities/",items:"/:shortname/dashboard/manifest/date/:date/items/",runs:"/:shortname/dashboard/manifest/date/:date/runs/",resources:"/:shortname/dashboard/manifest/date/:date/resources/"},bookings:{index:"/:shortname/dashboard/bookings/",calendar:"/:shortname/dashboard/bookings/calendar/",day:{index:"/:shortname/dashboard/bookings/day/",date:"/:shortname/dashboard/bookings/day/:date/"},grid:{index:"/:shortname/dashboard/bookings/grid/",date:"/:shortname/dashboard/bookings/grid/:date/"},timeline:{index:"/:shortname/dashboard/bookings/timeline/",date:"/:shortname/dashboard/bookings/timeline/:date/"},agenda:{index:"/:shortname/dashboard/bookings/agenda/",date:"/:shortname/dashboard/bookings/agenda/:date/"},booking:{deprecatedPermalink:"/:shortname/dashboard/bookings/:bookingUuid/view/",deprecatedAffiliatePermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/:bookingUuid/"},contact:{index:"/:shortname/dashboard/bookings/contacts/:contactPk/",order:"/:shortname/dashboard/bookings/contacts/:contactPk/orders/:orderUuid/view/",booking:"/:shortname/dashboard/bookings/contacts/:contactPk/bookings/:bookingUuid/view/",affiliateContactPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/",affiliateBookingPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/bookings/:bookingUuid/",affiliateOrderPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/orders/:orderUuid/"}},reports:{index:"/:shortname/dashboard/reports/",type:"/:shortname/dashboard/reports/:type/",invoices:{index:"/:shortname/dashboard/reports/invoices/",create:{index:"/:shortname/dashboard/reports/invoices/create/",permalink:"/:shortname/dashboard/reports/invoices/create/report/:reportPk/"},permalink:"/:shortname/dashboard/reports/invoices/report/:reportPk/",invoice:{index:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/",multi:"/:shortname/dashboard/reports/invoices/invoices/:invoicePks(pks)/",notification:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/notification/",upload:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/upload/"},partnerInvoice:{index:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/",notification:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/notification/",upload:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/upload/"}},test:{index:"/:shortname/dashboard/reports/test/",permalink:"/:shortname/dashboard/reports/test/report/:reportPk/"},reports:{index:"/:shortname/dashboard/reports/reports/"},accounts:{index:"/:shortname/dashboard/reports/accounts/",permalink:"/:shortname/dashboard/reports/accounts/report/:reportPk/",transfer:"/:shortname/dashboard/reports/accounts/transfer/:transferPk/",upload:"/:shortname/dashboard/reports/accounts/upload/:uploadPk/"},customersRedirect:{index:"/:shortname/dashboard/reports/customers/"},contacts:{index:"/:shortname/dashboard/reports/contacts/",permalink:"/:shortname/dashboard/reports/contacts/report/:reportPk/"},bookings:{index:"/:shortname/dashboard/reports/bookings/",permalink:"/:shortname/dashboard/reports/bookings/report/:reportPk/"},companies:{index:"/:shortname/dashboard/reports/companies/",permalink:"/:shortname/dashboard/reports/companies/report/:reportPk/"},payments:{index:"/:shortname/dashboard/reports/payments/",permalink:"/:shortname/dashboard/reports/payments/report/:reportPk/"},disputes:{index:"/:shortname/dashboard/reports/disputes/",permalink:"/:shortname/dashboard/reports/disputes/report/:reportPk/"},lineItems:{index:"/:shortname/dashboard/reports/line-items/",permalink:"/:shortname/dashboard/reports/line-items/report/:reportPk/"},payouts:{index:"/:shortname/dashboard/reports/payouts/",permalink:"/:shortname/dashboard/reports/payouts/report/:reportPk/",payout:"/:shortname/dashboard/reports/payouts/payout/:payoutPk/"},escrow:{index:"/:shortname/dashboard/reports/future-payouts/",permalink:"/:shortname/dashboard/reports/future-payouts/report/:reportPk/"},volume:{index:"/:shortname/dashboard/reports/volume/",permalink:"/:shortname/dashboard/reports/volume/report/:reportPk/"},transactions:{index:"/:shortname/dashboard/reports/transactions/",permalink:"/:shortname/dashboard/reports/transactions/report/:reportPk/",adjustment:"/:shortname/dashboard/reports/transactions/:adjustmentPk/"},bookingTypesSummary:{index:"/:shortname/dashboard/reports/booking-types-summary/",permalink:"/:shortname/dashboard/reports/booking-types-summary/report/:reportPk/"},crewSummary:{index:"/:shortname/dashboard/reports/crew-summary/",permalink:"/:shortname/dashboard/reports/crew-summary/report/:reportPk/"},customerTypesSummary:{index:"/:shortname/dashboard/reports/customer-types-summary/",permalink:"/:shortname/dashboard/reports/customer-types-summary/report/:reportPk/"},customFieldSummary:{index:"/:shortname/dashboard/reports/custom-field-summary/",permalink:"/:shortname/dashboard/reports/custom-field-summary/report/:reportPk/"},itemsSummary:{index:"/:shortname/dashboard/reports/items-summary/",permalink:"/:shortname/dashboard/reports/items-summary/report/:reportPk/"},lodgingsSummary:{index:"/:shortname/dashboard/reports/lodging-summary/",permalink:"/:shortname/dashboard/reports/lodging-summary/report/:reportPk/"},pickupsSummary:{index:"/:shortname/dashboard/reports/pickups-summary/",permalink:"/:shortname/dashboard/reports/pickups-summary/report/:reportPk/"},usersSummary:{index:"/:shortname/dashboard/reports/users-summary/",permalink:"/:shortname/dashboard/reports/users-summary/report/:reportPk/"},agentsSummary:{index:"/:shortname/dashboard/reports/agents-summary/",permalink:"/:shortname/dashboard/reports/agents-summary/report/:reportPk/"},desksSummary:{index:"/:shortname/dashboard/reports/desks-summary/",permalink:"/:shortname/dashboard/reports/desks-summary/report/:reportPk/"},campaignsSummary:{index:"/:shortname/dashboard/reports/campaigns-summary/",permalink:"/:shortname/dashboard/reports/campaigns-summary/report/:reportPk/"},revenueSummary:{index:"/:shortname/dashboard/reports/revenue-summary/",permalink:"/:shortname/dashboard/reports/revenue-summary/report/:reportPk/"},advanced:{redirect:"/:shortname/dashboard/reports/advanced/",index:"/:shortname/dashboard/reports/advanced/:modelSlug/",permalink:"/:shortname/dashboard/reports/advanced/:modelSlug/:reportPk/"}},items:{index:"/:shortname/dashboard/items/",grid:"/:shortname/dashboard/items/grid/",list:"/:shortname/dashboard/items/list/",item:{index:"/:shortname/dashboard/items/:itemPk/",activity:"/:shortname/dashboard/items/:itemPk/activity/",calendar:"/:shortname/dashboard/items/:itemPk/calendar/",prices:{index:"/:shortname/dashboard/items/:itemPk/prices/",customerTypes:"/:shortname/dashboard/items/:itemPk/prices/customer-types/",fieldGroups:"/:shortname/dashboard/items/:itemPk/prices/field-groups/",resources:"/:shortname/dashboard/items/:itemPk/prices/resources/"},embeds:"/:shortname/dashboard/items/:itemPk/embeds/",onlineBooking:"/:shortname/dashboard/items/:itemPk/online-booking/",suggestedItems:"/:shortname/dashboard/items/:itemPk/suggested-items/",seating:"/:shortname/dashboard/items/:itemPk/seating/",info:{index:"/:shortname/dashboard/items/:itemPk/info/",notes:"/:shortname/dashboard/items/:itemPk/info/notes/",basic:"/:shortname/dashboard/items/:itemPk/info/basic/",photos:"/:shortname/dashboard/items/:itemPk/info/photos/",advanced:"/:shortname/dashboard/items/:itemPk/info/advanced/",tags:"/:shortname/dashboard/items/:itemPk/info/tags/"},listing:{index:"/:shortname/dashboard/items/:itemPk/listing/",basic:"/:shortname/dashboard/items/:itemPk/listing/basic/",photos:"/:shortname/dashboard/items/:itemPk/listing/photos/",facts:"/:shortname/dashboard/items/:itemPk/listing/facts/"},notifications:{index:"/:shortname/dashboard/items/:itemPk/notifications/",internal:"/:shortname/dashboard/items/:itemPk/notifications/internal/",external:"/:shortname/dashboard/items/:itemPk/notifications/external/"},integrations:{index:"/:shortname/dashboard/items/:itemPk/integrations/",subscribe:"/:shortname/dashboard/items/:itemPk/integrations/subscribe/",reviewExpress:"/:shortname/dashboard/items/:itemPk/integrations/review-express/",picthrive:"/:shortname/dashboard/items/:itemPk/integrations/picthrive/"}}},resources:{index:"/:shortname/dashboard/resources/",resource:{index:"/:shortname/dashboard/resources/:resourcePk/",settings:"/:shortname/dashboard/resources/:resourcePk/settings/",uses:{index:"/:shortname/dashboard/resources/:resourcePk/uses/",overview:"/:shortname/dashboard/resources/:resourcePk/uses/overview/",day:"/:shortname/dashboard/resources/:resourcePk/uses/date/:date/"}}},settings:{index:"/:shortname/dashboard/settings/",advanced:"/:shortname/dashboard/settings/advanced/",payments:{index:"/:shortname/dashboard/settings/payments/",cards:{index:"/:shortname/dashboard/settings/payments/cards/",card:{index:"/:shortname/dashboard/settings/payments/cards/:cardPk/",settings:"/:shortname/dashboard/settings/payments/cards/:cardPk/settings/"}},inStorePaymentTypes:"/:shortname/dashboard/settings/payments/payment-types/",taxTypes:{index:"/:shortname/dashboard/settings/payments/tax-types/",taxType:"/:shortname/dashboard/settings/payments/tax-types/:taxTypePk"},emvDevices:"/:shortname/dashboard/settings/payments/emv-devices/",bankAccounts:"/:shortname/dashboard/settings/payments/bank-accounts/",refundReserve:"/:shortname/dashboard/settings/payments/refund-reserve/",ledgers:{index:"/:shortname/dashboard/settings/payments/ledgers/",ledger:"/:shortname/dashboard/settings/payments/ledgers/:ledgerPk"}},profile:{index:"/:shortname/dashboard/settings/profile/",style:"/:shortname/dashboard/settings/profile/style/",slideshow:"/:shortname/dashboard/settings/profile/slideshow/",pages:"/:shortname/dashboard/settings/profile/pages/"},info:{index:"/:shortname/dashboard/settings/info/",notesAndPolicies:{index:"/:shortname/dashboard/settings/info/notes/",health:"/:shortname/dashboard/settings/info/notes/health/",hours:"/:shortname/dashboard/settings/info/notes/hours/"},contact:"/:shortname/dashboard/settings/info/contact/",socialMedia:"/:shortname/dashboard/settings/info/social-media/",advanced:"/:shortname/dashboard/settings/info/advanced/",tags:"/:shortname/dashboard/settings/info/tags/",facts:"/:shortname/dashboard/settings/info/facts/"},cancellationPolicies:"/:shortname/dashboard/settings/cancellation-policies/",cancellationPolicy:{index:"/:shortname/dashboard/settings/cancellation-policies/:cancellationPolicyPk/",settings:"/:shortname/dashboard/settings/cancellation-policies/:cancellationPolicyPk/settings/"},tagGroups:{index:"/:shortname/dashboard/settings/tag-groups/",tagGroup:{index:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/",settings:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/settings/",tag:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/tags/:tagPk/"}},seating:{index:"/:shortname/dashboard/settings/seat-maps/",seatMap:{index:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/",layout:{index:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/",seatGroup:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/seat-groups/:seatGroupPk/",duplicate:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/seats/:seatPks(pks)/duplicate/",seats:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/seats/:seatPks(pks)/",new:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/new/:seatGroupPk/:xCoord/:yCoord/"},seatZones:{index:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/seat-zones/",seatZone:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/seat-zones/:seatZonePk/"},settings:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/settings/",activity:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/activity/"}},permissions:{index:"/:shortname/dashboard/settings/permissions/",groups:"/:shortname/dashboard/settings/permissions/groups/",group:"/:shortname/dashboard/settings/permissions/groups/:groupPk/",groupOverrides:"/:shortname/dashboard/settings/permissions/outside-users/",groupOverride:"/:shortname/dashboard/settings/permissions/outside-users/:groupOverridePk/",users:"/:shortname/dashboard/settings/permissions/users/",user:{index:"/:shortname/dashboard/settings/permissions/users/:username/",settings:"/:shortname/dashboard/settings/permissions/users/:username/settings/",apiKeys:{index:"/:shortname/dashboard/settings/permissions/users/:username/api-keys/",apiKey:"/:shortname/dashboard/settings/permissions/users/:username/api-keys/:resellerKeyPk/"}}},agents:{index:"/:shortname/dashboard/settings/agents/",agent:"/:shortname/dashboard/settings/agents/:agentPk/"},desks:{index:"/:shortname/dashboard/settings/desks/",desk:"/:shortname/dashboard/settings/desks/:deskPk/"},campaigns:{index:"/:shortname/dashboard/settings/campaigns/",campaign:{index:"/:shortname/dashboard/settings/campaigns/:campaignPk/",settings:"/:shortname/dashboard/settings/campaigns/:campaignPk/settings/",code:"/:shortname/dashboard/settings/campaigns/:campaignPk/codes/:codePk/"}},checkinStatuses:"/:shortname/dashboard/settings/check-in/",customerTypes:{index:"/:shortname/dashboard/settings/customer-types/",customerType:"/:shortname/dashboard/settings/customer-types/:customerTypePk/"},requirementGroups:{index:"/:shortname/dashboard/settings/requirement-groups/",requirementGroup:"/:shortname/dashboard/settings/requirement-groups/:requirementGroupPk"},customFields:{index:"/:shortname/dashboard/settings/custom-fields/",table:"/:shortname/dashboard/settings/custom-fields/table/",type:"/:shortname/dashboard/settings/custom-fields/type/:type/",customField:"/:shortname/dashboard/settings/custom-fields/:customFieldPk(pk)/"},customFieldInstanceGroups:{index:"/:shortname/dashboard/settings/custom-field-groups/",customFieldInstanceGroup:"/:shortname/dashboard/settings/custom-field-groups/:customFieldInstanceGroupPk(pk)/"},cannedMessages:{index:"/:shortname/dashboard/settings/canned-messages/",cannedMessage:"/:shortname/dashboard/settings/canned-messages/:cannedMessagePk/"},availabilityHeadlines:{index:"/:shortname/dashboard/settings/headlines/",availabilityHeadline:"/:shortname/dashboard/settings/headlines/:availabilityHeadlinePk/"},network:{index:"/:shortname/dashboard/settings/network/",affiliates:{index:"/:shortname/dashboard/settings/network/affiliates/",affiliate:{index:"/:shortname/dashboard/settings/network/affiliates/:affiliationPk/",cards:"/:shortname/dashboard/settings/network/affiliates/:affiliationPk/cards/"}},partners:{index:"/:shortname/dashboard/settings/network/partners/",partner:{index:"/:affiliateShortname/dashboard/settings/network/partners/:affiliationPk/",cards:"/:affiliateShortname/dashboard/settings/network/partners/:affiliationPk/cards/"}}},hotels:{index:"/:shortname/dashboard/settings/hotels/",hotel:"/:shortname/dashboard/settings/hotels/:hotelPk/"},lodgings:{index:"/:shortname/dashboard/settings/lodgings/",lodging:"/:shortname/dashboard/settings/lodgings/:lodgingPk/"},pickups:{index:"/:shortname/dashboard/settings/pickups/",pickup:"/:shortname/dashboard/settings/pickups/:pickupPk/"},routes:{index:"/:shortname/dashboard/settings/routes/",route:"/:shortname/dashboard/settings/routes/:routePk/"},translations:{index:"/:shortname/dashboard/settings/languages/",language:{index:"/:shortname/dashboard/settings/languages/:languagePk/",settings:"/:shortname/dashboard/settings/languages/:languagePk/settings/",translations:{index:"/:shortname/dashboard/settings/languages/:languagePk/translations/",forModel:"/:shortname/dashboard/settings/languages/:languagePk/translations/:modelName/"}}},pricing:{index:"/:shortname/dashboard/settings/pricing/",sheets:"/:shortname/dashboard/settings/pricing/sheets/",totalSheet:"/:shortname/dashboard/settings/pricing/total-sheets/:totalSheetPk/",invoiceSheet:"/:shortname/dashboard/settings/pricing/invoice-sheets/:invoiceSheetPk/",schedules:"/:shortname/dashboard/settings/pricing/schedules/",totalSchedules:{index:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/",settings:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/settings/",entry:{index:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/",settings:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/settings/"}},invoiceSchedules:{index:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/",settings:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/settings/",entry:{index:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/",settings:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/settings/"}},overview:"/:shortname/dashboard/settings/pricing/overview/"},activity:{index:"/:shortname/dashboard/settings/activity/",company:"/:shortname/dashboard/settings/activity/company/"},embeds:"/:shortname/dashboard/settings/embeds/",fhdn:"/:shortname/dashboard/settings/fhdn/",connect:"/:shortname/dashboard/settings/connect/",integrations:{index:"/:shortname/dashboard/settings/integrations/",subscribe:"/:shortname/dashboard/settings/integrations/subscribe/"},reseller:{index:"/:shortname/dashboard/settings/integrations/channels/",requests:"/:shortname/dashboard/settings/integrations/channels/requests/",company:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/settings/"},item:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/settings/"},customerType:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/customer-types/:resellerCustomerTypePk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/customer-types/:resellerCustomerTypePk/settings/"},option:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/options/:resellerOptionPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/options/:resellerOptionPk/settings/"},apps:{index:"/:shortname/dashboard/settings/integrations/apps/",app:{index:"/:shortname/dashboard/settings/integrations/apps/:resellerAppPk/",settings:"/:shortname/dashboard/settings/integrations/apps/:resellerAppPk/settings/"}}},waivers:{index:"/:shortname/dashboard/settings/waivers/",waiver:{index:"/:shortname/dashboard/settings/waivers/:waiverPk/"}},locations:{index:"/:shortname/dashboard/settings/locations/",settings:"/:shortname/dashboard/settings/locations/settings/",location:"/:shortname/dashboard/settings/locations/location/:locationPk/"},storedValue:{index:"/:shortname/dashboard/settings/gift-cards/",storedValueTypes:"/:shortname/dashboard/settings/gift-cards/types/",storedValueType:"/:shortname/dashboard/settings/gift-cards/types/:storedValueTypePk/",storedValueDesigns:"/:shortname/dashboard/settings/gift-cards/designs/",storedValueCards:"/:shortname/dashboard/settings/gift-cards/cards/",storedValueCard:{index:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/",settings:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/settings/",storedValueAdjustment:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/adjustments/:storedValueAdjustmentPk/"}},analyticsServices:{index:"/:shortname/dashboard/settings/analytics/",analyticsService:"/:shortname/dashboard/settings/analytics/:analyticsServicePk/"},flows:{index:"/:shortname/dashboard/settings/flows/",flowNode:{index:"/:shortname/dashboard/settings/flows/:flowNodePk/"}},ticketLayouts:{index:"/:shortname/dashboard/settings/ticket-layouts/",ticketLayout:{index:"/:shortname/dashboard/settings/ticket-layouts/:ticketLayoutPk/"}},suggestedItems:"/:shortname/dashboard/settings/suggested-items/",bookingRestrictions:{index:"/:shortname/dashboard/settings/booking-restrictions/",bookingRestriction:"/:shortname/dashboard/settings/booking-restrictions/:bookingRestrictionPk/"}}},root:{index:"/",login:"/login/",forgot:{index:"/forgot/",password:"/forgot/password/",resetPassword:"/forgot/password/reset/",credentials:"/forgot/credentials/"},version:"/version/",help:"/help/",demo:"/demo/",about:"/about/",tour:"/tour/"},email:{bookingNotification:"/email/:type/:shortname/bookings/:bookingUuid/",orderNotification:"/email/:type/:shortname/orders/:orderUuid/",invoicePaymentRequest:"/email/:type/:shortname/invoice/:invoicePk/"},embeds:{calendar:{index:"/embeds/calendar/:shortname/",all:"/embeds/calendar/:shortname/all/",items:"/embeds/calendar/:shortname/items/:itemPks(pks)/"},cart:{index:"/embeds/cart/"},checkin:{index:"/embeds/checkin/",company:{index:"/embeds/checkin/:shortname/",booking:{index:"/embeds/checkin/:shortname/bookings/:bookingUuid/",customer:"/embeds/checkin/:shortname/bookings/:bookingUuid/customers/:customerPk/"}},qr:"/:encodedCustomerPk"},book:{index:"/embeds/book/:shortname/",storedValueCard:{index:"/embeds/book/:shortname/gift-cards/:storedValueCardNumber/"},items:{index:"/embeds/book/:shortname/items/",calendar:"/embeds/book/:shortname/items/calendar/",date:{index:"/embeds/book/:shortname/items/date/",date:"/embeds/book/:shortname/items/date/:date/"}},item:{index:"/embeds/book/:shortname/items/:itemPk(pk)/",calendar:"/embeds/book/:shortname/items/:itemPk(pk)/calendar/",month:"/embeds/book/:shortname/items/:itemPk(pk)/calendar/:year/:month/",date:"/embeds/book/:shortname/items/:itemPk(pk)/date/:date/",availability:"/embeds/book/:shortname/items/:itemPk(pk)/availability/:availabilityPk/",book:"/embeds/book/:shortname/items/:itemPk(pk)/availability/:availabilityPk/book/",booking:"/embeds/book/:shortname/items/:itemPk(pk)/booking/:bookingUuid/"},cart:{index:"/embeds/book/:shortname/cart/",flowNode:"/embeds/book/:shortname/cart/?flow=:flowNodePk",permalink:"/embeds/book/:shortname/cart/?u=:cartUuid"},order:{index:"/embeds/book/:shortname/orders/:orderUuid/"},flowNode:{index:"/embeds/book/:shortname/items/?flow=:flowNodePk",calendar:"/embeds/book/:shortname/items/calendar/?flow=:flowNodePk",date:{index:"/embeds/book/:shortname/items/date/?flow=:flowNodePk",date:"/embeds/book/:shortname/items/date/:date/?flow=:flowNodePk"}},wait:{index:"/embeds/book/:shortname/pending/",order:"/embeds/book/:shortname/pending/orders/:orderUuid/",booking:"/embeds/book/:shortname/pending/bookings/:bookingUuid/"}},partners:{index:"/embeds/partners/",company:"/embeds/partners/:shortname/"},items:{index:"/embeds/items/:shortname/"},analytics:{booking:"/embeds/a/:shortname/booking/:bookingUuid/"}},pusher:{auth:"/realtime/auth/",channels:"/realtime/:shortname/channels/",members:"/realtime/:shortname/members/"},api:{login:"/api/v1/login/",logout:"/api/v1/logout/",forgotPassword:"/api/v1/forgot/password/",resetPassword:"/api/v1/forgot/password/reset/:shortname/",forgotCredentials:"/api/v1/forgot/credentials/",companies:"/api/v1/companies/",company:"/api/v1/companies/:shortname/",providerLogin:"/api/v1/companies/:shortname/login/provider/",companyNags:"/api/v1/companies/:shortname/nags/",companyFeatures:"/api/v1/companies/:shortname/features/",refundReserve:"/api/v1/companies/:shortname/refund-reserve/",companyItemColorsFeature:"/api/v1/companies/:shortname/item-colors-feature/",companyProfile:"/api/v1/companies/:shortname/profile/",companyContactInformation:"/api/v1/companies/:shortname/contact-information/",processorAccount:"/api/v1/companies/:shortname/processor-account/",processorOnboard:"/api/v1/companies/:shortname/tax-information/onboard/",processorCompleteAccountSetup:"/api/v1/companies/:shortname/processor-account/complete-setup/",companyTosAcceptance:"/api/v1/companies/:shortname/tos/",companyAccounts:"/api/v1/companies/:shortname/accounts/",companyStyles:"/api/v1/companies/:shortname/styles/",companyAdminNotes:"/api/v1/companies/:shortname/admin-notes/",companyPayments:"/api/v1/companies/:shortname/payments/",companyManifestSettings:"/api/v1/companies/:shortname/manifest-settings/",companyCalendar:"/api/v1/companies/:shortname/calendar/:year/:month/",companyImages:"/api/v1/companies/:shortname/images/",companyImage:"/api/v1/companies/:shortname/images/:imagePk/",tagGroups:"/api/v1/companies/:shortname/tag-groups/",tagGroup:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/",tags:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/tags/",tag:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/tags/:tagPk/",objectTags:"/api/v1/companies/:shortname/tags/:objectCls/:objectPk/",taxTypes:"/api/v1/companies/:shortname/tax-types/",taxType:"/api/v1/companies/:shortname/tax-types/:taxTypePk/",inStorePaymentTypes:"/api/v1/companies/:shortname/in-store-payment-types/",allInStorePaymentTypes:"/api/v1/companies/:shortname/in-store-payment-types/all/",ledgers:"/api/v1/companies/:shortname/ledgers/",allLedgers:"/api/v1/companies/:shortname/ledgers/all/",ledger:"/api/v1/companies/:shortname/ledgers/:ledgerPk/",inStorePaymentType:"/api/v1/companies/:shortname/in-store-payment-types/:inStorePaymentTypePk/",emvLocation:"/api/v1/companies/:shortname/emv-location/",emvDevices:"/api/v1/companies/:shortname/emv-devices/",emvDevice:"/api/v1/companies/:shortname/emv-devices/:emvDevicePk/",retrieveConnectionToken:"/api/v1/companies/:shortname/emv-devices/connection-token/",createInteractionToken:"/api/v1/companies/:shortname/emv-devices/emv-interaction-token/",checkEmvDeviceConnections:"/api/v1/companies/:shortname/emv-devices/check-connection/",checkEmvDeviceConnection:"/api/v1/companies/:shortname/emv-devices/check-connection/:emvDevicePk/",checkEmvPaymentStatus:"/api/v1/companies/:shortname/emv-devices/payment-status/",cancelEmvCharge:"/api/v1/companies/:shortname/emv-devices/cancel-charge/",bankAccounts:"/api/v1/companies/:shortname/bank-accounts/",bankAccount:"/api/v1/companies/:shortname/bank-accounts/:bankAccountPk/",cards:"/api/v1/companies/:shortname/cards/",card:"/api/v1/companies/:shortname/cards/:cardPk/",cardAffiliations:"/api/v1/companies/:shortname/cards/:cardPk/card-affiliations/",verifyBankAccount:"/api/v1/companies/:shortname/bank-accounts/:bankAccountPk/verify/",hotels:"/api/v1/companies/:shortname/hotels/",hotel:"/api/v1/companies/:shortname/hotels/:hotelPk/",lodgings:"/api/v1/companies/:shortname/lodgings/",duplicateLodgingsAcrossCompanies:"/api/v1/companies/:shortname/lodgings/duplicate/",lodging:"/api/v1/companies/:shortname/lodgings/:lodgingPk/",preferredPickups:"/api/v1/companies/:shortname/lodgings/:lodgingPk/preferred-pickups/",preferredPickup:"/api/v1/companies/:shortname/lodgings/:lodgingPk/preferred-pickups/:preferredPickupPk/",pickups:"/api/v1/companies/:shortname/pickups/",duplicatePickupsAcrossCompanies:"/api/v1/companies/:shortname/pickups/duplicate/",pickup:"/api/v1/companies/:shortname/pickups/:pickupPk/",routes:"/api/v1/companies/:shortname/routes/",duplicateRoutesAcrossCompanies:"/api/v1/companies/:shortname/routes/duplicate/",route:"/api/v1/companies/:shortname/routes/:routePk/",routeItems:"/api/v1/companies/:shortname/routes/:routePk/items/",duplicateRoute:"/api/v1/companies/:shortname/routes/:routePk/duplicate/",stops:"/api/v1/companies/:shortname/routes/:routePk/stops/",stop:"/api/v1/companies/:shortname/routes/:routePk/stops/:stopPk/",customManifests:"/api/v1/companies/:shortname/custom-manifests/",customManifest:"/api/v1/companies/:shortname/custom-manifests/:customManifestPk/",customCalendars:"/api/v1/companies/:shortname/custom-calendars/",customCalendar:"/api/v1/companies/:shortname/custom-calendars/:customCalendarPk/",customReports:"/api/v1/companies/:shortname/custom-reports/",customReport:"/api/v1/companies/:shortname/custom-reports/:customReportPk/",users:"/api/v1/companies/:shortname/users/",allUsers:"/api/v1/companies/:shortname/users/all/",relatedUsers:"/api/v1/companies/:shortname/users/related/",user:"/api/v1/companies/:shortname/users/:username/",userNags:"/api/v1/companies/:shortname/users/:username/nags/",userActivities:"/api/v1/companies/:shortname/users/:username/activities/",userSubscriptions:"/api/v1/companies/:shortname/users/:username/subscriptions/",userItemSubscriptions:"/api/v1/companies/:shortname/users/:username/subscriptions/items/:itemPk/",userOverview:"/api/v1/companies/:shortname/users/:username/overview/",reorder:"/api/v1/companies/:shortname/reorder/:objectCls/:objectPk/",activities:"/api/v1/companies/:shortname/activities/:activityObjectCls/:activityObjectPks/",activity:"/api/v1/companies/:shortname/activities/:activityPk(pk)/",allActivities:"/api/v1/companies/:shortname/activities/all/",systemActivities:"/api/v1/companies/:shortname/activities/system/",notes:"/api/v1/companies/:shortname/activities/:activityObjectCls/:activityObjectPk/notes/",items:"/api/v1/companies/:shortname/items/",allItems:"/api/v1/companies/:shortname/items/all/",item:"/api/v1/companies/:shortname/items/:itemPk/",itemColor:"/api/v1/companies/:shortname/items/:itemPk/color/",itemPricingOverview:"/api/v1/companies/:shortname/items/:itemPk/pricing-overview/",duplicateItem:"/api/v1/companies/:shortname/items/:itemPk/duplicate/",itemCalendar:"/api/v1/companies/:shortname/items/:itemPk/calendar/:year/:month/",itemSubscriptions:"/api/v1/companies/:shortname/items/:itemPk/subscriptions/",itemImages:"/api/v1/companies/:shortname/items/:itemPk/images/",itemImage:"/api/v1/companies/:shortname/items/:itemPk/images/:imagePk/",itemRatings:"/api/v1/companies/:shortname/items/:itemPk/ratings/",itemFlowPages:"/api/v1/companies/:shortname/items/:itemPk/flow-nodes/",itemHasFutureAvailsUsingCompanyLevelCfig:"/api/v1/companies/:shortname/items/:itemPk/has-future-avails-using-company-cfig/",itemsCalendar:"/api/v1/companies/:shortname/items/:itemPks(pks)/calendar/:year/:month/",flowNodes:"/api/v1/companies/:shortname/flow-nodes/",flowNode:"/api/v1/companies/:shortname/flow-nodes/:flowNodePk/",defaultFlowPage:"/api/v1/companies/:shortname/flow-nodes/default/",duplicateFlowNode:"/api/v1/companies/:shortname/flow-nodes/:flowNodePk/duplicate/",cannedMessages:"/api/v1/companies/:shortname/canned-messages/",cannedMessage:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/",cannedMessageItems:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/items/",cannedMessageAvailabilityHeadlines:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/availability-headlines/",availabilityHeadlines:"/api/v1/companies/:shortname/availability-headlines/",availabilityHeadline:"/api/v1/companies/:shortname/availability-headlines/:availabilityHeadlinePk/",availabilityHeadlineItems:"/api/v1/companies/:shortname/availability-headlines/:availabilityHeadlinePk/items/",allCustomerTypes:"/api/v1/companies/:shortname/customer-types/all/",customerTypes:"/api/v1/companies/:shortname/customer-types/",customerType:"/api/v1/companies/:shortname/customer-types/:customerTypePk/",customerTypeItems:"/api/v1/companies/:shortname/customer-types/:customerTypePk/items/",customerPrototypes:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/",customerPrototype:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/:customerPrototypePk/",duplicateCustomerPrototype:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/:customerPrototypePk/duplicate/",allCustomerPrototypes:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/all/",customerPrototypesMulti:"/api/v1/companies/:shortname/items/customer-prototypes/multi/",checkinStatuses:"/api/v1/companies/:shortname/checkin-statuses/",checkinStatus:"/api/v1/companies/:shortname/checkin-statuses/:checkinStatusPk/",checkinStatusForBookings:"/api/v1/companies/:shortname/checkin-statuses/bookings/",roles:"/api/v1/companies/:shortname/roles/",role:"/api/v1/companies/:shortname/roles/:rolePk/",crewMembers:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/crew-members/",crewMember:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/crew-members/:crewMemberPk/",customFields:"/api/v1/companies/:shortname/custom-fields/",allCustomFields:"/api/v1/companies/:shortname/custom-fields/all/",customField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/",customFieldItems:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/items/",customFieldCompanyCustomFieldGroups:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/company-custom-field-groups/",duplicateCustomField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/duplicate/",prevalidateCustomField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/prevalidate/total-sheets/:totalSheetPk/availabilities/:availabilityPk/",transportationOptions:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/transportation-options/",transportationOption:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/transportation-options/:transportationOptionPk/",extendedOptions:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/extended-options/",extendedOption:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/extended-options/:extendedOptionPk/",connectedCampaigns:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-campaigns/",connectedCampaign:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-campaigns/:connectedCampaignPk/",generatingCampaigns:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/generating-campaigns/",generatingCampaign:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/generating-campaigns/:generatingCampaignPk/",campaigns:"/api/v1/companies/:shortname/campaigns/",campaign:"/api/v1/companies/:shortname/campaigns/:campaignPk/",campaignValidityRules:"/api/v1/companies/:shortname/campaigns/:campaignPk/campaign-validity-rules/",campaignValidityRule:"/api/v1/companies/:shortname/campaigns/:campaignPk/campaign-validity-rules/:campaignValidityRulePk/",campaignCustomFields:"/api/v1/companies/:shortname/campaigns/:campaignPk/custom-fields/",storedValueTypes:"/api/v1/companies/:shortname/stored-value-types/",storedValueType:"/api/v1/companies/:shortname/stored-value-types/:storedValueTypePk/",storedValueCards:"/api/v1/companies/:shortname/stored-value-cards/",issueStoredValueCard:"/api/v1/companies/:shortname/stored-value-cards/issue/",storedValueCard:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/",storedValueCardPayments:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/payments/",storedValueCardNotifications:"/api/v1/companies/:shortname/stored-value-cards/notifications/?q=:storedValueCardNumber",searchStoredValueCardsByNumber:"/api/v1/companies/:shortname/stored-value-cards/search/",storedValueAdjustments:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/adjustments/",storedValueAdjustment:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/adjustments/:storedValueAdjustmentPk/",codes:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/",code:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/:codePk/",codesByTag:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/:tag/",allAffiliates:"/api/v1/companies/:shortname/affiliates/all/",affiliates:"/api/v1/companies/:shortname/affiliates/",affiliate:"/api/v1/companies/:shortname/affiliates/:affiliationPk/",affiliateCards:"api/v1/companies/:shortname/affiliates/:affiliationPk/cards/",affiliateCardAffiliations:"/api/v1/companies/:shortname/affiliates/:affiliationPk/card-affiliations/",partners:"/api/v1/companies/:shortname/partners/",partner:"/api/v1/companies/:affiliateShortname/partners/:affiliationPk/",partnerCards:"/api/v1/companies/:shortname/partners/:affiliationPk/cards/",partnerCardAffiliations:"/api/v1/companies/:shortname/partners/:affiliationPk/card-affiliations/",allAgents:"/api/v1/companies/:shortname/agents/all/",agents:"/api/v1/companies/:shortname/agents/",agent:"/api/v1/companies/:shortname/agents/:agentPk/",allDesks:"/api/v1/companies/:shortname/desks/all/",desks:"/api/v1/companies/:shortname/desks/",desk:"/api/v1/companies/:shortname/desks/:deskPk/",customFieldInstances:"/api/v1/companies/:shortname/custom-field-instances/",customFieldInstancesMulti:"/api/v1/companies/:shortname/items/custom-field-instances/multi/",customFieldInstance:"/api/v1/companies/:shortname/custom-field-instances/:customFieldInstancePk/",customFieldInstanceConditions:"/api/v1/companies/:shortname/custom-field-instances/:customFieldInstancePk/conditions/",customFieldInstanceCondition:"/api/v1/companies/:shortname/custom-field-instances/:customFieldInstancePk/conditions/:customFieldInstanceConditionPk/",customFieldInstanceGroup:"/api/v1/companies/:shortname/custom-field-instance-groups/:customFieldInstanceGroupPk/",customFieldInstanceGroupsMulti:"/api/v1/companies/:shortname/items/custom-field-instance-groups/multi/",duplicateCustomFieldInstanceGroup:"/api/v1/companies/:shortname/custom-field-instance-groups/:customFieldInstanceGroupPk/duplicate/",itemCustomFieldInstanceGroups:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instance-groups/",companyCustomFieldInstanceGroups:"/api/v1/companies/:shortname/custom-field-instance-groups/",customFieldInstanceGroupItems:"/api/v1/companies/:shortname/custom-field-instance-groups/:customFieldInstanceGroupPk/items/",customFieldInstancesForPushedCustomFieldValues:"/api/v1/companies/:shortname/items/:itemPk/source-booking/:sourceBookingPk/pushed-custom-field-instances/",supportedLanguages:"/api/v1/companies/:shortname/supported-languages/",supportedLanguage:"/api/v1/companies/:shortname/supported-languages/:languagePk/",translationsForModel:"/api/v1/companies/:shortname/supported-languages/:languagePk/translations/:modelName/",translationsForField:"/api/v1/companies/:shortname/translations/:objectType/:objectId/:objectField/",understoodLanguages:"/api/v1/companies/:shortname/understood-languages/",translationsForSubfield:"/api/v1/companies/:shortname/translations/:objectType/:objectId/:objectField/:subfield/",nextAvailability:"/api/v1/companies/:shortname/items/:itemPk/availabilities/next/",futureAvailabilityCount:"/api/v1/companies/:shortname/:objectType/:objectPk/availabilities/future/count/",availabilitiesByDate:"/api/v1/companies/:shortname/items/:itemPk/availabilities/date/:date/",availabilitiesByResource:"/api/v1/companies/:shortname/items/:itemPk/availabilities/date/:date/resource/:resourcePk/",availabilitiesByTag:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:tag/",availability:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/",availabilityStatus:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/status/",availabilityLiveCapacity:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/live/",availabilityResourceUses:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/resource-uses/",updateItemAvailabilities:"/api/v1/companies/:shortname/items/:itemPk/availabilities/update/",updateAvailabilities:"/api/v1/companies/:shortname/availabilities/update/",availabilityNote:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/note/",availabilityCheckinStatuses:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/checkin-statuses/",availabilityNotificationOptions:"/api/v1/companies/:shortname/availabilities/:availabilityPk/notification-options/",sendConfirmations:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/send-confirmations/",notifications:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/notifications/",smsNotifications:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/sms-notifications/",subjectsBooking:"/api/v1/companies/:shortname/subjects/:type/bookings/:bookingUuid/:language/",subjectsOrder:"/api/v1/companies/:shortname/subjects/:type/orders/:orderUuid/:language/",subjectsAvailability:"/api/v1/companies/:shortname/subjects/:type/availabilities/:availabilityPk/:languages/",customerTypeRates:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/customer-type-rates/",customerTypeRate:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/customer-type-rates/:customerTypeRatePk/",blocks:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/blocks/",block:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/blocks/:blockPk/",rule:"/api/v1/companies/:shortname/items/:itemPk/availabilities/rule/",orders:"/api/v1/companies/:shortname/orders/",order:"/api/v1/companies/:shortname/orders/:orderUuid/",orderPayments:"/api/v1/companies/:shortname/orders/:orderUuid/payments/",orderNotification:"/api/v1/companies/:shortname/orders/:orderUuid/notification/",orderCancellation:"/api/v1/companies/:shortname/orders/:orderUuid/cancel/",book:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/book/",bookings:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/bookings/",booking:"/api/v1/companies/:shortname/bookings/:bookingUuid/",bookingByPk:"/api/v1/companies/:shortname/bookings/:bookingPk/",repriceBooking:"/api/v1/companies/:shortname/bookings/:bookingUuid/reprice/",bookingCheckinStatus:"/api/v1/companies/:shortname/bookings/:bookingUuid/checkin-status/",customerCheckinStatus:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers/:customerPk/checkin-status/",bookingCustomersWithSeatAssignments:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers-with-seat-assignments/",orderCustomersWithSeatAssignments:"/api/v1/companies/:shortname/orders/:orderUuid/customers-with-seat-assignments/",bookingNote:"/api/v1/companies/:shortname/bookings/:bookingUuid/note/",bookingExplicitGross:"/api/v1/companies/:shortname/bookings/:bookingUuid/explicit-gross/",bookingExplicitInvoicePrice:"/api/v1/companies/:shortname/bookings/:bookingUuid/explicit-invoice-price/",bookingNotificationOptions:"/api/v1/companies/:shortname/bookings/:bookingUuid/notification-options/",bookingEffectiveCancellationRule:"/api/v1/companies/:shortname/bookings/:bookingUuid/effective-cancellation-rule/",searchCustomersByEncodedPk:"/embeds/redirect/checkin/:encodedPk/",contact:"/api/v1/companies/:shortname/contacts/:contactPk/",contactBookings:"/api/v1/companies/:shortname/contacts/:contactPk/bookings/",contactPayments:"/api/v1/companies/:shortname/contacts/:contactPk/payments/",affiliation:"/api/v1/companies/:shortname/bookings/:bookingUuid/affiliation/",notification:"/api/v1/companies/:shortname/bookings/:bookingUuid/notification/",smsNotification:"/api/v1/companies/:shortname/bookings/:bookingUuid/sms-notifications/",lineItems:"/api/v1/companies/:shortname/bookings/:bookingUuid/line-items/",lineItem:"/api/v1/companies/:shortname/bookings/:bookingUuid/line-items/:lineItemPk/",customerCustomFieldValue:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers/custom-field-values/:customerCustomFieldValuePk/",bookingCustomFieldValue:"/api/v1/companies/:shortname/bookings/:bookingUuid/custom-field-values/:bookingCustomFieldValuePk/",pushCustomFieldValues:"/api/v1/companies/:shortname/bookings/:bookingUuid/push-custom-field-values/",payments:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/",installmentPayment:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/installment-payment/",orderInstallmentPayment:"/api/v1/companies/:shortname/orders/:orderUuid/payments/order-installment-payment/",relatedPayments:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/related/",authorizationHolds:"/api/v1/companies/:shortname/bookings/:bookingUuid/authorization-holds/",refunds:"/api/v1/companies/:shortname/bookings/:bookingUuid/refunds/",orderRefunds:"/api/v1/companies/:shortname/orders/:orderUuid/refunds/",customRefunds:"/api/v1/companies/:shortname/bookings/:bookingUuid/refunds/custom/",availabilitiesManifest:"/api/v1/companies/:shortname/manifest/availabilities/date/:date/",bookingsManifest:"/api/v1/companies/:shortname/manifest/bookings/date/:date/",runsManifest:"/api/v1/companies/:shortname/manifest/runs/date/:date/",resourcesManifest:"/api/v1/companies/:shortname/manifest/resources/date/:date/",manifestSelectableAvailabilities:"/api/v1/companies/:shortname/manifest/selectable-availabilities/date/:date/",searchAllAvailabilitiesByDate:"/api/v1/companies/:shortname/search/availabilities/date/:date/",searchAvailabilitiesByDate:"/api/v1/companies/:shortname/search/items/:itemPks(pks)/availabilities/date/:date/",searchAvailabilitiesByUpcoming:"/api/v1/companies/:shortname/search/availabilities/upcoming/:filter",searchAvailabilitiesByPk:"/api/v1/companies/:shortname/search/availabilities/:availabilityPks/",searchBookingsByQuery:"/api/v1/companies/:shortname/search/bookings/query/:filter",searchBookingsByNew:"/api/v1/companies/:shortname/search/bookings/new/:filter",searchBookingsByUuid:"/api/v1/companies/:shortname/search/bookings/:bookingUuids/",searchRunsByDate:"/api/v1/companies/:shortname/search/runs/date/:date/",bookingsByContact:"/api/v1/companies/:shortname/search/bookings/contact/:contactPk/",invoices:"/api/v1/companies/:shortname/invoices/",invoice:"/api/v1/companies/:shortname/invoices/:invoicePk/",uuidInvoice:"/api/v1/companies/:shortname/invoices/uuid/:invoiceUuid/",invoiceNotifications:"/api/v1/companies/:shortname/invoices/:invoicePk/notifications/",invoiceUploads:"/api/v1/companies/:shortname/invoices/:invoicePk/uploads/",partnerInvoice:"/api/v1/companies/:shortname/invoices/partner-invoices/:invoicePk/",groups:"/api/v1/companies/:shortname/groups/",group:"/api/v1/companies/:shortname/groups/:groupPk/",duplicateGroup:"/api/v1/companies/:shortname/groups/:groupPk/duplicate/",groupOverrides:"/api/v1/companies/:shortname/group-overrides/",groupOverride:"/api/v1/companies/:shortname/group-overrides/:groupOverridePk/",groupOverrideActivities:"/api/v1/companies/:shortname/group-overrides/:groupOverridePk/activities/",relatedGroupOverrides:"/api/v1/companies/:shortname/group-overrides/related/",reports:"/api/v1/companies/:shortname/reports/",recentReports:"/api/v1/companies/:shortname/reports/recent/",inProgressReports:"/api/v1/companies/:shortname/reports/in-progress/",volumeOverviewReport:"/api/v1/companies/:shortname/reports/volume-overview/",dailyVolumeOverviewReport:"/api/v1/companies/:shortname/reports/daily-volume-overview/",paymentOverviewReport:"/api/v1/companies/:shortname/reports/payment-overview/",itemsSummaryOverviewReport:"/api/v1/companies/:shortname/reports/items-summary-overview/",nextPayoutOverviewReport:"/api/v1/companies/:shortname/reports/next-payout-overview/",report:"/api/v1/companies/:shortname/reports/:reportPk(pk)/",reportObjects:"/api/v1/companies/:shortname/reports/:reportPk(pk)/objects/",reportReports:"/api/v1/companies/:shortname/reports/reports/",reportContacts:"/api/v1/companies/:shortname/reports/contacts/",reportBookings:"/api/v1/companies/:shortname/reports/bookings/",reportInvoiceableBookings:"/api/v1/companies/:shortname/reports/invoiceable-bookings/",reportTest:"/api/v1/companies/:shortname/reports/test/",reportLineItems:"/api/v1/companies/:shortname/reports/line-items/",reportPayments:"/api/v1/companies/:shortname/reports/payments/",reportDisputes:"/api/v1/companies/:shortname/reports/disputes/",reportPayouts:"/api/v1/companies/:shortname/reports/payouts/",reportInvoices:"/api/v1/companies/:shortname/reports/invoices/",reportAccounts:"/api/v1/companies/:shortname/reports/accounts/",reportTransactions:"/api/v1/companies/:shortname/reports/transactions/",reportEscrow:"/api/v1/companies/:shortname/reports/escrow/",reportVolume:"/api/v1/companies/:shortname/reports/volume/",reportCompanies:"/api/v1/companies/:shortname/reports/companies/",reportItemsSummary:"/api/v1/companies/:shortname/reports/summary/items/",reportUsersSummary:"/api/v1/companies/:shortname/reports/summary/users/",reportBookingTypesSummary:"/api/v1/companies/:shortname/reports/summary/booking-types/",reportCustomerTypesSummary:"/api/v1/companies/:shortname/reports/summary/customer-types/",reportCustomFieldSummary:"/api/v1/companies/:shortname/reports/summary/custom-field/",reportLodgingsSummary:"/api/v1/companies/:shortname/reports/summary/lodgings/",reportPickupsSummary:"/api/v1/companies/:shortname/reports/summary/pickups/",reportCrewSummary:"/api/v1/companies/:shortname/reports/summary/crew/",reportAgentsSummary:"/api/v1/companies/:shortname/reports/summary/agents/",reportDesksSummary:"/api/v1/companies/:shortname/reports/summary/desks/",reportCampaignsSummary:"/api/v1/companies/:shortname/reports/summary/campaigns/",reportRevenueSummary:"/api/v1/companies/:shortname/reports/summary/revenue/",reportAdvanced:"/api/v1/companies/:shortname/reports/advanced/",reviewExpressSettings:"/api/v1/companies/:shortname/items/:itemPk/review-express-settings/",picthriveSettings:"/api/v1/companies/:shortname/items/:itemPk/picthrive-settings/",payouts:"/api/v1/companies/:shortname/payouts/",payout:"/api/v1/companies/:shortname/payouts/:payoutPk/",payoutRetry:"/api/v1/companies/:shortname/payouts/:payoutPk/retry/",transfers:"/api/v1/companies/:shortname/transfers/",transfer:"/api/v1/companies/:shortname/transfers/:transferPk/",oneTimeTransfer:"/api/v1/companies/:shortname/one-time-transfer/",upcomingRefundReserveAmounts:"/api/v1/companies/:shortname/upcoming-refund-reserve-amounts/",uploads:"/api/v1/companies/:shortname/uploads/",upload:"/api/v1/companies/:shortname/uploads/:uploadPk/",adjustments:"/api/v1/companies/:shortname/adjustments/",adjustment:"/api/v1/companies/:shortname/adjustments/:adjustmentPk/",waivers:"/api/v1/companies/:shortname/waivers/",waiver:"/api/v1/companies/:shortname/waivers/:waiverPk/",waiverInstance:"/api/v1/companies/:shortname/waiver-instances/:waiverInstancePk/",connectedWaivers:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-waivers/",connectedWaiver:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-waivers/:connectedWaiverPk/",locations:"/api/v1/companies/:shortname/locations/",location:"/api/v1/companies/:shortname/locations/:locationPk/",locationItems:"/api/v1/companies/:shortname/locations/:locationPk/items/",primaryLocation:"/api/v1/companies/:shortname/locations/primary/",totalSchedules:"/api/v1/companies/:shortname/total-schedules/",totalSchedule:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/",totalScheduleAffiliations:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/affiliations/",duplicateTotalSchedule:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/duplicate/",totalScheduleEntries:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/",totalScheduleEntry:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/",totalScheduleEntryRules:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/rules/",totalScheduleEntryRule:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/rules/:totalScheduleEntryRulePk/",invoiceSchedules:"/api/v1/companies/:shortname/invoice-schedules/",invoiceSchedule:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/",invoiceScheduleAffiliations:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/affiliations/",duplicateInvoiceSchedule:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/duplicate/",invoiceScheduleEntries:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/",invoiceScheduleEntry:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/",invoiceScheduleEntryRules:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/rules/",invoiceScheduleEntryRule:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/rules/:invoiceScheduleEntryRulePk/",effectiveSheets:"/api/v1/companies/:shortname/availabilities/:availabilityPk/effective-sheets/",affiliationEffectiveSheets:"/api/v1/companies/:shortname/availabilities/:availabilityPk/affiliations/:affiliationPk/effective-sheets/",rebookingEffectiveSheets:"/api/v1/companies/:shortname/availabilities/:availabilityPk/bookings/:bookingUuid/effective-sheets/",totalScheduleEffectiveSheet:"/api/v1/companies/:shortname/availabilities/:availabilityPk/total-schedules/:totalSchedulePk/effective-sheets/",invoiceScheduleEffectiveSheet:"/api/v1/companies/:shortname/availabilities/:availabilityPk/invoice-schedules/:invoiceSchedulePk/effective-sheets/",totalSheets:"/api/v1/companies/:shortname/total-sheets/",totalSheet:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/",totalSheetSchedules:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/schedules/",totalSheetAffiliations:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/affiliations/",duplicateTotalSheet:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/duplicate/",totalPricing:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/pricing/:objectCls/:objectPk/",totalStack:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/pricing/:objectCls/:objectPk/stack/",invoiceSheets:"/api/v1/companies/:shortname/invoice-sheets/",invoiceSheet:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/",invoiceSheetSchedules:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/schedules/",invoiceSheetAffiliations:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/affiliations/",duplicateInvoiceSheet:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/duplicate/",invoicePricing:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/pricing/:objectCls/:objectPk/",invoiceStack:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/pricing/:objectCls/:objectPk/stack/",resources:"/api/v1/companies/:shortname/resources/",resource:"/api/v1/companies/:shortname/resources/:resourcePk/",resourceItems:"/api/v1/companies/:shortname/resources/:resourcePk/items/",resourceRequirementGroups:"/api/v1/companies/:shortname/resources/:resourcePk/requirement-groups/",resourceAvailabilities:"/api/v1/companies/:shortname/resources/:resourcePk/availabilities/date/:date/",resourceUsesByDate:"/api/v1/companies/:shortname/resources/:resourcePk/resource-uses/:date/",resourceUsesCalendar:"/api/v1/companies/:shortname/resources/:resourcePk/resource-uses/calendar/:year/:month/",resourceUsesUnassignSeats:"/api/v1/companies/:shortname/resource-uses/unassign-seats/",reapplyResourceUses:"/api/v1/companies/:shortname/reapply-resource-uses/",requirementGroups:"/api/v1/companies/:shortname/requirement-groups/",itemRequirementGroups:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/",requirementGroup:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/",duplicateRequirementGroup:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/duplicate/",requirementGroupItems:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/items/",requirements:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/",requirement:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/:requirementPk/",resourceRequirements:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/:requirementPk/resource-requirements/",resourceRequirement:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/:requirementPk/resource-requirements/:resourceRequirementPk/",resourceUse:"/api/v1/companies/:shortname/bookings/:bookingUuid/resource-uses/:resourceUsePk/",resourceOverride:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:resourceOverridePk/",resourceOverrideRule:"/api/v1/companies/:shortname/resources/:resourcePk/resource-override-rule/",resourceOverridesByTag:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:tag/",resourceOverridesByDate:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:date/",seatResourceOverrides:"/api/v1/companies/:shortname/seat-resource-overrides/",seatMaps:"/api/v1/companies/:shortname/seat-maps/",seatMap:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/",duplicateSeatMap:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/duplicate/",seatMapResourceUsesBySeat:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/resource-uses/:startAt/:endAt/",seatMapResourceOverridesBySeat:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/resource-overrides/:startAt/:endAt/",seatMapResources:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/resources/",seatGroups:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-groups/",seatGroup:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-groups/:seatGroupPk/",seatZones:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-zones/",companySeatZones:"/api/v1/companies/:shortname/seat-zones/",seatZone:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-zones/:seatZonePk/",availabilitiesWithResourceRequirements:"/api/v1/companies/:shortname/availabilities/:availabilityPks(pks)/resource-requirements/",seatRequirements:"/api/v1/companies/:shortname/availabilities/:availabilityPk/total-sheets/:totalSheetPk/seat-requirements/",customersWithSeats:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers-with-seats/",resellerCompanies:"/api/v1/companies/:shortname/reseller-companies/",resellerCompany:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/",resellerCompanyMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-company-mappings/",resellerCompanyMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-company-mappings/:resellerCompanyMappingPk/",resellerItems:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/",resellerItem:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/",resellerItemMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-item-mappings/",resellerItemMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-item-mappings/:resellerItemMappingPk",resellerCustomerTypes:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/",resellerCustomerType:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/",resellerCustomerTypeMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/reseller-customer-type-mappings/",resellerCustomerTypeMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/reseller-customer-type-mappings/:resellerCustomerTypeMappingPk/",resellerOptions:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/",resellerOption:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/",resellerOptionMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/reseller-option-mappings/",resellerOptionMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/reseller-option-mappings/:resellerOptionMappingPk/",resellerUnmappedItems:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/unmapped/items/",resellerUnmappedCustomerPrototypes:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/unmapped/customer-prototypes/",resellerKeys:"/api/v1/companies/:shortname/users/:username/reseller-keys/",resellerKey:"/api/v1/companies/:shortname/reseller-keys/:resellerKeyPk/",resellerApps:"/api/v1/companies/:shortname/reseller-apps/",resellerApp:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/",resellerAppRequests:"/api/v1/companies/:shortname/reseller-app-requests/",resellerAppRequest:"/api/v1/companies/:shortname/reseller-app-requests/:resellerAppRequestPk/",resellerAppCompanies:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/reseller-app-companies/",resellerAppCompany:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/reseller-app-companies/:resellerAppCompanyPk",ticketLayouts:"/api/v1/companies/:shortname/ticket-layouts/",ticketLayout:"/api/v1/companies/:shortname/ticket-layouts/:ticketLayoutPk/",analyticsServices:"/api/v1/companies/:shortname/a-services/",analyticsService:"/api/v1/companies/:shortname/a-services/:analyticsServicePk/",cancellationPolicies:"/api/v1/companies/:shortname/cancellation-policies/",cancellationPolicy:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/",cancellationRules:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/cancellation-rules/",cancellationRule:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/cancellation-rules/:cancellationRulePk/",cancellationPolicyAffiliations:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/affiliations/",cancellationPolicyItems:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/items/",bookingRestrictions:"/api/v1/companies/:shortname/booking-restrictions/",bookingRestriction:"/api/v1/companies/:shortname/booking-restrictions/:bookingRestrictionPk/",bookingRestrictionItems:"/api/v1/companies/:shortname/booking-restrictions/:bookingRestrictionPk/items/",paymentProcessingDocument:"/api/v1/companies/:shortname/payment-processing/document/:paymentProcessingDocumentPk/",persistentStore:"/api/v1/persistence/:identifier/",persistentStoreForCompany:"/api/v1/persistence/:identifier/:shortname/",persistentStoreItem:"/api/v1/persistence/:identifier/:shortname/:key/",taskResult:"/api/v1/task-result/:taskId/",version:"/api/v1/version/",token:"/api/v1/queuing/items/:itemPk/refresh/",isItemQueued:"/api/v1/queuing/items/:itemPk/is-queued/",view:"/api/v1/view/:objectType/:objectIdentifier/"}};return a}]),e.run(["$rootScope","urls",function(e,t){e.urls=t}])}()},3842:function(e){var t=function(){function e(e){return{newPos:e.newPos,components:e.components.slice(0)}}function t(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}var n=function(e){this.ignoreWhitespace=e};n.prototype={diff:function(t,n){if(n===t)return[{value:n}];if(!n)return[{value:t,removed:!0}];if(!t)return[{value:n,added:!0}];n=this.tokenize(n),t=this.tokenize(t);var r=n.length,i=t.length,a=r+i,o=[{newPos:-1,components:[]}],s=this.extractCommon(o[0],n,t,0);if(o[0].newPos+1>=r&&s+1>=i)return o[0].components;for(var c=1;c<=a;c++)for(var l=-1*c;l<=c;l+=2){var u,d=o[l-1],m=o[l+1];s=(m?m.newPos:0)-l,d&&(o[l-1]=void 0);var p=d&&d.newPos+1<r,f=m&&0<=s&&s<i;if(p||f){if(!p||f&&d.newPos<m.newPos?(u=e(m),this.pushComponent(u.components,t[s],void 0,!0)):((u=e(d)).newPos++,this.pushComponent(u.components,n[u.newPos],!0,void 0)),s=this.extractCommon(u,n,t,l),u.newPos+1>=r&&s+1>=i)return u.components;o[l]=u}else o[l]=void 0}},pushComponent:function(e,t,n,r){var i=e[e.length-1];i&&i.added===n&&i.removed===r?e[e.length-1]={value:this.join(i.value,t),added:n,removed:r}:e.push({value:t,added:n,removed:r})},extractCommon:function(e,t,n,r){for(var i=t.length,a=n.length,o=e.newPos,s=o-r;o+1<i&&s+1<a&&this.equals(t[o+1],n[s+1]);)o++,s++,this.pushComponent(e.components,t[o],void 0,void 0);return e.newPos=o,s},equals:function(e,t){var n=/\S/;return!(!this.ignoreWhitespace||n.test(e)||n.test(t))||e===t},join:function(e,t){return e+t},tokenize:function(e){return e}};var r=new n,i=new n(!0),a=new n;i.tokenize=a.tokenize=function(e){return t(e.split(/(\s+|\b)/))};var o=new n(!0);o.tokenize=function(e){return t(e.split(/([{}:;,]|\s+)/))};var s=new n;return s.tokenize=function(e){for(var t=[],n=e.split(/^/m),r=0;r<n.length;r++){var i=n[r],a=n[r-1];"\n"==i&&a&&"\r"===a[a.length-1]?t[t.length-1]+="\n":i&&t.push(i)}return t},{Diff:n,diffChars:function(e,t){return r.diff(e,t)},diffWords:function(e,t){return i.diff(e,t)},diffWordsWithSpace:function(e,t){return a.diff(e,t)},diffLines:function(e,t){return s.diff(e,t)},diffCss:function(e,t){return o.diff(e,t)},createPatch:function(e,t,n,r,i){var a=[];a.push("Index: "+e),a.push("==================================================================="),a.push("--- "+e+(void 0===r?"":"\t"+r)),a.push("+++ "+e+(void 0===i?"":"\t"+i));var o=s.diff(t,n);function c(e){return e.map((function(e){return" "+e}))}function l(e,t,n){var r=o[o.length-2],i=t===o.length-2,a=t===o.length-3&&(n.added!==r.added||n.removed!==r.removed);/\n$/.test(n.value)||!i&&!a||e.push("\\ No newline at end of file")}o[o.length-1].value||o.pop(),o.push({value:"",lines:[]});for(var u=0,d=0,m=[],p=1,f=1,h=0;h<o.length;h++){var g=o[h],y=g.lines||g.value.replace(/\n$/,"").split("\n");if(g.lines=y,g.added||g.removed){if(!u){var v=o[h-1];u=p,d=f,v&&(u-=(m=c(v.lines.slice(-4))).length,d-=m.length)}m.push.apply(m,y.map((function(e){return(g.added?"+":"-")+e}))),l(m,h,g),g.added?f+=y.length:p+=y.length}else{if(u)if(y.length<=8&&h<o.length-2)m.push.apply(m,c(y));else{var T=Math.min(y.length,4);a.push("@@ -"+u+","+(p-u+T)+" +"+d+","+(f-d+T)+" @@"),a.push.apply(a,m),a.push.apply(a,c(y.slice(0,T))),y.length<=4&&l(a,h,g),u=0,d=0,m=[]}p+=y.length,f+=y.length}}return a.join("\n")+"\n"},applyPatch:function(e,t){for(var n=t.split("\n"),r=[],i=!1,a=!1,o="I"===n[0][0]?4:0;o<n.length;o++)if("@"===n[o][0]){var s=n[o].split(/@@ -(\d+),(\d+) \+(\d+),(\d+) @@/);r.unshift({start:s[3],oldlength:s[2],oldlines:[],newlength:s[4],newlines:[]})}else"+"===n[o][0]?r[0].newlines.push(n[o].substr(1)):"-"===n[o][0]?r[0].oldlines.push(n[o].substr(1)):" "===n[o][0]?(r[0].newlines.push(n[o].substr(1)),r[0].oldlines.push(n[o].substr(1))):"\\"===n[o][0]&&("+"===n[o-1][0]?i=!0:"-"===n[o-1][0]&&(a=!0));var c=e.split("\n");for(o=r.length-1;o>=0;o--){for(var l=r[o],u=0;u<l.oldlength;u++)if(c[l.start-1+u]!==l.oldlines[u])return!1;Array.prototype.splice.apply(c,[l.start-1,+l.oldlength].concat(l.newlines))}if(i)for(;!c[c.length-1];)c.pop();else a&&c.push("");return c.join("\n")},convertChangesToXML:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];r.added?t.push("<ins>"):r.removed&&t.push("<del>"),t.push(r.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")),r.added?t.push("</ins>"):r.removed&&t.push("</del>")}return t.join("")},convertChangesToDMP:function(e){for(var t,n=[],r=0;r<e.length;r++)t=e[r],n.push([t.added?1:t.removed?-1:0,t.value]);return n}}}();e.exports=t}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}!function(){"use strict";n(4477),n(5038),n(9813);var e,t,r=n(3842);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}(e=angular.module("lib.services",["flash.services","lib.factories","lib.filters","lib.models","lib.processors","ngSanitize","ngCookies"])).factory("sessionStorage",[function(){var e=function(){var e={};return{get:function(t){var n=e[t];if(!_.isUndefined(n))return _.parseJSON(n)},set:function(t,n){e[t]=_.stringifyJSON(n)},del:function(t){delete e[t]},clear:function(){e={}}}},t=e();return t.create=e,t}]),e.factory("storage",["$window","sessionStorage",function(e,t){var n,r=function(){try{return window.localStorage.setItem("$test","$test"),window.localStorage.removeItem("$test"),!0}catch(e){return!1}}();return r?(n={key:function(t){try{return e.localStorage.key(t)}catch(e){}},get:function(t){try{var n=e.localStorage.getItem(t);if(!_.isString(n))return;return _.parseJSON(n)}catch(e){}},set:function(t,n){try{e.localStorage.setItem(t,_.stringifyJSON(n))}catch(e){}},del:function(t){try{e.localStorage.removeItem(t)}catch(e){}},clear:function(){try{e.localStorage.clear()}catch(e){}}},Object.defineProperty(n,"length",{get:function(){try{return e.localStorage.length}catch(e){return 0}},configurable:!1,enumerable:!1})):n=t.create(),n.isPersistent=function(){return r},n}]),e.factory("persistentStorage",["$q","$rootScope","clientOptions","db","events","navigation","require","storage",function(e,t,n,r,i,a,o,s){var c="persistentStorageIdentifier";if(!_.isValidUuid(n.userIdentifier)){var l=s.get(c);n.userIdentifier=_.isValidUuid(l)?l:_.uuid()}s.set(c,n.userIdentifier),console.log("persistentStorage: identified user:",n.userIdentifier);var u=function(e){o.notNull(a.currentCompany,"shortname","persistentStorage needs currentCompany");var t={identifier:n.userIdentifier,shortname:a.currentCompany.shortname};return e&&(t.key=e),t},d={getIdentifier:function(){return n.userIdentifier},setIdentifier:function(e){s.set(c,e),n.userIdentifier=e,console.log("persistentStorage: re-identified user:",e),i.broadcast("persistentStorage.reIdentifiedUser")},regenerateIdentifier:function(){d.setIdentifier(_.uuid())},get:function(e){var t=u(e),n=r.persistentStoreItem(t);return n.$promise.then((function(e){return n}))},set:function(e,t){var n=u(e),i=r.persistentStoreItem.update(n,t);return i.$promise.then((function(){return i}))},del:function(e){var t=u(e);return r.persistentStoreItem.remove(t).$promise},clear:function(){var e=u();return r.persistentStoreForCompany.remove(e).$promise},getForAllCompanies:function(e){var t=r.persistentStore({identifier:n.userIdentifier});return t.$promise.then((function(){var n={};return _.forEach(t,(function(t){n[t.company.shortname]={company:t.company},n[t.company.shortname][e]=t[e]})),n}))}};return i.on(t,"auth.logout",d.regenerateIdentifier),i.on(t,"auth.login",d.regenerateIdentifier),d}]),e.factory("translate",["$rootScope","$window","db",function(e,t,n){var r,i={isReady:!1,initialize:function(e){i.isReady?function(e,n){r?e.append(r):(r=$('<div id="google-translate"></div>'),e.append(r),new t.google.translate.TranslateElement({pageLanguage:"en"},r[0]))}(e):console.warn("translate: attempting to initialize before load")}};return n.slipstream("isAnonymous")&&function n(r){if(r<=0)console.warn("translate: failed to load Google Translate");else{if(!t.google||!t.google.translate||!t.google.translate.TranslateElement)return console.info("translate: not yet loaded, retrying..."),void setTimeout(_.bind(n,_,r-1),1e3);console.info("translate: loaded"),e.$apply((function(){i.isReady=!0}))}}(3),i}]),e.factory("postBook",["$filter","auth","navigation","require",function(e,t,n,r){return{startBooking:function(e){console.log("postBook: start booking",e),t.sessionStorage.set("postBook.path",e)},stopBooking:function(i){r.assert(i,"postBook: expected booking");var a=e("bookingUrl")(i),o=t.sessionStorage.get("postBook.path");if(t.sessionStorage.del("postBook.path"),console.log("postBook: stop booking",i,a,o),!o)return a;var s=n.parseMultiUrl(a);if(!s)return a;if(0!==o.indexOf(s.path))return a;var c={};return c[s.key]=s.multiPath,_.extend(c,s.search),n.extendQuery(o,c)}}}]),e.constant("showdown",window.showdown),e.factory("markdownConverter",["$sanitize","showdown",function(e,t){var n=new t.Converter({simpleLineBreaks:!0,noHeaderId:!0,openLinksInNewWindow:!0});return{makeHtml:function(t){if(!t)return"";try{var r=_.escape(t);r=_.replaceAll(r,"&gt;",">"),r=_.replaceAll(r,"&#96;","`");var i=n.makeHtml(r);return e(i)}catch(e){return console.error("markdownConverter.makeHtml:",e),""}}}}]),e.constant("Mailcheck",window.Mailcheck),e.constant("moment",window.moment),e.constant("Pikaday",window.Pikaday),e.constant("QRCode",window.QRCode),e.constant("Sentry",window.Sentry),e.factory("filepicker",(function(){return window.filepicker||null})),e.factory("fileuploader",["$q","$window",function(e,t){var n={},r=window.filepicker;return n.upload=function(){var n=e.defer();return r.pickAndStore({mimetypes:["image/*","application/*","text/*"],services:["COMPUTER","WEBCAM","FACEBOOK","INSTAGRAM","URL"]},{location:"S3"},(function(e){var r=e?_.first(e):"";if(r.url){var i=function(e){return e.replace(t.slipstream.remoteFileDomain,t.slipstream.remoteFileCdnDomain)}(r.url),a=r.mimetype||"",o=r.filename||"attachment",s=a.match(/^image\/\S+$/);n.resolve({url:i,fileName:o,isImage:s})}else n.reject()}),(function(e){e&&101===e.code?n.resolve():n.reject()})),n.promise},n.uploadAsMarkdown=function(){return n.upload().then((function(e){return e?(t=e.url,n=e.fileName,e.isImage?"!["+T("Description of image")+"]("+t+")":"["+T("View")+" "+n+"]("+t+")"):"";var t,n}))},n}]),e.factory("diff",(function(){return r})),e.factory("exporter",["$q","$rootScope","$timeout","$window","filepicker",function(e,t,n,r,i){var a=document.createElement("a"),o="download"in a&&"Blob"in window;return{exportToCsvFile:function(s,c,l){(l=l||{}).mediaType="text/csv";var u=function(e){var t="\ufeff";return _.forEach(e,(function(e){var n=_.map(e,(function(e){return _.isUndefined(e)?e="":_.isString(e)&&(e='"'+(e=(e=(e=(e=e.replace(/^\s+|\s+$/g,"")).replace(/\s+/g," ")).replace(/,$/,"")).replace(/"/g,'""'))+'"'),e}));t+=n.join(",")+"\n"})),t}(s);return function(s,c,l){l=l||{};var u=e.defer();if(o)n((function(){var e=new Blob([s],{type:l.mediaType}),t=URL.createObjectURL(e);a.setAttribute("href",t),a.setAttribute("download",c),document.body.appendChild(a),a.click(),document.body.removeChild(a),u.resolve()}),0,!1);else if(l.openWindow){var d=encodeURIComponent(s);window.open("data:"+l.mediaType+";charset=utf-8,"+d),u.resolve()}else{if(!i||i._queue)return u.reject(),u.promise;(function(n,r,a){var o=e.defer();return i.store(n,{filename:r,mimetype:"application/octet-stream"},(function(e){t.$safeApply((function(){o.resolve(e.url)}))}),(function(){t.$safeApply((function(){o.reject()}))})),o.promise})(s,c).then((function(e){r.location.href=e,u.resolve()}),(function(){u.reject()}))}return u.promise}(u,c,l)},isDownloadSupported:o}}]),e.factory("xmessage",["$window","db",function(e,t){return{broadcast:function(n,r,i){var a={type:n};_.extend(a,r),i=i||"*";var o="";try{o=_.stringifyJSON(a),t.slipstream("isDebug")&&console.info("xmessage: broadcast",o),e.parent.postMessage(o,i)}catch(e){console.error("xmessage: unable to broadcast",o)}},on:function(n,r,i,a){a=a||"*";var o=function(e){try{var n=_.parseJSON(e.data);if(!_.isObject(n))return;if(t.slipstream("isDebug")&&console.info("xmessage: on",n),!r||n.type!==r)return;if("*"!==a&&(!a||a!==n.origin))return;i(n.data)}catch(e){}};e.addEventListener("message",o);var s=function(){e.removeEventListener("message",o)};return n.$on("$destroy",(function(){s()})),s}}}]),e.factory("events",["$rootScope",function(e){return{on:function(e,t,n){return e.$on(t,n)},broadcast:function(){e.$broadcast.apply(e,arguments)}}}]),e.factory("require",(function(){var e=function(e,t){return e="require: "+e,t?e+" ("+t+")":e};return{assert:function(t,n){if(!t)throw new Error(e("expected '"+t+"' to be true",n))},assertDefined:function(t,n){if(_.isUndefined(t))throw new Error(e("expected '"+t+"' to be defined",n))},notNull:function(t,n,r){if(null===t[n])throw new Error(e("expected '"+n+"' not to be null",r))},defined:function(t,n,r){if(_.isUndefined(t[n]))throw new Error(e("expected '"+n+"' to be defined",r))},unDefined:function(t,n,r){if(!_.isUndefined(t[n]))throw new Error(e("expected '"+n+"' to be undefined",r))},inScope:function(t,n,r){if(_.isUndefined(_.getDotted(t,n)))throw new Error(e("expected '"+n+"' to be in scope",r))},notInScope:function(t,n,r){if(!_.isUndefined(t[n]))throw new Error(e("expected '"+n+"' not to be in scope",r))}}})),e.provider("convert",["moment",function(e){var t=/_([a-z0-9])/g,n=function(e){return"/"===(e=e||"")[0]?e:e.replace(t,(function(e,t){return t.toUpperCase()}))},r=function t(n,r){if(!n)return null;var i=e(n,"YYYY-MM-DDTHH:mm:ssZZ",!0);if(i.isValid())return i;if((i=e(n,"YYYY-MM-DDTHH:mm:ss",!0)).isValid())return i;if((i=e(n,"YYYY-MM-DD",!0)).isValid())return i;if(3===n.split("-")[0].length)return console.warn("convert: date has a 3-digit year; please fix.",r,n),t(n="0".concat(n),r);throw new Error("convert: invalid date "+r+": "+n)},i=/_at$/,a=function e(t){if(_.isArray(t))for(var a=0,o=t.length;a<o;a++)e(t[a]);else if(_.isObject(t))for(var s in t)if(t.hasOwnProperty(s)){var c=t[s];delete t[s];var l=n(s);i.test(s)||"at"===s?t[l]=r(c,l):t[l]=e(c)}return t},o=function(e,t,n){return t+"_"+n.toLowerCase()},s=/([a-z])([A-Z0-9])/g,c=/([0-9])([a-zA-Z])/g,l=function(e){return(e=e.replace(s,o)).replace(c,o)},u=function t(n){var r;if(e.isMoment(n))r=n.format();else{if(_.isDate(n))throw new Error("convert: expected moment, not date "+n);if(_.isArray(n)){r=[];for(var i=0,a=n.length;i<a;i++)r.push(t(n[i]))}else if(_.isObject(n))for(var o in r={},n)o&&n.hasOwnProperty(o)&&"$"!==o[0]&&(r[l(o)]=t(n[o]));else r=n}return r},d=function(e,t,n){return t+" "+n},m=function(e,t){return e=(e=(e=(e=e.toString()).replace(s,d)).replace(c,d)).replace(/-/g," "),_[t?"titleize":"capitalize"](e.toLowerCase())};this.serverResponse=a,this.clientRequest=u,this.$get=function(){return{serverResponse:a,clientRequest:u,camelKey:n,unCamelKey:l,humanize:m}}}]),e.factory("shortcutsOverlay",["$rootScope","auth","db","events",function(e,t,n,r){var i,a={isShowing:!1,shouldConfirmClose:!1,show:function(){a.isShowing=!0},hide:function(){a.isShowing=!1},confirmClose:function(e){a.shouldConfirmClose=e}};return r.on(e,"navigation.company.updated",(function(e,r){if(!n.slipstream("isDebug")){var o=r.company;o&&i!==o&&(i=o,o.adminNotes&&t.permissions.canAdminUpdate(o)&&a.show())}})),a}]),e.factory("shortcuts",["$document","auth","d",function(e,t,n){var r=[],i={delete:8,tab:9,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},a=function(e,t){for(var n=e.length,r=0;r<n;r++)i[e[r]]=t+r};a("1234567890",49),a("abcdefghijklmnopqrstuvwxyz",65);var o={};_.forEach(i,(function(e,t){o[e]=t}));var s={shift:"shift",ctrl:"ctrl",meta:"meta",alt:"alt"};return e.on("keydown",(function(e){if(t.currentUser.isAuthenticated){var a=$(e.target);if(!n.isTextInput(a)&&!a.is(".js-disable-shortcuts, select"))for(var s,c,l,u=function(e){var t={};return t.keyCode=i[o[e.which]],t.meta=e.metaKey||!1,t.alt=e.altKey||!1,t.ctrl=e.ctrlKey||!1,t.shift=e.shiftKey||!1,t}(e),d=r.length-1;d>=0;d--)if(c=u,l=(s=r[d]).keys,c&&l&&c.keyCode===l.keyCode&&c.ctrl===l.ctrl&&c.alt===l.alt&&c.meta===l.meta&&c.shift===l.shift)return e.preventDefault(),void s.action()}})),{shortcuts:r,register:function(e){var t,n;if(e.keys=(t=e.keySet.split("+"),n={},_.forEach(s,(function(e){n[e]=!1})),_.forEach(t,(function(e){var t=s[e];if(t)n[t]=!0;else if(n.keyCode=i[e],!n.keyCode)return})),n),e.keys)return r.push(e),e},unregister:function(e){_.overwriteWithout(r,e)}}}]),e.factory("toggles",["$document","$rootScope",function(e,t){$("html").on("click",(function(r){var i=$(r.target);i.closest("[ng-toggle], [ng-toggled], [ng-toggled-show]").length||$.contains(e[0].documentElement,r.target)&&(i.closest(".select2-container, .pika-select").length||t.$apply((function(){_.forEach(n.toggles,(function(e,t){!e.autoClose||e.group&&!e.isCloseableGroup||(e.state=!1)}))})))}));var n={toggles:{},create:function(e,r){var i=n.toggles[e];if(i)return i.state=r.defaultState||i.state||!1,void(i.count+=1);i={autoClose:r.autoClose||!1,state:r.defaultState||!1,group:r.group||null,isCloseableGroup:r.isCloseableGroup||!1,when:r.when||_.always,count:1},n.toggles[e]=i,i.group&&(i.deregisterGroupWatch=t.$watch((function(){return i.state}),(function(e){e&&_.forEach(n.toggles,(function(e,t){i!==e&&i.group===e.group&&(e.state=!1)}))})))},destroy:function(e){var t=n.toggles[e];t?(t.count-=1,t.count||(t.deregisterGroupWatch&&t.deregisterGroupWatch(),delete n.toggles[e])):console.warn("invalid toggle",e)},toggle:function(e,t){var r=n.toggles[e];r?r.when()?(t=_.isUndefined(t)?!r.state:!!t,r.group?r.isCloseableGroup?r.state=t:r.state=!0:r.state=t):console.info("toggles: disabled toggle",e):console.warn("toggles: invalid toggle",e)},state:function(e){var t=n.toggles[e];return!!t&&t.state},closeAll:function(){_.forEach(n.toggles,(function(e){e.state=!1}))}};return n}]),angular.module("lib.services.interpolate",[]).provider("$interpolate",[function(){var e="{{",t="}}",n="{!",r="!}";this.startSymbol=function(t){return t?(e=t,this):e},this.endSymbol=function(e){return e?(t=e,this):t},this.staticStartSymbol=function(e){return e?(n=e,this):n},this.staticEndSymbol=function(e){return e?(r=e,this):r},this.$get=["$parse","$exceptionHandler","$sce",function(a,o,s){var c=e.length,l=t.length,u=n.length,d=r.length,m=function(o,m,p){for(var f,h,g,y,v,T,E=0,_=[],b=o.length,C=!1,k=[];E<b;)-1!=(f=o.indexOf(e,E))&&-1!=(h=o.indexOf(t,f+c))?(E!=f&&_.push(o.substring(E,f)),_.push({fn:a(g=o.substring(f+c,h)),exp:g,static:!1}),E=h+l,C=!0):-1!=(f=o.indexOf(n,E))&&-1!=(h=o.indexOf(r,f+u))?(E!=f&&_.push(o.substring(E,f)),_.push({fn:a(g=o.substring(f+u,h)),exp:g,static:!0}),E=h+d,C=!0):(E!=b&&_.push(o.substring(E)),E=b);(b=_.length)||(_.push(""),b=1);var A=p===s.URL||p===s.MEDIA_URL;if(p&&!A&&_.length>1)throw console.error("$interpolate: error while interpolating SCE violation",_),new Error("$interpolate: error while interpolating: SCE violation");if(!m||C)return k.length=b,(T=function(e){if(void 0!==T.values[e.$id])return T.values[e.$id];try{for(var t,n=0,r=0,a=b;r<a;r++)"object"===i(t=_[r])?(y=t.fn(e),y=p?s.getTrusted(p,y):s.valueOf(y),v=i(y),null===y||"undefined"===v?y="":"number"===v?y=""+y:"string"!==v&&(y=angular.toJson(y)),t.static||n++):y=t,k[r]=y;var c=k.join("");return n||(T.values[e.$id]=c),c}catch(e){console.error("unable to interpolate",o,"error",e)}}).exp=o,T.parts=_,T.values={},T};return m.startSymbol=function(){return e},m.endSymbol=function(){return t},m.staticStartSymbol=function(){return n},m.staticEndSymbol=function(){return r},m}]}]),e.factory("selectedItems",["navigation",function(e){return{extendUrl:function(t,n){if(n.length){var r={"selected-items":_.pluck(n,"pk").join(",")};return e.compose(t,r)}return t}}}]),e.factory("parseAttrsForScope",["$parse",function(e){return function(t,n,r,i){var a={},o=_.isString(i)?function(e){return i+_.capitalize(e.slice(0,1))+e.slice(1)}:function(e){return e};return _.forEach(r,(function(r,i){var s=o(i);"@"===r?a[i]=t[s]:"="===r?a[i]=n.$eval(t[s]):"&"===r&&(a[i]=e(t[s]).bind(null,n))})),a}}]),e.factory("tableHeaders",["$parse",function(e){return{parsePredicate:function(t,n,r,i){i=i||"$row";var a=_.choose(n.split(";"),(function(t){if(t)return e(t)})),o=_.map(a,(function(e,r){return function(r){var a={};a[i]=r;var o=e(t,a);return moment.isMoment(o)&&(o=o.unix()),_.isUndefined(o)?(console.warn("ng-table-header: predicate returned undefined",n,r),0):o}}));return 1===o.length&&(o=o[0]),o.source=n,o.isDefault=r||!1,o}}}]),e.factory("autoExport",["$filter","$q","$timeout","exporter","flash",function(e,t,n,r,i){var a=e("stripNewlines"),o=function e(t){return _.map(t.contents(),(function(t){var n=$(t);return 3===t.nodeType?n.text():n.is(":visible")&&!n.is("[ng-auto-export-skip]")?e(n):void 0})).join(" ")},s=function(e){return e=_.isUndefined(e)?1:e,_.map(_.range(e),_.constant(""))},c=function(e,t){var n=t.rowSelector?t.rowSelector:t.isCSS?"> .thead > .tr, > .tbody > .tr, > .tfoot > .tr":"> thead > tr, > tbody > tr, > tfoot > tr",r=t.cellSelector?t.cellSelector:t.isCSS?"> .td, > .th":"> td, > th",i=e.data().ngAutoExportSkip;if(!i||!i()){var c=[];return _.forEach(e.find(n),(function(e){var t,n=$(e);if(!(t=n.data().ngAutoExportSkip)||!t()){var i=[];_.forEach(n.find(r),(function(e){var t,n=$(e),r=n.data();if(!(t=r.ngAutoExportSkip)||!t()){var c,l;c=(l=r.ngAutoExportValue)?l():o(n),i.push(a(c).trim().replace(/‑/g,"-"));var u=n.prop("colspan");u=u?parseInt(u,10):1,_.ref.append(i,s(u-1))}})),c.push(i)}})),{rows:c}}},l={},u={status:"ready",ready:function(){return"ready"===u.status||"error"===u.status},autoExport:function(e,a,o){if(e=e||"default",a=a||e,u.ready()){var d=l[e]||[];if(d.length){var m=function(){u.status="error",i.error("Error exporting "+a)};u.status="processing",n((function(){var e=[];try{var n=[];_.forEach(d,(function(r){if(r.process){var i=r.process(),a=t.when(i);return n.push(a),void a.then((function(t){t&&e.push({rows:t})}))}var o=r.tableSelector?r.tableSelector:r.isCSS?".table":"table",s=r.element;s.is(o)||(s=s.find(o)),_.forEach(s,(function(t){var n=c($(t),r);n&&e.push(n)}))})),t.all(n).then((function(){var t=function(e){if(e&&e.length){if(1===e.length)return e[0];var t={rows:e[0].rows,filename:e[0].filename};return _.forEach(_.rest(e),(function(e){t.rows.push(s()),_.ref.append(t.rows,e.rows)})),t}console.warn("autoExport: no exports found")}(e);t?(u.status="exporting",r.exportToCsvFile(t.rows,a,o).then((function(){u.status="ready"}),m)):u.status="ready"}))}catch(e){m(),console.error("Error exporting",e)}}),0,!1)}else console.warn("autoExport: no exports")}else console.warn("autoExport: not ready")},addExport:function(e,t,n){var r=l[e=e||"default"]=l[e]||[],i={element:t,namespace:e};return _.extend(i,n||{}),r.push(i),i},removeExport:function(e){var t=l[e.namespace]=l[e.namespace]||[];_.ref.remove(t,e)},isDownloadSupported:r.isDownloadSupported,canExport:function(e){return!!l[e]&&l[e].length>0}};return u}]),e.factory("scrollbar",[function(){var e={width:null,getWidth:function(){if(null!==e.width)return e.width;var t=document.createElement("p");t.style.width="100%",t.style.height="200px";var n=document.createElement("div");n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.visibility="hidden",n.style.width="200px",n.style.height="150px",n.style.overflow="hidden",n.appendChild(t),document.body.appendChild(n);var r=t.offsetWidth;n.style.overflow="scroll";var i=t.offsetWidth;return r==i&&(i=n.clientWidth),document.body.removeChild(n),e.width=Math.max(r-i,0),e.width}};return e}]),e.factory("scroll",["$window",function(e){return{scrollTo:function(t,n,r,i){if(t){"top"===t&&(t="body");var a=!n;n=n||"html,body";var o=$(t),s=$(n);if(o.length&&s.length){var c=Math.min.apply(Math,_.map(o,(function(e){return $(e).offset().top||0}))),l=_.chooseFirst(s,(function(e){var t=$(e).scrollTop();if(t)return t}))||0,u=_.chooseFirst(s,(function(e){if(e.scrollHeight)return e.scrollHeight}))||0,d=Math.min.apply(Math,_.choose(s,(function(e){var t=$(e).height();if(t)return t})));a&&(d=Math.min(d,e.innerHeight));var m,p=Math.max(0,u-d),f=Math.abs(c-l)<1;c<0?(m=15,c=0):f?m=c-15:c>p&&(m=p-15,c=p),p&&(!i||_.isUndefined(m)?r?s.stop().animate({scrollTop:c},500,"swing"):s.scrollTop(c):s.stop().animate({scrollTop:m},250,"swing").animate({scrollTop:c},250,"swing"))}}}}}]),e.factory("dateUtils",["moment","models",function(e,t){var n=/^\d\d:\d\d$/,r="YYYY-MM-DD-HH-mm-ss",i="YYYY-MM-DD",a=e("1900-01-01",i),o=function(t){return _.isUndefined(t)?e():e().tz(t)},s=function(e,t){return function(n){return[o(n).subtract(1,e+"s").startOf(e),t?o(n).subtract(1,e+"s"):o(n).subtract(1,e+"s").endOf(e)]}},c=function(e,t){return function(n){return[o(n).startOf(e),t?o(n):o(n).endOf(e)]}},l=function(e){return function(t){return[o(t).add(1,e+"s").startOf(e),o(t).add(1,e+"s").endOf(e)]}},u=function(e){return function(t){return[o(t).startOf("day"),o(t).add(e-1,"days").endOf("day")]}},d=function(e){return function(t){return[o(t).subtract(e-1,"days").startOf("day"),o(t).endOf("day")]}},m=t.Report,p={};p[m.TODAY_DATE_RANGE]=c("day"),p[m.THIS_WEEK_DATE_RANGE]=c("week"),p[m.THIS_WEEK_TO_DATE_DATE_RANGE]=c("week",!0),p[m.THIS_MONTH_DATE_RANGE]=c("month"),p[m.THIS_MONTH_TO_DATE_DATE_RANGE]=c("month",!0),p[m.THIS_QUARTER_DATE_RANGE]=c("quarter"),p[m.THIS_QUARTER_TO_DATE_DATE_RANGE]=c("quarter",!0),p[m.THIS_YEAR_DATE_RANGE]=c("year"),p[m.THIS_YEAR_TO_DATE_DATE_RANGE]=c("year",!0),p[m.REMAINING_THIS_YEAR_DATE_RANGE]=function(e){return[o(e).startOf("day"),o(e).endOf("year")]},p[m.YESTERDAY_DATE_RANGE]=s("day"),p[m.LAST_WEEK_DATE_RANGE]=s("week"),p[m.LAST_WEEK_TO_DATE_DATE_RANGE]=s("week",!0),p[m.LAST_MONTH_DATE_RANGE]=s("month"),p[m.LAST_MONTH_TO_DATE_DATE_RANGE]=s("month",!0),p[m.LAST_QUARTER_DATE_RANGE]=s("quarter"),p[m.LAST_QUARTER_TO_DATE_DATE_RANGE]=s("quarter",!0),p[m.LAST_YEAR_DATE_RANGE]=s("year"),p[m.LAST_YEAR_TO_DATE_DATE_RANGE]=s("year",!0),p[m.TOMORROW_DATE_RANGE]=l("day"),p[m.NEXT_WEEK_DATE_RANGE]=l("week"),p[m.NEXT_MONTH_DATE_RANGE]=l("month"),p[m.NEXT_YEAR_DATE_RANGE]=l("year"),p[m.LAST_SEVEN_DAYS_DATE_RANGE]=d(7),p[m.LAST_THIRTY_DAYS_DATE_RANGE]=d(30),p[m.NEXT_SEVEN_DAYS_DATE_RANGE]=u(7),p[m.NEXT_THIRTY_DAYS_DATE_RANGE]=u(30),p[m.ALL_TIME_DATE_RANGE]=function(e){return[o(e).startOf("year").year(1),o(e).endOf("year").year(9990)]};var f={};f[m.THIS_WEEK_DATE_RANGE]=[!0,!0],f[m.THIS_WEEK_TO_DATE_DATE_RANGE]=[!0,!1],f[m.LAST_WEEK_DATE_RANGE]=[!0,!0],f[m.LAST_WEEK_TO_DATE_DATE_RANGE]=[!0,!1],f[m.NEXT_WEEK_DATE_RANGE]=[!0,!0];var h={DATE_RANGES:p,dateRange:function(e,t){var n=p[e];n||(n=p[m.TODAY_DATE_RANGE]);var r=n(t.timezone);if(!t.features.isSundayBased){var i=f[e];i&&_.forEach(i,(function(e,t){e&&r[t].add(1,"days")}))}return r},isInvertedRange:function(t){if(!t[0]||!t[1])return!1;var r=n.test(t[0]),i=r?"HH:mm":null;if(r&&"00:00"===t[1])return!1;var a=e(t[0],i),o=e(t[1],i);return a.isValid()&&o.isValid()&&a>o},isValidDates:function(t){return!(e(t[0],i)<a||e(t[1],i)<a)},formatMoment:function(e){return e.format(r)},formatTimeRange:function(e){return h.formatMoment(e.startAt)+"/"+h.formatMoment(e.endAt)},parseTimeRange:function(t){var n=_.split(t,"/");return{startAt:e(n[0],r),endAt:e(n[1],r),formatted:t}},overlapsWith:function(e,t){return function(n){return e.startAt<n.endAt&&n.startAt<e.endAt||!!t&&n.startAt.isSame(n.endAt)&&n.startAt.isSame(e.startAt)}}};return h}]),e.factory("searchTerms",[function(){return{}}]),e.factory("flows",["$q","availabilityCalendarController","cache","clientOptions","db","models","navigation","require","urls",function(e,t,n,r,i,a,o,s,c){var l,u=a.FlowNode,d=o.getPks("selected-items"),m=function(e,t){var n=i.defaultFlowPage({shortname:e});n.$promise.then((function(){t.resolve(),p.initialFlowNode=n.flowNode}),t.reject)},p={wrapEndpoint:function(e,t){return function(n,r,a,o,s){o=o||{},d.length&&(o.selectedItems=d.join(",")),t||(o.isPage=!0),(s=s||{}).ignoreQueryParamsInCacheUri=!0,s.sideKeys=["emptyPageItems"];var c=e(n,r,a,o,s);return c.$promise.then((function(e){var n,r;e!==i.CANCELLED&&(n=t?e.primaryData.flowNode:e.primaryData,r=e.emptyPageItems,!n.children.length&&r&&(n.emptyPageChildren=_.map(r,(function(e){return{cls:u.cls,uri:"",pk:null,company:n.company,type:u.ITEM_TYPE,parent:n,item:e,properties:{},unicode:e.unicode}}))))})),c}},isNoFlow:function(){return p.initialFlowNode===u.NO_FLOW},currentFlowNodePk:function(){var e=o.get(u.FLOW_QUERY);return"no"!==e&&(e?_.int(e):null)},currentFlowNodeUrl:function(e,t){var n,r=p.currentFlowNodePk();if(!1===r)return null;if(r){var i=e.features.isFlowDateViewEnabled?c.company.flowNode.date.index:c.company.flowNode.calendar;return n=t?i:c.company.flowNode.index,c.populate(n,{flowNodePk:r,shortname:e.shortname})}var a=e.features.isFlowDateViewEnabled?c.company.items.date.index:c.company.items.calendar;return n=t?a:c.company.items.index,e.$url(n)},currentFlowNodeFromCache:function(e){s.assert(p.initialFlowNode,"flows must be initialized");var t=p.currentFlowNodePk();if(t){var r={shortname:e,flowNodePk:t},a=c.populate(c.api.flowNode,r),o=n.cache[a];return o&&o.breadcrumbs||(o=i.flowNode(r)),o}return p.initialFlowNode},initialFlowNode:void 0,initialItemBindings:void 0,initialize:function(t){if(l)return console.log("flows: already initialized"),l;var n=e.defer();l=n.promise;var r=p.currentFlowNodePk();if(!1===r){var a=o.pathStartsWith(c.company.item.index);if(a)return p.initialItemBindings=a,p.initialFlowNode=u.NO_FLOW,n.resolve(),l;o.clear(u.FLOW_QUERY,!0)}if(o.get(u.IS_FROM_CART_QUERY)){var s=[];s.push(i.defaultFlowPage({shortname:t}).$promise),r&&!p.isOnFlowNodePage()&&s.push(i.flowNode({shortname:t,flowNodePk:r}).$promise),e.all(s).then((function(e){p.initialFlowNode=e[0].primaryData.flowNode,n.resolve()}),n.reject)}else if(r){var d=i.flowNode({shortname:t,flowNodePk:r});d.$promise.then((function(){p.initialFlowNode=d,n.resolve()}),(function(e){o.clear(u.FLOW_QUERY,!0),m(t,n)}))}else m(t,n);return l},initialUrl:function(){return s.assert(p.initialFlowNode,"flows must be initialized"),p.initialFlowNode===u.NO_FLOW?c.populate(c.company.item.index,p.initialItemBindings):p.initialFlowNode.$url(c.company.flowNode.index)},extendWithFlow:function(e){var t=u.FLOW_QUERY,n=o.get(t);if(_.isUndefined(n))return e;var r={};return r[t]=n,o.compose(e,r,!0)},endpointParams:function(e){var t={shortname:e.company.shortname},n={allowGrouped:"yes",bookableOnly:r.isBookableOnly?"yes":"no"};return e.childrenCount>0?n.flow=e.pk:d.length&&(t.itemPks=d.join(",")),{params:t,queryParams:n}},calendarController:function(e,n,r){var a=i.company.calendar,o=p.endpointParams(n);return o.itemPks&&(a=i.items.calendar),r.params=_.extend({},r.params,o.params),r.queryParams=_.extend({},r.queryParams,o.queryParams),t(e,_.extend({url:r.url,company:n.company,endpoint:a},r))},isOnInitialFlowNode:function(){s.assert(p.initialFlowNode,"flows must be initialized");var e=p.currentFlowNodePk();return null===e||e===p.initialFlowNode.pk},isOnFlowNodePage:function(){return!!(o.pathEquals(c.company.items.index)||o.pathStartsWith(c.company.items.calendar)||o.pathStartsWith(c.company.items.date.index))},backToCartUrl:function(){var e,t={};return t[u.IS_FROM_CART_QUERY]="",e=p.isNoFlow()?o.currentCompany.$url(c.embeds.book.cart.index):p.initialFlowNode.$url(c.embeds.book.cart.flowNode),o.compose(e,t)}};return p}]),e.factory("poller",["$timeout","$q","db","flash",function(e,t,n,r){var i=[1,1,1,1,1,2,2,3,3,4,4,5,5,10],a=function t(n){var i=this;if(!i.isCancelled)if(!i.result||i.result.isInProgress){n=n||0;var a=i.pollIntervals[Math.min(n,i.pollIntervals.length-1)];a*=1e3,i.result=i.endpoint(i.params,i.payload),i.request=i.result.$promise,i.request.then((function(r){i.status="success",i.isCancelled||(i.result.isInProgress?(i.request=e(_.bind(t,i,n+1),a,i.request),i.request.cancel=function(){e.cancel(i.request)}):i.deferred.resolve(i.result))}),(function(e){i.status="success",i.cancel();var t=e.data.errorMessage;r.error(i.errorMessage+(t?"("+t+")":"")),i.deferred.reject(e)}))}else i.deferred.resolve(i.result)};return function(e){var n=t.defer();return{endpoint:e.endpoint,params:e.params||{},payload:e.payload||{},errorMessage:e.errorMessage||"",isComplete:e.isComplete||_.constant(!0),status:"initial",isCancelled:!1,request:null,result:null,deferred:n,pollIntervals:e.pollIntervals||i,poll:function(){return this.isCancelled=!1,a.apply(this),this},cancel:function(){return this.isCancelled=!0,this.request&&this.request.cancel(),this.request=null,this},$promise:n.promise}}}]),e.factory("ratelimit",["$q","require",function(e,t){var n=1e3,r=0,i=[],a=0,o=!1,s=function e(){o=!1;var t=_.slice(i,0,20);_.forEach(t,(function(e){e()})),(i=_.rest(i,20)).length>0&&(o=!0,_.delay(e,n)),a=Date.now()};return function(c){return function(){var l=_.toArray(arguments),u=Date.now()-a>n;if(u&&(r=0),++r<=20){a=Date.now();var d=c.apply(null,l);return t.assert(_.isPromise(d),"expected promise"),d}console.log("ratelimit: queuing fn:",c);var m=e.defer();return i.push((function(){var e=c.apply(null,l);return t.assert(_.isPromise(e),"expected promise"),e.then(m.resolve,m.reject),e})),o||(o=!0,_.delay(s,n)),m.promise}}}]),e.run(["$rootScope","flows","searchTerms","shortcutsOverlay","toggles","translate",function(e,t,n,r,i,a){e.toggles=i,e.translate=a,e.searchTerms=n,e.shortcutsOverlay=r,e.flows=t}]),n(1916),n(4981),n(9895),angular.module("lib",["lib.controllers","lib.directives","lib.filters","lib.factories","lib.services","lib.services.interpolate"]),n(305),n(8784),n(6270),angular.module("auth",["auth.controllers","auth.directives","auth.services"]),n(9407),angular.module("cache",["cache.services"]),n(7405),n(8145),angular.module("db",["db.services"]),n(7253),angular.module("clientOptions",["clientOptions.services"]),n(1073),n(9619),angular.module("lightframe",["lightframe.services"]),n(3986),n(6146),angular.module("tracking",["tracking.directives","tracking.services"]),n(4802),angular.module("urls",["urls.services"]),n(7828),angular.module("native",["native.services"]),n(5564),n(9919),angular.module("navigation",["navigation.services","navigation.directives"]),t=angular.module("embeds.cart",["lib","auth","cache","cart","clientOptions","db","flash","lightframe","native","navigation","tracking","urls"]),configure(t),t.controller("embeds.cart.IndexCtrl",["$scope","cart","events","lightframe","navigation","xmessage",function(e,t,n,r,i,a){var o,s=12e4;e.indexCtrl={carts:[],cartEntriesTotal:0};var c=function(){e.indexCtrl.cartEntriesTotal=0,e.indexCtrl.carts=_.filter(t.allCompanies.carts,(function(t){return e.indexCtrl.cartEntriesTotal+=t.entries.length,!!t.entries.length}));var n=e.indexCtrl.carts.length?"fareharbor.cart.show":"fareharbor.cart.hide";a.broadcast(n),o=moment()},l=function(){t.allCompanies.load().then(c)};l(),a.on(e,"fareharbor.cart.changed",l),a.on(e,"fareharbor.window.focused",_.debounce(l,1e4,{leading:!0,trailing:!1})),setInterval((function(){(!o||moment().diff(o)>=s)&&l()}),s),e.indexCtrl.selectedCart=null,e.viewCart=function(n){if(n=n||e.indexCtrl.selectedCart){var a=t.permalinkUrl(n.company);a=i.compose(a,{"from-embed":"cart"}),r.open(a),e.indexCtrl.selectedCart=null}},e.hide=function(){a.broadcast("fareharbor.cart.hide")}}])}()}();;